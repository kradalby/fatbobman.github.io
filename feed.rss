<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content"><channel><title>è‚˜å­çš„Swiftè®°äº‹æœ¬</title><description>å¾æ¨çš„ä¸ªäººåšå®¢,Core Data,Swift,Swift UI,Combine,å¥åº·ç¬”è®°,iOS APP,Health Note,HealthNotes</description><link>http://www.fatbobman.com</link><language>zh</language><lastBuildDate>Sat, 30 Jan 2021 21:54:40 +0800</lastBuildDate><pubDate>Sat, 30 Jan 2021 21:54:40 +0800</pubDate><ttl>250</ttl><atom:link href="http://www.fatbobman.com/feed.rss" rel="self" type="application/rss+xml"/><item><guid isPermaLink="true">http://www.fatbobman.com/posts/publish-1</guid><title>ç”¨Publishåˆ›å»ºåšå®¢ï¼ˆä¸€ï¼‰â€”â€”å…¥é—¨</title><description>Publishæ˜¯ä¸€æ¬¾ä¸“é—¨ä¸ºSwiftå¼€å‘è€…æ‰“é€ çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ã€‚å®ƒä½¿ç”¨Swiftæ„å»ºæ•´ä¸ªç½‘ç«™ï¼Œå¹¶æ”¯æŒä¸»é¢˜ã€æ’ä»¶å’Œå…¶ä»–å¤§é‡çš„å®šåˆ¶é€‰é¡¹ã€‚ æœ¬æ–‡åŒ…å«Publishçš„å¿«é€Ÿä½¿ç”¨å…¥é—¨ä»¥åŠåŸºæœ¬ç»“æ„è¯´æ˜ã€‚</description><link>http://www.fatbobman.com/posts/publish-1</link><pubDate>Sat, 30 Jan 2021 21:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p><a href="https://github.com/JohnSundell/Publish">Publish</a>æ˜¯ä¸€æ¬¾ä¸“é—¨ä¸ºSwiftå¼€å‘è€…æ‰“é€ çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ã€‚å®ƒä½¿ç”¨Swiftæ„å»ºæ•´ä¸ªç½‘ç«™ï¼Œå¹¶æ”¯æŒä¸»é¢˜ã€æ’ä»¶å’Œå…¶ä»–å¤§é‡çš„å®šåˆ¶é€‰é¡¹ã€‚ ä½œä¸ºSwiftå¼€å‘è€…ï¼Œé€šè¿‡Publishåˆ›å»ºç«™ç‚¹çš„å¼€å‘è¿‡ç¨‹å’Œä½“éªŒåŒå¼€å‘å…¶ä»–ç¨‹åºå¾ˆç±»ä¼¼ã€‚</p></blockquote><h2>å¼€ç¯‡</h2><h3>å¼€å‘è€…John Sundell</h3><p>Publishçš„å¼€å‘è€…John Sundellè¿™äº›å¹´ä¸€ç›´è‡´åŠ›äºå‘è¡¨å…³äºSwiftçš„é«˜è´¨é‡æ–‡ç« ã€æ’­å®¢å’Œè§†é¢‘ã€‚ä»–çš„ä½œå“å¤§å¤šéƒ½å‘å¸ƒåœ¨å…¶ç‹¬ç«‹è¿è¥çš„ <a href="https://swiftbysundell.com/">Swift by Sundell</a>ä¸Šã€‚ä»–å¼€å‘äº†<a href="https://github.com/JohnSundell/Publish">Publish</a>ç”¨ä»¥åˆ›å»ºå¹¶ç®¡ç†è‡ªå·±çš„ç«™ç‚¹ã€‚</p><p>åœ¨å¼€å‘Publishçš„è¿‡ç¨‹ä¸­ï¼Œä»–è¿˜å¼€æºäº†å…¶ä»–å¤§é‡çš„åŸºæœ¬åº“ï¼Œæ¯”å¦‚<a href="https://github.com/JohnSundell/Ink">Ink</a>ï¼ˆé«˜æ•ˆçš„Markdownè§£æå™¨ï¼‰ã€<a href="https://github.com/JohnSundell/Plot">Plot</a>ï¼ˆåˆ›å»ºHTMLã€XMLã€RSSçš„DSLï¼‰ã€<a href="https://github.com/JohnSundell/Sweep">Sweep</a>ï¼ˆé«˜æ•ˆçš„å­—ç¬¦ä¸²æ‰«æåº“ï¼‰ã€<a href="https://github.com/JohnSundell/Codextended">Codextended</a>ï¼ˆCodableå¢å¼ºï¼‰ç­‰ã€‚å®ƒä»¬ä¸ä»…ä¸€èµ·æ„å»ºäº†å¼ºå¤§çš„Publishï¼Œå¹¶ä¸”åœ¨å„è‡ªçš„é¢†åŸŸä¹Ÿæ˜¯æä¸ºå‡ºè‰²çš„å¼€æºåº“ã€‚</p><h3>æˆ‘ä¸ºä»€ä¹ˆä½¿ç”¨Publish</h3><p>æˆ‘åœ¨ä¸€å¹´å‰æ¢å¤è‡ªå·±çš„è¿™ä¸ªåšå®¢æ—¶ä½¿ç”¨çš„æ˜¯<code>Hexo</code>ã€‚Hexoåœ¨å›½å†…æœ‰éå¸¸å¥½çš„ç¾¤ä¼—åŸºç¡€ï¼Œç½‘ä¸Šæœ‰å¤§é‡ä¼˜ç§€çš„æ•™ç¨‹ï¼Œä¹Ÿæœ‰éå¸¸å¤šçš„å¼€å‘è€…è´¡çŒ®äº†è‡ªå·±åˆ›ä½œçš„å„ç§ä¸»é¢˜å’Œæ’ä»¶ã€‚å°½ç®¡Hexoè®©æˆ‘ç›¸å½“æ»¡æ„ï¼Œä½†ç”±äºæˆ‘ä¸»è¦ä½¿ç”¨çš„è¯­è¨€æ˜¯Swiftï¼Œä¸”å¯¹JavaScriptéå¸¸ä¸ç†Ÿæ‚‰ï¼Œå› æ­¤æƒ³è¦å¯¹Hexoåšæ›´æ·±å…¥çš„å®šåˆ¶æˆ–ä¿®æ”¹å¾ˆå›°éš¾ã€‚</p><p>ä½œä¸ºå¼€å‘è€…ï¼ˆå³ä½¿æ˜¯ä¸šä½™çš„ï¼‰ï¼Œæ€»å¸Œæœ›å¯¹è‡ªå·±çš„é¡¹ç›®æœ‰æ›´å…¨é¢çš„æŒæ§ï¼Œå› æ­¤å®Œå…¨ç”±Swiftå¼€å‘çš„Publishå°±æˆä¸ºäº†æˆ‘çš„é¦–é€‰ã€‚</p><p>éšç€ä½¿ç”¨Publishå¯¹<a href="https://www.fatbobman.com">è‚˜å­çš„Swiftè®°äº‹æœ¬</a>é‡å»ºè¿‡ç¨‹çš„æ·±å…¥ï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±åšå‡ºäº†æ­£ç¡®çš„é€‰æ‹©ã€‚Publishè®©æˆ‘å¯ä»¥ç”¨å¼€å‘æ™®é€šappçš„æ€è·¯å’Œé€»è¾‘æ¥åˆ›å»ºç«™ç‚¹ï¼Œé«˜æ•ˆåœ°å®Œæˆæˆ‘æƒ³è¦çš„å„ç§å®šåˆ¶å’Œæ”¹åŠ¨ã€‚</p><h3>å†™æœ¬æ–‡çš„åŸå› </h3><p>æˆªè‡³è½ç¬”æ—¶ï¼ŒPublishå·²ç»åœ¨Githubä¸Šè·å¾—äº†3.1Kçš„å¥½è¯„ã€‚ä½†ç½‘ç»œä¸Šå¯¹Publishçš„ä»‹ç»å¹¶ä¸å¤šï¼Œå°¤å…¶æ¬ ç¼ºå…³äºæ¨¡æ¿å®šåˆ¶ã€æ’ä»¶å¼€å‘æ–¹é¢çš„èµ„æ–™å’Œäº¤æµã€‚åœ¨Githubä¸Šæœç´¢ç›¸å…³çš„æ’ä»¶å’Œæ¨¡æ¿çš„ç»“æœæ•°é‡ä¹Ÿéå¸¸æœ‰é™ã€‚</p><p>é€ æˆä¸Šè¿°çš„æƒ…å†µå›ºç„¶æœ‰Publishè¯ç”Ÿæ—¶é—´è¾ƒçŸ­ã€ä½¿ç”¨é‡ä¸å¤§ï¼ŒSwiftåœˆå­è¾ƒå°ç­‰åŸå› ï¼Œä½†æˆ‘è®¤ä¸ºä¸‹é¢çš„æƒ…å†µä¹ŸåŠ å‰§äº†è¿™ä¸€å±€é¢çš„å½¢æˆï¼šç”±äºä¸åŒäºå…¶ä»–çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œåœ¨Publishé¡¹ç›®ä¸­ï¼Œå¼€å‘è€…å¯ä»¥ç”¨çŸ­å°çš„ä»£ç å®ç°å„ç§åŠŸèƒ½ã€‚è¿™ç§ç¢ç‰‡åŒ–çš„ä»£ç å…¶å®æ˜¯ä¸åˆ©äºåˆ†äº«ä¸”å¹¶ä¸å®¹æ˜“è¢«æœç´¢ï¼›å¦å¤–ï¼Œç”±äºPublishä¸­çš„æ¨¡æ¿å’Œç½‘ç«™çš„åŠŸèƒ½å…·ä½“å®ç°ç»‘å®šçš„è¾ƒæ·±ï¼Œå•ç‹¬åˆ†äº«çš„æ¨¡æ¿çš„åˆ©ç”¨åº¦ä¹Ÿè¾ƒä½ã€‚</p><blockquote><p>ä½†Publishçš„è¿™ç§ç‰¹è´¨ä¹Ÿæ°æ°æ˜¯å…¶å¸å¼•äººä¹‹å¤„ã€‚</p></blockquote><p>æœ‰é‰´äºæ­¤ï¼Œæˆ‘å°†ç”¨ä¸‰ç¯‡æ–‡ç« ï¼ˆå…¥é—¨ã€å¦‚ä½•å†™æ¨¡æ¿ã€å¦‚ä½•å†™æ’ä»¶ï¼‰å®Œæˆå¯¹Publishçš„ç®€ç»ï¼Œä¹Ÿå¸Œæœ›å›½å†…çš„Swiftå¼€å‘è€…æˆ–çˆ±å¥½è€…ä»¬å¯ä»¥æ›´å¤šçš„äº†è§£å’Œä½¿ç”¨è¿™ä¸ªä¼˜ç§€çš„å·¥å…·ã€‚</p><p>ä¸ºäº†è®©å¤§å®¶èƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ï¼Œæˆ‘å·²å°†æœ¬ç«™ç‚¹æ‰€ç”¨çš„ä»£ç ï¼ˆåŒ…æ‹¬æ¨¡æ¿ã€è‡ªå®šä¹‰æ’ä»¶ç­‰ï¼‰æ”¾ç½®åœ¨<a href="https://github.com/fatbobman/PublishThemeForFatbobmanBlog">Github</a>ä¸Šï¼Œæ–¹ä¾¿å¤§å®¶é€šè¿‡ä»£ç æ›´å¿«çš„äº†è§£å’ŒæŒæ¡Publishã€‚</p><h2>å¿«é€Ÿä½¿ç”¨å…¥é—¨</h2><h3>å¦‚ä½•å®‰è£…Publish</h3><p>åŒå¤§é‡çš„å…¶ä»–é™æ€ç½‘ç«™ç”Ÿæˆå™¨ä¸€æ ·ï¼ŒPublishæä¾›äº†CLIã€‚ä½ å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå¿«é€Ÿçš„å®Œæˆåˆ›å»ºæ¨¡æ¿ã€å†…å®¹æ›´æ–°ã€è¿œç¨‹å‘å¸ƒç­‰ä¸€ç³»åˆ—æ“ä½œã€‚Publishç›®å‰å¯ä»¥è¿è¡Œåœ¨Macå’ŒLinuxä¸Šï¼Œç”±äºå…¶ä»£ç å¯¹æ“ä½œç³»ç»Ÿçš„ä¾å­˜åº¦æä½ï¼Œä¼°è®¡å…¶åä¹Ÿå‡ºç°åœ¨Windowså¹³å°ä¸Šã€‚</p><h4>Macä¸‹é€šè¿‡brewå®‰è£…</h4><pre data-language="bash"><code><span class="hljs-variable">$brew</span> install publish
</code></pre><h4>æºä»£ç å®‰è£…</h4><pre data-language="bash"><code><span class="hljs-variable">$git</span> <span class="hljs-built_in">clone</span> https://github.com/JohnSundell/Publish.git
<span class="hljs-variable">$cd</span> Publish
<span class="hljs-variable">$make</span>
</code></pre><h3>åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªé¡¹ç›®</h3><p>è®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„Blogé¡¹ç›®</p><pre data-language="bash"><code><span class="hljs-variable">$mkdir</span> myblog
<span class="hljs-variable">$cd</span> myblog
<span class="hljs-variable">$publish</span> new
</code></pre><p>Publishå°†åœ¨myblogç›®å½•ä¸­åˆ›å»ºæˆ‘ä»¬æ‰€éœ€çš„é¡¹ç›®æ¨¡æ¿ã€‚å®ƒçš„åŸºæœ¬æ„æˆå¤§æ¦‚å¦‚ä¸‹ï¼š</p><pre data-language="undefined"><code>
|-- myblog
|   |-- Content
|           |â€“â€“ posts
|                 |â€“â€“ first-post.md
|                 |â€“â€“ index.md
|           |â€“â€“ index.md
|   |-- Resources
|   |-- Sources
|           |â€“â€“ Myblog
|                  |â€“â€“ main.swift
</code></pre><ul><li>Content</li></ul><p>åœ¨æ­¤æ”¾å…¥ä½ è¦åœ¨ç½‘ç«™å‘å¸ƒçš„æ–‡ç« ã€é¡µé¢ç­‰ä½¿ç”¨markdownç¼–å†™çš„æ–‡ä»¶ã€‚</p><ul><li>Resources</li></ul><p>é¡¹ç›®ä¸»é¢˜éœ€è¦çš„ä¸€äº›èµ„æºï¼Œæ¯”å¦‚cssï¼Œå›¾ç‰‡ç­‰ï¼Œç›®å‰ä¸ºç©ºã€‚åœ¨ä½ è¿›è¡Œç¬¬ä¸€å‘å¸ƒåï¼Œå¯ä»¥çœ‹åˆ°å®ƒåŒ…å«äº†é»˜è®¤çš„FoundationThemeçš„styles.cssæ–‡ä»¶ã€‚</p><ul><li>Source</li></ul><p>æè¿°ç½‘ç«™çš„ä»£ç ã€‚åœ¨<code>main.swift</code>ä¸­å®šä¹‰äº†ç½‘ç«™çš„åŸºæœ¬å±æ€§ã€åˆ›å»ºå·¥ä½œæµç­‰ã€‚</p><h3>ç¼–è¯‘åŠè¿è¡Œ</h3><p>Swiftæ˜¯ç¼–è¯‘å‹è¯­è¨€ï¼Œå› æ­¤ä½ çš„ç«™ç‚¹çš„ä»£ç åœ¨æ¯æ¬¡ä¿®æ”¹ä¹‹åï¼Œéƒ½éœ€åœ¨æœ¬æœºç¼–è¯‘å¹¶è¿è¡Œæ‰èƒ½å®Œæˆå†…å®¹çš„ç”Ÿæˆå·¥ä½œï¼Œå¥½åœ¨è¿™ä¸€åˆ‡éƒ½åªéœ€è¦ä¸€æ¡å‘½ä»¤ã€‚</p><p>æˆ‘ä»¬è®©Publishå®Œæˆä¸Šè¿°å·¥ä½œå¹¶å¯åŠ¨å†…ç½®çš„Web Serverä¾›æˆ‘ä»¬æµè§ˆæ–°åˆ›å»ºçš„é¡¹ç›®ã€‚</p><pre data-language="bash"><code><span class="hljs-variable">$publish</span> run
</code></pre><p>ç¬¬ä¸€æ¬¡è¿è¡Œï¼ŒPublishä¼šè‡ªåŠ¨ä»Githubä¸Šè·å–æ‰€éœ€çš„å…¶ä»–åº“ï¼Œè¯·ç¨ç­‰å‡ åˆ†é’Ÿã€‚</p><pre data-language="bash"><code>$ publish run
............
Publishing Myblog (6 steps)
[1/6] Copy <span class="hljs-string">'Resources'</span> files
[2/6] Add Markdown files from <span class="hljs-string">'Content'</span> folder
[3/6] Sort items
[4/6] Generate HTML
[5/6] Generate RSS feed
[6/6] Generate site map
âœ… Successfully published Myblog
ğŸŒ Starting web server at http://localhost:8000

Press ENTER to stop the server and <span class="hljs-built_in">exit</span>
</code></pre><p>ç°åœ¨ä½ å°±å¯ä»¥ç”¨æµè§ˆå™¨è®¿é—® http://localhost:8000 æ¥è®¿é—®ä½ çš„æ–°ç«™ç‚¹äº†ã€‚</p><p>ç½‘ç«™çš„å…¨éƒ¨å†…å®¹éƒ½è¢«ç”Ÿæˆå¹¶æ”¾ç½®åœ¨äº†<code>Output</code>ç›®å½•ä¸‹ã€‚ä½ åªéœ€è¦å°†å…¶ä¸­çš„å†…å®¹ä¸Šä¼ åˆ°ä½ çš„æœåŠ¡å™¨ï¼Œæˆ–è€…é€šè¿‡ç®€å•çš„é…ç½®ï¼Œæ¯”å¦‚ï¼š</p><pre data-language="swift"><code>.unwrap(.gitHub(<span class="hljs-string">"fatbobman/fatbobman.github.io"</span>, useSSH: <span class="hljs-literal">true</span>), <span class="hljs-type">PublishingStep</span>.deploy)
</code></pre><p>ç„¶åä½¿ç”¨</p><pre data-language="bash"><code><span class="hljs-variable">$publish</span> deploy
</code></pre><p>ä¾¿å¯å°†å†…å®¹å‘å¸ƒåˆ°ä½ çš„github.ioä¸Šï¼ˆå…·ä½“é…ç½®åé¢è¯´æ˜ï¼‰ã€‚</p><p>æ­¤æ—¶ä½ åœ¨<code>Content</code> - <code>posts</code>ä¸­æ·»åŠ å¦‚ä¸‹æ–‡ä»¶<code>second-post.md</code></p><pre data-language="undefined"><code>
---
date: 2021-01-29 19:58
description: æˆ‘çš„ç¬¬äºŒç¯‡æ–‡ç« 
tags: publish,swift 
---
# Hello Wolrd
</code></pre><p>å†åº¦æ‰§è¡Œ <code>publish run</code> ä¾¿å¯ä»¥çœ‹åˆ°æ–°æ–‡ç« å·²ç»å‡ºç°åœ¨é¡µé¢ä¸Šäº†ã€‚</p><h3>ä½¿ç”¨æˆ‘æä¾›çš„æ¨¡æ¿å¿«é€Ÿä¸Šæ‰‹</h3><p>é¦–å…ˆè¦ç¡®ä¿å·²ç»å®‰è£…äº†Publish CLI</p><pre data-language="bash"><code><span class="hljs-variable">$git</span> <span class="hljs-built_in">clone</span> https://github.com/fatbobman/PublishThemeForFatbobmanBlog.git
<span class="hljs-variable">$cd</span> PublishThemeForFatbobmanBlog
<span class="hljs-variable">$publish</span> run
</code></pre><h2>æ›´å¤šå…³äºPublishçš„çŸ¥è¯†</h2><p>æœ¬èŠ‚çš„å†…å®¹å°†ä»‹ç»å‡ ä¸ªPublishä¸­çš„æ¦‚å¿µï¼Œå¯¹äºåé¢äº†è§£æ¨¡æ¿å®šåˆ¶å’ŒåŠŸèƒ½æ‰©å±•ååˆ†é‡è¦ã€‚</p><h3>Site</h3><p>å½“ä½ ä½¿ç”¨Publishæ¥åˆ›å»ºé¡¹ç›®æ—¶ï¼ŒPublishä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<code>Swift Package</code>ã€‚ç½‘ç«™çš„ç”Ÿæˆå’Œéƒ¨ç½²é…ç½®éƒ½æ˜¯é€šè¿‡è¯¥åŒ…å®Œæˆçš„ï¼Œä½¿ç”¨çš„éƒ½æ˜¯åŸç”Ÿçš„ä¸”ç±»å‹å®‰å…¨çš„Swiftä»£ç ã€‚</p><p>ä¸‹é¢çš„ä»£ç ä¾¿æ˜¯ä½¿ç”¨<code>publish new myblog</code>ç”Ÿæˆçš„<code>main.swift</code>ï¼ˆåŒ…çš„å…¥å£æ–‡ä»¶ï¼‰ä¸­å†…å®¹ã€‚</p><pre data-language="swift"><code><span class="hljs-comment">//Siteçš„å®šä¹‰</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Myblog</span>: <span class="hljs-title">Website</span> </span>{
    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SectionID</span>: <span class="hljs-title">String</span>, <span class="hljs-title">WebsiteSectionID</span> </span>{
        <span class="hljs-comment">// æ·»åŠ ä½ éœ€è¦çš„Section</span>
        <span class="hljs-keyword">case</span> posts
    }

    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ItemMetadata</span>: <span class="hljs-title">WebsiteItemMetadata</span> </span>{
        <span class="hljs-comment">// åœ¨è¿™é‡Œæ·»åŠ ä»»ä½•æ‚¨æƒ³ä½¿ç”¨çš„ç‰¹å®šç«™ç‚¹å…ƒæ•°æ®</span>
    }

    <span class="hljs-comment">// ä½ ç½‘ç«™çš„ä¸€äº›é…ç½®xn'xi</span>
    <span class="hljs-keyword">var</span> url = <span class="hljs-type">URL</span>(string: <span class="hljs-string">"https://your-website-url.com"</span>)!
    <span class="hljs-keyword">var</span> name = <span class="hljs-string">"Myblog"</span>
    <span class="hljs-keyword">var</span> description = <span class="hljs-string">"A description of Myblog"</span>
    <span class="hljs-keyword">var</span> language: <span class="hljs-type">Language</span> { .english }
    <span class="hljs-keyword">var</span> imagePath: <span class="hljs-type">Path?</span> { <span class="hljs-literal">nil</span> }
}
<span class="hljs-comment">//å¯ä»¥åœ¨æ¨¡æ¿æˆ–æ’ä»¶ç­‰ä½ç½®è®¿é—®Siteä¸­çš„å±æ€§ä¿¡æ¯</span>

<span class="hljs-comment">// æ‰§è¡Œå…¥å£ã€‚å½“å‰ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„æ¨¡æ¿ï¼Œä¸”ä½¿ç”¨çš„æ˜¯Publishé¢„ç½®çš„ç”Ÿæˆã€å¯¼å‡ºã€å‘å¸ƒæµç¨‹ã€‚</span>
<span class="hljs-comment">// å·¥ä½œæµçš„å®šä¹‰ï¼Œæ›´å¤šå†…å®¹è§Step</span>
<span class="hljs-keyword">try</span> <span class="hljs-type">Myblog</span>().publish(withTheme: .foundation)
</code></pre><p><code>Site</code>ä¸ä»…å®šä¹‰äº†ç½‘ç«™é¡¹ç›®çš„åŸºç¡€é…ç½®ä¿¡æ¯ï¼Œè€Œä¸”å®šä¹‰äº†ç½‘ç«™ä»ç”Ÿæˆåˆ°å‘å¸ƒçš„å·¥ä½œæµç¨‹ã€‚</p><h3>Section</h3><p>æ¯ä¸ªSectionéƒ½ä¼šåœ¨<code>Output</code>ä¸‹ç”Ÿæˆçš„ä¸€ä¸ªå­ç›®å½•ã€‚åœ¨main.swiftä¸­ï¼Œé€šè¿‡æšä¸¾çš„æ–¹å¼å¯¹<code>Section</code>è¿›è¡Œå®šä¹‰ã€‚ä½ å¯ä»¥æŠŠSectionå¯ä»¥ä½œä¸ºä¸€ç»„<code>Item</code>ï¼ˆæ–‡ç« ï¼‰çš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥ä»…æŒ‡å‘æŸä¸ª<code>Page</code>ï¼ˆéItemçš„è‡ªæœ‰é¡µé¢ï¼‰ã€‚ å½“éœ€è¦ä½¿ç”¨<code>Section</code>ç®¡ç†ä¸€ç»„æ–‡ç« æ—¶ï¼Œåªéœ€è¦åœ¨<code>Content</code>ç›®å½•ä¸‹åˆ›å»ºåŒè¯¥<code>Section</code>åå­—ç›¸åŒçš„å­ç›®å½•å³å¯ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹èŒƒä¾‹ä¸­<code>Content</code>ä¸‹çš„<code>posts</code>å’Œ<code>project</code>ã€‚</p><p><code>Section</code>çš„å®šä¹‰</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SectionID</span>: <span class="hljs-title">String</span>, <span class="hljs-title">WebsiteSectionID</span> </span>{
     <span class="hljs-keyword">case</span> posts <span class="hljs-comment">//æ–°åˆ›å»ºçš„é¡¹ç›®ç¼ºçœåªæœ‰è¿™ä¸ªï¼Œå¯¹åº”content-postsç›®å½•</span>
     <span class="hljs-keyword">case</span> links <span class="hljs-comment">//å¯ä»¥è‡ªå·±æ·»åŠ ï¼Œå°†å±äºè¯¥sectionçš„æ–‡ç« æ”¾ç½®åˆ°å¯¹åº”çš„ç›®å½•å³å¯</span>
     <span class="hljs-keyword">case</span> about
}
</code></pre><p>åœ¨<a href="http://www.fatbobman.com">è‚˜å­çš„Swiftè®°äº‹æœ¬</a>ä¸­ï¼Œæ¯ä¸ªSectionåŒæ—¶ä¹Ÿå¯¹åº”ç€ä¸Šæ–¹å¯¼èˆªåŒºçš„ä¸€ä¸ªé€‰é¡¹ã€‚<code>Section</code>å¯ä»¥æœ‰å¤šç§ç”¨é€”ï¼Œåœ¨æ¨¡æ¿å®šåˆ¶ç« èŠ‚ä¼šåšæ›´å¤šæ¢è®¨ã€‚</p><h3>Item</h3><p>ä¿å­˜åœ¨<code>Content--å¯¹åº”Sectioin</code>ç›®å½•ä¸­çš„æ–‡ç« ã€‚æ¯ä¸ª<code>Item</code>éƒ½å¯¹åº”ä¸€ä¸ª<code>Section</code>ï¼Œæ— éœ€ç‰¹åˆ«è®¾ç½®ï¼Œå…¶ä¿å­˜åœ¨å“ªä¸ª<code>Section</code>çš„ç›®å½•ä¸­ï¼Œå°±å±äºå“ªä¸ª<code>Section</code>ã€‚å¦‚æœè¯¥<code>Section</code>ä¸éœ€è¦ä½œä¸ºæ–‡ä»¶å®¹å™¨ï¼Œå¯ä»¥ç›´æ¥åœ¨<code>Content</code>ä¸­åˆ›å»ºå’Œ<code>Section</code>åŒåçš„mdæ–‡ä»¶ã€‚æˆ‘æä¾›çš„èŒƒä¾‹æ¨¡æ¿ä¸­ï¼Œ<code>about</code>å°±æ˜¯è¿™ç§å½¢å¼ã€‚</p><h3>Page</h3><p>ä¸å½’å±äºä»»ä½•<code>Section</code>çš„æ–‡ç« ã€‚<code>Page</code>ä¸ä¼šå‡ºç°åœ¨<code>Section</code>çš„<code>item</code>åˆ—è¡¨ä¸­ï¼Œé€šå¸¸ä¹Ÿä¸ä¼šå‡ºç°åœ¨indexï¼ˆé¦–é¡µï¼‰åˆ—è¡¨ä¸­ã€‚åœ¨<code>content</code>ä¸‹çš„ä¸å±äºä»»ä½•<code>Section</code>çš„ç›®å½•ä¸­æŒ‰å¦‚ä¸‹ç»“æ„æ·»åŠ æ–‡ä»¶å³å¯åˆ›å»º<code>Page</code>ã€‚æ³¨æ„<code>Page</code>çš„åˆ›å»ºè·¯å¾„å’Œè®¿é—®è·¯å¾„çš„å…³ç³»ã€‚</p><pre data-language="undefined"><code>
| content -- 404
|             | -- index.md
</code></pre><p>ä½ å¯ä»¥é€šè¿‡è®¿é—®http://localhost:8000/404/index/æŸ¥çœ‹</p><p>Pageä¸ºæˆ‘ä»¬æä¾›ä¸€ç§æ„å»ºè‡ªç”±é¡µé¢çš„æ–¹æ³•ã€‚æ¯”å¦‚ä½ å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºä¸éœ€è¦æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­çš„æ–‡ç« ï¼Œæˆ–è€…åƒèŒƒä¾‹æ¨¡æ¿çš„æ¼”ç¤ºä¸€æ ·åˆ›å»º404ğŸ˜…ã€‚</p><h3>Content</h3><p>åœ¨æ­¤ç‰¹æŒ‡<code>Item</code>ã€<code>Page</code>ä¸­çš„<code>content</code>å±æ€§ã€‚ä½œä¸ºå†…å®¹é›†ï¼Œå…¶èŒƒå›´åŒ…æ‹¬æ–‡æœ¬ï¼ˆå¦‚æ ‡é¢˜å’Œæè¿°ï¼‰ã€æ‰€å±æ ‡ç­¾ï¼ˆtagï¼‰ã€è½¬æ¢åHTMLä»£ç ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å„ç§å…ƒæ•°æ®ã€‚å…ƒæ•°æ®éœ€è¦åœ¨Markdonwæ–‡ç« çš„å¤´éƒ¨æ³¨æ˜ã€‚</p><p><code>Section</code>ä¹Ÿæœ‰<code>Content</code>ï¼Œå®ƒçš„å†…å®¹å¯¹åº”ç€ä½ åœ¨è¯¥<code>Section</code>å¯¹åº”çš„<code>Content</code>å­ç›®å½•ä¸­åˆ›å»ºçš„index.mdï¼ˆå¦‚æœæœ‰å¿…è¦çš„è¯ï¼‰ã€‚</p><p>åœ¨ä»£ç ä¸­å°†æ¥è¿˜ä¼šç¢°åˆ°å¦ä¸€ç§<code>Content</code>,ç¡®åˆ‡çš„è¯´æ˜¯<code>PublishingContext</code>ã€‚é‡Œé¢åŒ…å«ç€æ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆSiteã€Sectionsã€Itemsã€Tagsç­‰ï¼‰ï¼Œé€šè¿‡å°†å®ƒçš„å®ä¾‹ä¼ é€’ç»™<code>Step</code>æˆ–è€…<code>Plugin</code>æ¥å®Œæˆä¿®æ”¹æˆ–é…ç½®ç½‘ç«™çš„å„ç§å·¥ä½œã€‚</p><h3>Metadata</h3><p>Markdownæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œåœ¨æ–‡ç« ï¼ˆMarkdownï¼‰æ–‡ä»¶çš„å¤´éƒ¨åšå‡ºæ ‡è¯†ã€‚åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç§æ˜¯Publishé¢„ç½®çš„ã€‚å¦ä¸€ç§æ˜¯é€šè¿‡åœ¨<code>Site</code>ä¸­<code>ItemMetadata</code>è‡ªå®šä¹‰çš„ã€‚</p><pre data-language="undefined"><code>
---
date: 2021-01-29 19:58
description: A description of my first post.
tags: first, article
author: fat 
image: /images/first-post.png
---
</code></pre><h4>é¢„è®¾</h4><ul><li><strong>title</strong> æ–‡å­—æ ‡é¢˜</li></ul><p>å¦‚æœæ²¡æœ‰è®¾ç½®ï¼ŒPublishä¼šç›´æ¥æŸ¥æ‰¾æ–‡ç« æ­£æ–‡ä¸­ç¬¬ä¸€ä¸ªTop-level Head<code> # </code>ä½œä¸ºæ ‡é¢˜</p><ul><li><strong>description</strong> æ–‡ç« ç®€ä»‹</li></ul><ul><li><strong>date</strong> æ–‡ç« åˆ›ä½œæ—¥æœŸ</li></ul><p>å¦‚æœæ²¡è®¾ç½®åˆ™ç›´æ¥ä½¿ç”¨æ–‡ä»¶çš„modificationDate</p><ul><li><strong>tags</strong> æ–‡ç« æ ‡ç­¾ï¼Œæ¯ç¯‡æ–‡ç« å¯ä»¥è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼Œä¸ºæ–‡ç« çš„ç»„ç»‡å¤šä¸€ä¸ªç»´åº¦</li></ul><ul><li><strong>image</strong> å›¾ç‰‡åœ°å€ æ¯”å¦‚å¯ä»¥ç”¨æ¥åœ¨Itemåˆ—è¡¨ä¸­æ˜¾ç¤ºä¸€ä¸ªæ–‡ç« çš„ä¸»é¢˜å›¾ç‰‡ï¼ˆéœ€åœ¨æ¨¡æ¿ä¸­å®šä¹‰ï¼‰</li></ul><ul><li><strong>audio</strong> éŸ³é¢‘æ•°æ®</li></ul><ul><li><strong>video</strong> è§†é¢‘æ•°æ®</li></ul><p>éŸ³è§†é¢‘çš„å®šä¹‰è¿‡äºå¤æ‚ï¼Œå¦‚æœç¡®å®éœ€è¦å¯ä»¥è‡ªè¡Œå®šä¹‰ã€‚</p><h4>è‡ªå®šä¹‰</h4><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ItemMetadata</span>: <span class="hljs-title">WebsiteItemMetadata</span> </span>{
    <span class="hljs-comment">// Add any site-specific metadata that you want to use here.</span>
    <span class="hljs-keyword">var</span> author:<span class="hljs-type">String</span>
}
</code></pre><p>å¦‚æœé¢„ç½®çš„<code>metadata</code>ä¸è¶³ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œå¯ä»¥åœ¨<code>ItemMetadata</code>ä¸­è‡ªè¡Œå®šä¹‰ã€‚</p><h4>ä¸¤ç§metadataçš„åŒºåˆ«</h4><p>é¢„è®¾çš„<code>metadata</code>åœ¨Publishä¸­æ˜¯ä½œä¸ºçš„å±æ€§å­˜åœ¨çš„ã€‚</p><pre data-language="swift"><code><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> content.allItems(sortedBy: \.date){
         <span class="hljs-built_in">print</span>(item.title)
 }
</code></pre><p>è‡ªå®šä¹‰çš„<code>metadata</code>éœ€é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–</p><pre data-language="swift"><code><span class="hljs-keyword">let</span> author = (item.metadata <span class="hljs-keyword">as</span>! <span class="hljs-type">Myblog</span>.<span class="hljs-type">ItemMetadata</span>).author
</code></pre><p>åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ›´æ–¹ä¾¿</p><pre data-language="swift"><code>.text(item.metadata.author)
</code></pre><p>Publishä¸­é¢„è®¾çš„<code>metadata</code>ï¼Œ<code>Item</code>å¹¶ä¸è¦æ±‚å¿…é¡»å¡«å†™ã€‚ä½†æ˜¯å¯¹äºè‡ªå®šä¹‰çš„<code>metadata</code>åˆ™å¿…é¡»åœ¨<code>markdown</code>æ–‡æ¡£ä¸­æ·»åŠ ã€‚<code>index.md</code>ã€ <code>Page</code> å¯ä»¥æ²¡æœ‰<code>metadata</code>ï¼ˆæ— è®ºæ˜¯å¦ä¸ºè‡ªå®šä¹‰ï¼‰</p><h3>Theme</h3><p>Publishä½¿ç”¨<a href="https://github.com/fatbobman/PublishThemeForFatbobmanBlog">Plot</a>ä½œä¸ºå…¶HTMLä¸»é¢˜çš„æè¿°å¼•æ“ï¼Œå¼€å‘è€…å¯ä»¥ç”¨éå¸¸Swiftçš„æ–¹å¼æ¥å®šä¹‰é¡µé¢ã€‚å¦‚æœä½¿ç”¨è¿‡DSLç±»å‹çš„å¼€å‘æ–¹å¼ï¼Œä¼šæ„Ÿè§‰éå¸¸äº²åˆ‡ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç å®šä¹‰äº†Section Listçš„å¸ƒå±€å‘ˆç°</p><pre data-language="swift"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeSectionHTML</span><span class="hljs-params">(
        <span class="hljs-keyword">for</span> section: Section&lt;Site&gt;,
        context: PublishingContext&lt;Site&gt;
    )</span></span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">HTML</span> {
        <span class="hljs-type">HTML</span>(
            .lang(context.site.language), <span class="hljs-comment">//ç½‘é¡µè¯­è¨€</span>
            .head(<span class="hljs-keyword">for</span>: section, on: context.site), <span class="hljs-comment">//å¤´æ–‡ä»¶ï¼Œmetadataã€cssç­‰</span>
            .body(
                .header(<span class="hljs-keyword">for</span>: context, selectedSection: section.id), <span class="hljs-comment">//ç½‘ç«™çš„ä¸Šéƒ¨åŒºåŸŸï¼ŒèŒƒä¾‹ä¸­åŒ…æ‹¬äº†Logoï¼Œä»¥åŠå¯¼èˆªæ¡</span>
                .wrapper(
                    .itemList(<span class="hljs-keyword">for</span>: section.items, on: context.site) <span class="hljs-comment">// æ–‡ç« åˆ—è¡¨</span>
                ),
                .footer(<span class="hljs-keyword">for</span>: context.site) <span class="hljs-comment">//æœ€ä¸‹æ–¹çš„ç‰ˆæƒåŒºåŸŸ</span>
            )
        )
    }
</code></pre><p>åœ¨Themeä¸­å®šä¹‰çš„å¸ƒå±€ç»†èŠ‚ä»éœ€è¦åœ¨cssä¸­è¿›è¡Œè¿›ä¸€æ­¥è®¾ç½®ã€‚</p><p>ä¸Šé¢ä»£ç ä¸­ <code>header</code>ã€<code>wrapper</code>ç­‰åœ¨Plotä¸­éƒ½è¢«ç§°ä½œ<code>Node</code>,é™¤äº†ä½¿ç”¨Publishä¸­é¢„ç½®çš„å¤§é‡<code>Node</code>å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå·±ç¼–å†™çš„<code>Node</code>ã€‚</p><p>æ›´å¤šå…³äºThemeçš„å†…å®¹ï¼Œå°†åœ¨ç”¨Publishåˆ›å»ºåšå®¢ï¼ˆäºŒï¼‰ä¸­åšè¯¦ç»†ä»‹ç»ã€‚</p><h3>Step</h3><p>Publishé‡‡ç”¨å·¥ä½œæµï¼ˆPipelineï¼‰çš„æ–¹å¼æ¥æ˜ç¡®å®šä¹‰å„ä¸ªç¯èŠ‚çš„æ“ä½œè¿‡ç¨‹ã€‚ä»æ–‡ä»¶è¯»å–ã€markdownè§£æã€HTMLç”Ÿæˆã€RSSå¯¼å‡ºç­‰ç­‰ã€‚é€šè¿‡<code>publish new</code>ç”Ÿæˆçš„<code>main.swift</code>ä¸­ï¼Œå°½ç®¡åªä½¿ç”¨äº†ä¸€æ¡è¯­å¥</p><pre data-language="swift"><code><span class="hljs-keyword">try</span> <span class="hljs-type">Myblog</span>().publish(withTheme: .foundation)
</code></pre><p>ä½†å…¶èƒŒåå¯¹åº”ç€ä¸‹é¢ä¸€ç³»åˆ—æ“ä½œæ­¥éª¤ï¼š</p><pre data-language="swift"><code>using: [
      .group(plugins.<span class="hljs-built_in">map</span>(<span class="hljs-type">PublishingStep</span>.installPlugin)),
      .<span class="hljs-keyword">optional</span>(.copyResources()),
      .addMarkdownFiles(),
      .sortItems(by: \.date, order: .descending),
      .group(additionalSteps),
      .generateHTML(withTheme: theme, indentation: indentation),
      .unwrap(rssFeedConfig) { config <span class="hljs-keyword">in</span>
      .generateRSSFeed(
               including: rssFeedSections,
                      config: config
                    )
          },
       .generateSiteMap(indentedBy: indentation),
       .unwrap(deploymentMethod, <span class="hljs-type">PublishingStep</span>.deploy)
         ]
</code></pre><p>åœ¨å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šæ˜¾å¼çš„å°†æ¯ä¸€ä¸ªæ“ä½œæ­¥éª¤æ ‡æ˜å‡ºæ¥ã€‚æ¯ä¸ªæ­¥éª¤åœ¨Publishä¸­è¢«ç§°ä¸º<code>Step</code>ã€‚Publishå·²ç»é¢„ç½®äº†ä¸å°‘<code>Step</code>ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚æˆ‘ä¹ˆä¹Ÿå¯ä»¥å°†è‡ªå·±åˆ›å»ºçš„<code>Step</code>æ³¨å…¥åˆ°å·¥ä½œæµä¸­åˆé€‚çš„ä½ç½®ä»¥å®ç°æ›´å¤šåŠŸèƒ½ã€‚</p><p>æ¯ä¸ª<code>Step</code>éƒ½ä¼šè¢«ä¼ é€’ä¸€ä¸ª<code>PublishContent</code>å®ä¾‹ï¼Œè¯¥å®ä¾‹å¯ç”¨äºæ›´æ”¹ç½‘ç«™ä¸­çš„å„ç§å…ƒç´ ï¼ˆåŒ…æ‹¬æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€Itemã€Pageç­‰ï¼‰ã€‚å…³äº<code>PublishContent</code>åŒ<code>Content</code>çš„ä¸åŒï¼Œè¯·è§ä¸Šæ–‡ã€‚</p><h3>Plugin</h3><pre data-language="swift"><code>.installPlugin(.highlightJS()), <span class="hljs-comment">//è¯­æ³•é«˜äº®</span>
</code></pre><p>ä¸Šé¢çš„ä»£ç åœ¨Publishå·¥ä½œæµä¸­é€šè¿‡åä¸º<code>installPlugin</code>çš„<code>Step</code>æ¥å®Œæˆæ’ä»¶<code>highlightJS</code>çš„å®‰è£…ã€‚</p><p><code>Plugin</code>çš„å¼€å‘å’Œ<code>Step</code>éå¸¸ç±»ä¼¼ï¼Œéƒ½ä¼šè·å¾—ä¸€ä¸ª<code>PublishContent</code>å®ä¾‹ï¼Œå¹¶é€šè¿‡å…¶å®Œæˆç›¸å…³å·¥ä½œã€‚</p><p>æ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥ç”¨<code>Step</code>æ¥å®ŒæˆæŸäº›å…·æœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼›ç”¨<code>Plugin</code>æ¥å®Œæˆç±»å¦‚<code>Modifier</code>ï¼ˆmarkdownçš„å®šåˆ¶åŒ–è§£æï¼‰æ³¨å…¥çš„å·¥ä½œã€‚</p><p>å¯¹äºè‡ªå®šä¹‰ä»£ç ï¼Œä»åŠŸèƒ½è§’åº¦è®²ï¼Œä¸¤è€…éƒ½èƒ½å®ç°å¯¹æ–¹çš„å·¥ä½œã€‚å› æ­¤åœ¨åˆ›å»ºåŠŸèƒ½æ‰©å±•æ—¶ï¼Œé‡‡ç”¨<code>Step</code>è¿˜æ˜¯<code>Plugin</code>å–å†³äºä¸ªäººçš„åå¥½ã€‚</p><p>å…³äºå¦‚ä½•å®šåˆ¶<code>Step</code>å’Œ<code>Plugin</code>å°†åœ¨ç”¨Publishåˆ›å»ºåšå®¢ï¼ˆä¸‰ï¼‰ä¸­åšè¯¦ç»†è¯´æ˜ã€‚</p><h2>Publishé€‚åˆä»€ä¹ˆäºº</h2><p>PublishåŒå½“å‰ä¸»æµçš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ç›¸æ¯”è¿˜ç•¥æœ‰ä¸è¶³ï¼Œå¦‚ç¤¾åŒºæ´»è·ƒåº¦è¾ƒä½ã€å¼€å‘æ—¶é—´è¾ƒçŸ­ã€Swiftè¯­è¨€ç”¨æˆ·é‡è¾ƒå°ç­‰ã€‚å½“å‰Publishè¾ƒé€‚åˆç¬¦åˆå¦‚ä¸‹çŠ¶å†µçš„æœ‹å‹ï¼š</p><ul><li>ä½¿ç”¨Swiftè¯­è¨€çš„å¼€å‘è€…æˆ–Swiftçš„çˆ±å¥½è€…</li><li>æ¬ ç¼ºJavascripteçš„ç»éªŒï¼Œæˆ–è€…å–œæ¬¢Javascripte freeçš„é£æ ¼</li><li>è¿½æ±‚é«˜æ•ˆã€ç®€æ´çš„ç½‘é¡µå‘ˆç°æ–¹å¼</li><li>å¸Œæœ›èƒ½å¤Ÿå®Œæ•´æŒæ¡ç½‘ç«™çš„å„ä¸ªç¯èŠ‚å¹¶é€šè¿‡è‡ªå·±çš„åŒæ‰‹é€æ­¥å®ç°å„é¡¹åŠŸèƒ½</li><li>å–„äºå°é²œè€…</li></ul><h2>Next</h2><p>æˆ‘å°†åœ¨ç”¨Publishåˆ›å»ºåšå®¢ï¼ˆäºŒï¼‰ä¸­æ¢è®¨Themeçš„å¼€å‘ï¼Œåœ¨ï¼ˆä¸‰ï¼‰ä¸­äº†è§£å¦‚ä½•é€šè¿‡å¤šç§æ‰‹æ®µæ‰©å±•Publishçš„åŠŸèƒ½ã€‚</p><p>å¦‚æœä½ å·²ç»å¼€å§‹æ„Ÿå…´è¶£ï¼Œé©¬ä¸Šåœ¨Githubä¸Šå¼€é€šä½ çš„github.ioç«™ç‚¹ï¼Œç”¨Publishä¸€é”®deployå±äºè‡ªå·±çš„åšå®¢å§ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftui-ipad</guid><title>åœ¨SwiftUIä¸‹å¯¹iPadè¿›è¡Œé€‚é…</title><description>SwiftUIåˆ›å»ºåˆè¡·ä¹‹ä¸€ä¾¿æ˜¯å¯ä»¥é«˜æ•ˆã€å¯é çš„é€‚é…å¤šä¸ªè‹¹æœçš„ç¡¬ä»¶å¹³å°ã€‚åœ¨å¥åº·ç¬”è®°2.0å¼€å‘åˆå§‹ï¼Œé€‚é…iPadä¾¿æ˜¯æˆ‘æœ¬æ¬¡çš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€ã€‚æœ¬æ–‡å¹¶éæ•™ç¨‹ï¼Œåªæ˜¯æˆ‘åœ¨è¿›è¡Œæœ¬æ¬¡å¼€å‘ä¸­ï¼Œå¯¹äºé€‚é…iPadçš„ä¸€äº›æ•™è®­å’Œå¿ƒå¾—ã€‚</description><link>http://www.fatbobman.com/posts/swiftui-ipad</link><pubDate>Thu, 29 Oct 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUIåˆ›å»ºåˆè¡·ä¹‹ä¸€ä¾¿æ˜¯å¯ä»¥é«˜æ•ˆã€å¯é çš„é€‚é…å¤šä¸ªè‹¹æœçš„ç¡¬ä»¶å¹³å°ã€‚åœ¨å¥åº·ç¬”è®°2.0å¼€å‘åˆå§‹ï¼Œé€‚é…iPadä¾¿æ˜¯æˆ‘æœ¬æ¬¡çš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€ã€‚æœ¬æ–‡å¹¶éæ•™ç¨‹ï¼Œåªæ˜¯æˆ‘åœ¨è¿›è¡Œæœ¬æ¬¡å¼€å‘ä¸­ï¼Œå¯¹äºé€‚é…iPadçš„ä¸€äº›æ•™è®­å’Œå¿ƒå¾—ã€‚</p></blockquote><h2>æˆ‘æ˜¯è°</h2><p>appä¸­çš„ä»£ç å¿…é¡»èƒ½é«˜æ•ˆã€æ¸…æ™°çš„äº†è§£å½“å‰è®¾å¤‡çš„çŠ¶å†µï¼Œæ—¶åˆ»ææ¸…æ¥šæˆ‘æ˜¯è°ï¼Œæˆ‘åœ¨å“ªï¼Œåœ¨å¹²å•¥ç­‰ç­‰ã€‚å› æ­¤åœ¨é¡¹ç›®å¼€å§‹ä¹‹åˆæˆ‘ä¾¿åšäº†ä¸å°‘çš„å‡†å¤‡å¹¶åˆ›å»ºäº†ä¸€ç³»åˆ—çš„ä»£ç ã€‚</p><p>æ¯”å¦‚ï¼Œå½“å‰çš„è¿è¡Œè®¾å¤‡ï¼š</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Device</span> </span>{
    <span class="hljs-comment">//MARK:å½“å‰è®¾å¤‡ç±»å‹ iphone ipad mac</span>
    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Devicetype</span></span>{
        <span class="hljs-keyword">case</span> iphone,ipad,mac
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> deviceType:<span class="hljs-type">Devicetype</span>{
        #<span class="hljs-keyword">if</span> os(macOS)
        <span class="hljs-keyword">return</span> .mac
        #<span class="hljs-keyword">else</span>
        <span class="hljs-keyword">if</span>  <span class="hljs-type">UIDevice</span>.current.userInterfaceIdiom == .pad {
            <span class="hljs-keyword">return</span> .ipad
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> .iphone
        }
        #endif
 }
</code></pre><p>å¦‚æœæƒ³è¦å…·ä½“äº†è§£å½“å‰è¿è¡Œè®¾å¤‡çš„å‹å·ï¼ŒGithubä¸Šæœ‰äººæä¾›äº†ä»£ç å¯ä»¥è¿”å›æ›´ç²¾å‡†çš„ä¿¡æ¯ã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿåœ¨Viewä¸­æ–¹ä¾¿çš„åˆ©ç”¨è¿™äº›çŠ¶æ€ä¿¡æ¯åº”å¯¹ä¸åŒçš„æƒ…å†µï¼Œè¿˜éœ€è¦ç»§ç»­åšäº›å‡†å¤‡ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">ViewBuilder</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ifIs</span>&lt;T&gt;<span class="hljs-params">(<span class="hljs-number">_</span> condition: Bool, transform: <span class="hljs-params">(<span class="hljs-keyword">Self</span>)</span></span></span> -&gt; <span class="hljs-type">T</span>) -&gt; some <span class="hljs-type">View</span> <span class="hljs-keyword">where</span> <span class="hljs-type">T</span>: <span class="hljs-type">View</span> {
        <span class="hljs-keyword">if</span> condition {
            transform(<span class="hljs-keyword">self</span>)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">self</span>
        }
    }
    
    @<span class="hljs-type">ViewBuilder</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ifElse</span>&lt;T:View,V:View&gt;<span class="hljs-params">( <span class="hljs-number">_</span> condition:Bool,isTransform:<span class="hljs-params">(<span class="hljs-keyword">Self</span>)</span></span></span> -&gt; <span class="hljs-type">T</span>,elseTransform:(<span class="hljs-type">Self</span>) -&gt; <span class="hljs-type">V</span>) -&gt; some <span class="hljs-type">View</span> {
        <span class="hljs-keyword">if</span> condition {
            isTransform(<span class="hljs-keyword">self</span>)
        } <span class="hljs-keyword">else</span> {
            elseTransform(<span class="hljs-keyword">self</span>)
        }
    }
}
</code></pre><p>è¿™ä¸¤æ®µæ˜¯æˆ‘ä½¿ç”¨éå¸¸é¢‘ç¹çš„ä»£ç ï¼Œåœ¨SwiftUIä¸‹ï¼Œåˆ©ç”¨ç±»ä¼¼çš„ä»£ç å¯ä»¥éå¸¸å®¹æ˜“çš„åˆ©ç”¨åŒä¸€æ®µä»£ç åº”å¯¹å„ç§ä¸åŒçš„çŠ¶å†µã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre data-language="swift"><code><span class="hljs-type">VStack</span>{
     <span class="hljs-type">Text</span>(<span class="hljs-string">"hello world"</span>)
}
.ifIs(<span class="hljs-type">Deivce</span>.deviceType == .iphone){
  $<span class="hljs-number">0</span>.frame(width:<span class="hljs-number">150</span>)
}
.ifIs(<span class="hljs-type">Device</span>.deviceType == .ipad){
  $<span class="hljs-number">0</span>.frame(width:<span class="hljs-number">300</span>)
}
.ifIs(<span class="hljs-type">Device</span>.deviceType == .mac){
  $<span class="hljs-number">0</span>.frmae(minWidth:<span class="hljs-number">200</span>,maxWidth:<span class="hljs-number">600</span>)
}
</code></pre><p>åªæœ‰è§£å†³äº†æˆ‘æ˜¯è°çš„é—®é¢˜ï¼Œåé¢çš„å·¥ä½œæ‰èƒ½æ›´å¥½çš„å±•å¼€</p><h2>èººç€è¿˜æ˜¯ç«™ç€</h2><p>å› ä¸ºå¥åº·ç¬”è®°ä»¥åˆ—è¡¨è¢«ä¸»è¦è¡¨ç°å½¢å¼çš„appï¼Œæœ€åˆæ‰€ä»¥æˆ‘å¸Œæœ›åœ¨iphoneä¸Šå§‹ç»ˆä¿æŒPortraitï¼Œåœ¨ipadä¸Šä¿æŒLandscapeçš„å½¢å¼ã€‚ä¸è¿‡æœ€ç»ˆè¿˜æ˜¯å†³å®šè®©å…¶åœ¨ipadä¸ŠåŒæ—¶æ”¯æŒPortraitå’ŒLandscapeã€‚</p><img src="http://cdn.fatbobman.com/swiftui-ipad-ipadiPhone.png" alt="ipadiphone"/><p>ä¸ºäº†æ›´çµæ´»çš„å¤„ç†ï¼Œæˆ‘æ²¡æœ‰é€‰æ‹©åœ¨info.plistä¸­å¯¹å…¶è¿›è¡Œè®¾å®šï¼Œè€Œæ˜¯é€šè¿‡åœ¨delegateä¸­ï¼Œé’ˆå¯¹ä¸åŒçš„æƒ…å†µä½œå‡ºå“åº”ã€‚</p><img src="http://cdn.fatbobman.com/swiftui-ipad-xcode.png" alt="xcode"/><p>å› ä¸ºæ— éœ€æ”¯æŒå¤šçª—å£ï¼Œæ‰€ä»¥å…³é—­äº†multiple windowsã€‚å¦å¤–éœ€è¦æ¿€æ´»Requires full screenæ‰èƒ½è®©delegateä½œå‡ºå“åº”</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppDelegate</span>:<span class="hljs-title">NSObject</span>,<span class="hljs-title">UIApplicationDelegate</span></span>{
  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">application</span><span class="hljs-params">(<span class="hljs-number">_</span> application: UIApplication, supportedInterfaceOrientationsFor window: UIWindow?)</span></span> -&gt; <span class="hljs-type">UIInterfaceOrientationMask</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-type">Device</span>.deviceType == .ipad
            ? <span class="hljs-type">UIInterfaceOrientationMask</span>.all
            : <span class="hljs-type">UIInterfaceOrientationMask</span>.portrait
    }
}
</code></pre><p>åœ¨SwiftUIä¸‹å¦‚ä½•è®¾ç½®Delegateè¯·æŸ¥çœ‹<a href="http://www.fatbobman.com/posts/swiftui2-new-feature-1/">SwiftUI2.0 â€”â€” Appã€SceneåŠæ–°çš„ä»£ç ç»“æ„</a></p><p>å¦‚æ­¤ä¾¿å¯ä»¥æ–¹ä¾¿çš„æ§åˆ¶è‡ªå·±æƒ³è¦çš„appå‘ˆç°å½¢æ€äº†ã€‚</p><h2>éš¾ä»¥æ§åˆ¶çš„NavigationView</h2><p>SwiftUIçš„NavigationViewæœ¬èº«ä¸ºäº†é€‚é…åšäº†ä¸å°‘çš„å·¥ä½œï¼Œä½†æ•ˆæœå¹¶ä¸å¥½ã€‚</p><p>ç›®å‰å®ƒæ”¯æŒä¸¤ç§styleï¼š StackNavigationViewã€DoubleColumnNavigationViewStyleï¼Œä¸‰ç§è¡¨ç°å½¢å¼ï¼šå•åˆ—ã€åŒåˆ—ã€ä»¥åŠä¸‰åˆ—ï¼ˆsidebarï¼‰ã€‚è™½ç„¶çœ‹ä¼¼è¦†ç›–äº†å¤šæ•°çš„åº”ç”¨ï¼Œä½†ç”±äºæ²¡æœ‰æä¾›æ›´å¤šçš„æ§åˆ¶é€‰é¡¹ï¼Œå› æ­¤ç”¨èµ·æ¥å¹¶ä¸é¡ºæ‰‹ã€‚</p><p>æ¯”å¦‚ï¼ŒDoubleColumnNavigationViewStyleï¼Œåœ¨ipadä¸Šçš„ç«–å±å’Œæ¨ªå±æ—¶çš„å‘ˆç°æ˜¯ä¸åŒçš„ã€‚å·¦ä¸Šè§’çš„éšè—æŒ‰é’®ä¸å¯æ›´æ”¹ï¼Œä¸å¯å–æ¶ˆã€‚åœ¨åŒ…å«sidebarçš„ä¸‰åˆ—æ¨¡å¼ä¸‹ï¼Œé€»è¾‘åˆæœ‰ä¸åŒï¼Œä¸è¿‡æŒ‰é’®åŒæ ·ä¸æä¾›ä»»ä½•æ›¿æ¢ã€å–æ¶ˆçš„èƒ½åŠ›ã€‚</p><p>NavigationLinkåªèƒ½åœ¨å½“å‰åˆ—ä¸­å“åº”ï¼Œå¦å¤–å¹¶ä¸æä¾›æ§åˆ¶åˆ—å®½çš„èƒ½åŠ›ã€‚</p><p>å¦‚æœæƒ³è°ƒæ•´åŒåˆ—NavigationViewçš„åˆ—å®½ï¼Œå¯ä»¥ä½¿ç”¨Introspectï¼Œå‚è§<a href="http://www.fatbobman.com/posts/healthnote2-3rd-package/">ä»‹ç»å‡ ä¸ªæˆ‘åœ¨å¼€å‘å¥åº·ç¬”è®°2ç”¨åˆ°çš„Swiftæˆ–SwiftUIç¬¬ä¸‰æ–¹åº“</a></p><pre data-language="swift"><code><span class="hljs-type">NavigationView</span>{
  <span class="hljs-type">Text</span>(<span class="hljs-string">"hello"</span>)
}
.introspectNavigationController{ navigation <span class="hljs-keyword">in</span>
    navigation.splitViewController?.maximumPrimaryColumnWidth = <span class="hljs-number">360</span>
    navigation.splitViewController?.preferredPrimaryColumnWidth = <span class="hljs-number">500.0</span>
}
</code></pre><p>ä¸ºäº†èƒ½å¤Ÿè®©ipadåœ¨ç«–å±æˆ–æ¨ªå±çŠ¶æ€ä¸‹éƒ½å›ºå®šå‘ˆç°åŒåˆ—çš„æ¨¡å¼ï¼Œå¹¶ä¸”å·¦ä¾§åˆ—ä¸å¯æŠ˜å åŒæ—¶ä¹Ÿä¸èƒ½å‡ºç°æˆ‘æƒ³è¦çš„æŠ˜å æŒ‰é’®ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªä¸å¾—å·²çš„æ‰‹æ®µã€‚ä¼ªé€ äº†ä¸€ä¸ªåŒåˆ—æ˜¾ç¤ºçš„NavigationViewã€‚</p><p>é’ˆå¯¹ä¸åŒçš„è®¾å¤‡è¿›å…¥ä¸åŒçš„rootView</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HealthNotesApp</span>:<span class="hljs-title">APP</span></span>{
  <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span>{
     rootView()
  }
  
  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">rootView</span><span class="hljs-params">()</span></span>-&gt; some <span class="hljs-type">View</span>{
        <span class="hljs-keyword">switch</span> <span class="hljs-type">Device</span>.deviceType {
        <span class="hljs-keyword">case</span> .ipad:
            <span class="hljs-keyword">return</span> <span class="hljs-type">AnyView</span>(<span class="hljs-type">ContentView_iPad</span>())
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-type">AnyView</span>(<span class="hljs-type">ContentView_iPhone</span>())
        }
    }
}
</code></pre><p>åœ¨ContentView_iPadä¸­ï¼Œä½¿ç”¨ç±»ä¼¼ä»£ç ä¼ªé€ ä¸€ä¸ªåŒåˆ—å½¢å¼</p><pre data-language="swift"><code><span class="hljs-type">HStack</span>(spacing:<span class="hljs-number">0</span>){
      <span class="hljs-type">ItemRootView</span>(item: $item)
           .frame(width:height)
       <span class="hljs-type">Divider</span>()
       <span class="hljs-type">ItemDataRootView</span>()
            .navigationContent()
        }
.edgesIgnoringSafeArea(.all)
</code></pre><p>å¦‚æ­¤ä¸€æ¥ä¾¿æ‹¥æœ‰äº†ä¸Šé¢å›¾ç‰‡ä¸­iPadçš„æ˜¾ç¤ºæ•ˆæœã€‚çŠ¶æ€åŸºæœ¬ä¸ŠåŒDoubleColumnNavigationViewStyleçš„å½¢å¼æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚åˆ†åˆ«éƒ½å¯ä»¥è®¾ç½®Toolbarï¼Œå¹¶ä¸”åˆ†å‰²çº¿ä¹Ÿå¯ä»¥è´¯ç©¿å±å¹•ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">View</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">navigationContent</span><span class="hljs-params">()</span></span> -&gt; some <span class="hljs-type">View</span>{
        <span class="hljs-type">NavigationView</span>{
            <span class="hljs-keyword">self</span>
        }
        .navigationViewStyle(<span class="hljs-type">StackNavigationViewStyle</span>())
    }
}
</code></pre><p>ç”±äºåœ¨Ipadä¸‹å³ä¾§åˆ—çš„è§†å›¾åŒæ—¶è¢«ç”¨åœ¨iphoneä¸‹ï¼Œåœ¨iPhoneä¸‹å®ƒæ˜¯ç”±NavigationLinkæ¿€æ´»çš„ï¼Œæ‰€ä»¥ä»åœ¨NavigationViewä¸­ï¼Œä½†åœ¨iPadä¸‹ï¼Œéœ€è¦æ˜ç¡®çš„å°†åœ¨æ”¾ç½®åœ¨NavigationViewä¸­ã€‚é€šè¿‡ .navigationContentï¼Œç»“åˆä¸Šé¢çš„isIfï¼Œä¾¿å¯ä»¥çµæ´»çš„æ§åˆ¶å½¢æ€äº†ã€‚</p><p>å¦å¤–éœ€è¦é’ˆå¯¹iPhoneå’Œipadçš„äºŒçº§Viewæ¿€æ´»è¿›è¡Œåˆ†åˆ«å¤„ç†,æ¯”å¦‚</p><pre data-language="swift"><code><span class="hljs-keyword">if</span> <span class="hljs-type">Device</span>.deviceType  == .iphone {
                    <span class="hljs-type">NavigationLink</span>(<span class="hljs-string">""</span>, destination: <span class="hljs-type">ItemDataRootView</span>(), isActive: $gotoDataList).frame(width:<span class="hljs-number">0</span>,height:<span class="hljs-number">0</span>)
            }

<span class="hljs-comment">//åœ¨linkçš„buttonä¸­</span>
<span class="hljs-type">Button</span>(<span class="hljs-string">"Item1"</span>){
   store.item = item
   <span class="hljs-keyword">if</span> <span class="hljs-type">Devie</span>.deviceType == .iphone {
       gotoDataList.toggle()
   }
}

<span class="hljs-comment">//åœ¨ItemDataRootViewä¸­ç›´æ¥å“åº”store.itemå³å¯</span>
</code></pre><h2>Bugè¿˜æ˜¯ç‰¹åˆ«è®¾è®¡ï¼Ÿ</h2><p>æŸäº›SwiftUIçš„é»˜è®¤æ§ä»¶åœ¨iPadå’ŒiPhoneä¸‹çš„è¿è¡Œæ•ˆæœå’Œé¢„æœŸæœ‰è¾ƒå¤§å·®åˆ«,</p><p>æ¯”å¦‚ActionSheet:</p><p>å½“å‰AlertSheetåœ¨è¿è¡ŒiOS14çš„ipadä¸Šçš„æ˜¾ç¤ºä½ç½®æ˜¯å‡ ä¹ä¸å¯æ§çš„ã€‚ç®­å¤´çš„ä½ç½®ï¼Œå†…å®¹çš„æ˜¾ç¤ºï¼Œå’Œé¢„æœŸéƒ½æœ‰å·¨å¤§çš„å·®åˆ«ã€‚æˆ‘ä¸çŸ¥é“ä»¥åéƒ½ä¼šæ˜¯è¿™æ ·è¿˜æ˜¯ç›®å‰çš„Bugã€‚</p><p>ä¸ªäººä¸æ¨èå½“å‰åœ¨iPadä¸Šä½¿ç”¨ActionSheetã€‚æœ€ç»ˆåªèƒ½åœ¨iPadä¸‹ä½¿ç”¨Alertæ›¿ä»£äº†ActionSheetã€‚å¦‚æœä¸€å®šè¦ä½¿ç”¨ActionSheetï¼Œpopoveræˆ–è®¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><p>ContextMenuç›®å‰åœ¨iPadä¸Šæœ‰å“åº”ä¸Šçš„é—®é¢˜ï¼ŒåŒæ ·çš„æŒ‡ä»¤åœ¨iPhoneä¸Šæ²¡æœ‰é—®é¢˜ï¼Œåœ¨iPadä¸Šä¼šå‡ºç°æ— æ³•è·å–å€¼çš„çŠ¶å†µã€‚åŒæ ·ä¸æ¸…æ¥šæ˜¯Bugè¿˜æ˜¯å…¶ä»–åŸå› ã€‚</p><p>æ¯”å¦‚</p><pre data-language="swift"><code><span class="hljs-type">Text</span>(<span class="hljs-string">"click"</span>)
.contextMenu{
  <span class="hljs-type">Button</span>(<span class="hljs-string">"del"</span>){
     delItem = item
     <span class="hljs-type">ShowActionSheet</span>.toggle()
  }
}
.<span class="hljs-type">ActionSheet</span>(isPresented:showActionSheet){
    delSheet(item:delItem)
}
</code></pre><p>è¿™æ®µä»£ç åœ¨iphoneä¸Šæ‰§è¡Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä¸è¿‡åœ¨ipadä¸Šï¼Œdelsheetå¾ˆæœ‰å¯èƒ½ä¼šæ— æ³•è·å–itemã€‚ä¸ºäº†é¿å…è¿™ä¸ªæƒ…å†µï¼Œç›®å‰åªèƒ½åšäº›ç‰¹æ®Šå¤„ç†</p><pre data-language="swift"><code><span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="hljs-number">0.5</span>){
                  showActionSheet.wrappedValue = <span class="hljs-literal">true</span>
}
</code></pre><p>ç±»ä¼¼ä¸Šè¿°çš„é—®é¢˜è¿˜æœ‰ä¸€äº›ï¼Œåªæœ‰å½“ä»£ç åœ¨ipadä¸Šè·‘èµ·æ¥å¤šåšæµ‹è¯•æ‰ä¼šå‘ç°å…¶ä¸­çš„é—®é¢˜ã€‚</p><h2>å¸ƒå±€ä¼˜åŒ–</h2><p>ç”±äºå¥åº·ç¬”è®°2.0åœ¨iPadä¸Šæ˜¾ç¤ºçš„å·¦å³ä¸¤åˆ—ï¼Œæ‰€ä»¥æœ¬æ¥åœ¨iphoneä¸‹è¿è¡Œæ²¡æœ‰é—®é¢˜View,åœ¨iPadä¸‹å°±ä¼šå‡ºç°å·¦å³ä¸å¯¹é½ï¼Œä¸å¯¹ç§°ç­‰é—®é¢˜ã€‚æ‰€ä»¥åªè¦å¤šè°ƒè¯•ï¼Œé‡‡ç”¨isIfå¤šåšå¤„ç†ï¼Œé—®é¢˜åŸºæœ¬ä¸Šéƒ½ä¼šæ¯”è¾ƒå®¹æ˜“è·å¾—è§£å†³ã€‚</p><p>ä»…ä¸¾ä¸€ä¾‹ï¼š</p><pre data-language="swift"><code><span class="hljs-type">List</span>{
   ...
}
.listStyle(<span class="hljs-type">InsetGroupedListStyle</span>())
</code></pre><p>å½“å®ƒåœ¨iphoneä¸Šä½œä¸ºç‹¬å å±å¹•çš„Viewæ—¶ï¼Œæ˜¾ç¤ºå¾ˆå®Œç¾ï¼Œä½†å½“å®ƒæ˜¾ç¤ºåœ¨IPadçš„å³ä¾§åˆ—æ—¶ï¼ŒGroupä¸Šæ–¹çš„ç•™ç©ºå’Œå·¦ä¾§åˆ—çš„å°±ä¸å¯¹é½ï¼Œåšç‚¹å¤„ç†å°±okäº†ã€‚</p><h2>ç»“å°¾</h2><p>æ€»ä¹‹ä½¿ç”¨SwiftUIé€‚é…iPhoneå’ŒiPadæ€»ä½“æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚èƒ½å¦å……åˆ†åˆ©ç”¨å¥½å„è‡ªè®¾å¤‡çš„ç‰¹ç‚¹ä¸»è¦è¿˜æ˜¯è¦åœ¨äº¤äº’é€»è¾‘å’ŒUIè®¾è®¡ä¸Šå¤šä¸‹åŠŸå¤«ï¼Œä»£ç ä¸Šçš„éš¾åº¦ä¸å¤§ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/coredata-in-swiftui</guid><title>èŠä¸€ä¸‹åœ¨SwiftUIä¸­ä½¿ç”¨CoreData</title><description>æœ¬æ–‡å¹¶éä¸€ä¸ªæ•™ä½ å¦‚ä½•åœ¨SwiftUIä¸‹ä½¿ç”¨CoreDataçš„æ•™ç¨‹ã€‚ä¸»è¦æ¢è®¨çš„æ˜¯åœ¨æˆ‘è¿‘ä¸€å¹´çš„SwiftUIå¼€å‘ä¸­ä½¿ç”¨CoreDataçš„æ•™è®­ã€ç»éªŒã€å¿ƒå¾—ã€‚</description><link>http://www.fatbobman.com/posts/coredata-in-swiftui</link><pubDate>Wed, 28 Oct 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>æœ¬æ–‡å¹¶éä¸€ä¸ªæ•™ä½ å¦‚ä½•åœ¨SwiftUIä¸‹ä½¿ç”¨CoreDataçš„æ•™ç¨‹ã€‚ä¸»è¦æ¢è®¨çš„æ˜¯åœ¨æˆ‘è¿‘ä¸€å¹´çš„SwiftUIå¼€å‘ä¸­ä½¿ç”¨CoreDataçš„æ•™è®­ã€ç»éªŒã€å¿ƒå¾—ã€‚</p></blockquote><h2>SwiftUI lifecycle ä¸­å¦‚ä½•å£°æ˜æŒä¹…åŒ–å­˜å‚¨å’Œä¸Šä¸‹æ–‡</h2><p>åœ¨XCode12ä¸­ï¼Œè‹¹æœæ–°å¢äº†SwiftUI lifecycleï¼Œè®©Appå®Œå…¨çš„SwiftUIåŒ–ã€‚ä¸è¿‡è¿™å°±éœ€è¦æˆ‘ä»¬ä½¿ç”¨æ–°çš„æ–¹æ³•æ¥å£°æ˜æŒä¹…åŒ–å­˜å‚¨å’Œä¸Šä¸‹æ–‡ã€‚</p><p>å¥½åƒæ˜¯ä»beta6å¼€å§‹ï¼ŒXCode 12æä¾›äº†åŸºäºSwiftUI lifecycleçš„CoreDataæ¨¡æ¿</p><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CoreDataTestApp</span>: <span class="hljs-title">App</span> </span>{
    <span class="hljs-comment">//æŒä¹…åŒ–å£°æ˜</span>
    <span class="hljs-keyword">let</span> persistenceController = <span class="hljs-type">PersistenceController</span>.shared

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
            <span class="hljs-type">ContentView</span>()
                .environment(\.managedObjectContext, persistenceController.container.viewContext)  
          <span class="hljs-comment">//ä¸Šä¸‹æ–‡æ³¨å…¥</span>
        }
    }
}
</code></pre><p>åœ¨å®ƒçš„Presitenceä¸­ï¼Œæ·»åŠ äº†ç”¨äºpreviewçš„æŒä¹…åŒ–å®šä¹‰</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PersistenceController</span> </span>{
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared = <span class="hljs-type">PersistenceController</span>()

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> preview: <span class="hljs-type">PersistenceController</span> = {
        <span class="hljs-keyword">let</span> result = <span class="hljs-type">PersistenceController</span>(inMemory: <span class="hljs-literal">true</span>)
        <span class="hljs-keyword">let</span> viewContext = result.container.viewContext
        <span class="hljs-comment">//æ ¹æ®ä½ çš„å®é™…éœ€è¦ï¼Œåˆ›å»ºç”¨äºpreviewçš„æ•°æ®</span>
        <span class="hljs-keyword">for</span> <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..&lt;<span class="hljs-number">10</span> {
            <span class="hljs-keyword">let</span> newItem = <span class="hljs-type">Item</span>(context: viewContext)
            newItem.timestamp = <span class="hljs-type">Date</span>()
        }
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">try</span> viewContext.save()
        } <span class="hljs-keyword">catch</span> {
            <span class="hljs-keyword">let</span> nsError = error <span class="hljs-keyword">as</span> <span class="hljs-type">NSError</span>
            <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Unresolved error \(nsError), \(nsError.userInfo)"</span>)
        }
        <span class="hljs-keyword">return</span> result
    }()

    <span class="hljs-keyword">let</span> container: <span class="hljs-type">NSPersistentCloudKitContainer</span>
    <span class="hljs-comment">//å¦‚æœæ˜¯ç”¨äºpreviewä¾¿å°†æ•°æ®ä¿å­˜åœ¨å†…å­˜è€Œésqliteä¸­</span>
    <span class="hljs-keyword">init</span>(inMemory: <span class="hljs-type">Bool</span> = <span class="hljs-literal">false</span>) {
        container = <span class="hljs-type">NSPersistentCloudKitContainer</span>(name: <span class="hljs-string">"Shared"</span>)
        <span class="hljs-keyword">if</span> inMemory {
            container.persistentStoreDescriptions.first!.url = <span class="hljs-type">URL</span>(fileURLWithPath: <span class="hljs-string">"/dev/null"</span>)
        }
        container.loadPersistentStores(completionHandler: { (storeDescription, error) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error <span class="hljs-keyword">as</span> <span class="hljs-type">NSError?</span> {
                <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Unresolved error \(error), \(error.userInfo)"</span>)
            }
        })
    }
}
</code></pre><p>è™½ç„¶å¯¹äºç”¨äºpreviewçš„æŒä¹…åŒ–è®¾ç½®å¹¶ä¸å®Œç¾ï¼Œä¸è¿‡è‹¹æœä¹Ÿæ„è¯†åˆ°äº†åœ¨SwiftUI1.0ä¸­çš„ä¸€ä¸ªå¾ˆå¤§é—®é¢˜ï¼Œæ— æ³•previewä½¿ç”¨äº†@FetchRequestçš„è§†å›¾ã€‚</p><p>ç”±äºåœ¨å®˜æ–¹CoreDataæ¨¡æ¿å‡ºç°å‰ï¼Œæˆ‘å·²ç»å¼€å§‹äº†æˆ‘çš„é¡¹ç›®æ„å»ºï¼Œå› æ­¤ï¼Œæˆ‘ä½¿ç”¨äº†ä¸‹é¢çš„æ–¹å¼æ¥å£°æ˜</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">HealthNotesApp</span>:<span class="hljs-title">App</span></span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> coreDataStack = <span class="hljs-type">CoreDataStack</span>(modelName: <span class="hljs-string">"Model"</span>) <span class="hljs-comment">//Model.xcdatemodeld</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> context = <span class="hljs-type">DataNoteApp</span>.coreDataStack.managedContext
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> storeRoot = <span class="hljs-type">Store</span>() 
   @<span class="hljs-type">UIApplicationDelegateAdaptor</span>(<span class="hljs-type">AppDelegate</span>.<span class="hljs-keyword">self</span>) <span class="hljs-keyword">var</span> delegate
  <span class="hljs-type">WindowGroup</span> {
        rootView()
            .environmentObject(store)
            .environment(\.managedObjectContext, <span class="hljs-type">DataNoteApp</span>.context)
  }
}
</code></pre><p>åœ¨UIKit App Delegateä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç åœ¨Appä»»æ„ä½ç½®è·å–ä¸Šä¸‹æ–‡</p><pre data-language="swift"><code><span class="hljs-keyword">let</span> context = (<span class="hljs-type">UIApplication</span>.shared.delegate <span class="hljs-keyword">as</span>! <span class="hljs-type">AppDelegate</span>).persistentContainer.viewContext
</code></pre><p>ä½†ç”±äºæˆ‘ä»¬å·²ç»æ²¡æœ‰åŠæ³•åœ¨SwiftUI lifecycleä¸­å¦‚æ­¤ä½¿ç”¨ï¼Œé€šè¿‡ä¸Šé¢çš„å£°æ˜æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„æ–¹æ³•åœ¨å…¨å±€è·å–æƒ³è¦çš„ä¸Šä¸‹æ–‡æˆ–å…¶ä»–æƒ³è¦è·å¾—çš„å¯¹è±¡</p><pre data-language="swift"><code><span class="hljs-keyword">let</span> context = <span class="hljs-type">HealthNotesApp</span>.context
</code></pre><p>æ¯”å¦‚åœ¨ delegateä¸­</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppDelegate</span>:<span class="hljs-title">NSObject</span>,<span class="hljs-title">UIApplicationDelegate</span></span>{
    
    <span class="hljs-keyword">let</span> send = <span class="hljs-type">HealthNotesApp</span>.storeRoot.send
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">application</span><span class="hljs-params">(<span class="hljs-number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: <span class="hljs-keyword">Any</span>]?)</span></span> -&gt; <span class="hljs-type">Bool</span> {
       
        logDebug(<span class="hljs-string">"app startup on ios"</span>)
       
        send(.loadNote)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">applicationDidFinishLaunching</span><span class="hljs-params">(<span class="hljs-number">_</span> application: UIApplication)</span></span>{
        
        logDebug(<span class="hljs-string">"app quit on ios"</span>)
        send(.counter(.save))

    }

}

<span class="hljs-comment">//æˆ–è€…ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œéƒ½æ˜¯å¯ä»¥çš„</span>
</code></pre><h2>å¦‚ä½•åŠ¨æ€è®¾ç½® @FetchRequest</h2><p>åœ¨SwiftUIä¸­ï¼Œå¦‚æœæ— éœ€å¤æ‚çš„æ•°æ®æ“ä½œï¼Œä½¿ç”¨CoreDataæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚åœ¨å®Œæˆxcdatamodeldçš„è®¾ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨Viewä¸­è½»æ¾çš„æ“ä½œæ•°æ®äº†ã€‚</p><p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å¦‚ä¸‹è¯­å¥æ¥è·å–æŸä¸ªentityçš„æ•°æ®</p><pre data-language="swift"><code>@<span class="hljs-type">FetchRequest</span>(sortDescriptors: [<span class="hljs-type">NSSortDescriptor</span>(keyPath: \<span class="hljs-type">Student</span>.studentId, ascending: <span class="hljs-literal">true</span>)],
              predicate:<span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"age &gt; 10"</span>),
              animation: .<span class="hljs-keyword">default</span>) 
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> students: <span class="hljs-type">FetchedResults</span>&lt;<span class="hljs-type">Student</span>&gt;
</code></pre><p>ä¸è¿‡å¦‚æ­¤ä½¿ç”¨çš„è¯ï¼ŒæŸ¥è¯¢æ¡ä»¶å°†æ— æ³•æ”¹å˜ï¼Œå¦‚æœæƒ³æ ¹æ®éœ€è¦è°ƒæ•´æŸ¥è¯¢æ¡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ã€‚</p><p>å¥åº·ç¬”è®°2ä¸­çš„éƒ¨åˆ†ä»£ç ï¼š</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">rootView</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> predicate:<span class="hljs-type">NSPredicate?</span> = <span class="hljs-literal">nil</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> <span class="hljs-built_in">sort</span> = <span class="hljs-type">NSSortDescriptor</span>(key: <span class="hljs-string">"date"</span>, ascending: <span class="hljs-literal">false</span>)
    @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> searchStore = <span class="hljs-type">SearchStore</span>()
    @<span class="hljs-type">EnvironmentObject</span> <span class="hljs-keyword">var</span> store:<span class="hljs-type">Store</span>
    <span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
      <span class="hljs-type">VStack</span> {
       <span class="hljs-type">SearchBar</span>(text: $searchStore.searchText) <span class="hljs-comment">//æœç´¢æ¡†</span>
       <span class="hljs-type">MemoList</span>(predicate: predicate, <span class="hljs-built_in">sort</span>: <span class="hljs-built_in">sort</span>,searching:searchStore.showSearch)
        }
      .onChange(of: searchStore.text){ <span class="hljs-number">_</span> <span class="hljs-keyword">in</span>
          getMemos()
      } 
    }
  
       <span class="hljs-comment">//è¯»å–æŒ‡å®šèŒƒå›´çš„memo</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getMemos</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">var</span> predicators:[<span class="hljs-type">NSPredicate</span>] = []
        <span class="hljs-keyword">if</span> !searchStore.searchText.isEmpty &amp;&amp; searchStore.showSearch {
            <span class="hljs-comment">//memoå†…å®¹æˆ–è€…itemåç§°åŒ…å«å…³é”®å­—</span>
            predicators.append(<span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"itemData.item.name contains[cd] %@ OR content contains[cd] %@"</span>, searchStore.searchText,searchStore.searchText))
        }
        <span class="hljs-keyword">if</span> star {
            predicators.append(<span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"star = true"</span>))
        }
        
        <span class="hljs-keyword">switch</span> store.state.memo{
        <span class="hljs-keyword">case</span> .all:
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> .memo:
            <span class="hljs-keyword">if</span> !searchStore.searchText.isEmpty &amp;&amp; noteOption == <span class="hljs-number">1</span> {
                <span class="hljs-keyword">break</span>
            }
            <span class="hljs-keyword">else</span> {
                predicators.append(<span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"itemData.item.note = nil"</span>))
            }
        <span class="hljs-keyword">case</span> .note(<span class="hljs-keyword">let</span> note):
            <span class="hljs-keyword">if</span> !searchStore.searchText.isEmpty &amp;&amp; noteOption == <span class="hljs-number">1</span> {
                <span class="hljs-keyword">break</span>
            }
            <span class="hljs-keyword">else</span> {
                predicators.append(<span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"itemData.item.note = %@"</span>, note))
            }
        }
        
        withAnimation(.easeInOut){
            predicate =  <span class="hljs-type">NSCompoundPredicate</span>(type: <span class="hljs-type">NSCompoundPredicate</span>.<span class="hljs-type">LogicalType</span>.and, subpredicates: predicators)
            <span class="hljs-built_in">sort</span> =  <span class="hljs-type">NSSortDescriptor</span>(key: <span class="hljs-string">"date"</span>, ascending: ascending)
        }
    }
}
</code></pre><p>ä¸Šè¿°ä»£ç ä¼šæ ¹æ®æœç´¢å…³é”®å­—ä»¥åŠä¸€äº›å…¶ä»–çš„èŒƒå›´æ¡ä»¶ï¼ŒåŠ¨æ€çš„åˆ›å»ºpredicateï¼Œä»è€Œè·å¾—æ‰€éœ€çš„æ•°æ®ã€‚</p><p>å¯¹äºç±»ä¼¼æŸ¥è¯¢è¿™æ ·çš„æ“ä½œï¼Œæœ€å¥½é…åˆä¸ŠCombineæ¥é™åˆ¶æ•°æ®è·å–çš„é¢‘æ¬¡</p><p>ä¾‹å¦‚ï¼š</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchStore</span>:<span class="hljs-title">ObservableObject</span></span>{
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> searchText = <span class="hljs-string">""</span>
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> text = <span class="hljs-string">""</span>
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> showSearch = <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cancellables:[<span class="hljs-type">AnyCancellable</span>] = []
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">registerPublisher</span><span class="hljs-params">()</span></span>{
        $searchText
            .removeDuplicates()
            .debounce(<span class="hljs-keyword">for</span>: <span class="hljs-number">0.4</span>, scheduler: <span class="hljs-type">DispatchQueue</span>.main)
            .assign(to: &amp;$text)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">removePublisher</span><span class="hljs-params">()</span></span>{
        cancellables.removeAll()
    }
    
}
</code></pre><p>ä¸Šè¿°æ‰€æœ‰ä»£ç å‡ç¼ºå¤±äº†å¾ˆå¤§éƒ¨åˆ†ï¼Œä»…åšæ€è·¯ä¸Šçš„è¯´æ˜</p><h2>å¢åŠ è½¬æ¢å±‚æ–¹ä¾¿ä»£ç å¼€å‘</h2><p>åœ¨å¼€å‘å¥åº·ç¬”è®° 1.0çš„æ—¶å€™æˆ‘ç»å¸¸è¢«ç±»ä¼¼ä¸‹é¢çš„ä»£ç æ‰€çƒ¦æ¼</p><pre data-language="swift"><code>@<span class="hljs-type">FetchRequest</span>(sortDescriptors: [<span class="hljs-type">NSSortDescriptor</span>(keyPath: \<span class="hljs-type">Student</span>.name, ascending: <span class="hljs-literal">true</span>)],
              animation: .<span class="hljs-keyword">default</span>) 
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> students: <span class="hljs-type">FetchedResults</span>&lt;<span class="hljs-type">Student</span>&gt;

<span class="hljs-type">ForEach</span>(students){ student <span class="hljs-keyword">in</span>
  <span class="hljs-type">Text</span>(student.name ?? <span class="hljs-string">""</span>)
  <span class="hljs-type">Text</span>(<span class="hljs-type">String</span>(student.date ?? <span class="hljs-type">Date</span>()))
}
</code></pre><p>åœ¨CoreDataä¸­ï¼Œè®¾ç½®Attributeï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½å®Œå…¨å¦‚æ„¿ã€‚</p><p>å¥½å‡ ä¸ªç±»å‹æ˜¯å¯é€‰çš„ï¼Œæ¯”å¦‚Stringï¼ŒUUIDç­‰ï¼Œå¦‚æœåœ¨å·²å‘å¸ƒçš„appï¼Œå°†æ–°å¢çš„attributeå…¶æ”¹ä¸ºä¸å¯é€‰ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼ï¼Œå°†æå¤§çš„å¢åŠ è¿ç§»çš„éš¾åº¦ã€‚å¦å¤–ï¼Œå¦‚æœä½¿ç”¨äº†NSPersistentCloudKitContainer,ç”±äºCloudkitçš„atrributeå’ŒCoreDataå¹¶ä¸ç›¸åŒï¼ŒXCodeä¼šå¼ºåˆ¶ä½ å°†å¾ˆå¤šAttributeæ”¹æˆä½ ä¸å¸Œæœ›çš„æ ·å¼ã€‚</p><p>ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œå¹¶ä¸ºæœªæ¥çš„ä¿®æ”¹ç•™å‡ºçµæ´»ã€å……åˆ†çš„æ›´æ”¹ç©ºé—´ï¼Œåœ¨å¥åº·ç¬”è®°2.0çš„å¼€å‘ä¸­ï¼Œæˆ‘ä¸ºæ¯ä¸ªNSManagedObjectéƒ½å¢åŠ äº†ä¸€ä¸ªä¾¿äºåœ¨Viewå’Œå…¶ä»–æ•°æ®æ“ä½œä¸­ä½¿ç”¨çš„ä¸­é—´å±‚ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre data-language="swift"><code><span class="hljs-meta">@objc</span>(<span class="hljs-type">Student</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>: <span class="hljs-title">NSManagedObject</span>,<span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-meta">@NSManaged</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> name: <span class="hljs-type">String?</span>
    @<span class="hljs-type">NSmanaged</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> birthdate: <span class="hljs-type">Date?</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StudentViewModel</span>: <span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">let</span> name:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> birthdate:<span class="hljs-type">String</span>
}

<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Student</span></span>{
   <span class="hljs-keyword">var</span> viewModel:<span class="hljs-type">StudentViewModel</span>(
        name:name ?? <span class="hljs-string">""</span>
        birthdate:(birthdate ?? <span class="hljs-type">Date</span>()).<span class="hljs-built_in">toString</span>() <span class="hljs-comment">//ä¸¾ä¾‹</span>
   )
  
}
</code></pre><p>å¦‚æ­¤ä¸€æ¥ï¼Œåœ¨Viewä¸­è°ƒç”¨å°†éå¸¸æ–¹ä¾¿ï¼ŒåŒæ—¶å³ä½¿æ›´æ”¹entityçš„è®¾ç½®ï¼Œæ•´ä¸ªç¨‹åºçš„ä»£ç ä¿®æ”¹é‡ä¹Ÿå°†æ˜¾è‘—é™ä½ã€‚</p><pre data-language="swift"><code><span class="hljs-type">ForEach</span>(students){ student <span class="hljs-keyword">in</span>
  <span class="hljs-keyword">let</span> student = student.viewModel
  <span class="hljs-type">Text</span>(student.name)
  <span class="hljs-type">Text</span>(student.birthdate)
}
</code></pre><p>åŒæ—¶ï¼Œå¯¹äºæ•°æ®çš„å…¶ä»–æ“ä½œï¼Œæˆ‘ä¹Ÿéƒ½é€šè¿‡è¿™ä¸ªviewModelæ¥å®Œæˆã€‚</p><p>æ¯”å¦‚ï¼š</p><pre data-language="swift"><code><span class="hljs-comment">//MARK:é€šè¿‡ViewModelç”ŸæˆNoteæ•°æ®,æ‰€æœ‰çš„prepareåŠ¨ä½œéƒ½éœ€è¦æ˜¾ç¤ºè°ƒç”¨ _coreDataSave()</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">_prepareNote</span><span class="hljs-params">(<span class="hljs-number">_</span> viewModel:NoteViewModel)</span></span> -&gt; <span class="hljs-type">Note</span>{
        <span class="hljs-keyword">let</span> note = <span class="hljs-type">Note</span>(context: context )
        note.id = viewModel.id 
        note.index = <span class="hljs-type">Int32</span>(viewModel.index)  
        note.createDate = viewModel.createDate  
        note.name = viewModel.name 
        note.source = <span class="hljs-type">Int32</span>(viewModel.source)  
        note.descriptionContent = viewModel.descriptionContent 
        note.color = viewModel.color.rawValue 
        <span class="hljs-keyword">return</span> note
    }
    
    <span class="hljs-comment">//MARK:æ›´æ–°Noteæ•°æ®,ä»éœ€æ˜¾ç¤ºè°ƒç”¨save</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">_updateNote</span><span class="hljs-params">(<span class="hljs-number">_</span> note:Note,<span class="hljs-number">_</span> viewModel:NoteViewModel)</span></span> -&gt; <span class="hljs-type">Note</span> {
        note.name = viewModel.name
        note.source = <span class="hljs-type">Int32</span>(viewModel.source)
        note.descriptionContent = viewModel.descriptionContent
        note.color = viewModel.color.rawValue
        <span class="hljs-keyword">return</span> note
    }

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newNote</span><span class="hljs-params">(noteViewModel:NoteViewModel)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">AppAction</span>,<span class="hljs-type">Never</span>&gt; {
       <span class="hljs-keyword">let</span> <span class="hljs-number">_</span> = _prepareNote(noteViewModel)
       <span class="hljs-keyword">if</span>  !_coreDataSave() {
            logDebug(<span class="hljs-string">"æ–°å»ºNoteå‡ºç°é”™è¯¯"</span>)
       }
       <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>(<span class="hljs-type">AppAction</span>.<span class="hljs-keyword">none</span>).eraseToAnyPublisher()
    }
    
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">editNote</span><span class="hljs-params">(note:Note,newNoteViewModel:NoteViewModel)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">AppAction</span>,<span class="hljs-type">Never</span>&gt;{
        <span class="hljs-keyword">let</span> <span class="hljs-number">_</span> = _updateNote(note, newNoteViewModel)
        <span class="hljs-keyword">if</span> !_coreDataSave() {
            logDebug(<span class="hljs-string">"æ›´æ–°Noteå‡ºç°é”™è¯¯"</span>)
        }
        <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>(<span class="hljs-type">AppAction</span>.<span class="hljs-keyword">none</span>).eraseToAnyPublisher()
}
</code></pre><p>åœ¨Viewä¸­è°ƒç”¨</p><pre data-language="swift"><code><span class="hljs-type">Button</span>(<span class="hljs-string">"New"</span>){
      <span class="hljs-keyword">let</span> noteViewModel = <span class="hljs-type">NoteViewModel</span>(createDate: <span class="hljs-type">Date</span>(), descriptionContent: myState.noteDescription, id: <span class="hljs-type">UUID</span>(), index: -<span class="hljs-number">1</span>, name: myState.noteName, source: <span class="hljs-number">0</span>, color: .<span class="hljs-keyword">none</span>)
     store.send(.newNote(noteViewModel: noteViewModel))
     presentationMode.wrappedValue.dismiss()
}
</code></pre><p>ä»è€Œå°†å¯é€‰å€¼æˆ–è€…ç±»å‹è½¬æ¢æ§åˆ¶åœ¨æœ€å°èŒƒå›´</p><h2>ä½¿ç”¨NSPersistentCloudKitContainer éœ€è¦æ³¨æ„çš„é—®é¢˜</h2><p>ä»iOS13å¼€å§‹ï¼Œè‹¹æœæä¾›äº†NSPersistentCloudKitContainerï¼Œè®©appå¯ä»¥ä»¥æœ€ç®€å•çš„æ–¹å¼äº«æœ‰äº†æ•°æ®åº“äº‘åŒæ­¥åŠŸèƒ½ã€‚</p><p>ä¸è¿‡åœ¨ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„å‡ ä¸ªé—®é¢˜ã€‚</p><ul><li>Attribute åœ¨ä¸Šä¸€èŠ‚æé«˜è¿‡ï¼Œç”±äºCloudkitçš„æ•°æ®è®¾å®šå’ŒCoreDataå¹¶ä¸å®Œå…¨å…¼å®¹ï¼Œå› æ­¤å¦‚æœä½ åœ¨é¡¹ç›®åˆå§‹é˜¶æ®µæ˜¯ä½¿ç”¨NSPersistentContainerè¿›è¡Œå¼€å‘çš„ï¼Œå½“å°†ä»£ç æ”¹æˆNSPersistentCloudKitContaineråï¼ŒXCodeå¯èƒ½ä¼šæç¤ºä½ æŸäº›Attributeä¸å…¼å®¹çš„æƒ…å†µã€‚å¦‚æœä½ é‡‡ç”¨äº†ä¸­é—´å±‚å¤„ç†æ•°æ®ï¼Œä¿®æ”¹èµ·æ¥ä¼šå¾ˆæ–¹ä¾¿ï¼Œå¦åˆ™ä½ éœ€è¦å¯¹å·²å®Œæˆçš„ä»£ç åšå‡ºä¸å°‘çš„ä¿®æ”¹å’Œè°ƒæ•´ã€‚æˆ‘é€šå¸¸ä¸ºäº†å¼€å‘è°ƒè¯•çš„æ•ˆç‡ï¼Œåªæœ‰åˆ°æœ€åçš„æ—¶å€™æ‰ä¼šä½¿ç”¨NSPersistentCloudKitContainerï¼Œå› æ­¤è¿™ä¸ªé—®é¢˜ä¼šæ¯”è¾ƒçªå‡ºã€‚</li></ul><ul><li>åˆå¹¶ç­–ç•¥ å¥‡æ€ªçš„æ˜¯ï¼Œåœ¨XCodeçš„CoreDataï¼ˆç‚¹é€‰ä½¿ç”¨CloudKitï¼‰é»˜è®¤æ¨¡æ¿ä¸­ï¼Œå¹¶æ²¡æœ‰è®¾å®šåˆå¹¶ç­–ç•¥ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®çš„è¯ï¼Œå½“appçš„æ•°æ®è¿›è¡Œäº‘åŒæ­¥æ—¶ï¼Œæ—¶é•¿ä¼šå‡ºç°åˆå¹¶é”™è¯¯ï¼Œå¹¶ä¸”@FetchRequestä¹Ÿå¹¶ä¸ä¼šåœ¨æœ‰æ•°æ®å‘ç”Ÿå˜åŠ¨æ—¶å¯¹Viewè¿›è¡Œåˆ·æ–°ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±æ˜ç¡®æ•°æ®çš„åˆå¹¶ç­–ç•¥ã€‚</li></ul><pre data-language="swift"><code>      <span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> persistentContainer: <span class="hljs-type">NSPersistentCloudKitContainer</span> = {
          <span class="hljs-keyword">let</span> container = <span class="hljs-type">NSPersistentCloudKitContainer</span>(name: modelName)
          container.loadPersistentStores(completionHandler: { (storeDescription, error) <span class="hljs-keyword">in</span>
              <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error <span class="hljs-keyword">as</span> <span class="hljs-type">NSError?</span> {
                  <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Unresolved error \(error), \(error.userInfo)"</span>)
              }
          })
          <span class="hljs-comment">//éœ€è¦æ˜¾å¼è¡¨æ˜ä¸‹é¢çš„åˆå¹¶ç­–ç•¥,å¦åˆ™ä¼šå‡ºç°åˆå¹¶é”™è¯¯!</span>
          container.viewContext.automaticallyMergesChangesFromParent = <span class="hljs-literal">true</span>
          container.viewContext.mergePolicy = <span class="hljs-type">NSMergeByPropertyObjectTrumpMergePolicy</span>
          <span class="hljs-keyword">return</span> container
      }()
</code></pre><ul><li>è°ƒè¯•ä¿¡æ¯ å½“æ‰“å¼€äº‘åŒæ­¥åï¼Œåœ¨è°ƒè¯•ä¿¡æ¯ä¸­å°†å‡ºç°å¤§é‡çš„æ•°æ®åŒæ­¥è°ƒè¯•ä¿¡æ¯ï¼Œä¸¥é‡å½±å“äº†å¯¹äºå…¶ä»–è°ƒè¯•ä¿¡æ¯çš„è§‚å¯Ÿã€‚è™½ç„¶å¯ä»¥é€šè¿‡å¯åŠ¨å‘½ä»¤å±è”½æ‰æ•°æ®åŒæ­¥ä¿¡æ¯ï¼Œä½†æœ‰æ—¶å€™æˆ‘è¿˜æ˜¯éœ€è¦å¯¹å…¶è¿›è¡Œè§‚å¯Ÿçš„ã€‚ç›®å‰æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªä¸´æ—¶çš„è§£å†³æ–¹æ¡ˆã€‚</li></ul><pre data-language="swift"><code>  #<span class="hljs-keyword">if</span> !targetEnvironment(macCatalyst) &amp;&amp; canImport(<span class="hljs-type">OSLog</span>)
  <span class="hljs-keyword">import</span> OSLog
  <span class="hljs-keyword">let</span> logger = <span class="hljs-type">Logger</span>.<span class="hljs-keyword">init</span>(subsystem: <span class="hljs-string">"com.fatbobman.DataNote"</span>, category: <span class="hljs-string">"main"</span>) <span class="hljs-comment">//è°ƒè¯•ç”¨</span>
  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">logDebug</span><span class="hljs-params">(<span class="hljs-number">_</span> text:String,enable:Bool = <span class="hljs-literal">true</span>)</span></span>{
      #<span class="hljs-keyword">if</span> <span class="hljs-type">DEBUG</span>
      <span class="hljs-keyword">if</span> enable {
          logger.debug(<span class="hljs-string">"\(text)"</span>)
      }
      #endif
  }
  #<span class="hljs-keyword">else</span>
  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">logDebug</span><span class="hljs-params">(<span class="hljs-number">_</span> text:String,enable:Bool = <span class="hljs-literal">true</span>)</span></span>{
      <span class="hljs-built_in">print</span>(text,<span class="hljs-string">"$$$$"</span>)
  }
  #endif
</code></pre><p>å¯¹äºéœ€è¦æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯çš„åœ°æ–¹</p><pre data-language="swift"><code>  logDebug(<span class="hljs-string">"æ•°æ®æ ¼å¼é”™è¯¯"</span>)
</code></pre><p>ç„¶åé€šè¿‡åœ¨Debugçª—å£ä¸­å°†Filterè®¾ç½®ä¸º$$$$æ¥å±è”½æ‰æš‚æ—¶ä¸æƒ³çœ‹åˆ°çš„å…¶ä»–ä¿¡æ¯</p><h2>ä¸è¦ç”¨SQLçš„æ€ç»´é™åˆ¶äº†CoreDataçš„èƒ½åŠ›</h2><p>CoreDataè™½ç„¶ä¸»è¦æ˜¯é‡‡ç”¨Sqliteæ¥ä½œä¸ºæ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼Œä¸è¿‡å¯¹äºå®ƒçš„æ•°æ®å¯¹è±¡æ“ä½œä¸è¦å®Œå…¨å¥—ç”¨Sqlä¸­çš„æƒ¯ç”¨æ€ç»´ã€‚</p><p>ä¸€äº›ä¾‹å­</p><p>æ’åºï¼š</p><pre data-language="swift"><code><span class="hljs-comment">//Sqlå¼çš„</span>
<span class="hljs-type">NSSortDescriptor</span>(key: <span class="hljs-string">"name"</span>, ascending: <span class="hljs-literal">true</span>)
<span class="hljs-comment">//æ›´CoreDataåŒ–ï¼Œä¸ä¼šå‡ºç°æ‹¼å†™é”™è¯¯</span>
<span class="hljs-type">NSSortDescriptor</span>(keyPath: \<span class="hljs-type">Student</span>.name, ascending: <span class="hljs-literal">true</span>)
</code></pre><p>åœ¨æ–­è¨€ä¸­ä¸é€‚ç”¨å­æŸ¥è¯¢è€Œç›´æ¥æ¯”è¾ƒå¯¹è±¡ï¼š</p><pre data-language="swift"><code><span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"itemData.item.name = %@"</span>,name)
</code></pre><p>Count:</p><pre data-language="swift"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">_getCount</span><span class="hljs-params">(entity:String,predicate:NSPredicate?)</span></span> -&gt; <span class="hljs-type">Int</span>{
        <span class="hljs-keyword">let</span> fetchRequest = <span class="hljs-type">NSFetchRequest</span>&lt;<span class="hljs-type">NSNumber</span>&gt;(entityName: entity)  
        fetchRequest.predicate = predicate
        fetchRequest.resultType = .countResultType
        
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">let</span> results  = <span class="hljs-keyword">try</span> context.fetch(fetchRequest)
            <span class="hljs-keyword">let</span> <span class="hljs-built_in">count</span> = results.first!.intValue
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">count</span>
        }
        <span class="hljs-keyword">catch</span> {
            #<span class="hljs-keyword">if</span> <span class="hljs-type">DEBUG</span>
            logDebug(<span class="hljs-string">"\(error.localizedDescription)"</span>)
            #endif
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        }
    }
</code></pre><p>æˆ–è€…æ›´åŠ ç®€å•çš„count</p><pre data-language="swift"><code>@<span class="hljs-type">FetchRequest</span>(sortDescriptors: [<span class="hljs-type">NSSortDescriptor</span>(keyPath: \<span class="hljs-type">Student</span>.name, ascending: <span class="hljs-literal">true</span>)],
              animation: .<span class="hljs-keyword">default</span>) 
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> students: <span class="hljs-type">FetchedResults</span>&lt;<span class="hljs-type">Student</span>&gt;

sutudents.<span class="hljs-built_in">count</span>
</code></pre><p>å¯¹äºæ•°æ®é‡ä¸å¤§çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸é‡‡ç”¨ä¸Šé¢çš„åŠ¨æ€predicateæ–¹å¼ï¼Œåœ¨Viewä¸­ç›´æ¥å¯¹è·å–åçš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚ï¼š</p><pre data-language="swift"><code>@<span class="hljs-type">FetchRequest</span>(sortDescriptors: [<span class="hljs-type">NSSortDescriptor</span>(keyPath: \<span class="hljs-type">Student</span>.name, ascending: <span class="hljs-literal">true</span>)],
              animation: .<span class="hljs-keyword">default</span>) 
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> studentDatas: <span class="hljs-type">FetchedResults</span>&lt;<span class="hljs-type">Student</span>&gt;
@<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> students:[<span class="hljs-type">Student</span>] = []
<span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
  <span class="hljs-type">List</span>{
        <span class="hljs-type">ForEach</span>(students){ student <span class="hljs-keyword">in</span>
           <span class="hljs-type">Text</span>(student.viewModel.name)
         }
        }
        .onReceive(studentDatas.publisher){ <span class="hljs-number">_</span> <span class="hljs-keyword">in</span>
            students = studentDatas.<span class="hljs-built_in">filter</span>{ student <span class="hljs-keyword">in</span>
                student.viewModel.age &gt; <span class="hljs-number">10</span>
            }
        }
   }
}
</code></pre><p>æ€»ä¹‹æ•°æ®çš†å¯¹è±¡</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/healthnote2-3rd-package</guid><title>ä»‹ç»å‡ ä¸ªæˆ‘åœ¨å¼€å‘å¥åº·ç¬”è®°2ç”¨åˆ°çš„Swiftæˆ–SwiftUIç¬¬ä¸‰æ–¹åº“</title><description>æœ¬æ–‡ä»‹ç»äº†å…¶ä¸­å‡ ä¸ªåœ¨å¥åº·ç¬”è®°å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹çš„å¼€æºåº“</description><link>http://www.fatbobman.com/posts/healthnote2-3rd-package</link><pubDate>Tue, 27 Oct 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<h2><a href="https://github.com/SwiftUIX/SwiftUIX">SwiftUIX</a></h2><blockquote><p>SwiftUIXè¯•å›¾å¼¥è¡¥ä»å¤„äºæ–°ç”Ÿé˜¶æ®µçš„SwiftUIæ¡†æ¶çš„ç©ºç™½ï¼Œæä¾›äº†å¹¿æ³›çš„ç»„ä»¶ï¼Œæ‰©å±•å’Œå®ç”¨ç¨‹åºå¥—ä»¶æ¥è¡¥å……æ ‡å‡†åº“ã€‚ è¿„ä»Šä¸ºæ­¢ï¼Œè¯¥é¡¹ç›®æ˜¯ç¼ºå°‘çš„UIKit / AppKitåŠŸèƒ½çš„æœ€å®Œæ•´çš„ç§»æ¤ï¼ŒåŠ›æ±‚ä½¿å…¶ä»¥å¤§å¤šæ•°ç±»ä¼¼äºAppleçš„æ–¹å¼äº¤ä»˜ã€‚ è¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯è¡¥å……SwiftUIæ ‡å‡†åº“ï¼Œæä¾›æ•°ç™¾ç§æ‰©å±•å’Œè§†å›¾ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°é€šè¿‡SwiftUIçš„é©å‘½æ¥æ„å»ºåº”ç”¨ç¨‹åºã€‚</p></blockquote><p>æä¾›äº†éå¸¸å¤šçš„è‹¹æœæœ¬åº”æä¾›ä½†æ²¡æœ‰æä¾›çš„åŠŸèƒ½æ‰©å±•ã€‚é¡¹ç›®çš„å‘èµ·è€…éå¸¸å¹´è½»ï¼Œä½†macçš„å¼€å‘ç»éªŒååˆ†ä¸°å¯Œã€‚åˆ°ç›®å‰ä¸ºæ­¢ä¸€ç›´ä¿æŒçš„è¾ƒé«˜çš„æ›´æ–°é¢‘ç‡å’Œç»´æŠ¤çŠ¶æ€ã€‚è¿™ä¸ªåº“åŒæ—¶æ”¯æŒUIKitå’ŒAppkitï¼Œå¯¹äºéœ€è¦åšè‹¹æœç”Ÿæ€å…¨å¹³å°çš„ç”¨æˆ·ååˆ†å‹å¥½ã€‚ç”±äºç›®å‰SwiftUIçš„Listå’ŒLazyVStackçš„é—®é¢˜è¿˜å¾ˆå¤šï¼Œä»–è‡ªå·±åœ¨å¼€å‘ä¸­ä¹Ÿæ·±å—å…¶è‹¦ï¼Œå‰å¤©åœ¨äº¤æµä¸­ï¼Œä»–å·²ç»å†³å®šé‡åšCocoaListåŠŸèƒ½ï¼Œå°¤å…¶æé«˜å¯¹Fetchrequestçš„æ”¯æŒã€‚</p><p>å¯¹äºè¿›è¡ŒSwiftUIå¼€å‘çš„æœ‹å‹ï¼Œå®ƒæ˜¯ååˆ†å€¼å¾—æ¨èçš„ã€‚</p><p>ç›®å‰çš„é—®é¢˜æ˜¯æ–‡æ¡£å¤ªå°‘ã€‚ä¸è¿‡å¯¹æˆ‘æ¥è¯´ä¹Ÿæœªå°ä¸æ˜¯ä¸€ä¸ªå¥½äº‹ã€‚åœ¨ç ”ç©¶å®ƒçš„ç”¨æ³•è¿‡ç¨‹ä¸­ï¼Œç»™äº†æˆ‘æ›´å¤šçš„æœºä¼šé˜…è¯»å¹¶å­¦ä¹ å®ƒçš„ä»£ç ï¼Œå¯¹SwiftUIï¼ŒUIkitç­‰æœ‰äº†æ›´å¤šçš„è®¤è¯†å’Œäº†è§£ã€‚</p><h2><a href="https://github.com/danielgindi/Charts">Charts</a></h2><blockquote><p>denielgindiå¯¹è‘—åçš„å®‰å“å›¾è¡¨åº“ MPAndroidChartçš„Swiftç§»æ¤ã€‚æ˜¯ç›®å‰ä¸å¤šçš„çº¯Swiftè§£å†³æ–¹æ¡ˆã€‚å®ƒçš„ä¼˜åŠ¿ä¹Ÿæ˜¯åŒæ—¶æ”¯æŒUIKitå’ŒAppkitï¼ŒåŒæ—¶æä¾›äº†ä¸é”™çš„Demoç¤¾åŒºæ´»è·ƒåº¦ã€‚</p></blockquote><p>ä¸è¿‡ä»–çš„å¼€å‘è€…å¥½åƒä¸æ‰“ç®—åœ¨3.xç‰ˆæœ¬ä¸Šåœ¨å¢åŠ å¤ªå¤šçš„åŠŸèƒ½ï¼Œéå¸¸å¤šç›®å‰æ€¥éœ€å¹¶ä¸”å·²æœ‰è§£å†³æ–¹æ¡ˆçš„åŠŸèƒ½å¹¶æ²¡æœ‰è¢«å½“å‰ç‰ˆæœ¬æ¥å—ã€‚æ‰€ä»¥æ•´ä½“çš„è§†è§‰å‘ˆç°è¿˜æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„ã€‚ç¤¾åŒºä¸Šå¯¹äºåŠŸèƒ½çš„è®¨è®ºä¸å°‘ï¼Œä½†åˆå¹¶çš„æå°‘ï¼Œ4.0çš„ç‰ˆæœ¬å¥½åƒä¹Ÿå·²ç»å¼€å‘äº†ä¸çŸ­çš„æ—¶é—´äº†ï¼Œä¸è¿‡è¿›åº¦å¥½åƒä¹Ÿä¸æ˜¯ç‰¹åˆ«ç†æƒ³ã€‚</p><p>ä»æ•ˆç‡ä¸Šè®²ï¼ŒChartsåº”è¯¥æ˜¯éå¸¸åˆæ ¼çš„äº†ã€‚</p><p><a href="https://www.hangge.com">èˆªæ­Œ</a> ä¸Šé¢æœ‰éå¸¸è¯¦ç»†çš„ä¸­æ–‡ä½¿ç”¨æ•™ç¨‹ï¼Œå¯¹æˆ‘çš„å­¦ä¹ å¸®åŠ©å¾ˆå¤§ã€‚</p><p>ä¸ºäº†å¥åº·ç¬”è®°å¼€å‘çš„éœ€è¦ï¼Œæˆ‘åœ¨å½“å‰3.6çš„ç‰ˆæœ¬ä¸Šåˆå¹¶äº†ä¸¤ä¸ªç¤¾åŒºä¸Šè¾ƒä¸ºæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>åœ†è§’Bar</li></ul><pre data-language="swift"><code>  dataSet.roundedCorners = [.topLeft,.topRight]
</code></pre><ul><li>æ¸å˜è‰²Bar</li></ul><pre data-language="swift"><code>  dataSet.drawBarGradientEnabled = <span class="hljs-literal">true</span>
              dataSet.colors = [<span class="hljs-type">UIColor</span>(named: <span class="hljs-string">"barColor1"</span>)!, <span class="hljs-type">UIColor</span>(named: <span class="hljs-string">"barColor1"</span>)!, <span class="hljs-type">UIColor</span>(named: <span class="hljs-string">"barColor2"</span>)!]
              dataSet.gradientPositions = [<span class="hljs-number">0</span>, <span class="hljs-number">40</span>, <span class="hljs-number">100</span>]
</code></pre><p>ç”±äºå½“å‰çš„Chartsæœ¬èº«å¹¶ä¸æ”¯æŒå¯¹äºå›¾è¡¨æ»šåŠ¨ååœæ­¢äº‹ä»¶çš„å“åº”ï¼Œæˆ‘è‡ªå·±ä¸ºå®ƒå¢åŠ äº†åœæ­¢å“åº”ã€‚</p><pre data-language="swift"><code>        <span class="hljs-comment">//æ»šåŠ¨ç»ˆæ­¢æ—¶è°ƒç”¨</span>
        <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">chartScrollStop</span><span class="hljs-params">(<span class="hljs-number">_</span> chartView:ChartViewBase)</span></span>{
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"stopped"</span>)
        }
</code></pre><p>ä¿®æ”¹åçš„ä»£ç <a href="https://github.com/fatbobman/Charts">åœ¨æ­¤å¯ä»¥è·å¾—</a>ã€‚</p><h2><a href="https://github.com/siteline/SwiftUI-Introspect">Introspect</a></h2><blockquote><p>Introspectå…è®¸æ‚¨è·å–SwiftUIè§†å›¾çš„åŸºç¡€UIKitæˆ–AppKitå…ƒç´ ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨Introspectï¼Œæ‚¨å¯ä»¥è®¿é—®UITableViewæ¥ä¿®æ”¹åˆ†éš”ç¬¦ï¼Œæˆ–è®¿é—®UINavigationControlleræ¥è‡ªå®šä¹‰é€‰é¡¹å¡æ ã€‚</p></blockquote><p>æœ‰ä¸€ä¸ªéå¸¸æ¨èçš„åˆ©å™¨ã€‚ç›®å‰å®˜æ–¹å¯¹äºSwiftUIä¸­çš„æ§ä»¶æä¾›çš„å¯æ§é€‰é¡¹å¾ˆå°‘ï¼Œå¦‚æœæƒ³åšä¸€äº›æ·±åº¦å®šåˆ¶çš„è¯ï¼Œé€šå¸¸å°±æ˜¯è‡ªå·±å†™ä»£ç æ¥é‡æ–°åŒ…è£…UIkitæ§ä»¶ã€‚ä¸è¿‡introspectæä¾›äº†ä¸€ä¸ªéå¸¸å·§å¦™çš„åŠæ³•é€šè¿‡ç®€å•çš„æ³¨å…¥æ–¹å¼ä¾¿å¯ä»¥å¯¹SwiftUIæ§ä»¶åšæ›´å¤šçš„è°ƒæ•´ã€‚</p><p>æ¯”å¦‚ï¼š</p><p>åªæœ‰å½“å†…å®¹è¶…å‡ºæ˜¾ç¤ºèŒƒå›´æ‰è¿›è¡Œæ»šåŠ¨</p><pre data-language="swift"><code><span class="hljs-type">ScrollView</span>{
    ....
}
.introspectScrollView{ scrollView <span class="hljs-keyword">in</span>
        crollView.isScrollEnabled = scrollView.contentSize.height &gt; scrollView.frame.height
               }
</code></pre><p>æ˜¾ç¤ºTextFieldçš„clearæŒ‰é’®</p><pre data-language="swift"><code><span class="hljs-type">TextField</span>(<span class="hljs-string">"note_noteName"</span>,text: $myState.noteName)
          .introspectTextField{ text <span class="hljs-keyword">in</span>
             text.clearButtonMode = .whileEditing
           }
</code></pre><p>å¯¹äºæ–°çš„æ§ä»¶å®ƒæœ¬èº«è¿˜æ²¡æä¾›å…·ä½“æ”¯æŒçš„ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„æ³¨å…¥</p><p>ä¿®æ”¹SwiftUI2.0ä¸­æ–°æä¾›çš„TextEditorèƒŒæ™¯è‰²</p><pre data-language="swift"><code><span class="hljs-type">TextEditor</span>(text: $text)
                .introspect(selector: <span class="hljs-type">TargetViewSelector</span>.sibling){ textView <span class="hljs-keyword">in</span>
                    textView.backgroundColor = .clear
                }
</code></pre><p>ç­‰ç­‰ã€‚ç±»ä¼¼çš„ç”¨æ³•åœ¨æˆ‘æ•´ä¸ªçš„å¼€å‘ä¸­çš„ä½¿ç”¨é¢‘ç‡æ˜¯å¾ˆé«˜çš„ã€‚</p><h2><a href="https://github.com/malcommac/SwiftDate">SwiftDate</a></h2><blockquote><p>ä½¿ç”¨Swiftç¼–å†™çš„æ—¶é—´æ—¥æœŸå¤„ç†åº“ã€‚åŒæ—¶æ”¯æŒè‹¹æœå¹³å°ä»¥åŠLinuxã€‚</p></blockquote><p>å®ƒæä¾›äº†éå¸¸è¯¦å°½çš„æ–‡æ¡£ï¼Œèˆªå“¥ä¸Šä¹Ÿæœ‰éå¸¸å¥½çš„ä¸­æ–‡æ•™ç¨‹ã€‚</p><p>ç”±äºå¥åº·ç¬”è®°éœ€è¦å¯¹æ•°æ®è¿›è¡Œä¸å°‘å¤„ç†ï¼Œå°¤å…¶æ˜¯éœ€è¦å°†ç›¸åŒæ—¶é—´ç²’åº¦çš„æ•°æ®è¿›è¡Œåˆå¹¶æ¯”è¾ƒã€‚SwiftDateæä¾›çš„Regionæ–¹æ¡ˆæä¾›äº†å®Œç¾çš„è§£å†³é€”å¾„ã€‚</p><p>åœ¨SwiftDateä¸­ï¼Œæˆ‘å¤šæ•°ä½¿ç”¨å®ƒæä¾›çš„DateInRegionæ¥å¤„ç†æ—¥æœŸã€‚é€šè¿‡</p><pre data-language="swift"><code><span class="hljs-type">SwiftDate</span>.defaultRegion = region
</code></pre><p>æˆ‘å‡ ä¹æ— éœ€å…³å¿ƒæ—¥æœŸçš„æœ¬åœ°åŒ–é—®é¢˜ã€‚è€Œä¸”å®ƒä¹Ÿæä¾›äº†éƒ¨åˆ†çš„æ—¥æœŸæ—¶é—´çš„æœ¬åœ°åŒ–æ˜¾ç¤ºæ–¹æ¡ˆï¼ˆä½†å¹¶ä¸å®Œç¾ï¼‰ã€‚</p><p>ä¸€äº›ä½¿ç”¨ä¸¾ä¾‹ï¼š</p><p>é™¤éç”¨æˆ·åœ¨appä¸­è®¾å®šäº†ç‰¹å®šçš„æ—¶åŒºï¼Œå¦åˆ™ä½¿ç”¨å½“å‰è®¾å¤‡çš„é»˜è®¤è®¾ç½®ï¼š</p><pre data-language="swift"><code><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data = <span class="hljs-type">UserDefaults</span>.standard.data(forKey: <span class="hljs-string">"dateRegion"</span>),
           <span class="hljs-keyword">let</span> region = <span class="hljs-keyword">try</span>? <span class="hljs-type">JSONDecoder</span>().decode(<span class="hljs-type">Region</span>.<span class="hljs-keyword">self</span>, from: data) {
            <span class="hljs-type">SwiftDate</span>.defaultRegion = region
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-type">SwiftDate</span>.defaultRegion = <span class="hljs-type">Region</span>(calendar: <span class="hljs-type">Calendars</span>.gregorian, zone: <span class="hljs-type">Zones</span>.current, locale: <span class="hljs-type">Locales</span>.current)
        }
</code></pre><p>åˆ¤æ–­æŸä¸ªæ—¥æœŸå’ŒæŒ‡å®šæ—¥æœŸçš„å¤©æ•°å·®ï¼ˆæœ¬åœ°æ—¶åŒºï¼‰ï¼š</p><pre data-language="swift"><code><span class="hljs-keyword">let</span> startDate = <span class="hljs-type">DateInRegion</span>(datas.first!.viewModel.date1).dateTruncated(at: [.hour,.minute,.second])!
duration = date.difference(<span class="hljs-keyword">in</span>: .day, from: startDate) ?? <span class="hljs-number">0</span>
</code></pre><p>å¦‚æœä½ çš„ç¨‹åºéœ€è¦å¯¹æ—¥æœŸè¿›è¡Œé¢‘ç¹çš„å¤„ç†æˆ–è€…æœ‰è¾ƒå¤šçš„æœ¬åœ°åŒ–éœ€æ±‚æ—¶ï¼ŒSwiftDateæ˜¯éå¸¸å¥½çš„é€‰æ‹©ï¼</p><h2><a href="https://github.com/fatbobman/SwiftUIOverlayContainer">SwiftUIOverlayContainer</a></h2><blockquote><p>SwiftUIOverlayContaineræœ¬èº«å¹¶ä¸æä¾›ä»»ä½•é¢„ç½®çš„è§†å›¾æ ·å¼ï¼Œä¸è¿‡é€šè¿‡å®ƒï¼Œä½ æœ‰å……åˆ†çš„è‡ªæœ‰åº¦æ¥å®ç°è‡ªå·±éœ€è¦çš„è§†å›¾æ•ˆæœã€‚OverlayContainerçš„ä¸»è¦ç›®çš„åœ¨äºå¸®åŠ©ä½ å®ŒæˆåŠ¨ç”»ã€äº¤äº’ã€æ ·å¼å®šåˆ¶ç­‰åŸºç¡€å·¥ä½œï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿå°†æ—¶é—´å’Œç²¾åŠ›ä»…éœ€æŠ•å…¥åœ¨è§†å›¾æœ¬èº«çš„ä»£ç ä¸Šã€‚</p></blockquote><p>è¿™æ˜¯æˆ‘è‡ªå·±å†™çš„ä¸€ä¸ªåº“ï¼Œè¿™æ¬¡é€šè¿‡å®ƒå®ç°çš„å±å¹•ä¾§è¾¹æ»‘åŠ¨èœå•ã€‚</p><p>æœ¬æ¥å®ƒçš„ç”¨é€”ä¸»è¦ä¸æ˜¯åšè¿™ä¸ªçš„ï¼Œæš‚æ—¶ä½¿ç”¨å®ƒæ¥å®Œæˆä¾§å‘æ»‘åŠ¨èœå•ä¹Ÿæ˜¯æƒå®œä¹‹è®¡ï¼Œè¡¨ç°å°šå¯ã€‚</p><h2><a href="https://github.com/weichsel/ZIPFoundation">ZIPFoundation</a></h2><blockquote><p>ZIP Foundationæ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºï¼Œè¯»å–å’Œä¿®æ”¹ZIPå­˜æ¡£æ–‡ä»¶çš„åº“ã€‚ å®ƒæ˜¯ç”¨Swiftç¼–å†™çš„ï¼ŒåŸºäºAppleçš„libcompressionæ¥å®ç°é«˜æ€§èƒ½å’Œé«˜èƒ½æ•ˆã€‚</p></blockquote><p>å°å·§ã€é«˜æ•ˆï¼Œä½¿ç”¨ä¾¿æ·ã€‚å¥åº·ç¬”è®°åœ¨æ•°æ®å¯¼å…¥å¯¼å‡ºæ—¶ï¼Œä½¿ç”¨å®ƒæ¥å®Œæˆzipæ–‡ä»¶çš„æ“ä½œã€‚</p><p>æ¯”å¦‚è§£å‹å¤‡ä»½æ•°æ®ï¼š</p><pre data-language="swift"><code><span class="hljs-comment">//æ‰“å¼€æ²™ç›’è¯»å–æƒé™</span>
   <span class="hljs-number">_</span> = url.startAccessingSecurityScopedResource() 
<span class="hljs-comment">//è§£å‹</span>
   <span class="hljs-keyword">do</span> {
      <span class="hljs-keyword">try</span> <span class="hljs-type">FileManager</span>.<span class="hljs-keyword">default</span>.unzipItem(at: url, to: <span class="hljs-type">URL</span>(fileURLWithPath: <span class="hljs-type">NSTemporaryDirectory</span>()))
        }
        <span class="hljs-keyword">catch</span> {
          
        }
</code></pre><h2><a href="https://github.com/keitaoouchi/MarkdownView">MarkdownView</a></h2><blockquote><p>åŸºäºWKwebViewå®ç°çš„Markdownæ–‡ä»¶Viewerã€‚å¯¹mdçš„è§£ææ˜¯é€šè¿‡è°ƒç”¨jsåº“æ¥å®Œæˆçš„ã€‚</p></blockquote><p>ç”±äºSwiftUIçš„Textæ–‡æœ¬æ’ç‰ˆèƒ½åŠ›å‡ ä¹ä¸ºé›¶ï¼Œå› æ­¤æˆ‘é€‰æ‹©ä½¿ç”¨mdæ ¼å¼æ¥ä¿å­˜appæ‰€éœ€çš„ä¸€äº›æ–‡å­—æ˜¾ç¤ºï¼Œæ¯”å¦‚éšç§æ”¿ç­–ç­‰ã€‚</p><p>MarkdownViewçš„æ¸²æŸ“æ•ˆç‡ä¸€èˆ¬ï¼Œä½†æˆ‘çš„æ˜¾ç¤ºéœ€æ±‚å¹¶ä¸å¤§ï¼Œæ‰€ä»¥æ„Ÿè§‰ä¸æ˜æ˜¾ã€‚ä½†å®ƒçš„å¼€å‘è€…å¯¹jsæ–‡ä»¶è¿›è¡Œäº†åŠ æ‰°å¤„ç†ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³å¯¹å…¶ä¸­å®ƒæ‰€è°ƒç”¨çš„ä¾‹å¦‚mardown-itè¿›è¡Œæ›´å¤šé…ç½®çš„è¯ï¼Œå°±å‡ ä¹ä¸å¯èƒ½äº†ã€‚</p><p>å¦å¤–ï¼Œé€šè¿‡UIViewRepresentableå¯¹å…¶è¿›è¡Œå°è£…ï¼Œåœ¨SwiftUIä¸‹æ˜¯æ— æ³•æ­£ç¡®è·å–frameçš„å°ºå¯¸çš„ï¼Œä»è€Œæ— æ³•æ­£ç¡®æ˜¾ç¤ºã€‚æˆ‘å¯¹äºUIkitæ‰€çŸ¥ç”šå°‘ï¼Œåªèƒ½åšäº†æœ€ç®€å•çš„ä¿®æ”¹ï¼Œå‹‰å¼ºè®©å…¶å¯ä»¥åœ¨SwiftUIä¸‹å®Œæˆæ‰€éœ€è¦çš„åŠŸèƒ½ã€‚</p><p>ä¿®æ”¹åçš„ç‰ˆæœ¬å¯åœ¨<a href="https://github.com/fatbobman/MarkdownView">è¿™é‡Œä¸‹è½½</a></p><p>å¦å¤–ï¼Œæˆ‘åœ¨UIViewRepresentableåŒ…è£…ä¸­å¢åŠ äº†ä¸€äº›ç®€å•çš„ä¿®æ”¹ï¼Œä½¿å…¶å¯ä»¥æ–¹ä¾¿çš„å°†mdä¸­çš„å›¾ç‰‡ï¼Œæ›¿æ¢æˆBundleä¸­çš„æœ¬åœ°å›¾ç‰‡ã€‚</p><p>è°ƒç”¨ä»£ç  <a href="https://github.com/fatbobman/ShareCode/blob/main/MarkDownView.swift">ä¸‹è½½</a></p><h2><a href="https://github.com/avielg/ExcelExport/blob/master/Sources/ExcelExport/ExcelExport.swift">ExcelExport</a></h2><blockquote><p>ç”ŸæˆXSLæ–‡ä»¶çš„Swiftä»£ç ã€‚</p></blockquote><p>è¿™æ®µä»£ç æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¸è¿‡å»å¹´åˆåšäº†æ›´æ–°ï¼Œä¸è¿‡æˆ‘æ„Ÿè§‰æ›´æ–°åçš„ç‰ˆæœ¬è¿˜ä¸å¦‚ä¹‹å‰çš„ã€‚ä½†å®ƒçš„æ–°ç‰ˆæœ¬ä¸æ”¯æŒDateçš„å­—æ®µå¯¼å‡ºï¼Œè€ç‰ˆæœ¬å¯¼å‡ºçš„Dateå­—æ®µæ ¼å¼åœ¨Excelä¸­ä¹Ÿæœ‰é—®é¢˜ã€‚æˆ‘åˆå¹¶äº†ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸”è®©å…¶åœ¨å‘½åä¸Šå¯¹SwiftUIæ›´åŠ å‹å¥½ã€‚</p><p>ä¿®æ”¹åçš„ä»£ç  <a href="https://github.com/fatbobman/ShareCode/blob/main/ExcelExport">ä¸‹è½½</a></p><p>å¿…é¡»å¯¹æ—¥æœŸåšå¦‚ä¸‹å¤„ç†ï¼Œæ—¥æœŸå­—æ®µæ‰èƒ½è¢«Excelé¡ºåˆ©è¯†åˆ«</p><pre data-language="swift"><code> <span class="hljs-keyword">let</span> date = <span class="hljs-type">DateInRegion</span>(memo.viewModel.date).toFormat(<span class="hljs-string">"yyyy-MM-dd"</span>)
 <span class="hljs-keyword">let</span> time = <span class="hljs-type">DateInRegion</span>(memo.viewModel.date).toFormat(<span class="hljs-string">"HH:mm:ss.FFF"</span>)
 <span class="hljs-keyword">let</span> dateCell = <span class="hljs-type">ExcelCell</span>(date + <span class="hljs-string">"T"</span> + time,type: .dateTime)
</code></pre><p>ä¸Šè¿°çš„åº“éƒ½è¢«ä½¿ç”¨åœ¨ <a href="https://apps.apple.com/us/app/health-notes-2/id1534513553">å¥åº·ç¬”è®°2.0</a> ä¸­ã€‚å¦‚æƒ³æŸ¥çœ‹æ›´å¤šçš„æ¼”ç¤ºï¼Œå¯ä»¥ç§»æ­¥</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/healthNote2-development-memo-6</guid><title>å¥åº·ç¬”è®°2.0å¼€å‘éšç¬”ï¼ˆå…­ï¼‰</title><description>ä¸€æ™ƒå›½åº†ä¸­ç§‹é•¿å‡å³å°†ç»“æŸï¼Œè·ç¦»ä¸Šæ¬¡çš„éšç¬”ä¹Ÿæœ‰äº†ä¸€æ®µæ—¶é—´ã€‚åœ¨æœ€è¿‘çš„æ—¥å­é‡Œï¼Œæˆ‘ä¸€æ–¹é¢ç»§ç»­ç€å¼€å‘çš„è¿›ç¨‹ï¼ŒåŒæ—¶è¿˜è¦ä»˜å‡ºç›¸å½“çš„ç²¾åŠ›åŒiOS14ä¸­çš„å„ç§Bugå’Œå¼‚å¸¸æ–—æ™ºæ–—å‹‡ã€‚æœ¬ç¯‡éšç¬”ä¸»è¦è®°å½•äº†è¿™æ®µæ—¶é—´ç¢°åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œä»¥åŠèŠèŠiOS14ã€Xcode12ä»¥åŠSwiftUI2.0çš„ä¸€äº›ä¼˜ç¼ºç‚¹ã€‚æƒ³åˆ°å“ªã€å†™åˆ°å“ªï¼Œå¯èƒ½é€»è¾‘ä¼šæ¯”è¾ƒæ··ä¹±ã€‚</description><link>http://www.fatbobman.com/posts/healthNote2-development-memo-6</link><pubDate>Mon, 26 Oct 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<p>æ”¶å°¾å·¥ä½œå¾€å¾€æ˜¯æœ€æ¯ç‡¥çš„ã€‚</p><p>æœ€è¿‘è¿™10å‡ å¤©ï¼Œä¸»è¦çš„å·¥ä½œéƒ½æ˜¯æŸ¥æ‰¾bugï¼Œæ”¹è¿›æ€§èƒ½ï¼Œåå¤æµ‹è¯•æ•°æ®çš„ç¨³å®šæ€§ï¼Œä»¥åŠæ›´åŠ æ¯ç‡¥çš„æ–‡æ¡£å‡†å¤‡å·¥ä½œã€‚</p><p>å‘app storeæäº¤åå€’å¼‚å¸¸é¡ºåˆ©ï¼Œä¸­é—´åªå‡ºç°äº†ä¸€æ¬¡åå¤ã€‚è‹¹æœè¦æˆ‘ç¡®è®¤æ˜¯å¦ä¼šæ»¥ç”¨ç”¨æˆ·çš„æ•°æ®ï¼Œåœ¨æ˜ç¡®å›å¤ä¸ä¼šä¹‹åå°±é€šè¿‡äº†ã€‚æƒ³æƒ³å»å¹´åº•å¥åº·ç¬”è®°1.0çš„ä¸Šçº¿åå¤æŠ˜è…¾äº†æˆ‘10å¤šå¤©ã€‚</p><p>XCode 12ä¸­çš„StoreKitå¯¹äºè°ƒè¯•åº”ç”¨å†…çš„è´­ä¹°å®åœ¨æ˜¯å¤ªæ–¹ä¾¿äº†ï¼Œåœ¨å¼€å‘çš„æœ€åé˜¶æ®µï¼Œæˆ‘å°†appåˆ†æˆäº†åŸºç¡€ç‰ˆå’Œä¸“ä¸šç‰ˆã€‚åŸºç¡€ç‰ˆå…¶å®å·²ç»èƒ½åº”å¯¹ç”Ÿæ´»ä¸­ç»å¤§å¤šæ•°çš„éœ€æ±‚äº†ã€‚é€šè¿‡StoreKitçš„æ¨¡æ‹Ÿç¯å¢ƒï¼Œæˆ‘çš„åº”ç”¨å†…è´­ä¹°æ²¡æœ‰ä½¿ç”¨ä»»ä½•æ²™ç›’æµ‹è¯•ä¾¿ä¸€æ¬¡æ€§çš„å¼€å‘è°ƒè¯•æˆåŠŸï¼Œå¹¶ä¸”ä¸Šçº¿åä¹Ÿè¿è¡Œæ­£å¸¸ã€‚æå¤§çš„æé«˜äº†æ•ˆç‡ï¼</p><p>åœ¨æœ¬æ¬¡å†æ—¶è¿‘ä¸¤ä¸ªæœˆçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬ä¸Šæ²¡èµ°å¤ªå¤šå¼¯è·¯ã€‚çœŸæ­£è®©æˆ‘æ¶ˆè€—ç²¾åŠ›çš„åå€’æ˜¯å’ŒiOS 14ä»¥åŠSwiftUI 2.0ä¸­çš„Bugæ–—æ™ºæ–—å‹‡ã€‚å¾ˆå¤šå¥‡æ€ªçš„é—®é¢˜ï¼Œåœ¨å¯¹è‡ªå·±ä»£ç åå¤çš„æ£€æŸ¥ä¹‹åæ‰èƒ½åŸºæœ¬ç¡®è®¤æ˜¯ç³»ç»Ÿçš„åŸå› ï¼Œç„¶åè¿˜éœ€è¦è®¾æ³•ç”¨æœ€å°‘çš„ä»£ç é‡ç°é—®é¢˜å¾—ä»¥æœ€ç»ˆç¡®è®¤ã€‚ä»WWDC20è¿‡åï¼Œç›®å‰å·²ç»ç»™è‹¹æœæäº¤äº†10å‡ æ¡çš„Feedbackã€‚å…¶ä¸­è¶…è¿‡åŠæ•°åœ¨ä¸æ–­çš„ç‰ˆæœ¬å‡çº§åå¾—åˆ°äº†ä¿®å¤ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘åœ¨è¿™æ¬¡çš„å¼€å‘ä¸­ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæˆ‘æœ€è¿‘ä¼šå¯¹è¿™äº›åº“è¿›è¡Œè¯¦ç»†çš„ä»‹ç»ï¼š</p><ul><li>SwiftUIX</li><li>Charts</li><li>Introspect</li><li>ZIPFoundation</li><li>SwiftUIOverlayContainer</li><li>SwiftDate</li><li>MarkdownView</li></ul><p>iPadçš„é€‚é…å·¥ä½œé‡ä¹Ÿæ¯”æƒ³è±¡ä¸­çš„å¤§ã€‚å°½ç®¡SwiftUIå·±ç»æä¾›äº†æå¤§çš„æ–¹ä¾¿ï¼Œä½†å¦‚æœæƒ³æ›´å¥½çš„åˆ©ç”¨iPadçš„ç‰¹æ€§çš„è¯ï¼Œè¿˜æ˜¯æœ‰ä¸å°‘å·¥ä½œéœ€è¦å®Œæˆçš„ã€‚</p><p>æœ¬åœ°åŒ–ä¹Ÿæ˜¯è¿™æ¬¡å¼€å‘çš„ä¸€ä¸ªç›®æ ‡ï¼Œéš¾åº¦ä¸å¤ªå¤§ï¼Œä½†å·¥ä½œé‡ä¸å°ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/healthnote2-release</guid><title>å¥åº·ç¬”è®°2.0æ­£å¼ç‰ˆå®Œæˆäº†!</title><description>ç»è¿‡äº†å¤§åŠå¹´çš„ç§¯ç´¯å’Œå‡†å¤‡,æŒç»­äº†2ä¸ªæœˆçš„å¼€å‘,å¥åº·ç¬”è®°2.0åœ¨æ˜¨å¤©ä¸Šçº¿äº†.</description><link>http://www.fatbobman.com/posts/healthnote2-release</link><pubDate>Mon, 26 Oct 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<p>ç»è¿‡äº†å¤§åŠå¹´çš„ç§¯ç´¯å’Œå‡†å¤‡,æŒç»­äº†2ä¸ªæœˆçš„å¼€å‘,å¥åº·ç¬”è®°2.0åœ¨æ˜¨å¤©ä¸Šçº¿äº†.</p><p>æœ¬æ¬¡å¼€å‘,æˆ‘é‡å†™äº†å¥åº·ç¬”è®°çš„å…¨éƒ¨ä»£ç ,æœ€åçš„ç»“æœä¸ªäººè¿˜æ˜¯æ¯”è¾ƒæ»¡æ„çš„.</p><p>è‹¹æœåœ¨2020å¹´æ— è®ºä»iOS,Swift,SwiftUIè¿˜æ˜¯Xcodeå‡ ä¸ªæ–¹é¢æ”¹è¿›è¿˜æ˜¯æ˜¾è‘—çš„,å¯¹æˆ‘çš„å¸®åŠ©å¾ˆå¤§.</p><p>æ— è®ºä»åŠŸèƒ½ã€æ€§èƒ½ã€UIè¡¨ç°ä¸Š,2.0ç‰ˆéƒ½æ¯”1.0ç‰ˆæœ‰äº†è¾ƒå¤§æé«˜.</p><p>åœ¨è¿™é‡Œå¯ä»¥ä¸‹è½½ <a href="https://apps.apple.com/us/app/health-notes-2/id1534513553"><img src="http://cdn.fatbobman.com/appStoreIcon.svg" alt="pic"/></a></p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/healthNote2-development-memo-5</guid><title>å¥åº·ç¬”è®°2.0å¼€å‘éšç¬”ï¼ˆäº”ï¼‰</title><description>ä¸€æ™ƒå›½åº†ä¸­ç§‹é•¿å‡å³å°†ç»“æŸï¼Œè·ç¦»ä¸Šæ¬¡çš„éšç¬”ä¹Ÿæœ‰äº†ä¸€æ®µæ—¶é—´ã€‚åœ¨æœ€è¿‘çš„æ—¥å­é‡Œï¼Œæˆ‘ä¸€æ–¹é¢ç»§ç»­ç€å¼€å‘çš„è¿›ç¨‹ï¼ŒåŒæ—¶è¿˜è¦ä»˜å‡ºç›¸å½“çš„ç²¾åŠ›åŒiOS14ä¸­çš„å„ç§Bugå’Œå¼‚å¸¸æ–—æ™ºæ–—å‹‡ã€‚æœ¬ç¯‡éšç¬”ä¸»è¦è®°å½•äº†è¿™æ®µæ—¶é—´ç¢°åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œä»¥åŠèŠèŠiOS14ã€Xcode12ä»¥åŠSwiftUI2.0çš„ä¸€äº›ä¼˜ç¼ºç‚¹ã€‚æƒ³åˆ°å“ªã€å†™åˆ°å“ªï¼Œå¯èƒ½é€»è¾‘ä¼šæ¯”è¾ƒæ··ä¹±ã€‚</description><link>http://www.fatbobman.com/posts/healthNote2-development-memo-5</link><pubDate>Wed, 7 Oct 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<p>ä¸€æ™ƒå›½åº†ä¸­ç§‹é•¿å‡å³å°†ç»“æŸï¼Œè·ç¦»ä¸Šæ¬¡çš„éšç¬”ä¹Ÿæœ‰äº†ä¸€æ®µæ—¶é—´ã€‚åœ¨æœ€è¿‘çš„æ—¥å­é‡Œï¼Œæˆ‘ä¸€æ–¹é¢ç»§ç»­ç€å¼€å‘çš„è¿›ç¨‹ï¼ŒåŒæ—¶è¿˜è¦ä»˜å‡ºç›¸å½“çš„ç²¾åŠ›åŒiOS14ä¸­çš„å„ç§Bugå’Œå¼‚å¸¸æ–—æ™ºæ–—å‹‡ã€‚</p><p>æœ¬ç¯‡éšç¬”ä¸»è¦è®°å½•äº†è¿™æ®µæ—¶é—´ç¢°åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œä»¥åŠèŠèŠiOS14ã€Xcode12ä»¥åŠSwiftUI2.0çš„ä¸€äº›ä¼˜ç¼ºç‚¹ã€‚æƒ³åˆ°å“ªã€å†™åˆ°å“ªï¼Œå¯èƒ½é€»è¾‘ä¼šæ¯”è¾ƒæ··ä¹±ã€‚</p><h2>Bugå®åœ¨å¤š</h2><p>2020å¹´è‹¹æœæƒ³åœ¨è½¯ä»¶æ¶æ„å±‚é¢åšå‡ºéå¸¸å¤šçš„é‡è¦æ”¹å˜ã€‚big surè¦æ”¯æŒarmï¼ŒSwiftUIè¦çœŸæ­£åšåˆ°ä¸€å¥—ä»£ç é¡ºåˆ©çš„å¤šå¹³å°è¿è¡Œï¼ŒiOS14ä¹Ÿä½œå‡ºäº†åœ¨è¿‘å‡ å¹´è‚‰çœ¼å¯è§çš„æœ€å¤§å˜åŒ–ã€‚ä¸è¿‡å¯èƒ½æ˜¯ç›®æ ‡å¤ªå¤šã€å¤ªå¤§ï¼Œè€Œæ—¶é—´åˆç´§ï¼Œè‡³å°‘åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œbugå±‚å‡ºä¸ç©·ï¼Œæ”¹ä¸èƒœæ”¹ã€‚å°¤å…¶æ˜¯éšç€ç‰ˆæœ¬çš„å‡çº§ï¼Œç«Ÿç„¶å‡ºç°äº†ä¸å°‘å‰é¢å®Œå…¨ä¸æ›¾å‡ºç°çš„bugï¼Œå®åœ¨æ˜¯ä»¤äººå¿ƒçƒ¦ã€‚</p><p>æ¯”å¦‚åœ¨iOS14.2beta2ä¸­ï¼Œsheetçš„Delegateæ— æ³•å“åº”ï¼Œè€Œåœ¨ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬éƒ½æ²¡æœ‰é—®é¢˜ã€‚åœ¨iOS14.2beta2ä¸­ï¼ŒViewçš„åˆ·æ–°æ—¶æœºæœ‰å’Œä¹‹å‰æœ‰äº†ç»†å¾®çš„å˜åŒ–ï¼Œåœ¨ä¸€äº›åŠç‰¹æ®Šçš„æƒ…å†µä¸‹ä¼šå‡ºç°åˆ·æ–°ä¸åŒæ­¥ã€‚æ€»ä¹‹ç±»ä¼¼çš„é”™è¯¯ä¸€ç›´åœ¨å¢åŠ ã€‚</p><p>å¯¹äº@FetchRequestä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒViewä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå°½ç®¡14.2å¯¹äºListåšäº†ä¿®å¤ï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯éœ€è¦äººä¸ºå¹²é¢„ã€‚</p><p>@FetechRequestçš„æ•°æ®è¿›è¡Œå¢å‡æ—¶ï¼Œæœ‰æ—¶ä¼šæœ‰åŠ¨ç”»ï¼Œæœ‰æ—¶æ²¡æœ‰åŠ¨ç”»ã€‚åŒæ ·çš„ä»£ç ï¼Œåœ¨ä¸åŒçš„åœ°æ–¹ï¼Œæœ‰æ—¶ä¼šæœ‰åŠ¨ç”»ï¼Œæœ‰æ—¶æ²¡æœ‰åŠ¨ç”»ï¼Œè€Œè¿™äº›éƒ½æ˜¯åœ¨SwiftUI1.0ç‰ˆæœ¬éƒ½ä¸æ›¾å‡ºç°çš„é—®é¢˜ã€‚</p><p>åœ¨macä¸‹é€šè¿‡catalystè¿è¡Œappæ—¶ï¼Œæ€»æ˜¯ä¼šå‡ºç°å‡æ­»æƒ…å†µï¼ˆç³»ç»Ÿcupå ç”¨ä¸º0ï¼Œå°±æ˜¯appæ²¡æœ‰å“åº”ï¼‰ã€‚</p><p>Xcode12å„ç§ç°å®å¼‚å¸¸ï¼Œè¿™ä¸¤å¤©å‡ºç°äº†ä¸€ä¸ªå¼‚å¸¸å¥‡æ€ªçš„ç°è±¡ï¼Œå½“æˆ‘ç¼–è¾‘xcdatamodeldæ–‡ä»¶æ—¶ï¼Œå±å¹•ä¸Šå‡ºç°äº†ä¸€ç¯‡ç™½è‰²åŒºåŸŸé®ç›–äº†æ•°æ®ç¼–è¾‘åŒºï¼Œæˆ‘åªèƒ½ç›²æ“ä½œã€‚è€Œç¼–è¾‘å…¶ä»–ä»»ä½•æ–‡ä»¶éƒ½æ²¡æœ‰è¿™ç§æƒ…å†µã€‚</p><p>Xcode12çš„ä»£ç è¡¥å…¨è¿œä¸å¦‚Xcode11ï¼Œæ€»æ˜¯è¡¥å…¨åéœ€è¦åˆ é™¤å¤§é‡æ— ç”¨çš„è¡¥å…¨ä¿¡æ¯ã€‚</p><p>fileImporterç«Ÿç„¶ä¸èƒ½é€šè¿‡æ‰‹åŠ¿å–æ¶ˆï¼Œå¦‚æœä½¿ç”¨æ‰‹åŠ¿ï¼Œä¼šåå¤å¼¹å‡ºsheetï¼Œé™¤éä½ ç‚¹å‡»å³ä¸Šè§’çš„cancelã€‚</p><p>Menuï¼ˆSwiftUIæ–°å¢çš„æ§ä»¶ï¼‰ åœ¨è¢«é”®ç›˜é®æŒ¡åä¼šå‡ºç°å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ç›®å‰åªèƒ½æŠŠMenuæ”¾ç½®åœ¨å±å¹•çš„ä¸Šæ–¹</p><p>ContextMenuç‚¹é€‰åæ€»è¦é—ªçƒä¸€ä¸‹ï¼Œè®©äººå¾ˆä¸èˆ’æœã€‚</p><p>åœ¨SwiftUI2ä¸­ï¼Œå¯¹äºé”®ç›˜çš„è‡ªåŠ¨é¿è®©æœ¬æ¥æ˜¯ä¸€ä¸ªç›¸å½“ä¸é”™çš„è®¾è®¡ï¼Œä½†æ€»ä¼šå¯¼è‡´å¤§é‡çš„å¸ƒå±€å—é”®ç›˜æµ®åŠ¨çš„å½±å“ï¼Œåå€’éœ€è¦åšæ›´å¤šçš„å·¥ä½œæ¥é¿å…è¿™ç§æƒ…å†µï¼Œç»“æœæ˜¯å¥½çš„æƒ³æ³•ä½†å®ç°èµ·æ¥é€‚å¾—å…¶åã€‚</p><p>Xcode12çš„DebugåŒºåŸŸä¼šä¸¢å¤±ï¼Œå¯ä»¥é€šè¿‡å¿«æ·é”®é‡æ–°å”¤å‡ºã€‚è€Œä¸”è«åå…¶å¦™çš„æ€»æ˜¯é»˜è®¤ä¸æ˜¾ç¤ºå³ä¾§çš„Debug Outputçª—å£ã€‚</p><p>ä¸Šé¢æ‰€è¯´çš„éƒ½æ˜¯æœ€è¿‘è®©æˆ‘ç‰¹åˆ«å¿ƒçƒ¦çš„ä¸€äº›bugï¼Œå…¶ä»–çš„å®åœ¨æ˜¯å¤ªå¤šï¼Œå°±ä¸ä¸€ä¸€ä¾‹ä¸¾äº†ã€‚</p><p>bugè¿‡å¤šçš„ç»“æœå°±æ˜¯å¯¼è‡´æˆ‘éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´æ¥äº†åˆ¤æ–­æ˜¯æˆ‘è‡ªå·±çš„å®ç°é”™è¯¯è¿˜æ˜¯ç”±äºç³»ç»Ÿçš„bugå¯¼è‡´çš„ã€‚å¦‚æœç¡®å®šæ˜¯bugï¼Œè¿˜éœ€è¦å†™ä¸å°‘çš„feedbackç»™è‹¹æœï¼Œå¸Œæœ›å®ƒèƒ½å°½å¿«ä¿®å¤ã€‚å¯¹äºæ—¶é—´çš„æµªè´¹æ˜¯ååˆ†å·¨å¤§çš„ã€‚</p><p>ä¸ºäº†åˆ¤æ–­æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ï¼Œæˆ‘ç›®å‰åœ¨macä¸Šå®‰è£…äº† ä¸¤ä¸ªç‰ˆæœ¬çš„big sur(æœ€æ–°ç‰ˆã€æ¬¡æ–°ç‰ˆ)ï¼Œä¸‰ä¸ªç‰ˆæœ¬çš„Xcode(11.7,12.01,12.2beta2),ä¸¤ä¸ªè¿è¡Œä¸åŒç‰ˆæœ¬çš„iphone(14.2beta2,14.01),ä¸¤ä¸ªæ¨¡æ‹Ÿå™¨ï¼ˆ14.2ï¼Œ14.01ï¼‰ã€‚æ€»ä¹‹æœ‰å¤ŸèŠ±è´¹ç²¾åŠ›çš„ã€‚</p><p>ä¸è¿‡è¿™ä¹Ÿæ˜¯åœ¨ä¸€ä¸ªå°šæœªå®Œå…¨æˆç†Ÿçš„æ¶æ„ä¸‹ï¼Œåœ¨ä¸€ä¸ªå·¨å¤§å˜åŒ–çš„æ—¶é—´ç‚¹è¿›è¡Œå¼€å‘æ‰€è¦ä»˜å‡ºçš„å¿…è¦ä»£ä»·ã€‚</p><h2>ä¸å°çš„è¿›æ­¥</h2><p>ä¸Šé¢è¿›è¡Œäº†ä¸å°‘çš„åæ§½ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´è‹¹æœåœ¨ä»Šå¹´ç»™æˆ‘ä»¬å¸¦æ¥çš„è¿›æ­¥å’Œæ”¹å–„ã€‚</p><h3>Xcode12</h3><p>previewå·²ç»å¾ˆæˆç†Ÿäº†ï¼Œå·²ç»å¾ˆå°‘ä¼šå‡ºç°å´©æºƒæˆ–æ— æ³•é¢„è§ˆçš„æƒ…å†µã€‚</p><p>åœ¨projectåµŒå…¥playgroundéå¸¸æ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯æ‰“å¼€Build Active Schemeä¹‹åï¼Œå¯ä»¥åœ¨playgroundä¸­ç›´æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ã€‚å¯¹äºå¼€å‘ä¸­è¿›è¡Œè¯•éªŒæµ‹è¯•æä¾›äº†å·¨å¤§çš„ä¾¿åˆ©ã€‚</p><p>StoreKitçš„æ¨¡æ‹Ÿç¯å¢ƒéå¸¸æœ‰ç”¨ï¼Œæå¤§çš„æé«˜äº†å¼€å‘åº”ç”¨å†…ä»˜è´¹çš„æ•ˆç‡ã€‚å¯ä»¥åœ¨ä¸æäº¤appå¹¶å»ºç«‹èµ„è´¹çš„æƒ…å†µä¸‹ä¾¿å®Œæˆå’Œè°ƒè¯•æ‰€æœ‰å’Œæ”¶è´¹ç›¸å…³ä»£ç ã€‚ä¸è¿‡æˆ‘ç›®å‰å‘ç°restoreå¥½åƒæ²¡æœ‰å›é¦ˆï¼Œä¸çŸ¥é“æ˜¯æˆ‘çš„ä½¿ç”¨æ–¹æ³•ä¸å¯¹è¿˜æ˜¯å°±æ˜¯æ²¡æœ‰æä¾›ã€‚</p><p>å…¨å±å¼€å‘æ¨¡å¼æ”¯æŒç›´æ¥åœ¨ä¸€æ¬¡æ”¾ç½®æ¨¡æ‹Ÿå™¨ï¼Œæé«˜äº†å±å¹•ä½¿ç”¨ç‡ï¼Œè€Œä¸”æœ‰åŠ©äºæ³¨æ„åŠ›çš„æå‡ã€‚</p><p>SwiftUI liftcycleè®©è·¨å¹³å°å¼€å‘æ›´åŠ ä¾¿åˆ©ã€‚</p><h3>SwiftUI</h3><p>onChangeæ˜¯æˆ‘å¯¹äºä»Šå¹´SwiftUIæ”¹åŠ¨æœ€æ»¡æ„çš„åœ°æ–¹ã€‚åœ¨onChangeä¸­çš„ä»£ç è¿è¡Œæ—¶æœºå’ŒViewçš„updateä¸€ç›´ï¼ŒåŸºæœ¬å¯ä»¥ä¿è¯æ­£ç¡®çš„å“åº”æ—¶æœºã€‚</p><p>æ–°çš„DatePickeråœ¨iOSä¸ŠèŠ‚çœäº†æ˜¾ç¤ºçš„ç©ºé—´ï¼Œè®©formæ›´ç´§å‡‘ã€‚ä¸è¿‡é€‰æ‹©åå‡ºç°çš„é—ªçƒè¿˜è¡¨ç¤ºæœ‰è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´</p><p>ä¼—å¤šçš„æ–°æ§ä»¶ã€‚è¿›è¿‡æˆ‘åœ¨æœ¬æ¬¡å¼€å‘ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨å¤ªå¤šçš„æ–°æ§ä»¶ï¼Œä¸è¿‡æ›´å¤šçš„é€‰æ‹©è¿˜æ˜¯æœ‰åˆ©äºå¼€å‘è€…çš„ã€‚</p><p>æˆ‘ç›®å‰æœ€å¤šä½¿ç”¨çš„æ–°æ§ä»¶æœ‰ï¼š toolbar menu lazyStack lazyGrid</p><p>åœ¨DSLä¸­æ”¯æŒæ›´å¤æ‚çš„é€»è¾‘åˆ¤æ–­ã€‚ç”±äºç›®å‰æ”¯æŒäº†if let,switchå¯ä»¥åœ¨DSLä¸­ç”¨æ›´å°‘çš„ä»£ç å®ç°æ›´æ¸…æ™°çš„é€»è¾‘å¤„ç†ã€‚</p><p>å¯¹äºå¤æ‚çš„DSLçš„ç¼–è¯‘èƒ½åŠ›ä¹Ÿæœ‰äº†æé«˜</p><h3>Big Sur</h3><p>éšç€æµ‹è¯•ç‰ˆæœ¬çš„ä¸æ–­æé«˜ï¼Œcatalystå¯¹äºSwiftUIçš„æ”¯æŒè¶Šæ¥è¶Šå¥½ã€‚åœ¨æœ€åˆçš„ç‰ˆæœ¬ä¸­ï¼ŒåŸºæœ¬è¿˜æ˜¯åˆ©ç”¨appkitçš„æ§ä»¶æ¥ä»£æ›¿uikitçš„æ§ä»¶ï¼Œåœ¨ç›®å‰çš„beta9ä¸‹ï¼Œæ˜¾ç¤ºæ•ˆæœå·²ç»å’Œipadä¸Šç›¸å·®æ— å‡ ã€‚åªæ˜¯ç”¨SwiftUI + catalystæ¥å¼€å‘mac appå·²ç»è¶Šæ¥è¶Šæœ‰å¯èƒ½ã€‚</p><h2>æµ‹è¯•å¾é›†</h2><p>å¥åº·ç¬”è®°2.0ç›®å‰å·²ç»åˆ°äº†æ”¶å°¾é˜¶æ®µï¼Œé™¤äº†å›¾è¡¨éƒ¨åˆ†ä¹‹å¤–ï¼Œå¤§å¤šæ•°çš„åŠŸèƒ½éƒ½å·²å®Œæˆã€‚æˆ‘æ­£åœ¨ç”³è¯·test flightçš„betaæµ‹è¯•ã€‚å¦‚æœä½ æœ‰å…´è¶£è¿›è¡Œæµ‹è¯•ï¼Œè¯·å°†ä½ çš„é‚®ç®±å‘é€ç»™æˆ‘ã€‚</p><p>å¥åº·ç¬”è®°2.0éœ€è¦è¿è¡Œåœ¨iOS14ä»¥ä¸Šçš„è®¾å¤‡ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/healthNote2-development-memo-4</guid><title>å¥åº·ç¬”è®°2.0å¼€å‘éšç¬”ï¼ˆå››ï¼‰</title><description>æœ¬å‘¨æ²¡æœ‰å¤ªå¤šçš„ç²¾åŠ›å’Œæƒ…ç»ªç”¨æ¥å†™ä»£ç ã€‚è¿™ä¸¤å¤©åœ¨åŸæ¥ç»Ÿä¸€sheetç®¡ç†å’Œå®æ—¶Formçš„åŸºç¡€ä¸Šï¼Œå®Œæˆäº†å¯ä»¥æ§åˆ¶å–æ¶ˆæ‰‹åŠ¿çš„Sheetã€‚è¿™ä¸ªæ˜¯SwiftUIä¸­ä¸€ç›´ä»¥æ¥çš„ä¸€ä¸ªé‡è¦çš„ç¼ºå¤±åŠŸèƒ½ã€‚ åœ¨SwiftUIä¸­åˆ¶ä½œå¯ä»¥æ§åˆ¶å–æ¶ˆæ‰‹åŠ¿çš„Sheet</description><link>http://www.fatbobman.com/posts/healthNote2-development-memo-4</link><pubDate>Thu, 17 Sep 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<p>ç»è¿‡2å‘¨çš„æ²»ç–—,æˆ‘çˆ¶äº²ç»ˆäºè„±ç¦»çš„ç”Ÿå‘½å±é™©ã€‚ç–«æƒ…çš„åŸå› ï¼ŒåŒ»é™¢åªå…è®¸ä¸€ä¸ªæŠ¤å·¥åœ¨èº«è¾¹ç…§é¡¾ï¼Œç—…äººé•¿æ—¶é—´æ— æ³•è§åˆ°å®¶å±è€Œå¯¼è‡´äº†è¾ƒä¸¥é‡çš„å¿ƒç†é—®é¢˜ã€‚ç»¼åˆè€ƒè™‘ï¼Œå‘¨æœ«å·²æ¥å›å®¶ã€‚å›å®¶2å¤©åï¼Œæ•´ä¸ªçŠ¶å†µæœ‰äº†éå¸¸å¥½çš„è½¬å˜ã€‚åœ¨è¿™æ¬¡çš„æ²»ç–—ä¸­ï¼Œæˆ‘æä¾›ç»™åŒ»é™¢çš„æˆ‘çˆ¶äº²è¿™å‡ å¹´æ¥çš„å„æ–¹é¢èº«ä½“æŒ‡æ ‡æ•°æ®èµ·åˆ°äº†å¾ˆé‡è¦çš„ä½œç”¨ã€‚</p><p>æœ¬å‘¨æ²¡æœ‰å¤ªå¤šçš„ç²¾åŠ›å’Œæƒ…ç»ªç”¨æ¥å†™ä»£ç ã€‚è¿™ä¸¤å¤©åœ¨åŸæ¥ç»Ÿä¸€sheetç®¡ç†å’Œå®æ—¶Formçš„åŸºç¡€ä¸Šï¼Œå®Œæˆäº†å¯ä»¥æ§åˆ¶å–æ¶ˆæ‰‹åŠ¿çš„Sheetã€‚è¿™ä¸ªæ˜¯SwiftUIä¸­ä¸€ç›´ä»¥æ¥çš„ä¸€ä¸ªé‡è¦çš„ç¼ºå¤±åŠŸèƒ½ã€‚ <a href="http://www.fatbobman.com/posts/swiftui-dismiss-sheet/">åœ¨SwiftUIä¸­åˆ¶ä½œå¯ä»¥æ§åˆ¶å–æ¶ˆæ‰‹åŠ¿çš„Sheet</a></p><p>Xcode 12 beta6 çš„bugè¿˜æ˜¯ä¸å°‘ï¼Œè¿™ä¸¤å¤©æˆ‘ç«Ÿç„¶è§åˆ°äº†3æ¬¡å››å›½ç”»é¢ã€‚ SwiftUI 2.0çš„Listé—®é¢˜ä¹Ÿå¾ˆå¤šï¼Œç”šè‡³æ„Ÿè§‰æ¯”1.0æ›´ä¸ç¨³å®šï¼Œè€Œä¸”æ•ˆç‡æœ‰æ˜æ˜¾çš„é—®é¢˜ã€‚ç›®å‰å·²å°†æ‰€æœ‰ä½¿ç”¨Listçš„åœ°æ–¹éƒ½æš‚æ—¶æ›¿æ¢æˆäº†LazyVStackã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftui-dismiss-sheet</guid><title>åœ¨SwiftUIä¸­åˆ¶ä½œå¯ä»¥æ§åˆ¶å–æ¶ˆæ‰‹åŠ¿çš„Sheet</title><description>åœ¨å‰é¢çš„ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†å¦‚ä½•åˆ¶ä½œä¸€ä¸ªå¯ä»¥åˆ¤æ–­æ˜¯å¦è¿›è¡Œäº†ä¿®æ”¹çš„è¡¨å•ï¼Œä»¥åŠå¦‚ä½•ç»Ÿä¸€ç®¡ç†appå„ä¸ªå±‚çº§Viewçš„å¼¹å‡ºSheetã€‚ä»Šå¤©æˆ‘ä»¬å°†ä»–ä»¬åˆå¹¶åœ¨ä¸€èµ·ï¼Œå®Œæˆæ•´ä¸ªé¡¹ç›®çš„æœ€ç»ˆç›®çš„â€”â€”åœ¨Sheetä¸­åˆ¶ä½œä¸€ä¸ªå¯ä»¥å®æ—¶å“åº”çš„è¡¨å•ï¼Œå¹¶ä¸”sheetä¼šæ„Ÿè§‰è¡¨å•çš„æƒ…å†µå“åº”å–æ¶ˆæ‰‹åŠ¿ã€‚</description><link>http://www.fatbobman.com/posts/swiftui-dismiss-sheet</link><pubDate>Thu, 17 Sep 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>åœ¨å‰é¢çš„ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†å¦‚ä½•åˆ¶ä½œä¸€ä¸ªå¯ä»¥åˆ¤æ–­æ˜¯å¦è¿›è¡Œäº†ä¿®æ”¹çš„è¡¨å•ï¼Œä»¥åŠå¦‚ä½•ç»Ÿä¸€ç®¡ç†appå„ä¸ªå±‚çº§Viewçš„å¼¹å‡ºSheetã€‚ä»Šå¤©æˆ‘ä»¬å°†ä»–ä»¬åˆå¹¶åœ¨ä¸€èµ·ï¼Œå®Œæˆæ•´ä¸ªé¡¹ç›®çš„æœ€ç»ˆç›®çš„â€”â€”åœ¨Sheetä¸­åˆ¶ä½œä¸€ä¸ªå¯ä»¥å®æ—¶å“åº”çš„è¡¨å•ï¼Œå¹¶ä¸”sheetä¼šæ„Ÿè§‰è¡¨å•çš„æƒ…å†µå“åº”å–æ¶ˆæ‰‹åŠ¿ã€‚</p></blockquote><p><a href="http://www.fatbobman.com/posts/swiftui-multiSheet/">åœ¨SwiftUIä¸­,æ ¹æ®éœ€æ±‚å¼¹å‡ºä¸åŒçš„Sheet</a></p><p><a href="http://www.fatbobman.com/posts/swiftui-input-form/">å¦‚ä½•åœ¨SwiftUIä¸­åˆ›å»ºä¸€ä¸ªå®æ—¶å“åº”çš„Form</a></p><h2>ç”±æ¥</h2><p>åœ¨ä¹‹å‰Formçš„ä¾‹å­ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥æ ¹æ®è¡¨å•æ˜¯å¦è¿›è¡Œäº†ä¿®æ”¹æ¥å¯¹cancelã€editç­‰åšå‡ºä¸åŒçš„å“åº”ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰åŠæ³•æ§åˆ¶ç”¨æˆ·ç›´æ¥ä½¿ç”¨æ‰‹åŠ¿æ¥å–æ¶ˆsheetï¼Œä¸ºäº†ä¸è®©ç”¨æˆ·ç»•è¿‡ç¨‹åºçš„åˆ¤æ–­æ£€æŸ¥ï¼Œä¸å¾—å·²ä½¿ç”¨äº†fullScreenCoveræ¥è§„é¿æ‰‹åŠ¿å–æ¶ˆã€‚ä¸è¿‡åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå°½ç®¡å…¨å±sheetæä¾›äº†æ›´å¤šçš„å±å¹•å¯ç”¨ç©ºé—´ï¼Œä½†è¿˜æ˜¯ä¼šç»™ä½¿ç”¨è€…å¸¦æ¥äº†æ“ä½œé€»è¾‘ä¸ç»Ÿä¸€çš„ä½“éªŒã€‚</p><p>åœ¨å»å¹´ï¼Œæˆ‘ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå±è”½sheetçš„æ‹–åŠ¨æ‰‹åŠ¿ã€‚</p><pre data-language="swift"><code> .highPriorityGesture(<span class="hljs-type">DragGesture</span>())
</code></pre><p>è¿™ä¹Ÿæ˜¯æ²¡æœ‰åŠæ³•çš„åŠæ³•ã€‚</p><p>åæ¥ï¼ŒSwiftUI-labä¸­ï¼ŒJavieræå‡ºäº†ä»–çš„è§£å†³æ–¹æ¡ˆ<a href="https://swiftui-lab.com/modal-dismiss-gesture/">Dismiss Gesture for SwiftUI Modals</a>ã€‚è¿™ä¸ªæ–¹æ¡ˆåŸºæœ¬ä¸Šå®ç°äº†æˆ‘æƒ³è¦çš„å…¨éƒ¨åŠŸèƒ½ã€‚ä¸è¿‡è¿™ä¸ªæ–¹æ¡ˆçœ‹èµ·æ¥æœ‰äº›æ€ªå¼‚ã€‚</p><ol><li>æ•°æ®å’Œsheetæ§åˆ¶æ··åˆåœ¨ä¸€èµ·</li><li>å¯¹äºsheetçš„æ§åˆ¶è¿‡äºç¹çï¼Œè€Œä¸”ä¸ç›´è§‚</li></ol><p>å‰æ®µæ—¶é—´<a href="https://gist.github.com/mobilinked/9b6086b3760bcf1e5432932dad0813c0">mobilinked</a>ç¼–å†™äº†ä¸€æ®µç”¨äºæ§åˆ¶sheetçš„ä»£ç ï¼Œç»“æ„ç²¾å·§ï¼Œä½¿ç”¨ç®€å•ã€‚</p><p>æœ¬æ–‡å¯¹äºsheetçš„æ§åˆ¶é‡‡ç”¨äº†mobilinkedçš„åŸºç¡€ä»£ç ï¼Œå¹¶é’ˆå¯¹Formçš„å“åº”åšå‡ºäº†å¯¹åº”çš„ä¿®æ”¹ã€‚</p><p>åœ¨è¿›è¡Œä¸‹é¢çš„ä»£ç è¯´æ˜å‰ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰é˜…è¯»å‰ä¸¤ç¯‡æ–‡ç« çš„è¯ï¼Œè¯·é˜…è¯»åå†ç»§ç»­ã€‚</p><h2>ç›®æ ‡</h2><ol><li>è¡¨å•å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œå®æ—¶æ£€æŸ¥ï¼ˆæ˜¯å¦æœ‰é”™è¯¯ï¼Œæ˜¯å¦æœ‰ç©ºç™½é¡¹ï¼‰</li><li>è¡¨å•å°†æ ¹æ®å½“å‰çš„çŠ¶æ€å†³å®šæ˜¯å¦å…è®¸sheetè¿›è¡Œæ‰‹åŠ¿å–æ¶ˆ</li><li>å½“ç”¨æˆ·è¿›è¡Œæ‰‹åŠ¿å–æ¶ˆæ—¶ï¼Œå¦‚æœè¡¨å•å·²ç»è¿›è¡Œäº†ä¿®æ”¹ï¼Œéœ€è¦ç”¨æˆ·äºŒæ¬¡ç¡®è®¤æ˜¯å¦å–æ¶ˆ</li></ol><h2>ä»£ç ç®€ä»‹</h2><p>ç”±äºæœ¬æ–‡ä»£ç ä¸­å¤šæ•°éƒ¨åˆ†åŒFormç¤ºä¾‹ä»£ç ç±»ä¼¼ï¼Œæ‰€ä»¥ä»…ç®€è¿°ä¸€ä¸‹æ–°å¢åŠä¿®æ”¹çš„éƒ¨åˆ†ã€‚</p><p>SheetManager</p><pre data-language="swift"><code><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AIOSheetManager</span>:<span class="hljs-title">ObservableObject</span></span>{
    @<span class="hljs-type">Published</span>  <span class="hljs-keyword">var</span> action:<span class="hljs-type">AllInOneSheetAction?</span>
    <span class="hljs-keyword">var</span> unlock:<span class="hljs-type">Bool</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">//falseæ—¶æ— æ³•ä¸‹æ»‘dismiss,ç”±formç¨‹åºç»´æŠ¤</span>
    <span class="hljs-keyword">var</span> type:<span class="hljs-type">AllInOneSheetType</span> = .sheet <span class="hljs-comment">//sheet or fullScreenCover</span>
    <span class="hljs-keyword">var</span> dismissControl:<span class="hljs-type">Bool</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">//æ˜¯å¦å¯åŠ¨dismissé˜»æ­¢å¼€å…³,trueå¯åŠ¨é˜»æ­¢</span>
    
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> showSheet = <span class="hljs-literal">false</span>
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> showFullCoverScreen = <span class="hljs-literal">false</span>

    <span class="hljs-keyword">var</span> dismissed = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Bool</span>,<span class="hljs-type">Never</span>&gt;()
    <span class="hljs-keyword">var</span> dismissAction:(() -&gt; <span class="hljs-type">Void</span>)? = <span class="hljs-literal">nil</span>

    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">AllInOneSheetType</span></span>{
        <span class="hljs-keyword">case</span> fullScreenCover
        <span class="hljs-keyword">case</span> sheet
    }
}
</code></pre><p>sheetæ§åˆ¶ä»£ç </p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MbModalHackView</span>: <span class="hljs-title">UIViewControllerRepresentable</span> </span>{
    <span class="hljs-keyword">let</span> manager:<span class="hljs-type">AIOSheetManager</span>

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeUIViewController</span><span class="hljs-params">(context: UIViewControllerRepresentableContext&lt;MbModalHackView&gt;)</span></span> -&gt; <span class="hljs-type">UIViewController</span> {
        <span class="hljs-type">UIViewController</span>()
    }

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateUIViewController</span><span class="hljs-params">(<span class="hljs-number">_</span> uiViewController: UIViewController, context: UIViewControllerRepresentableContext&lt;MbModalHackView&gt;)</span></span> {
        rootViewController(of: uiViewController).presentationController?.delegate = context.coordinator
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">rootViewController</span><span class="hljs-params">(of uiViewController: UIViewController)</span></span> -&gt; <span class="hljs-type">UIViewController</span> {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> parent = uiViewController.parent {
            <span class="hljs-keyword">return</span> rootViewController(of: parent)
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> uiViewController
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeCoordinator</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Coordinator</span> {
        <span class="hljs-type">Coordinator</span>(manager: manager)
    }

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Coordinator</span>: <span class="hljs-title">NSObject</span>, <span class="hljs-title">UIAdaptivePresentationControllerDelegate</span> </span>{
        <span class="hljs-keyword">let</span> manager:<span class="hljs-type">AIOSheetManager</span>
        <span class="hljs-keyword">init</span>(manager:<span class="hljs-type">AIOSheetManager</span>){
            <span class="hljs-keyword">self</span>.manager = manager
        }
        <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentationControllerShouldDismiss</span><span class="hljs-params">(<span class="hljs-number">_</span> presentationController: UIPresentationController)</span></span> -&gt; <span class="hljs-type">Bool</span> {
            <span class="hljs-keyword">guard</span> manager.dismissControl <span class="hljs-keyword">else</span> {<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}
            <span class="hljs-keyword">return</span> manager.unlock
        }

        <span class="hljs-comment">//å½“é˜»æ­¢å–æ¶ˆæ—¶,å‘é€ç”¨æˆ·è¦æ±‚å–æ¶ˆsheetå‘½ä»¤</span>
        <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentationControllerDidAttemptToDismiss</span><span class="hljs-params">(<span class="hljs-number">_</span> presentationController: UIPresentationController)</span></span>{
            manager.dismissed.send(<span class="hljs-literal">true</span>)
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">allowAutoDismiss</span><span class="hljs-params">(<span class="hljs-number">_</span> manager:AIOSheetManager)</span></span> -&gt; some <span class="hljs-type">View</span> {
        <span class="hljs-keyword">self</span>
            .background(<span class="hljs-type">MbModalHackView</span>(manager: manager))

    }
}
</code></pre><p>åŒ…è£…</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">XSheet</span>:<span class="hljs-title">ViewModifier</span></span>{
    @<span class="hljs-type">EnvironmentObject</span> <span class="hljs-keyword">var</span> manager:<span class="hljs-type">AIOSheetManager</span>
    @<span class="hljs-type">EnvironmentObject</span> <span class="hljs-keyword">var</span> store:<span class="hljs-type">Store</span>
    @<span class="hljs-type">Environment</span>(\.managedObjectContext) <span class="hljs-keyword">var</span> context
    <span class="hljs-keyword">var</span> onDismiss:()-&gt;<span class="hljs-type">Void</span>{
        <span class="hljs-keyword">return</span> {
            (manager.dismissAction ?? {})()
            manager.dismissAction = <span class="hljs-literal">nil</span>
            manager.action = <span class="hljs-literal">nil</span>
            manager.showSheet = <span class="hljs-literal">false</span>
            manager.showFullCoverScreen = <span class="hljs-literal">false</span>
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">body</span><span class="hljs-params">(content: Content)</span></span> -&gt; some <span class="hljs-type">View</span> {
        <span class="hljs-type">ZStack</span>{
            content
            
            <span class="hljs-type">Color</span>.clear
                .sheet(isPresented: $manager.showSheet,onDismiss: onDismiss){
                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> action = manager.action
                        {
                            reducer(action)
                            .allowAutoDismiss(manager)
                            .environmentObject(manager)
                        }
                    
                }
            
            <span class="hljs-type">Color</span>.clear
                .fullScreenCover(isPresented: $manager.showFullCoverScreen,onDismiss: onDismiss){
                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> action = manager.action
                        {
                            reducer(action)
                                .allowAutoDismiss(manager)
                                .environmentObject(manager)
                        }
                }
        }
        .onChange(of: manager.action){ action <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">guard</span> action != <span class="hljs-literal">nil</span> <span class="hljs-keyword">else</span> {
                manager.showSheet = <span class="hljs-literal">false</span>
                manager.showFullCoverScreen = <span class="hljs-literal">false</span>
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-keyword">if</span> manager.type == .sheet {
                manager.showSheet = <span class="hljs-literal">true</span>
            }
            <span class="hljs-keyword">if</span> manager.type == .fullScreenCover{
                manager.showFullCoverScreen = <span class="hljs-literal">true</span>
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">AllInOneSheetAction</span>:<span class="hljs-title">Identifiable</span>,<span class="hljs-title">Equatable</span></span>{
    <span class="hljs-keyword">case</span> show(student:<span class="hljs-type">Student</span>)
    <span class="hljs-keyword">case</span> edit(student:<span class="hljs-type">Student</span>)
    <span class="hljs-keyword">case</span> new
    
    
    <span class="hljs-keyword">var</span> id:<span class="hljs-type">UUID</span>{<span class="hljs-type">UUID</span>()}
}

<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">XSheet</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reducer</span><span class="hljs-params">(<span class="hljs-number">_</span> action:AllInOneSheetAction)</span></span> -&gt; some <span class="hljs-type">View</span>{
        <span class="hljs-keyword">switch</span> action{
        <span class="hljs-keyword">case</span> .show(<span class="hljs-keyword">let</span> student):
            <span class="hljs-keyword">return</span> <span class="hljs-type">StudentManager</span>(action:.show, student:student)
        <span class="hljs-keyword">case</span> .new:
            <span class="hljs-keyword">return</span> <span class="hljs-type">StudentManager</span>(action: .new, student: <span class="hljs-literal">nil</span>)
        <span class="hljs-keyword">case</span> .edit(<span class="hljs-keyword">let</span> student):
            <span class="hljs-keyword">return</span> <span class="hljs-type">StudentManager</span>(action:.edit,student: student)
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">View</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">xsheet</span><span class="hljs-params">()</span></span> -&gt; some <span class="hljs-type">View</span>{
        <span class="hljs-keyword">self</span>
            .modifier(<span class="hljs-type">XSheet</span>())
    }
}
</code></pre><p>è°ƒç”¨æ–¹å¼</p><pre data-language="swift"><code><span class="hljs-type">NavigationView</span>{
    ...
}
.xsheet()


<span class="hljs-type">Button</span>(<span class="hljs-string">"New"</span>){
         sheetManager.type = .sheet  <span class="hljs-comment">//å½“å‰æ”¯æŒä¸¤ç§æ–¹å¼ sheet fullScreenCover</span>
         sheetManager.dismissControl = <span class="hljs-literal">true</span> <span class="hljs-comment">//æ‰“å¼€æ§åˆ¶</span>
         sheetManager.action = .new   <span class="hljs-comment">//è®¾ç½®ç»Ÿä¸€sheetçš„action</span>
              }
</code></pre><p>Formä»£ç çš„ä¿®æ”¹</p><p>ä¸ºäº†è®©æˆ‘ä»¬çš„è¡¨å•ä»£ç èƒ½å¤Ÿç®¡ç†sheetï¼Œå¹¶ä¸”å¯ä»¥å“åº”ç”¨æˆ·çš„å–æ¶ˆæ‰‹åŠ¿ï¼Œå¯¹Formä»£ç åšäº†å¦‚ä¸‹çš„ä¿®æ”¹ï¼š</p><pre data-language="swift"><code>    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> changed = <span class="hljs-literal">false</span>{
        <span class="hljs-keyword">didSet</span>{
            <span class="hljs-comment">//æ§åˆ¶sheetæ˜¯å¦å…è®¸dismiss</span>
            <span class="hljs-keyword">if</span> action == .show {
                sheetManager.unlock = <span class="hljs-literal">true</span>
            }
            <span class="hljs-keyword">else</span> {
                sheetManager.unlock = !changed
            }
        }
    }
</code></pre><pre data-language="swift"><code>æ–°å¢
 .onReceive(sheetManager.dismissed){ value <span class="hljs-keyword">in</span>
                delConfirm.toggle()
            }
</code></pre><p>è¯¦ç»†ä»£ç è¯·è®¿é—®æˆ‘çš„<a href="https://github.com/fatbobman/DismissConfirmSheet">github</a></p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/healthNote2-development-memo-3</guid><title>å¥åº·ç¬”è®°2.0å¼€å‘éšç¬”ï¼ˆä¸‰ï¼‰</title><description>æœ¬å‘¨çš„ç”±äºå…¶ä»–çäº‹çš„åŸå› ,æ¯å¤©èƒ½å¤Ÿç”¨äºå¼€å‘çš„æ—¶é—´åŸºæœ¬ä¸Šåªèƒ½ä¿è¯2-3ä¸ªå°æ—¶,æ‰€ä»¥è¿›å±•ä¸å¤§.ä¸è¿‡å¥½åœ¨æˆ‘ä¹Ÿæ²¡æœ‰æ˜ç¡®çš„è¿›åº¦æŒ‡æ ‡.</description><link>http://www.fatbobman.com/posts/healthNote2-development-memo-3</link><pubDate>Sat, 5 Sep 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<p>ç”±äºå®¶å±çªå‘ç–¾ç—…ï¼Œæœ€è¿‘æ¯å¤©éƒ½è¦å‡ºå…¥åŒ»é™¢ï¼Œå› æ­¤æœ€è¿‘ç”¨äºå¼€å‘çš„æ—¶é—´å¾ˆæœ‰é™ã€‚</p><p>ç›®å‰appå·²ç»å®Œæˆäº†ç¬”è®°ã€æ¡ç›®ã€æ•°æ®çš„åˆ›å»ºã€ç¼–è¾‘ã€æ˜¾ç¤ºã€åˆ é™¤å…¨éƒ¨é€»è¾‘ã€‚å¦‚æœä¸è€ƒè™‘å›¾è¡¨ã€æ•°æ®å¯¼å…¥å¯¼å‡ºã€äº¤å‰æ¯”å¯¹ç­‰åŠŸèƒ½ï¼Œappçš„åŸºæœ¬åŠŸèƒ½å·²ç»å®Œæˆäº†ã€‚</p><p>åœ¨æœ¬æ¬¡å¼€å‘ä¸­ï¼Œæˆ‘ç€é‡è°ƒæ•´äº†è¡¨å•çš„å¼€å‘æ–¹å¼ï¼Œç›®å‰è¡¨å•æ— è®ºä»å“åº”ï¼Œåˆ¤æ–­ç­‰æ–¹ä¾¿éƒ½æ¯”ä¸Šä¸€ç‰ˆæœ‰äº†å¾ˆå¤§çš„æé«˜ã€‚</p><p>æœ¬æ¬¡æˆ‘å°†ä»¥å‰åˆ†æ•£çš„è¾“å…¥æºï¼ˆsource of truthï¼‰ç»Ÿä¸€åˆ°äº†ä¸€èµ·ï¼Œä¸ä»…æ›´ä¾¿äºä»£ç ç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿å®ç°äº†å¾ˆå¤šä»¥å‰æ— æ³•æˆ–å®ç°èµ·æ¥éå¸¸å›°éš¾çš„åŠŸèƒ½ã€‚</p><p>å…³äºè¡¨å•çš„å¤„ç†ï¼Œå¯ä»¥å‚çœ‹æˆ‘çš„æ–‡ç« <a href="http://www.fatbobman.com/posts/swiftui-input-form/">å¦‚ä½•åœ¨SwiftUIä¸­åˆ›å»ºä¸€ä¸ªå®æ—¶å“åº”çš„Form</a>ã€‚</p><p>å¦å¤–ï¼Œç”±äºæˆ‘çš„appå¯¹äºsheetçš„ä½¿ç”¨é‡ä¹Ÿå¾ˆå¤šï¼Œæ‰€ä»¥ä¹Ÿå¯¹sheetçš„å“åº”åšå‡ºäº†ç»Ÿä¸€çš„ç®¡ç†ï¼Œè¿™æ–¹é¢æˆ‘è®°å½•åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­<a href="http://www.fatbobman.com/posts/swiftui-multiSheet/">åœ¨SwiftUIä¸­,æ ¹æ®éœ€æ±‚å¼¹å‡ºä¸åŒçš„Sheet</a>ã€‚</p><p>æ—¶é—´æœ‰é™ï¼Œéšä¾¿è®°å½•ä¸€ç‚¹ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftui-input-form</guid><title>å¦‚ä½•åœ¨SwiftUIä¸­åˆ›å»ºä¸€ä¸ªå®æ—¶å“åº”çš„Form</title><description>æˆ‘çš„appå¥åº·ç¬”è®°ä¸»è¦æ˜¯å¯¹æ•°æ®çš„æ”¶é›†ã€ç®¡ç†ï¼Œæ‰€ä»¥å¯¹äºè¡¨å•çš„å®æ—¶æ£€æŸ¥ã€å“åº”çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚å› æ­¤åˆ¶ä½œä¸€ä¸ªå¯¹ç”¨äºè¾“å…¥å“åº”åŠæ—¶ã€åé¦ˆå‡†ç¡®çš„Formååˆ†é‡è¦ã€‚æœ¬æ–‡å°è¯•æå‡ºä¸€ä¸ªSwiftUIä¸‹çš„Formå¼€å‘æ€è·¯ã€‚</description><link>http://www.fatbobman.com/posts/swiftui-input-form</link><pubDate>Fri, 4 Sep 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>æˆ‘çš„appå¥åº·ç¬”è®°ä¸»è¦æ˜¯å¯¹æ•°æ®çš„æ”¶é›†ã€ç®¡ç†ï¼Œæ‰€ä»¥å¯¹äºè¡¨å•çš„å®æ—¶æ£€æŸ¥ã€å“åº”çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚å› æ­¤åˆ¶ä½œä¸€ä¸ªå¯¹ç”¨äºè¾“å…¥å“åº”åŠæ—¶ã€åé¦ˆå‡†ç¡®çš„Formååˆ†é‡è¦ã€‚æœ¬æ–‡å°è¯•æå‡ºä¸€ä¸ªSwiftUIä¸‹çš„Formå¼€å‘æ€è·¯ã€‚</p></blockquote><h2>å¥åº·ç¬”è®°1.0çš„æ—¶å€™</h2><p>åœ¨å¼€å‘å¥åº·ç¬”è®°1.0çš„ä½¿ç”¨ï¼Œå½“æ—¶ç”±äºiOS13å°šä¸æ”¯æŒonChangeï¼Œå½“æ—¶ä¸»è¦ä½¿ç”¨ç±»ä¼¼çš„æ£€æŸ¥æ–¹å¼ï¼š</p><h2>å¯¹äºç®€å•æƒ…å†µ</h2><pre data-language="swift"><code>@<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">""</span>

<span class="hljs-type">TextField</span>(<span class="hljs-string">"name"</span>,text:$name)
     .foregroundColor(name.<span class="hljs-built_in">count</span>.isEmpty ? .red : .black)
</code></pre><h2>ç¨å¤æ‚çš„æƒ…å†µ</h2><pre data-language="swift"><code>@<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">""</span>
@<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> age = <span class="hljs-string">""</span>

<span class="hljs-type">TextField</span>(<span class="hljs-string">"name"</span>,text:$name)
    .foregroundColor(!checkName() ? .red : .black)
<span class="hljs-type">TextField</span>(<span class="hljs-string">"age"</span>,text:$name)
     .keyboardType(.decimalPad)
     .foregroundColor(!checkAge() ? .red : .black)

<span class="hljs-type">Button</span>(<span class="hljs-string">"Save"</span>){
   <span class="hljs-comment">//ä¿å­˜</span>
}
.disable(!(checkName()&amp;&amp;checkeAge))

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">chekcName</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Bool</span> {
   <span class="hljs-keyword">return</span> name.<span class="hljs-built_in">count</span> &gt; <span class="hljs-number">0</span> &amp;&amp; name.<span class="hljs-built_in">count</span> &lt;= <span class="hljs-number">10</span> 
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">checkAge</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Bool</span> {
   <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> age = <span class="hljs-type">Double</span>(age) <span class="hljs-keyword">else</span> {<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>}
   <span class="hljs-keyword">return</span> age &gt; <span class="hljs-number">10</span> &amp;&amp; age &lt; <span class="hljs-number">20</span>
}
</code></pre><p>å…¶å®ä¹‹å‰å¯¹äºå¾ˆå¤æ‚çš„è¡¨å•ï¼Œæˆ‘ä¹Ÿæ˜¯é‡‡ç”¨äº†Combineçš„æ–¹å¼æ¥åšéªŒè¯çš„ã€‚</p><p>ä¸è¿‡Publisherçš„å’ŒViewçš„åˆ·æ–°å‘¨æœŸä¹‹é—´æœ‰ä¸€ä¸ªå“åº”çš„å·®è·ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€ä¸ªè¾“å…¥çš„åˆ¤æ–­éœ€è¦åˆ°ç¬¬äºŒä¸ªè¾“å…¥æ—¶æ‰ä¼šè¿”å›ç»“æœã€‚å¦‚æ­¤ä¸€æ¥ï¼Œåªèƒ½å°†åˆ¤æ–­é€»è¾‘éƒ½å†™åœ¨Viewä¸­ã€‚ä¸è¿‡å¦‚æœéœ€è¦åˆ©ç”¨ç½‘ç»œéªŒè¯çš„éƒ¨åˆ†ï¼Œä»ç„¶æ˜¯ä½¿ç”¨Publisheræ¥å¤„ç†çš„ã€‚å®ƒçš„å“åº”ç”±äºä½¿ç”¨OnReceiveæ‰€ä»¥ä¸ä¼šå‡ºç°ä¸Šé¢çš„åˆ¤æ–­æ—¶é—´å·®ã€‚</p><h2>å¥åº·ç¬”è®°2.0çš„å¤„ç†æ–¹å¼</h2><p>åœ¨æˆ‘ç›®å‰å¼€å‘çš„å¥åº·ç¬”è®°2.0ä¸­ï¼Œç”±äºiOS 14æ”¯æŒäº†onChange,è®©å¼€å‘è€…åœ¨Viewæœ‰äº†éå¸¸æ–¹ä¾¿çš„å¤„ç†é€»è¾‘åˆ¤æ–­çš„æ—¶æœºã€‚</p><p>ä»¥ä¸‹æ˜¯ç›®å‰å¼€å‘ä¸­çš„ç”»é¢ï¼š</p><img src="http://cdn.fatbobman.com/swiftui-form-formDemo.gif" alt="demo"/><h2>ç”¨MVVMçš„æ–¹å¼æ¥ç¼–å†™Form</h2><p>åœ¨ä½¿ç”¨SwiftUIè¿›è¡Œå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦ä½¿ç”¨MVVMçš„æ€æƒ³æ¥è€ƒè™‘appçš„æ¶æ„ï¼Œå¯¹äºæ¯ä¸€ä¸ªViewéƒ½å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªminiçš„appæ¥å¯¹å¾…ã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå¦‚ä¸‹çš„åŠŸèƒ½ï¼š</p><ol><li>æ˜¾ç¤ºæ¡£æ¡ˆã€ç¼–è¾‘æ¡£æ¡ˆã€æ–°å»ºæ¡£æ¡ˆéƒ½ä½¿ç”¨åŒä¸€ä¸ªä»£ç </li><li>å¯¹äºç”¨æˆ·çš„æ¯ä¸€æ¬¡è¾“å…¥éƒ½ç»™å‡ºåŠæ—¶å’Œå‡†ç¡®çš„åé¦ˆ</li><li>åªæœ‰ç”¨æˆ·çš„æ•°æ®å®Œå…¨æ»¡è¶³éœ€æ±‚æ—¶ï¼ˆå„ä¸ªè¾“å…¥é¡¹éƒ½æ»¡è¶³æ£€æŸ¥æ¡ä»¶åŒæ—¶åœ¨ç¼–è¾‘çŠ¶æ€ä¸‹ï¼Œå½“å‰ä¿®æ”¹æ•°æ®è¦ä¸åŸå§‹æ•°æ®ä¸åŒï¼‰ï¼Œæ‰å…è®¸ç”¨æˆ·ä¿å­˜ã€‚</li><li>å¦‚æœç”¨æˆ·å·²ç»ä¿®æ”¹æˆ–åˆ›å»ºäº†æ•°æ®ï¼Œç”¨æˆ·å–æ¶ˆæ—¶éœ€è¦äºŒæ¬¡ç¡®è®¤</li><li>åœ¨ç”¨æˆ·æ˜¾ç¤ºæ¡£æ¡ˆæ—¶ï¼Œå¯ä»¥ä¸€é”®åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼</li></ol><p><em>å¦‚æœä½ æ‰€éœ€è¦åˆ›å»ºçš„FormViewåŠŸèƒ½ç®€å•ï¼Œè¯·åƒä¸‡ä¸è¦ä½¿ç”¨ä¸‹åˆ—çš„æ–¹æ³•ã€‚ä¸‹åˆ—ä»£ç ä»…åœ¨åˆ›å»ºè¾ƒå¤æ‚çš„è¡¨å•æ—¶æ‰ä¼šå‘æŒ¥ä¼˜åŠ¿ã€‚</em></p><p>å®Œæˆåçš„è§†é¢‘å¦‚ä¸‹ï¼š</p><img src="http://cdn.fatbobman.com/swiftui-form-studentDemo.gif" alt="demo"/><p>ä¸‹è½½ (å½“å‰ä»£ç å·²å’Œ <a href="https://zhuanlan.zhihu.com/p/245663226">åœ¨SwiftUIä¸­åˆ¶ä½œå¯ä»¥æ§åˆ¶å–æ¶ˆæ‰‹åŠ¿çš„Sheet</a> åˆå¹¶)</p><p><a href="https://github.com/fatbobman/DismissConfirmSheet">æºä»£ç </a></p><p>ä¸ºè¾“å…¥å‡†å¤‡æ•°æ®æº</p><p>ä¸åŒäºåˆ›å»ºå¤šä¸ª@Stateæ•°æ®æºæ¥å¤„ç†æ•°æ®ï¼Œæˆ‘ç°åœ¨å°†æ‰€æœ‰éœ€è¦å½•å…¥çš„æ•°æ®ç»Ÿä¸€æ”¾åˆ°äº†ä¸€ä¸ªæ•°æ®æºä¸­</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyState</span>:<span class="hljs-title">Equatable</span></span>{
    <span class="hljs-keyword">var</span> name:<span class="hljs-type">String</span>
    <span class="hljs-keyword">var</span> sex:<span class="hljs-type">Int</span>
    <span class="hljs-keyword">var</span> birthday:<span class="hljs-type">Date</span>
}
</code></pre><p>è®©Viewå“åº”ä¸åŒçš„åŠ¨ä½œ</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">StudentAction</span></span>{
    <span class="hljs-keyword">case</span> show,edit,new
}
</code></pre><p><strong>æœ‰äº†ä¸Šè¿°çš„å‡†å¤‡ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åˆ›å»ºè¡¨å•çš„æ„é€ æ–¹æ³•äº†ï¼š</strong></p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StudentManager</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">EnvironmentObject</span> <span class="hljs-keyword">var</span> store:<span class="hljs-type">Store</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> action:<span class="hljs-type">StudentAction</span>
    <span class="hljs-keyword">let</span> student:<span class="hljs-type">Student?</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> defaultState:<span class="hljs-type">MyState</span>  <span class="hljs-comment">//ç”¨äºä¿å­˜åˆå§‹æ•°æ®ï¼Œå¯ä»¥ç”¨æ¥æ¯”è¾ƒï¼Œæˆ–è€…åœ¨æˆ‘çš„appä¸­ï¼Œå¯ä»¥æ¢å¤ç”¨æˆ·ä¹‹å‰çš„å€¼</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> myState:<span class="hljs-type">MyState</span> <span class="hljs-comment">//æ•°æ®æº</span>
    
    @<span class="hljs-type">Environment</span>(\.presentationMode) <span class="hljs-keyword">var</span> presentationMode

<span class="hljs-keyword">init</span>(action:<span class="hljs-type">StudentAction</span>,student:<span class="hljs-type">Student?</span>){
        _action = <span class="hljs-type">State</span>(wrappedValue: action)
        <span class="hljs-keyword">self</span>.student = student
        
        <span class="hljs-keyword">switch</span> action{
        <span class="hljs-keyword">case</span> .new:
            <span class="hljs-keyword">self</span>.defaultState = <span class="hljs-type">MyState</span>(name: <span class="hljs-string">""</span>,sex:<span class="hljs-number">0</span>, birthday: <span class="hljs-type">Date</span>())
            _myState = <span class="hljs-type">State</span>(wrappedValue: <span class="hljs-type">MyState</span>(name: <span class="hljs-string">""</span>, sex:<span class="hljs-number">0</span>, birthday: <span class="hljs-type">Date</span>()))
        <span class="hljs-keyword">case</span> .edit,.show:
            <span class="hljs-keyword">self</span>.defaultState = <span class="hljs-type">MyState</span>(name: student?.name ?? <span class="hljs-string">""</span>, sex:<span class="hljs-type">Int</span>(student?.sex ?? <span class="hljs-number">0</span>) , birthday: student?.birthday ?? <span class="hljs-type">Date</span>())
            _myState = <span class="hljs-type">State</span>(wrappedValue: <span class="hljs-type">MyState</span>(name: student?.name ?? <span class="hljs-string">""</span>, sex:<span class="hljs-type">Int</span>(student?.sex ?? <span class="hljs-number">0</span>), birthday: student?.birthday ?? <span class="hljs-type">Date</span>()))
        }
    }
  
}
</code></pre><p>å‡†å¤‡è¡¨å•æ˜¾ç¤ºå†…å®¹</p><pre data-language="swift"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">nameView</span><span class="hljs-params">()</span></span> -&gt; some <span class="hljs-type">View</span>{
        <span class="hljs-type">HStack</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"å§“å:"</span>)
            <span class="hljs-keyword">if</span> action == .show {
                <span class="hljs-type">Spacer</span>()
                <span class="hljs-type">Text</span>(defaultState.name)
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-type">TextField</span>(<span class="hljs-string">"å­¦ç”Ÿå§“å"</span>,text:$myState.name)
                    .multilineTextAlignment(.trailing)
            }
        }
    }
</code></pre><p>åˆæˆæ˜¾ç¤ºå†…å®¹</p><pre data-language="swift"><code><span class="hljs-type">Form</span>{
             nameView()
             sexView()
             birthdayView()
             errorView()
      }
</code></pre><p>å¯¹æ¯ä¸ªè¾“å…¥é¡¹ç›®è¿›è¡ŒéªŒè¯</p><pre data-language="swift"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">checkName</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">if</span> myState.name.isEmpty {
            errors.append(<span class="hljs-string">"å¿…é¡»å¡«å†™å§“å"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        }
    }
</code></pre><p>å¤„ç†æ‰€æœ‰çš„éªŒè¯ä¿¡æ¯</p><pre data-language="swift"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">checkAll</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">if</span> action == .show {<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>}
        errors.removeAll()
        <span class="hljs-keyword">let</span> r1 = checkName()
        <span class="hljs-keyword">let</span> r2 = checkSex()
        <span class="hljs-keyword">let</span> r3 = checkBirthday()
        <span class="hljs-keyword">let</span> r4 = checkChange()
        <span class="hljs-keyword">return</span> r1&amp;&amp;r2&amp;&amp;r3&amp;&amp;r4
    }
</code></pre><p>é€šè¿‡onChangeæ¥è¿›è¡Œæ ¡éªŒ</p><pre data-language="swift"><code>.onChange(of: myState){ <span class="hljs-number">_</span> <span class="hljs-keyword">in</span>
         confirm =  checkAll()
       }
<span class="hljs-comment">//ç”±äºonChangeå¿…é¡»åœ¨æ•°æ®æºå‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šæ¿€å‘ï¼Œæ‰€ä»¥åœ¨Viewæœ€åˆæ˜¾ç¤ºæ—¶ä¾¿è¿›è¡Œä¸€æ¬¡éªŒè¯</span>
.onAppear{
     confirm =  checkAll()
   }
</code></pre><p>å¯¹toolbarçš„å†…å®¹è¿›è¡Œå¤„ç†</p><pre data-language="swift"><code><span class="hljs-type">ToolbarItem</span>(placement: <span class="hljs-type">ToolbarItemPlacement</span>.navigationBarTrailing){
                    <span class="hljs-keyword">if</span> action == .show {
                        <span class="hljs-type">Button</span>(<span class="hljs-string">"ç¼–è¾‘"</span>){
                            action = .edit
                            confirm = <span class="hljs-literal">false</span>
                        }
                    }
                    <span class="hljs-keyword">else</span> {
                    <span class="hljs-type">Button</span>(<span class="hljs-string">"ç¡®å®š"</span>){
                        <span class="hljs-keyword">if</span> action == .new {
                        presentationMode.wrappedValue.dismiss()
                        store.newStudent(viewModel: myState)
                        }
                        <span class="hljs-keyword">if</span> action == .edit{
                            presentationMode.wrappedValue.dismiss()
                            store.editStudent(viewModel: myState, student: student!)
                        }
                    }
                    .disabled(!confirm)
                    }
</code></pre><p>æ›´è¯¦å°½çš„å†…å®¹å¯ä»¥å‚çœ‹<a href="https://github.com/fatbobman/DismissConfirmSheet">æºä»£ç </a></p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftui-multiSheet</guid><title>åœ¨SwiftUIä¸­,æ ¹æ®éœ€æ±‚å¼¹å‡ºä¸åŒçš„Sheet</title><description>Sheetæ˜¯ä¸€ä¸ªæˆ‘æ¯”è¾ƒå–œæ¬¢çš„äº¤äº’å½¢å¼ï¼Œå®ƒå¯ä»¥å¾ˆå¥½çš„æ§åˆ¶ç”¨æˆ·çš„æ“ä½œè¡Œä¸ºï¼Œè®©ç”¨æˆ·çš„äº¤äº’é€»è¾‘å•çº¿æ¡åŒ–ã€‚åœ¨iOS14ä¸Šï¼ŒSwiftUIå¢åŠ äº†fullCoverï¼Œæ”¯æŒäº†å…¨å±çš„Sheetæ–¹å¼ï¼Œè®©å¼€å‘è€…åˆäº†æ›´å¤šçš„é€‰æ‹©ã€‚</description><link>http://www.fatbobman.com/posts/swiftui-multiSheet</link><pubDate>Fri, 4 Sep 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>Sheetæ˜¯ä¸€ä¸ªæˆ‘æ¯”è¾ƒå–œæ¬¢çš„äº¤äº’å½¢å¼ï¼Œå®ƒå¯ä»¥å¾ˆå¥½çš„æ§åˆ¶ç”¨æˆ·çš„æ“ä½œè¡Œä¸ºï¼Œè®©ç”¨æˆ·çš„äº¤äº’é€»è¾‘å•çº¿æ¡åŒ–ã€‚åœ¨iOS14ä¸Šï¼ŒSwiftUIå¢åŠ äº†fullCoverï¼Œæ”¯æŒäº†å…¨å±çš„Sheetæ–¹å¼ï¼Œè®©å¼€å‘è€…åˆäº†æ›´å¤šçš„é€‰æ‹©ã€‚</p></blockquote><h2>åŸºæœ¬ç”¨æ³•</h2><pre data-language="swift"><code>@<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> showView1 = <span class="hljs-literal">false</span>
@<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> showView2 = <span class="hljs-literal">false</span>

<span class="hljs-type">List</span>{
    <span class="hljs-type">Button</span>(<span class="hljs-string">"View1"</span>){
      showView1.toggle()
    }
  .sheet(isPresented:$showView1){
    <span class="hljs-type">Text</span>(<span class="hljs-string">"View1"</span>)
  }
  
  <span class="hljs-type">Button</span>(<span class="hljs-string">"View2"</span>){
    showView2.toggle()
  }
  .sheet(isPresented:$showView2){
    <span class="hljs-type">Text</span>(<span class="hljs-string">"View2"</span>)
  }
}
</code></pre><p>ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç‚¹å‡»ä¸åŒçš„æŒ‰é’®è€Œå¼¹å‡ºç›¸å¯¹åº”çš„Viewã€‚</p><p>ä¸è¿‡å®ƒæœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š</p><ol><li>å¦‚æœä½ çš„ä»£ç æœ‰å¤šå¤„éœ€è¦ä½¿ç”¨ä¸åŒviewä½œä¸ºsheetçš„æƒ…å†µï¼Œä½ éœ€è¦å£°æ˜å¤šä¸ªå¯¹åº”çš„å¼€å…³å€¼</li><li>å¦‚æœä½ çš„Viewç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œåœ¨æ¯”è¾ƒå†…éƒ¨çš„åœ°æ–¹ï¼Œä¸Šè¿°ä»£ç å¾ˆå¯èƒ½æ— æ³•æ¿€å‘sheetçš„æ˜¾ç¤ºï¼ˆè¿™ä¸ªé—®é¢˜åœ¨ios13ä¸Šå°±å­˜åœ¨ï¼Œåœ¨ios14ä¸Šä»æœ‰è¿™æ ·çš„æƒ…å†µã€‚æˆ‘è‡³ä»Šä¹Ÿæ²¡æœ‰å®Œå…¨æ€»ç»“å‡ºè§„å¾‹ï¼‰</li></ol><h2>ä½¿ç”¨Itemæ¥å¯¹åº”ä¸åŒçš„View</h2><p>å¥½åœ¨sheetæä¾›äº†å¦å¤–ä¸€ç§æ¿€æ´»æ–¹å¼</p><pre data-language="swift"><code>.sheet(item: <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Identifiable?</span>&gt;, content: (<span class="hljs-type">Identifiable</span>) -&gt; <span class="hljs-type">View</span>)
</code></pre><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥å®Œæˆåªå“åº”ä¸€ä¸ªæ¿€æ´»å˜é‡ï¼Œè€Œæ˜¾ç¤ºæ‰€éœ€çš„ä¸åŒView</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">View1</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">Environment</span>(\.presentationMode) <span class="hljs-keyword">var</span> presentationMode
    <span class="hljs-keyword">let</span> text:<span class="hljs-type">String</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">NavigationView</span>{
            <span class="hljs-type">VStack</span>{
            <span class="hljs-type">Text</span>(text)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"View1"</span>)
            }
                .toolbar{
                    <span class="hljs-type">ToolbarItem</span>(placement: <span class="hljs-type">ToolbarItemPlacement</span>.navigationBarLeading){
                        <span class="hljs-type">Button</span>(<span class="hljs-string">"cancel"</span>){
                            presentationMode.wrappedValue.dismiss()
                        }
                    }
                }
        }
    }
    
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">View2</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">Environment</span>(\.presentationMode) <span class="hljs-keyword">var</span> presentationMode
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">NavigationView</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"View2"</span>)
                .toolbar{
                    <span class="hljs-type">ToolbarItem</span>(placement: <span class="hljs-type">ToolbarItemPlacement</span>.navigationBarLeading){
                        <span class="hljs-type">Button</span>(<span class="hljs-string">"cancel"</span>){
                            presentationMode.wrappedValue.dismiss()
                        }
                    }
                }
        }
    }
    
}
</code></pre><p>å…ˆå‡†å¤‡ä¸¤ä¸ªéœ€è¦æ˜¾ç¤ºçš„View</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SheetUsingAnyView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sheetView:<span class="hljs-type">AnyView?</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">NavigationView</span>{
            <span class="hljs-type">List</span>{
                <span class="hljs-type">Button</span>(<span class="hljs-string">"View1"</span>){
                    sheetView = <span class="hljs-type">AnyView</span>(<span class="hljs-type">View1</span>(text:<span class="hljs-string">"Hello world"</span>))
                }
                <span class="hljs-type">Button</span>(<span class="hljs-string">"View2"</span>){
                    sheetView = <span class="hljs-type">AnyView</span>(<span class="hljs-type">View2</span>())
                }
            }
            .listStyle(<span class="hljs-type">InsetGroupedListStyle</span>())
            .sheet(item: $sheetView){ view <span class="hljs-keyword">in</span>
               view
            }
            .navigationTitle(<span class="hljs-string">"AnyView"</span>)
            .navigationBarTitleDisplayMode(.inline)
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">AnyView</span>:<span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> id:<span class="hljs-type">UUID</span>{<span class="hljs-type">UUID</span>()}
}
</code></pre><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡ç»™sheetViewèµ‹äºˆä¸åŒçš„å€¼æ¥å®ç°å¼¹å‡ºå¯¹åº”çš„Viewã€‚</p><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆéå¸¸çš„ä¾¿æ·ï¼Œä¸è¿‡ä¹Ÿå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>åœ¨æä¸ªåˆ«çš„æƒ…å†µä¸‹ï¼Œå½“appè¿›å…¥åå°ï¼ˆæ­¤æ—¶appçš„sheetå¤„äºæ˜¾ç¤ºçŠ¶æ€ï¼‰ï¼Œå†ä»åå°é‡æ–°æ˜¾ç¤ºæ—¶ä¼šå‡ºç°ç¨‹åºå´©æºƒæƒ…å†µã€‚è¿™ä¸ªé—®é¢˜åœ¨ios13 å’Œç›®å‰çš„ ios14ï¼ˆæµ‹è¯•åˆ°beta5ï¼‰éƒ½å¯èƒ½å‡ºç°ã€‚ä¸è¿‡å‡ºç°çš„å‰ææ˜¯ä½ çš„ä»£ç çš„æ˜¾ç¤ºå±‚çº§è¦è¶³å¤Ÿå¤æ‚ï¼Œå¦‚æœä»£ç æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ã€‚</li></ol><p>å¯¹äºè¿™ä¸ªå´©æºƒçš„æƒ…å†µï¼Œé”™è¯¯å’Œè°ƒè¯•ä»£ç ç»™çš„ä¿¡æ¯éƒ½å¾ˆä¸å‡†ç¡®ï¼Œä¼°è®¡åº”è¯¥å’ŒViewçš„åˆå§‹åŒ–å†²çªæœ‰å…³ã€‚</p><ol start="2"><li>æŒ‡ä»¤ä¸æ¸…æ™°ã€‚å¦‚æœèµ‹å€¼ç»™sheetViewçš„Viewå‚æ•°å¾ˆå¤šï¼Œä½ çš„ä»£ç çš„å¯è¯»æ€§ä¼šæ¯”è¾ƒå·®</li></ol><h2>é‡‡ç”¨Reducerçš„æ€è·¯è§£å†³é—®é¢˜</h2><p>å…¶å®å¯¹äºæ¯ä¸€ä¸ªViewï¼Œæˆ‘ä»¬ä¹Ÿéƒ½å¯ä»¥æŒ‰ç…§MVVMçš„æ€è·¯æ¥æ„å»ºå®ƒè‡ªå·±çš„miniçŠ¶æ€æœºï¼ˆæˆ‘çš„å¦ä¸€ç¯‡å…³äºFormçš„æ–‡ç« ä¹Ÿæ˜¯è¿™æ ·çš„æ€è·¯ï¼‰ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SheetUsingEnum</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sheetAction:<span class="hljs-type">SheetAction?</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">NavigationView</span>{
            <span class="hljs-type">List</span>{
                <span class="hljs-type">Button</span>(<span class="hljs-string">"view1"</span>){
                    sheetAction = .view1(text:<span class="hljs-string">"Test"</span>)
                }
                <span class="hljs-type">Button</span>(<span class="hljs-string">"view2"</span>){
                    sheetAction = .view2
                }
            }
            .listStyle(<span class="hljs-type">InsetGroupedListStyle</span>())
            .sheet(item: $sheetAction){ action <span class="hljs-keyword">in</span>
                getActionView(action)
            }
            .navigationTitle(<span class="hljs-string">"Enum"</span>)
            .navigationBarTitleDisplayMode(.inline)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getActionView</span><span class="hljs-params">(<span class="hljs-number">_</span> action:SheetAction)</span></span> -&gt; some <span class="hljs-type">View</span>{
        <span class="hljs-keyword">switch</span> action{
        <span class="hljs-keyword">case</span> .view1(<span class="hljs-keyword">let</span> text):
            <span class="hljs-keyword">return</span> <span class="hljs-type">AnyView</span>(<span class="hljs-type">View1</span>(text: text))
        <span class="hljs-keyword">case</span> .view2:
            <span class="hljs-keyword">return</span> <span class="hljs-type">AnyView</span>(<span class="hljs-type">View2</span>())
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SheetAction</span>:<span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">case</span> view1(text:<span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> view2
    
    <span class="hljs-keyword">var</span> id:<span class="hljs-type">UUID</span>{
        <span class="hljs-type">UUID</span>()
    }
}
</code></pre><p>æ¯”è¾ƒç›´æ¥ä½¿ç”¨AnyViewï¼Œä»£ç é‡ç¨å¾®å¢å¤šäº†ç‚¹ï¼Œä¸è¿‡ç¬¬ä¸€æ²¡æœ‰äº†å´©æºƒçš„å¯èƒ½æ€§ï¼ŒåŒæ—¶ä»£ç çš„æ˜“è¯»æ€§ä¹Ÿå¾—åˆ°äº†æé«˜ã€‚</p><h2>è§£å†³æŸäº›Viewæ— æ³•æ¿€æ´»Sheetçš„é—®é¢˜</h2><p>å…³äºåœ¨æŸäº›Viewä¸Šæ— æ³•æ¿€æ´»Sheetï¼Œæˆ‘ç›®å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯bindå®ƒçš„çˆ¶Viewçš„sheetActionï¼Œé€šè¿‡çˆ¶Viewæ¥æ¿€æ´»Sheetã€‚é€šè¿‡æšä¸¾çš„ç›¸å…³å€¼æ¥ä¼ é€’æ‰€éœ€çš„æ•°æ®ã€‚</p><p><strong>æ›´æ–°</strong>: åœ¨iOS14ä¸‹,ä½¿ç”¨itemæ¥æ¿€æ´»sheet,åœ¨æŸäº›ç‰¹æ®Šåœºåˆå¯èƒ½ä¼šå¯¼è‡´app(æ‰“å¼€sheetçš„æƒ…å†µä¸‹)ä»åå°è¿”å›æ—¶ä¼šå‘ç”Ÿé”™è¯¯ç”šè‡³å´©æºƒ.æ‰€ä»¥ä¸Šè¿°ä»£ç ä¸­å¯¹äºsheetçš„æ¿€æ´»,å·²ç»ä½œå‡ºäº†æ›´æ”¹.æ›´æ”¹åçš„ä»£ç å·²ç»ç»Ÿä¸€åˆ°äº†<a href="http://www.fatbobman.com/posts/swiftui-dismiss-sheet/">åœ¨SwiftUIä¸­åˆ¶ä½œå¯ä»¥æ§åˆ¶å–æ¶ˆæ‰‹åŠ¿çš„Sheet</a></p><p><a href="https://github.com/fatbobman/DismissConfirmSheet">å¯ä»¥åœ¨æ­¤ä¸‹è½½é¡¹ç›®å®Œæ•´ä»£ç </a></p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/healthNote2-development-memo-2</guid><title>å¥åº·ç¬”è®°2.0å¼€å‘éšç¬”(äºŒ)</title><description>æœ¬å‘¨çš„ç”±äºå…¶ä»–çäº‹çš„åŸå› ,æ¯å¤©èƒ½å¤Ÿç”¨äºå¼€å‘çš„æ—¶é—´åŸºæœ¬ä¸Šåªèƒ½ä¿è¯2-3ä¸ªå°æ—¶,æ‰€ä»¥è¿›å±•ä¸å¤§.ä¸è¿‡å¥½åœ¨æˆ‘ä¹Ÿæ²¡æœ‰æ˜ç¡®çš„è¿›åº¦æŒ‡æ ‡.</description><link>http://www.fatbobman.com/posts/healthNote2-development-memo-2</link><pubDate>Mon, 24 Aug 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<p>æœ¬å‘¨çš„ç”±äºå…¶ä»–çäº‹çš„åŸå› ,æ¯å¤©èƒ½å¤Ÿç”¨äºå¼€å‘çš„æ—¶é—´åŸºæœ¬ä¸Šåªèƒ½ä¿è¯2-3ä¸ªå°æ—¶,æ‰€ä»¥è¿›å±•ä¸å¤§.ä¸è¿‡å¥½åœ¨æˆ‘ä¹Ÿæ²¡æœ‰æ˜ç¡®çš„è¿›åº¦æŒ‡æ ‡.</p><p>ç”±äº2.0åœ¨åŠŸèƒ½ä¸ŠåŒ1.0çš„åŒºåˆ«å¹¶ä¸å¤ªå¤§,æ‰€ä»¥åœ¨åŠŸèƒ½éœ€æ±‚è®¾è®¡ä¸Šä¸éœ€è¦èŠ±è´¹å¤ªå¤šçš„æ—¶é—´.è¿™åŠå¹´æ¥æˆ‘è‡ªå·±ä¹ŸåŸºæœ¬æ€»ç»“äº†ä¸€ä¸ªè‡ªå·±ç”¨èµ·æ¥æ¯”è¾ƒé¡ºæ‰‹çš„MVVMæ¡†æ¶æ‰€ä»¥åœ¨æœ€å¼€å§‹çš„1å‘¨,å¹¶ä¸ç”¨å¤ªè´¹åŠ›å˜å®Œæˆäº†ä¸€ä¸ªæœ€ç®€é™‹uiçš„åŸå‹ç‰ˆ.</p><p>å°½ç®¡å«åŸå‹ç‰ˆ,ä½†æ•°æ®æµã€æ•°æ®åº“æ“ä½œç­‰å¾…åŸºç¡€ä»£ç éƒ½æ˜¯è¦ç”¨äºæ­£å¼ç‰ˆä¸­çš„.</p><p>åœ¨ä¸Šå‘¨,è‹¹æœå‘å¸ƒäº†Xcode12çš„beta5,å…¶ä¸­æä¾›äº†åœ¨SwiftUI lifecycleä¸‹çš„CoreDataæ¨¡ç‰ˆ.æ‰€ç”¨çš„æ€è·¯å’Œæˆ‘ç°åœ¨å·®ä¸å¤š.éƒ½æ˜¯ä½¿ç”¨staticæ¥ä¿è¯ä¸Šä¸‹æ–‡çš„å”¯ä¸€æ€§.å¦å¤–è‹¹æœä¹Ÿæä¾›äº†ä¸€ä¸ªç”¨äºpreviewçš„æ€è·¯,åˆ›å»ºäº†ä¸€ä¸ªin-memory çš„Sqllite.è¿™ä¸ªä¹Ÿå’Œæˆ‘ç°åœ¨çš„é€”å¾„å·®è·ä¸å¤§,æˆ‘ç°åœ¨æ˜¯ç›´æ¥é€šè¿‡ç”ŸæˆSample NSManageObjectç»™Previewæ¥å®ç°çš„.åæ­£éƒ½æ˜¯å¯ä»¥åœ¨previewä¸­æ¯”è¾ƒå¥½çš„æ”¯æŒCoreDataæ•°æ®.</p><p>previewåœ¨Xcode12ä¸­å¾—åˆ°äº†å¾ˆå¤§çš„åŠ å¼º,å´©æºƒçš„æœºç‡æ˜æ˜¾ä¸‹é™å¾ˆå¤š.æˆ‘ç›®å‰å‡ ä¹æ‰€æœ‰çš„Viewéƒ½å¯ä»¥å®Œç¾çš„previewå‡ºæ¥.</p><p>æœ¬æ¬¡å‡çº§æˆ‘å¯¹äºappçš„UIçš„è¿˜æ˜¯æœ‰ç‚¹ä¼å›¾å¿ƒçš„,æœ€åˆä¹Ÿå¸Œæœ›èƒ½å¤Ÿåˆ¶ä½œæˆä¸€ä¸ªæ¯”è¾ƒæœ‰é£æ ¼çš„app.ä¸è¿‡åœ¨ä»”ç»†æƒè¡¡è¿‡å,è¿˜æ˜¯æ”¾å¼ƒäº†.æ”¾å¼ƒçš„ç†ç”±ä¹Ÿååˆ†ç®€å•,å¯¹äºä¸ªäººå¼€å‘è€…æˆ–è€…å°å‹å›¢é˜Ÿå¼€å‘è€…,å¦‚æœæ²¡æœ‰å¥½çš„å®¡ç¾åˆ¤æ–­åŠ›ã€ç¾å·¥æ‰§è¡ŒåŠ›ã€äº¤äº’é€»è¾‘çš„è®¾è®¡èƒ½åŠ›,ä¸€ä¸ªè²Œä¼¼å…·æœ‰ä¸ªäººé£æ ¼çš„è®¾è®¡å¾ˆå¯èƒ½ä¼šä»¥æƒ¨è´¥å‘Šç»ˆ.</p><p>æœ€ç»ˆè¿˜æ˜¯å†³å®šä»¥iOSçš„åŸç”ŸUIKitåŸºç¡€ä¸Šæ¥è¿›è¡Œè®¾è®¡.ä¸è¿‡å³ä½¿è‹¹æœçš„åŸç”Ÿæ§ä»¶å·²ç»æ¯”è¾ƒæœ‰ç¾æ„Ÿ,ä¸è¿‡æƒ³è¦å¥½çš„è‰²å½©æ­é…ã€åˆé€‚çš„å¸ƒå±€ã€é¡ºç•…çš„äº¤äº’ä»ç„¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ….</p><p>ä¸“ä¸šçš„äº‹æƒ…è¿˜æ˜¯è¦æ‰¾ä¸“ä¸šçš„è§£å†³æ–¹æ¡ˆ.æœ€ç»ˆ,æˆ‘åœ¨gumroad.comä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªè‡ªå·±æ¯”è¾ƒå–œæ¬¢çš„æ§ä»¶è®¾è®¡åŒ…<a href="https://gumroad.com/l/iostoolkit"><strong>Figma iOS UI kit</strong></a>,ä»¥99ç¾é‡‘ä¹°äº†ä¸‹æ¥.</p><p>è¿™ä¸ªåŒ…çš„æ¯”è¾ƒé€‚åˆå¼€å‘iOSåŸç”Ÿçš„app.ç”±äºå®ƒåŒæ—¶æä¾›äº†lightå’Œdarkä¸¤ä¸ªæ¨¡å¼ä¸‹çš„å¯¹åº”Demo,æ‰€ä»¥æŒ‡å¯¼æ€§è¿˜æ˜¯å¾ˆå¼ºçš„.</p><p>åœ¨ç ”ç©¶è¿™ä¸ªæ¨¡ç‰ˆçš„è®¾è®¡æ–‡ä»¶è¿‡ç¨‹ä¸­æˆ‘æ‰å‘ç°,ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„æ§ä»¶å…¶å®é‡Œé¢æœ‰ç€éå¸¸å¤šçš„ç»†èŠ‚.æˆ‘è¯•å›¾åœ¨SwiftUIä¸­åœ¨ä¿è¯æ€§èƒ½çš„æƒ…å†µä¸‹,å®ç°æ›´å¤šçš„ç»†èŠ‚.</p><p>è¿™æ˜¯æˆ‘ç›®å‰ä¸€éƒ¨åˆ†Viewçš„è®¾è®¡ç¨¿</p><img src="http://cdn.fatbobman.com/healthnotes-develop-memo-2-1.jpg" alt="æˆªå±2020-08-24 ä¸‹åˆ3.53.25"/><img src="http://cdn.fatbobman.com/healthnotes-develop-memo-2-2.jpg" alt="æˆªå±2020-08-24 ä¸‹åˆ3.54.24"/><p>ç›®å‰å·²ç»é’ˆå¯¹å®Œæˆçš„è¿™ä¸€å°éƒ¨åˆ†å¼€å§‹ç¼–å†™ä»£ç äº†.ä¹‹æ‰€ä»¥åœ¨æ²¡æœ‰å®Œå…¨å®Œæˆè®¾è®¡çš„æƒ…å†µä¸‹ä¾¿å¼€å§‹å†™ä»£ç ,ä¸»è¦çš„åŸå› æ˜¯ä¸ºäº†æ£€æŸ¥æˆ‘åœ¨ä»£ç ä¸Šå¯¹è®¾è®¡çš„è¿˜åŸåº¦,åŒæ—¶ä¹Ÿçœ‹ä¸€ä¸‹å½“å‰çš„è®¾è®¡åœ¨å®é™…è¿è¡ŒçŠ¶å†µä¸‹æ˜¯å¦åˆç†,ä»¥ä¾¿æ€»ç»“ç»éªŒå®Œæˆä¸‹ä¸€æ­¥çš„å…¨é¢è®¾è®¡.</p><p><em>figmaåŠŸèƒ½ä¸ŠåŒSketchå·®ä¸å¤š,è€Œä¸”æœ€ä½é—¨æ§›è¿˜æ˜¯å…è´¹çš„.ä¸è¿‡å®ƒå¯¹äºç½‘ç»œçš„å¤–ç½‘è¿æ¥çŠ¶å†µè¦æ±‚æ¯”è¾ƒé«˜.</em></p><p>åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™,è¿˜æ˜¯èƒ½å¤Ÿæ˜æ˜¾æ„Ÿè§‰åˆ°å’Œè®¾è®¡ä¹‹é—´çš„å·®åˆ«çš„,æœ‰äº›åœ°æ–¹è¦åšå–èˆ,æœ‰äº›åœ°æ–¹åœ¨å®æœºä¸Šçš„æ˜¾ç¤ºåˆä¸å°½å¦‚äººæ„.åªæœ‰ä¸æ–­çš„ç£¨åˆæ‰èƒ½å¢é•¿ç»éªŒ.</p><img src="http://cdn.fatbobman.com/healthnotes-develop-memo-2-3.jpg" alt="æˆªå±2020-08-24 ä¸‹åˆ4.13.08"/><p>æ€»ä½“è€Œè¨€ä½¿ç”¨Figmaæˆ–Sketchè¿›è¡Œçš„è®¾è®¡åœ¨SwiftUIä¸­çš„è¿˜åŸåº¦è¿˜æ˜¯å¾ˆé«˜çš„.å¼€å‘éš¾åº¦ä¹Ÿä¸å¤§.</p><p>åœ¨æœ¬å‘¨å¼€å‘è¿‡ç¨‹ä¸­,å‡ºç°äº†ä¸€ä¸ªè®©æˆ‘æ¯”è¾ƒå¤´ç–¼çš„åœ°æ–¹,ä¸è¿‡æœ€ç»ˆè¿˜æ˜¯è§£å†³äº†.</p><p>åœ¨2.0ä¸­,æˆ‘æ‰“ç®—ä½¿ç”¨ç±»ä¼¼iOSé‚®ä»¶ç¨‹åºçš„ä¾§æ»‘èœå•è¿›è¡Œäº¤äº’,ä¸è¿‡å½“æ•°æ®é‡å¢å¤§æ—¶,æ˜¾ç¤ºå˜å¾—å¼‚å¸¸å¡é¡¿.æœ€ç»ˆå‘ç°äº†é—®é¢˜å‡ºåœ¨Listä¸­ä¸æ­£ç¡®çš„ä½¿ç”¨äº†ForEach.å…·ä½“å…³äºè¿™éƒ¨åˆ†çš„å†…å®¹,æˆ‘å·²ç»è®°å½•åœ¨äº†å¦ä¸€ç¯‡æ–‡ç« ä¸­<a href="http://www.fatbobman.com/posts/swiftui-list-foreach/">èŠä¸€ä¸‹SwiftUIä¸­çš„Listå’ŒForEach</a>.</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftui-list-foreach</guid><title>èŠä¸€ä¸‹SwiftUIä¸­çš„Listå’ŒForEach</title><description>åœ¨SwiftUIä¸­ä½¿ç”¨Listå¯ä»¥éå¸¸æ–¹ä¾¿å¿«é€Ÿçš„åˆ¶ä½œå„ç§åˆ—è¡¨.Listå…¶å®å°±æ˜¯å¯¹UITableViewè¿›è¡Œçš„å°è£….</description><link>http://www.fatbobman.com/posts/swiftui-list-foreach</link><pubDate>Mon, 24 Aug 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<p>åœ¨SwiftUIä¸­ä½¿ç”¨Listå¯ä»¥éå¸¸æ–¹ä¾¿å¿«é€Ÿçš„åˆ¶ä½œå„ç§åˆ—è¡¨.Listå…¶å®å°±æ˜¯å¯¹UITableViewè¿›è¡Œçš„å°è£…(æ›´å¤šListçš„å…·ä½“ç”¨æ³•è¯·å‚é˜…<a href="https://zhuanlan.zhihu.com/p/110749923">ListåŸºæœ¬ç”¨æ³•</a>).</p><p>åœ¨Listä¸­æ·»åŠ åŠ¨æ€å†…å®¹,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼</p><h3>ç›´æ¥ä½¿ç”¨Listè‡ªå·±æä¾›çš„åŠ¨æ€å†…å®¹æ„é€ æ–¹æ³•</h3><pre data-language="swift"><code>  <span class="hljs-type">List</span>(<span class="hljs-number">0</span>..&lt;<span class="hljs-number">100</span>){ i <span class="hljs-keyword">in</span>
    <span class="hljs-type">Text</span>(<span class="hljs-string">"id:\(id)"</span>)
  }
</code></pre><h3>åœ¨Listä¸­ä½¿ç”¨ForEach</h3><pre data-language="swift"><code>  <span class="hljs-type">List</span>{
    <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>..&lt;<span class="hljs-number">100</span>){ i <span class="hljs-keyword">in</span>
      <span class="hljs-type">Text</span>(<span class="hljs-string">"id:\(id)"</span>)
    }
  }
</code></pre><p>åœ¨ç¢°åˆ°æˆ‘æœ€è¿‘å‡ºç°çš„é—®é¢˜ä¹‹å‰,æˆ‘ä¸€ç›´ä»¥ä¸ºä¸Šè¿°ä¸¤ç§ç”¨æ³•é™¤äº†æä¸ªåˆ«çš„åŒºåˆ«å¤–,åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆä¸åŒ.</p><p>å½“æ—¶çŸ¥é“çš„åŒºåˆ«:</p><h3>ä½¿ç”¨ForEachå¯ä»¥åœ¨åŒä¸€Listä¸­,æ·»åŠ å¤šä¸ªåŠ¨æ€æº,ä¸”å¯æ·»åŠ é™æ€å†…å®¹</h3><pre data-language="swift"><code>  <span class="hljs-type">List</span>{
    <span class="hljs-type">ForEach</span>(items,id:\.<span class="hljs-keyword">self</span>){ item <span class="hljs-keyword">in</span>
      <span class="hljs-type">Text</span>(item)
    }
    <span class="hljs-type">Text</span>(<span class="hljs-string">"å…¶ä»–å†…å®¹"</span>)
    <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>..&lt;<span class="hljs-number">10</span>){ i <span class="hljs-keyword">in</span>
      <span class="hljs-type">Text</span>(<span class="hljs-string">"id:\(i)"</span>)
    }
  }
</code></pre><h3>ä½¿ç”¨ForEachå¯¹äºåŠ¨æ€å†…å®¹å¯ä»¥æ§åˆ¶ç‰ˆå¼</h3><pre data-language="swift"><code>  <span class="hljs-type">List</span>{
    <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>..&lt;<span class="hljs-number">10</span>){ i <span class="hljs-keyword">in</span>
      <span class="hljs-type">Rectangle</span>()
        .listRowInsets(<span class="hljs-type">EdgeInsets</span>()) <span class="hljs-comment">//å¯ä»¥æ§åˆ¶è¾¹ç•Œinsets</span>
    }
  }
  
  <span class="hljs-type">List</span>(<span class="hljs-number">0</span>..&lt;<span class="hljs-number">10</span>){ i <span class="hljs-keyword">in</span>
     <span class="hljs-type">Rectangle</span>()
        .listRowInsets(<span class="hljs-type">EdgeInsets</span>()) 
        <span class="hljs-comment">// ä¸å¯ä»¥æ§åˆ¶è¾¹ç•Œinsets.   .listRowInsets(EdgeInsets())åœ¨Listä¸­åªå¯¹é™æ€å†…å®¹æœ‰æ•ˆ</span>
  }
</code></pre><p>åŸºäºä»¥ä¸Šçš„åŒºåˆ«,æˆ‘åœ¨å¤§å¤šæ•°çš„æ—¶å€™å‡é‡‡ç”¨ForEachåœ¨Listä¸­è£…å¡«åˆ—è¡¨å†…å®¹,å¹¶ä¸”éƒ½å–å¾—äº†é¢„æƒ³çš„æ•ˆæœ.</p><p>ä½†æ˜¯åœ¨æœ€è¿‘æˆ‘åœ¨å¼€å‘ä¸€ä¸ªç±»ä¼¼äºiOSé‚®ä»¶appçš„åˆ—è¡¨æ—¶å‘ç”Ÿäº†è®©æˆ‘æ— è¯­çš„çŠ¶æ€â€”â€”åˆ—è¡¨å¡é¡¿åˆ°å®Œå…¨æ— æ³•å¿è€.</p><p>é€šè¿‡ä¸‹é¢çš„è§†é¢‘å¯ä»¥çœ‹åˆ°è®©æˆ‘ç—›è‹¦çš„appè¡¨ç°</p><video src="http://cdn.fatbobman.com/swiftui-list-foreach-10ForEach.mp4" controls = "controls"></video><p>åªæœ‰åæ¡è®°å½•æ—¶çš„çŠ¶æ€.éå¸¸ä¸æ»‘</p><pre data-language="swift"><code> <span class="hljs-type">List</span>{
    <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>..&lt;<span class="hljs-number">10000</span>){ i <span class="hljs-keyword">in</span>
        <span class="hljs-type">Cell</span>(id: i)
          .listRowInsets(<span class="hljs-type">EdgeInsets</span>())
          .swipeCell(cellPosition: .both, leftSlot: slot1, rightSlot: slot1)
        }
    }
</code></pre><video src="http://cdn.fatbobman.com/swiftui-list-foreach-10000MyList.mp4" controls = "controls"></video><p>10000æ¡è®°å½•çš„æ ·å­</p><p>åœ¨10æ¡è®°å½•æ—¶ä¸€åˆ‡éƒ½å¾ˆå®Œç¾,ä½†å½“è®°å½•è®¾ç½®ä¸º10000æ¡æ—¶,å®Œå…¨å¡æˆäº†pptçš„çŠ¶æ€.å°¤å…¶æ˜¯Viewåˆå§‹åŒ–ä¾¿å æœ‰äº†å¤§é‡çš„æ—¶é—´.</p><p>èµ·åˆæˆ‘è®¤ä¸ºå¯èƒ½æ˜¯æˆ‘å†™çš„æ»‘åŠ¨èœå•çš„é—®é¢˜,ä½†åœ¨è‡ªå·±æ£€æŸ¥ä»£ç åæ’å‡ºäº†è¿™ä¸ªé€‰é¡¹.ä¸ºäº†æ›´å¥½çš„äº†è§£åœ¨Listä¸­Cellçš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€,å†™äº†ä¸‹é¢çš„æµ‹è¯•ä»£ç .</p><pre data-language="swift"><code>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Cell</span>:<span class="hljs-title">View</span></span>{
        <span class="hljs-keyword">let</span> id:<span class="hljs-type">Int</span>
        @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> t = <span class="hljs-type">Test</span>()
        <span class="hljs-keyword">init</span>(id:<span class="hljs-type">Int</span>){
            <span class="hljs-keyword">self</span>.id = id
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"init:\(id)"</span>)
        }
        <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
            <span class="hljs-type">Rectangle</span>()
                .fill(<span class="hljs-type">Color</span>.blue)
                .overlay(
                    <span class="hljs-type">Text</span>(<span class="hljs-string">"id:\(id)"</span>)
                )
                .onAppear{
                    t.id = id
                }
        }
        
        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span>:<span class="hljs-title">ObservableObject</span></span>{
            <span class="hljs-keyword">var</span> id:<span class="hljs-type">Int</span> = <span class="hljs-number">0</span>{
                <span class="hljs-keyword">didSet</span>{
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"get value \(id)"</span>)
                }
            }
            <span class="hljs-keyword">init</span>(){
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"init object"</span>)
            }
            <span class="hljs-keyword">deinit</span> {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"deinit:\(id)"</span>)
            }
        }
    }
    
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span>:<span class="hljs-title">ObservableObject</span></span>{
        @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> currentID:<span class="hljs-type">Int</span> = <span class="hljs-number">0</span>
    }
</code></pre><p>æ‰§è¡Œå,å‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡:<strong>åœ¨Listä¸­,å¦‚æœç”¨ForEachå¤„ç†æ•°æ®æº,æ‰€æœ‰çš„æ•°æ®æºçš„Viewç«Ÿç„¶éƒ½è¦åœ¨Liståˆ›å»ºæ—¶è¿›è¡Œåˆå§‹åŒ–,è¿™å®Œå…¨è¿èƒŒäº†tableViewçš„æœ¬æ¥æ„å›¾</strong>.</p><p>å°†ä¸Šé¢çš„ä»£ç çš„æ•°æ®æºåˆ‡æ¢åˆ°Listçš„æ–¹å¼è¿›è¡Œæµ‹è¯•</p><pre data-language="swift"><code> <span class="hljs-type">List</span>(<span class="hljs-number">0</span>..&lt;<span class="hljs-number">10000</span>){ i <span class="hljs-keyword">in</span>
        <span class="hljs-type">Cell</span>(id: i)
          .listRowInsets(<span class="hljs-type">EdgeInsets</span>())
          .swipeCell(cellPosition: .both, leftSlot: slot1, rightSlot: slot1)
    }
</code></pre><video src="http://cdn.fatbobman.com/swiftui-list-foreach-10000withoutForEach.mp4" controls = "controls"></video><p>ç†Ÿæ‚‰çš„ä¸æ»‘åˆå›æ¥äº†.</p><p><strong>ForEachè¦é¢„å…ˆå¤„ç†æ‰€æœ‰æ•°æ®,æå‰å‡†å¤‡View.å¹¶ä¸”åˆå§‹åŒ–å,å¹¶ä¸è‡ªåŠ¨é‡Šæ”¾è¿™äº›View(å³ä½¿ä¸å¯è§)!</strong>å…·ä½“å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„æµ‹è¯•ä»£ç é€šè¿‡Debugæ¥åˆ†æ.</p><p>ä¸æµç•…çš„åŸå› å·²ç»æ‰¾åˆ°äº†,ä¸è¿‡ç”±äºListå¤„ç†çš„æ•°æ®æºå¹¶ä¸èƒ½è®¾ç½®listRowInsets,å°¤å…¶åœ¨iOS14ä¸‹,è‹¹æœéå¸¸å¥‡æ€ªçš„å±è”½äº†ä¸å°‘é€šè¿‡UITableViewæ¥è®¾ç½®Listçš„å±æ€§çš„é€”å¾„,æ‰€ä»¥ä¸ºäº†æ—¢èƒ½ä¿è¯æ€§èƒ½,åˆèƒ½ä¿è¯æ˜¾ç¤ºéœ€æ±‚,åªå¥½é€šè¿‡è‡ªå·±åŒ…è£…UITableViewæ¥åŒæ—¶æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶.</p><p>å¥½åœ¨æˆ‘ä¸€ç›´ä½¿ç”¨<a href="https://github.com/SwiftUIX/SwiftUIX">SwiftUIX</a>è¿™ä¸ªç¬¬ä¸‰æ–¹åº“,èŠ‚çœäº†è‡ªå·±å†™å°è£…ä»£ç çš„æ—¶é—´.å°†ä»£ç åšäº†è¿›ä¸€æ­¥è°ƒæ•´,å½“å‰çš„é—®é¢˜å¾—ä»¥è§£å†³.</p><pre data-language="swift"><code> <span class="hljs-type">CocoaList</span>(item){ i <span class="hljs-keyword">in</span>
           <span class="hljs-type">Cell</span>(id: i)
           .frame(height:<span class="hljs-number">100</span>)
           .listRowInsets(<span class="hljs-type">EdgeInsets</span>())
           .swipeCell(cellPosition: .both, leftSlot: slot1, rightSlot: slot1)
       }.edgesIgnoringSafeArea(.all)
</code></pre><video src="http://cdn.fatbobman.com/swiftui-list-foreach-10000MyList.mp4" controls = "controls"></video><p>é€šè¿‡è¿™æ¬¡ç¢°åˆ°çš„é—®é¢˜,æˆ‘çŸ¥é“äº†å¯ä»¥åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ForEach.é€šè¿‡è¿™ç¯‡æ–‡ç« è®°å½•ä¸‹æ¥,å¸Œæœ›å…¶ä»–äººå°‘èµ°è¿™æ ·çš„å¼¯è·¯.</p><p><strong>åè®°:</strong></p><p>æˆ‘å·²ç»å‘è‹¹æœåé¦ˆäº†è¿™ä¸ªé—®é¢˜,å¸Œæœ›ä»–ä»¬èƒ½å¤Ÿè¿›è¡Œè°ƒæ•´å§(æœ€è¿‘è‹¹æœå¯¹äºå¼€å‘è€…çš„feedbackå›åº”è¿˜æ˜¯æŒºåŠæ—¶çš„,Xcode12å‘å¸ƒå,æˆ‘æäº¤äº†5ä¸ªfeedback,å·²ç»æœ‰4ä¸ªè·å¾—äº†åé¦ˆ,3ä¸ªåœ¨æœ€æ–°ç‰ˆå¾—åˆ°äº†è§£å†³).</p><p><strong>é—æ†¾:</strong></p><p>ç›®å‰çš„è§£å†³æ–¹æ¡ˆä½¿æˆ‘å¤±å»äº†ä½¿ç”¨ScrollViewReaderçš„æœºä¼š.</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/healthNote2-development-memo-1</guid><title>å¥åº·ç¬”è®°2.0å¼€å‘éšç¬”ï¼ˆä¸€ï¼‰</title><description>å¥åº·ç¬”è®°ä»2020å¹´1æœˆä¸Šçº¿ä»¥æ¥ï¼Œè‡³ä»Šå·²ç»è¿‡äº†å¤§åŠå¹´çš„æ—¶é—´ï¼ˆå¯ä»¥ä»[è€äººæ–°å…µ â€”â€” ä¸€æ¬¾iOS appçš„å¼€å‘æ‰‹è®°](https://zhuanlan.zhihu.com/p/103822455)äº†è§£å¥åº·ç¬”è®°appçš„ç”±æ¥ï¼‰ã€‚åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘å¯¹äºSwiftã€SwiftUIã€CoreDataç­‰éƒ½æœ‰äº†è¿›ä¸€æ­¥çš„äº†è§£å’Œè®¤è¯†ã€‚åœ¨å¼€å‘1.0ç‰ˆæœ¬æ—¶æ‰€é¢å¯¹çš„é—®é¢˜å’Œç–‘æƒ‘å¤šæ•°éƒ½å¾—åˆ°äº†è§£å†³ã€‚</description><link>http://www.fatbobman.com/posts/healthNote2-development-memo-1</link><pubDate>Mon, 17 Aug 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>å¥åº·ç¬”è®°ä»2020å¹´1æœˆä¸Šçº¿ä»¥æ¥ï¼Œè‡³ä»Šå·²ç»è¿‡äº†å¤§åŠå¹´çš„æ—¶é—´ï¼ˆå¯ä»¥ä»<a href="https://zhuanlan.zhihu.com/p/103822455">è€äººæ–°å…µ â€”â€” ä¸€æ¬¾iOS appçš„å¼€å‘æ‰‹è®°</a>äº†è§£å¥åº·ç¬”è®°appçš„ç”±æ¥ï¼‰ã€‚åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘å¯¹äºSwiftã€SwiftUIã€CoreDataç­‰éƒ½æœ‰äº†è¿›ä¸€æ­¥çš„äº†è§£å’Œè®¤è¯†ã€‚åœ¨å¼€å‘1.0ç‰ˆæœ¬æ—¶æ‰€é¢å¯¹çš„é—®é¢˜å’Œç–‘æƒ‘å¤šæ•°éƒ½å¾—åˆ°äº†è§£å†³ã€‚</p></blockquote><p>æœ€è¿‘éšç€iOS14å‘å¸ƒçš„ä¸´è¿‘ï¼ŒåŒæ—¶ä¹Ÿæƒ³å°†è¿™çŸ­æ—¶é—´æ¥å­¦ä¹ çš„çŸ¥è¯†è¿›è¡Œæ›´ç³»ç»Ÿçš„æ•´ç†å’Œåº”ç”¨ï¼Œäºæ˜¯ä¾¿å°†å¥åº·ç¬”è®°2.0çš„å¼€å‘å·¥ä½œæä¸Šäº†æ—¥ç¨‹ï¼Œå¹¶å·²ç»ç€æ‰‹è¿›è¡Œä¸­ã€‚</p><h2>å¥åº·ç¬”è®°2.0çš„è§„</h2><ul><li>åŠŸèƒ½</li></ul><p>å¥åº·ç¬”è®°1.0ç›®å‰çš„åŠŸèƒ½å·²åŸºæœ¬èƒ½å¤Ÿæ»¡è¶³æˆ‘ä¸ªäººçš„æ—¥å¸¸ä½¿ç”¨ï¼Œåœ¨ä¸Šçº¿è¿™æ®µæ—¶é—´å†…ï¼Œæˆ‘ä¹Ÿæ ¹æ®ç”¨æˆ·æå‡ºçš„å»ºè®®å¢åŠ äº†éƒ¨åˆ†æ–°åŠŸèƒ½ã€‚å› æ­¤åœ¨2.0ä¸Šï¼Œappæ ¸å¿ƒåŠŸèƒ½çš„å¢åŠ å¹¶ä¸æ˜¯å¤ªå¤šï¼Œä¸»è¦é›†ä¸­åœ¨ä¸¤ç‚¹ï¼š</p><ul><li>æ•°æ®ç±»å‹</li></ul><p>1.0ä¸­å½“å‰æ”¯æŒä¸¤ç§æ•°æ®ç±»å‹ï¼Œä¸€ç§æ˜¯æ•°å­—å‹ï¼ˆä»…è®°å½•ä¸€ä¸ªæ•°å­—+æ—¥æœŸï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯é€‰é¡¹å‹ï¼ˆè‡ªå®šä¹‰é€‰é¡¹å†…å®¹+æ—¥æœŸï¼‰ï¼Œåœ¨2.0ä¸­ï¼Œæ–°å¢äº†å…¶ä»–5ä¸­æ•°æ®ç±»å‹åŒ…æ‹¬ï¼šåŒæ•°å­—å‹ã€æ•°å­—é€‰é¡¹å‹ã€èµ·å§‹æ—¶é—´å‹ç­‰ã€‚ä½¿ç”¨è€…å¯ä»¥è®°å½•ç”Ÿæ´»ä¸­æ›´å¤šç§ç±»çš„å†…å®¹ã€‚</p><ul><li>æ•°æ®å¯¼å…¥å¯¼å‡º</li></ul><p>1.0ä¸­å·²ç»æä¾›äº†å¯¹äºæ•°å­—å¡ç‰‡ã€æ¡ç›®ç­‰å†…å®¹çš„æ•°æ®å„è‡ªçš„å¯¼å‡ºæ”¯æŒï¼ˆcsv,pdf,xslxï¼‰,2.0ç‰ˆä¸­å°†æä¾›åŒä¸€çš„å¯¼å‡ºå…¥å£ï¼Œå¹¶å°†æä¾›å¯¼å…¥åŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥æœ‰æ›´å¤šæ®µé€‰æ‹©ä¿ç®¡å¹¶ä½¿ç”¨è‡ªå·±çš„æ•°æ®ï¼Œæ¯”å¦‚å°†è‡ªå·±åˆ›å»ºçš„å¡ç‰‡åˆ†äº«ç»™å…¶ä»–ç”¨æˆ·ï¼Œæˆ–è€…é‡æ–°å¯¼å…¥è‡ªå·±ä¿å­˜çš„ç¦»çº¿æ•°æ®ç­‰ã€‚</p><p>æ—¢ç„¶æ˜¯ä¸€æ¬¡å¤§ç‰ˆæœ¬çš„æ›´æ–°ï¼Œè™½ç„¶åœ¨åŠŸèƒ½ä¸Šçš„æ”¹å˜å¹¶éå¤ªå¤šï¼Œä½†åœ¨å…¶ä»–åœ°æ–¹çš„å˜åŒ–è¿˜æ˜¯ä¼šå¾ˆå¤§çš„ï¼Œæ›´å¤šçš„å˜åŒ–éƒ½ä¼šåœ¨åæ–‡ä¸­æåˆ°ã€‚</p><h2>å¼€å‘ç¯å¢ƒã€æ¡†æ¶</h2><p>Xcode12 + SwiftUI2.0 ï¼Œä¸»è¦çš„åŸå› å¦‚ä¸‹ï¼š</p><ul><li>ä»WWDC20ä»¥æ¥æˆ‘ä¸€ç›´åœ¨è·Ÿè¸ªå¹¶å­¦ä¹ iOS14ä¸‹çš„æ–°ç‰¹æ€§ï¼ˆæˆ‘çš„æœ€è¿‘çš„æ–‡ç« å¤§å¤šéƒ½æœ‰å…³äºæ­¤ï¼‰ï¼Œä»¥åŠSwiftU2.0ä¸­æä¾›çš„æ–°åŠŸèƒ½ã€‚åœ¨è§„åˆ’åˆå§‹ï¼Œæˆ‘æ‰“ç®—åœ¨2.0ä¸­ä½¿ç”¨ä¸å°‘çš„æ–°åŠŸèƒ½æ¥å®Œæˆè‡ªå·±çš„æ„æ€ã€‚ç”±äºiOS14å¯¹äºç¡¬ä»¶çš„æ”¯æŒå®Œå…¨æ¶µç›–çš„ä¹‹å‰iOS13çš„æœºå‹ï¼Œç›¸ä¿¡å¯¹äºiOS13çš„ç”¨æˆ·æ¥è¯´ï¼Œæ›´æ–°çš„é˜»åŠ›ä¸ä¼šå¤ªå¤§ã€‚</li></ul><ul><li>å½“å‰çš„ç”¨æˆ·æ•°å¹¶ä¸å¤šï¼Œå†å²åŒ…è¢±è¾ƒå°ã€‚ä»ä¸Šçº¿æ¥ï¼Œç›®å‰å¥åº·ç¬”è®°çš„æ€»ä¸‹è½½é‡æ‰åˆšåˆšè¶…è¿‡1000ï¼Œå› æ­¤è®©æˆ‘å¯ä»¥è½»è£…ä¸Šé˜µï¼Œæœ‰è¾ƒå¤§çš„è°ƒæ•´ç©ºé—´ã€‚</li><li>1.0ç‰ˆæœ¬ä¸­å¾ˆå¤šçš„è§„åˆ’ã€è®¾è®¡ä¸å®Œå–„ã€‚æœ€è¿‘å‡ ä¸ªæœˆï¼Œæˆ‘å·²ç»å¾ˆå°‘å‘1.0ç‰ˆæœ¬ä¸­å¢åŠ æ–°çš„åŠŸèƒ½äº†ï¼Œä¸»è¦åŸå› å°±æ˜¯æœ€å¼€å§‹çš„ç»“æ„è®¾è®¡ä¸åˆç†ã€ä»£ç æ··ä¹±ã€‚å¦‚æœå¼ºè¡Œæ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œåªä¼šå¯¼è‡´ç•™ä¸‹æ›´å¤šçš„éšæ‚£ï¼Œåå€’ä¸åˆ©äºä»Šåçš„è°ƒæ•´ã€‚æ‰€ä»¥åœ¨2.0ä¸­ï¼Œå†³å®šå°†ä¹‹å‰çš„æ•°æ®ç»“æ„è®¾è®¡è¿›è¡Œäº†è¾ƒå¤§çš„æ”¹å˜ï¼Œå°†1.0çš„ä»£ç å…¨éƒ¨æ¨ç¿»é‡å†™ã€‚</li><li>æ•°æ®è¿ç§»çš„é—®é¢˜ã€‚ç”±äº1.0çš„æ•°æ®ç»“æ„è®¾è®¡ä¸ä½³ï¼Œæˆ‘æ‰“ç®—åœ¨2.0ä¸­è¿›è¡Œå¤§å˜åŒ–ï¼Œè¿™æ ·ä¼šå¯¼è‡´CoreDataçš„æ•°æ®è¿ç§»é¢ä¸´ä¸¥å³»çš„è€ƒéªŒã€‚åœ¨1.0ç‰ˆæœ¬çš„æ•°æ®å°å‡çº§ä¸­ï¼Œæˆ‘å·²ç»é¢†æ•™åˆ°äº†CoreDataçš„è¿ç§»æœºåˆ¶æ‰€å¸¦æ¥çš„ä¾¿åˆ©æ€§å’Œéš¾ä»¥æ§åˆ¶çš„åŒé¢é—®é¢˜ã€‚å°½ç®¡å¯ä»¥é€šè¿‡ç¼–å†™è‡ªå·±çš„CoreDataè¿ç§»ä»£ç æ¥è§£å†³ç»“æ„å¤§å˜åŒ–æ—¶æ‰€é¢ä¸´çš„éš¾é¢˜ï¼Œä¸è¿‡ä¸ºäº†ä¸ç•™ä¸‹éšæ‚£ã€ç»™å°†æ¥çš„æ‰©å……ç•™ä¸‹æ›´è‡ªç”±çš„ç©ºé—´ï¼Œè¿˜æ˜¯å†³å®šæ”¾å¼ƒäº†ä½¿ç”¨CoreDataçš„è¿ç§»æœºåˆ¶ã€‚</li><li>æˆ‘æœ¬æ¥å°±æ‰“ç®—åœ¨2.0ä¸­è¿›ä¸€æ­¥åŠ å¼ºæ•°æ®çš„å¯¼å…¥å¯¼å‡ºï¼Œæ‰€ä»¥å¯¹äº1.0ç‰ˆæœ¬çš„ç”¨æˆ·ï¼Œæˆ‘å°†æä¾›å®‰å…¨çš„æ•°æ®è¿ç§»èƒ½åŠ›ï¼Œå¹³æ»‘çš„è¿‡åº¦åˆ°2.0ä¸Šã€‚</li></ul><p>ç»“æœå°±æ˜¯ï¼šç”¨æˆ·å°†é‡æ–°åœ¨app storeä¸Šä¸‹è½½å¥åº·ç¬”è®°2.0app(ä¸æ˜¯åœ¨1.0ä¸Šæ›´æ–°)ï¼Œ2.0å°†æ”¯æŒiOS14ã€macOS 11åŠä»¥ä¸Šçš„ç³»ç»Ÿã€‚ä¹‹å‰çš„å¥åº·ç¬”è®°1.0ç”¨æˆ·æ•°æ®éƒ½å¯ä»¥å®‰å…¨æ–¹ä¾¿çš„æ‰‹åŠ¨è½¬ç§»åˆ°2.0ç‰ˆæœ¬ä¸Šã€‚</p><ul><li>æ”¯æŒå¤šå¹³å°</li></ul><p>2.0å°†æ”¯æŒiPhone,iPadå’ŒmacOSã€‚</p><p>SwiftUIæœ¬èº«å¯¹äºå¤šå¹³å°çš„æ”¯æŒå°±éå¸¸å‡ºè‰²ï¼Œä¸è¿‡ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸‹æ›´å¥½çš„å‘æŒ¥å…¶å„è‡ªçš„ç‰¹ç‚¹ï¼Œæˆ‘è¿˜æ˜¯å†³å®šä¸ºæ”¯æŒå¤šå¹³å°åšæ›´å¤šé’ˆå¯¹æ€§çš„è°ƒæ•´ã€‚</p><ul><li>iPhoneä¸‹ä»åŒ1.0ä¸€æ ·å¼ºåˆ¶ç«–å±ä½¿ç”¨ã€‚</li></ul><ul><li>iPadä¸‹å¼ºåˆ¶æ¨ªå±ä½¿ç”¨ï¼Œå¹¶é‡‡ç”¨äº†å’ŒiPhoneä¸‹å®Œå…¨ä¸åŒçš„å¸ƒå±€ã€‚</li></ul><ul><li>macOSä¸‹ä¸ä½¿ç”¨Catalystï¼Œè€Œä½¿ç”¨åŸç”Ÿçš„macOS targetè¿›è¡Œç¼–å†™ã€‚è™½ç„¶åŠ å¤§äº†å·¥ä½œé‡ï¼Œä½†å¯ä»¥æ›´å¥½çš„é€‚é…æ¡Œé¢æ“ä½œï¼Œå°¤å…¶æ˜¯æä¾›åŒæ‰‹æŒ‡æ“ä½œå®Œå…¨ä¸åŒé”®é¼ äº¤äº’é€»è¾‘ï¼Œå¹¶é‡‡ç”¨æ›´é€‚åˆæ¡Œé¢å¹³å°çš„å¸ƒå±€å’Œæ§ä»¶æ“ä½œã€‚</li></ul><ul><li>æˆ‘åœ¨æœ€è¿‘ç¼–å†™çš„Swiftåº“ä¸­ï¼ŒåŸºæœ¬ä¸Šéƒ½æä¾›äº†è·¨å¹³å°çš„æ”¯æŒã€‚</li></ul><ul><li>ç”±äºå†³å®šäº†è¿›è¡Œå®Œå…¨çš„è·¨å¹³å°å¼€å‘ï¼ˆuikit+appkitï¼‰ï¼Œå› æ­¤åœ¨é€‰æ‹©ç¬¬ä¸‰æ–¹åº“çš„é™åˆ¶å°†ä¼šæ›´å¤šã€‚<ul></ul></li></ul><ul><li>å¤šè¯­ç§</li></ul><p>å¥åº·ç¬”è®°çš„æœ¬èº«çš„æ–‡å­—é‡å¹¶ä¸å¤šï¼Œå› æ­¤å•çº¯ä»æ–‡æœ¬å†…å®¹çš„è§’åº¦æ¥çœ‹ï¼Œå¤šè¯­ç§æ”¯æŒå¹¶ä¸å¤æ‚ã€‚ä¸è¿‡ç”±äºæ¶‰åŠäº†ä¸å°‘çš„æ•°æ®æ˜¾ç¤ºã€æ—¥æœŸè®¡ç®—ç­‰ï¼Œåœ¨çœŸæ­£è¿›è¡Œå¤šè¯­ç§æ”¯æŒçš„æ—¶å€™è¿˜æ˜¯é‡åˆ°äº†ä¸å°‘æŒ‘æˆ˜ã€‚</p><p>åœ¨ç›®å‰çš„å¼€å‘ç‰ˆæœ¬ä¸­ï¼Œå·²ç»å¯ä»¥è®©ç”¨æˆ·åœ¨appä¸­å•ç‹¬è®¾ç½®è¯­è¨€ã€æ—¶åŒºè€Œä¸å®Œå…¨ä¾èµ–ç³»ç»Ÿè®¾å®šã€‚</p><p>ç›®å‰ä»æ²¡æœ‰æƒ³å¥½çš„å¤šè¯­ç§æ”¯æŒé—®é¢˜ä¸»è¦å­˜åœ¨äºDemoæ•°æ®çš„åŠ è½½ä¸Šã€‚æˆ‘å¸Œæœ›èƒ½æ‰¾åˆ°ä¸€ä¸ªå·¥ä½œé‡è¾ƒå°ã€æ•°æ®é‡è¾ƒå°çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2>ä»£ç ç»“æ„</h2><p>å¥åº·ç¬”è®°2.0å°†ä»£ç å®Œå…¨æ¨ç¿»é‡å†™ï¼Œå…¶ä¸­æä¸ºé‡è¦çš„ä¸€ä¸ªåŸå› æ˜¯æˆ‘æƒ³å®ç°ä¸€ä¸ªè‡ªå·±è®¤å¯çš„èƒ½é€‚ç”¨äºSwiftUIçš„MVVMç»“æ„ã€‚</p><p>æˆ‘åœ¨å¼€å‘1.0ç‰ˆæœ¬çš„æ—¶å€™æ‰æ¥è§¦åˆ°MVVMï¼Œåœ¨æœ€åˆçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬ä¸Šæ˜¯æŒ‰ç…§åˆ«äººæä¾›çš„ä»£ç é€»è¾‘æ¥å®Œæˆçš„ã€‚åœ¨å®é™…çš„ä½¿ç”¨ä¸­ä¸€æ–¹é¢å‘ç°äº†å¾ˆå¤šè‡ªå·±ä¸ç†è§£æˆ–ç”¨èµ·æ¥ä¸é¡ºæ‰‹çš„åœ°æ–¹ï¼ŒåŒæ—¶åœ¨ä¸æ–­çš„å­¦ä¹ ä¸­ï¼Œä¹Ÿå‘ç°äº†å¾ˆå¤šä¼ ç»ŸMVVMä¸å®Œé€‚åº”SwiftUIæ¡†æ¶çš„é—®é¢˜ã€‚æœ€è¿‘å‡ ä¸ªæœˆï¼Œæˆ‘ä¸€ç›´åœ¨å­¦ä¹ å¹¶ç ”ç©¶é€‚ç”¨äºSwfitUIçš„MVVMç»“æ„ï¼Œ2.0çš„å¼€å‘ä¸­è¿™äº›å­¦ä¹ ç»“æœå°†å¾—åˆ°å……åˆ†çš„æ£€éªŒæœºä¼šã€‚</p><p>Xcode12ä¸­æä¾›äº† SwiftUI lifecycleï¼Œä»ç¨‹åºå…¥å£ç‚¹ï¼Œåˆ°App Delegateã€Scene Delegateå“åº”éƒ½æœ‰äº†å½»åº•åœ°æ”¹å˜ï¼Œå¦‚ä½•è®¾è®¡ä¸€ä¸ªæ›´é€‚åˆSwfit2.0çš„çŠ¶æ€æœºåœ¨ä¸å°‘è®ºå›è¿›è¡Œäº†è®¨è®ºå’Œåˆ†æã€‚æˆ‘ç›®å‰åœ¨å¼€å‘ä¸­é‡‡ç”¨çš„ç»“æ„å¯¹è¿™äº›éƒ½åšäº†æœ‰é’ˆå¯¹æ€§çš„è°ƒæ•´ã€‚å¹¶ä¸”ä¸ºå¤šå¹³å°ï¼Œå¤šè¯­ç§éƒ½æä¾›ä¸é”™çš„å“åº”æ”¯æŒã€‚åŒæ—¶ä¸ºäº†ä¾¿äºä½¿ç”¨Previewï¼Œå¯¹äºCoreDataçš„å£°æ˜å’Œæ³¨å…¥ä¹Ÿåšäº†é’ˆå¯¹æ€§çš„è°ƒæ•´ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä¼šä¸“é—¨å†™ä¸€ç¯‡å…³äºè¿™æ–¹é¢çš„æ–‡ç« å’Œå¤§å®¶ä¸€èµ·ç ”ç©¶è°ˆæ¢è®¨ã€‚</p><h2>å•†ä¸šè®¡åˆ’</h2><p>æ²¡æœ‰ã€‚</p><p>ç”±äºç¼–å†™ä»£ç ä»…æ˜¯æˆ‘çš„ä¸ªäººçˆ±å¥½ï¼Œå¯¹äºå¥åº·ç¬”è®°è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘å®Œå…¨æ˜¯ä¸ºäº†æ»¡è¶³è‡ªå·±çš„éœ€è¦è€Œå¼€å‘çš„ã€‚å› æ­¤ï¼Œåœ¨å¥åº·ç¬”è®°ä¸Šæˆ‘æ˜¯æ²¡æœ‰ä»»ä½•å•†ä¸šè§„åˆ’å’Œæ„¿æœ›ä¸æƒ³æ³•çš„ã€‚åªè¦æˆ‘çš„ç²¾åŠ›å…è®¸ï¼Œèº«ä½“çŠ¶æ€okï¼Œæˆ‘å°±ä¼šåšæŒå§è¿™ä¸ªappå®Œå–„ä¸‹å»ã€‚</p><p>æˆ‘å°†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸å®šæ—¶åœ°æ›´æ–°éšç¬”ã€‚ä¸€æ–¹é¢å¯¹è‡ªå·±çš„æ€è·¯è¿›è¡Œä¸€ä¸ªæ¢³ç†ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›èƒ½å¤Ÿç»™å…¶ä»–çš„ä¸ªäººå¼€å‘è€…æä¾›ä¸€ç‚¹å‚è€ƒã€‚</p><p><a href="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=1492861358">å¥åº·ç¬”è®°1.0ä¸‹è½½</a></p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swifui-overlay</guid><title>SwiftUIOverlayContainer â€”â€”å¯ä»¥å®ç°å„ç§è‡ªå®šä¹‰æ ·å¼å¼¹å‡ºè§†å›¾çš„SwitUIåº“</title><description>SwiftUIç›®å‰å¯ä»¥æä¾›sheet,fullScreenCover,alert,actionsheetç­‰å¼¹å‡ºè§†å›¾ç”¨äºä¸°å¯ŒUIäº¤äº’ã€‚ä¸è¿‡ç§ç±»è¿˜æ˜¯æœ‰äº›å•è°ƒã€‚ä¸ºäº†èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„ç¼–å†™å„ç§å¼¹å‡ºå¼çª—å£çš„ä»£ç ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„SwiftUIåº“ â€”â€” SwiftUIOverlayContainerã€‚</description><link>http://www.fatbobman.com/posts/swifui-overlay</link><pubDate>Wed, 12 Aug 2020 16:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUIç›®å‰å¯ä»¥æä¾›sheet,fullScreenCover,alert,actionsheetç­‰å¼¹å‡ºè§†å›¾ç”¨äºä¸°å¯ŒUIäº¤äº’ã€‚ä¸è¿‡ç§ç±»è¿˜æ˜¯æœ‰äº›å•è°ƒã€‚ä¸ºäº†èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„ç¼–å†™å„ç§å¼¹å‡ºå¼çª—å£çš„ä»£ç ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„SwiftUIåº“ â€”â€” SwiftUIOverlayContainerã€‚</p></blockquote><p>SwiftUIOverlayContaineræœ¬èº«å¹¶ä¸æä¾›ä»»ä½•é¢„ç½®çš„è§†å›¾æ ·å¼ï¼Œä¸è¿‡é€šè¿‡å®ƒï¼Œä½ æœ‰å……åˆ†çš„è‡ªæœ‰åº¦æ¥å®ç°è‡ªå·±éœ€è¦çš„è§†å›¾æ•ˆæœã€‚OverlayContainerçš„ä¸»è¦ç›®çš„åœ¨äºå¸®åŠ©ä½ å®ŒæˆåŠ¨ç”»ã€äº¤äº’ã€æ ·å¼å®šåˆ¶ç­‰åŸºç¡€å·¥ä½œï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿå°†æ—¶é—´å’Œç²¾åŠ›ä»…éœ€æŠ•å…¥åœ¨è§†å›¾æœ¬èº«çš„ä»£ç ä¸Šã€‚</p><p><a href="https://github.com/fatbobman/SwiftUIOverlayContainer">SwiftUIOverlayContainer</a></p><video src="http://cdn.fatbobman.com/swiftui-overlay-demo.mp4" controls = "controls">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video><p>åº“ä»£ç å·²ç»ä¿®æ”¹å¯ä»¥ç›´æ¥åœ¨xcode11ä¸‹ä½¿ç”¨</p><p>ä»£ç æ€è·¯å—åˆ°äº†<a href="https://link.zhihu.com/?target=https%3A//github.com/AndreaMiotto/PartialSheet">PartialSheet</a>å¾ˆå¤§çš„å½±å“,å¹¶ä½¿ç”¨äº†å…¶éƒ¨åˆ†ä»£ç ã€‚</p><h2>ä½¿ç”¨æ–¹æ³•</h2><ol><li>Add a <strong>OverlayContainerManager</strong> instance as an <em>environment object</em> to your Root View in you <em>SceneDelegate</em>or App</li></ol><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Test</span>: <span class="hljs-title">App</span> </span>{
    <span class="hljs-keyword">let</span> manager = <span class="hljs-type">OverlayContainerManager</span>()
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
            <span class="hljs-type">ContentView</span>()
                .environmentObject(manager)
        }
    }
}
</code></pre><ol><li>Add the <strong>OverlayView</strong> to your <em>Root View</em>, and if you want give it a style. In your RootView file at the end of the builder add the following modifier:</li></ol><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
       ...
       .addOverlayContainer(style: &lt;<span class="hljs-type">OverlayContainerStyle</span>&gt;)
    }
}
</code></pre><ol><li>In anyone of your views add a reference to the <em>environment object</em> and than just call the <code>showOverlayView&lt;T&gt;(_ onDismiss: (() -&gt; Void)? = nil, @ViewBuilder content: @escaping () -&gt; T) where T: View</code> func whenever you want like this:</li></ol><pre data-language="swift"><code>@<span class="hljs-type">EnvironmentObject</span> <span class="hljs-keyword">var</span> manager: <span class="hljs-type">OverlayContainerManager</span>

...

<span class="hljs-type">Button</span>(action: {
    <span class="hljs-keyword">self</span>.manager.showOverlayView({
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"dismissed"</span>)
    }) {
         <span class="hljs-type">VStack</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"This is Overlay View"</span>)
         }
    }
}, label: {
    <span class="hljs-type">Text</span>(<span class="hljs-string">"Show overlyView"</span>)
})
</code></pre><h3>æ ·å¼è¯´æ˜</h3><pre data-language="swift"><code><span class="hljs-keyword">let</span> style2 = <span class="hljs-type">OverlayContainerStyle</span>(
                                   alignment: .leading,  <span class="hljs-comment">//å®¹å™¨å¯¹é½ä½ç½®</span>
                                   coverColor: <span class="hljs-type">Color</span>.gray.opacity(<span class="hljs-number">0.3</span>), <span class="hljs-comment">//è¦†ç›–è‰²</span>
                                   shadow:.<span class="hljs-keyword">init</span> (color: <span class="hljs-type">Color</span>.black.opacity(<span class="hljs-number">0.3</span>), radius: <span class="hljs-number">20</span>, x: <span class="hljs-number">2</span>, y: <span class="hljs-number">0</span>), <span class="hljs-comment">//é˜´å½±æ ·å¼</span>
                                   blur: <span class="hljs-literal">nil</span>,  <span class="hljs-comment">//æ¨¡ç³Šæ ·å¼</span>
                                   animation: .easeInOut ,  <span class="hljs-comment">//åŠ¨ç”»æ›²çº¿</span>
                                   transition:.move(edge:.leading),  <span class="hljs-comment">//è¿›å‡ºåŠ¨ç”»æ•ˆæœ</span>
                                   animatable: <span class="hljs-literal">true</span>,  <span class="hljs-comment">//æ˜¯å¦æ˜¾ç¤ºåŠ¨ç”»</span>
                                   autoHide: <span class="hljs-literal">nil</span>,  <span class="hljs-comment">//æ˜¯å¦è‡ªåŠ¨éšè—,å¯è®¾ç½®ç§’æ•°</span>
                                   enableDrag: <span class="hljs-literal">true</span>,  <span class="hljs-comment">//æ˜¯å¦å…è®¸æ»‘åŠ¨å–æ¶ˆ,ç›®å‰åªæ”¯æŒ .leading,.trailing,.bottom,.top</span>
                                   clickDismiss: <span class="hljs-literal">true</span>) <span class="hljs-comment">//æ˜¯å¦æ”¯æŒæ˜¾ç¤ºå,ç‚¹å‡»å±å¹•å…¶ä»–ä½ç½®å–æ¶ˆ</span>
</code></pre><p>æ›´å¤šå…·ä½“åº”ç”¨,è¯·å‚çœ‹ ä»£ç DEMO</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swipeCell</guid><title>ç”¨SwiftUIå®ç°iOS mailç¨‹åºçš„ä¾§æ»‘èœå•</title><description>éšç€SwiftUI2.0çš„ä¸æ–­å®Œå–„ï¼Œæˆ‘è§‰å¾—æ˜¯æ—¶å€™å°†æˆ‘çš„appåšä¸€ä¸ªè¾ƒå¤§çš„å‡çº§äº†ã€‚ä¹‹å‰ä¸€ç›´æƒ³åœ¨appä¸­å®ç°ç±»ä¼¼iOS é‚®ä»¶ç¨‹åºé‚£æ ·ä¼˜é›…çš„ä¾§æ»‘èœå•æ•ˆæœï¼Œåœ¨ç½‘ä¸Šä¹Ÿæ‰¾äº†ä¸€ä¸‹ï¼Œå®ç°çš„è¾ƒå¥½çš„æ˜¯é€‚ç”¨äºUIKitçš„ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰èƒ½å¤Ÿå¾ˆå¥½çš„é€‚é…SwiftUIçš„é¡¹ç›®åº“ã€‚æœ€ç»ˆè‡ªå·±åœ¨Xcode12å®ç°äº†ä¸€ä¸ªã€‚</description><link>http://www.fatbobman.com/posts/swipeCell</link><pubDate>Wed, 12 Aug 2020 14:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>éšç€SwiftUI2.0çš„ä¸æ–­å®Œå–„ï¼Œæˆ‘è§‰å¾—æ˜¯æ—¶å€™å°†æˆ‘çš„appåšä¸€ä¸ªè¾ƒå¤§çš„å‡çº§äº†ã€‚ä¹‹å‰ä¸€ç›´æƒ³åœ¨appä¸­å®ç°ç±»ä¼¼iOS é‚®ä»¶ç¨‹åºé‚£æ ·ä¼˜é›…çš„ä¾§æ»‘èœå•æ•ˆæœï¼Œåœ¨ç½‘ä¸Šä¹Ÿæ‰¾äº†ä¸€ä¸‹ï¼Œå®ç°çš„è¾ƒå¥½çš„æ˜¯é€‚ç”¨äºUIKitçš„ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰èƒ½å¤Ÿå¾ˆå¥½çš„é€‚é…SwiftUIçš„é¡¹ç›®åº“ã€‚æœ€ç»ˆè‡ªå·±åœ¨Xcode12å®ç°äº†ä¸€ä¸ªã€‚</p></blockquote><p>SwipeCell æ˜¯ä¸€ä¸ªç”¨Swift 5.3å¼€å‘çš„ SwiftUIåº“.ç›®æ ‡æ˜¯ä¸ºäº†å®ç°ç±»ä¼¼iOS Mailç¨‹åºå®ç°çš„å·¦å³æ»‘åŠ¨èœå•åŠŸèƒ½. SwipeCell éœ€è¦ XCode 12 ,iOS 14</p><p><a href="https://github.com/fatbobman/SwipeCell">SwipeCell GitHub</a></p><video src="http://cdn.fatbobman.com/SwipeCellDemoVideo.mp4" controls = "controls">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video><h2>é…ç½®Button</h2><pre data-language="swift"><code><span class="hljs-keyword">let</span> button1 = <span class="hljs-type">SwipeCellButton</span>(buttonStyle: .titleAndImage,
                title: <span class="hljs-string">"Mark"</span>, 
                systemImage: <span class="hljs-string">"bookmark"</span>,
                titleColor: .white, 
                imageColor: .white, 
                view: <span class="hljs-literal">nil</span>,   
                backgroundColor: .green,
                action: {bookmark.toggle()},
                feedback:<span class="hljs-literal">true</span>
                )
<span class="hljs-comment">//ä½ å¯ä»¥å°†æŒ‰é’®è®¾ç½®æˆä»»æ„Viewä»è€Œå®ç°æ›´å¤æ‚çš„è®¾è®¡ä»¥åŠåŠ¨æ€æ•ˆæœ</span>
<span class="hljs-keyword">let</span> button3 = <span class="hljs-type">SwipeCellButton</span>(buttonStyle: .view, title:<span class="hljs-string">""</span>,systemImage: <span class="hljs-string">""</span>, view: {
    <span class="hljs-type">AnyView</span>(
        <span class="hljs-type">Group</span>{
            <span class="hljs-keyword">if</span> unread {
                <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"envelope.badge"</span>)
                    .foregroundColor(.white)
                    .font(.title)
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"envelope.open"</span>)
                    .foregroundColor(.white)
                    .font(.title)
            }
        }
    )
}, backgroundColor: .orange, action: {unread.toggle()}, feedback: <span class="hljs-literal">false</span>)
</code></pre><h2>é…ç½®Slot</h2><pre data-language="swift"><code><span class="hljs-keyword">let</span> slot1 = <span class="hljs-type">SwipeCellSlot</span>(slots: [button2,button1])
<span class="hljs-keyword">let</span> slot2 = <span class="hljs-type">SwipeCellSlot</span>(slots: [button4], slotStyle: .destructive, buttonWidth: <span class="hljs-number">60</span>) 
<span class="hljs-keyword">let</span> slot3 = <span class="hljs-type">SwipeCellSlot</span>(slots: [button2,button1],slotStyle: .destructiveDelay)
</code></pre><h2>è£…é…</h2><pre data-language="swift"><code>cellView()
    .swipeCell(cellPosition: .<span class="hljs-keyword">left</span>, leftSlot: slot4, rightSlot: <span class="hljs-literal">nil</span>)
</code></pre><p>æ›´å¤šçš„é…ç½®é€‰é¡¹</p><pre data-language="swift"><code>cellView()
    .swipeCell(cellPosition: .both, 
                leftSlot: slot1, 
                rightSlot: slot1 ,
                swipeCellStyle: <span class="hljs-type">SwipeCellStyle</span>(
                            alignment: .leading,
                            dismissWidth: <span class="hljs-number">20</span>,
                            appearWidth: <span class="hljs-number">20</span>,
                            destructiveWidth: <span class="hljs-number">240</span>, 
                            vibrationForButton: .error, 
                            vibrationForDestructive: .heavy, 
                            autoResetTime: <span class="hljs-number">3</span>)
                            )
</code></pre><h2>æ»šåŠ¨åˆ—è¡¨è‡ªåŠ¨æ¶ˆé™¤</h2><p>For List</p><pre data-language="swift"><code><span class="hljs-type">List</span>{
    ...
    }
    .dismissSwipeCell()
}
</code></pre><p>For single cell in ScrollView</p><pre data-language="swift"><code><span class="hljs-type">ScrollView</span>{
    <span class="hljs-type">VStack</span>{
        <span class="hljs-type">Text</span>(<span class="hljs-string">"Mail Title"</span>)
            .dismissSwipeCellForScrollView() 
        <span class="hljs-type">Text</span>(<span class="hljs-string">"Mail Content"</span>)
        ....
    }
    .frame(maxWidth:.infinity,maxHeight: .infinity)
}
.swipeCell(cellPosition: .both, leftSlot: leftSlot, rightSlot: rightSlot,clip: <span class="hljs-literal">false</span>)
</code></pre><p>For LazyVStack in ScrollView</p><pre data-language="swift"><code><span class="hljs-type">ScrollView</span>{
    <span class="hljs-type">LazyVStack</span>{
    <span class="hljs-type">ForEach</span>(lists,id:\.<span class="hljs-keyword">self</span>){ item <span class="hljs-keyword">in</span>
       <span class="hljs-type">Text</span>(<span class="hljs-string">"Swipe in scrollView:\(item)"</span>)
        .frame(height:<span class="hljs-number">80</span>)
        .swipeCell(cellPosition: .both, leftSlot:slot, rightSlot: slot)
        .dismissSwipeCellForScrollViewForLazyVStack()
    }
    }
}
</code></pre><ul><li>dismissSwipeCell åœ¨editmodeä¸‹æ”¯æŒé€‰æ‹©</li><li>dismissSwipeCellForScrollView ç”¨äºScrollView,é€šå¸¸ç”¨äºåªæœ‰ä¸€ä¸ªCellçš„åœºæ™¯,æ¯”å¦‚è¯´Mailä¸­çš„é‚®ä»¶å†…å®¹æ˜¾ç¤º.å‚çœ‹Demoä¸­çš„æ¼”ç¤º</li><li>dismissSwipeCellForScrollViewForLazyVStack ç”¨äºScrollViewä¸­ä½¿ç”¨LazyVStackåœºæ™¯.ä¸ªåˆ«æ—¶å€™ä¼šæ‰“æ–­æ»‘åŠ¨èœå•å‡ºç°åŠ¨ç”».ä¸ªäººè§‰å¾—å¦‚æ— ç‰¹åˆ«éœ€è¦è¿˜æ˜¯ä½¿ç”¨Listä»£æ›¿LazyVStackæ¯”è¾ƒå¥½.</li></ul><p>ç”±äºSwiftUIæ²¡æœ‰å¾ˆå¥½çš„æ–¹æ¡ˆèƒ½å¤Ÿè·å–æ»šåŠ¨çŠ¶æ€,æ‰€ä»¥é‡‡ç”¨äº† <a href="https://github.com/siteline/SwiftUI-Introspect.git">Introspect</a>å®ç°çš„ä¸Šè¿°åŠŸèƒ½.</p><p>destructiveDelay å½¢å¼çš„ buttonï¼Œéœ€è¦åœ¨actionä¸­æ·»åŠ  dismissDestructiveDelayButton()å·²ä¿è¯åœ¨alteræ‰§è¡Œåï¼ŒCellå¤ä½</p><h2>å½“å‰é—®é¢˜</h2><ul><li>åŠ¨ç”»ç»†èŠ‚ä»ç„¶ä¸è¶³</li><li>EditModeæ¨¡å¼ä¸‹ä»æœ‰ä¸è¶³</li></ul><h2>æ¬¢è¿å¤šæå®è´µæ„è§</h2><p>SwipeCell is available under the <a href="https://github.com/fatbobman/SwipeCell/blob/main/LICENSE.md">MIT license</a>.</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-import-export</guid><title>HowTo â€”â€” SwiftUI2.0 æ–‡ä»¶å¯¼å…¥å¯¼å‡º</title><description>SwiftUI2.0ä¸­æ–°å¢äº†åŸç”Ÿçš„æ–‡ä»¶å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ã€‚éœ€æ³¨æ„çš„æ˜¯å¯¹äºä¸åŒç›®å½•ä¸‹æ–‡ä»¶çš„å¯¼å‡ºè¡Œä¸ºä¼šæœ‰ä¸åŒï¼Œä¸åŒå¹³å°ä¸‹å¯¹äºæƒé™çš„å¤„ç†ä¹Ÿä¸åŒã€‚</description><link>http://www.fatbobman.com/posts/howto-swiftui-import-export</link><pubDate>Tue, 28 Jul 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUI2.0ä¸­æ–°å¢äº†åŸç”Ÿçš„æ–‡ä»¶å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ã€‚éœ€æ³¨æ„çš„æ˜¯å¯¹äºä¸åŒç›®å½•ä¸‹æ–‡ä»¶çš„å¯¼å‡ºè¡Œä¸ºä¼šæœ‰ä¸åŒï¼Œä¸åŒå¹³å°ä¸‹å¯¹äºæƒé™çš„å¤„ç†ä¹Ÿä¸åŒã€‚</p></blockquote><h2>æ›´æ–°</h2><p>ç›®å‰SwiftUIå¤§å¹…åº¦çš„ä¿®æ”¹äº†å¯¼å…¥å¯¼å‡ºçš„ç”¨æ³•.</p><p>fileImporter fileExporter fileMover åˆ†åˆ«å¯¹åº” å¯¼å…¥ã€å¯¼å‡ºã€ç§»åŠ¨</p><p>ç¤ºä¾‹å¦‚ä¸‹:</p><pre data-language="swift"><code>  .fileImporter(isPresented: showImport, allowedContentTypes: [.<span class="hljs-built_in">zip</span>], onCompletion: {
            result <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">switch</span> result{
            <span class="hljs-keyword">case</span> .success(<span class="hljs-keyword">let</span> url):
                <span class="hljs-built_in">print</span>(store.dataHandler.importData(url))
            <span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
                <span class="hljs-built_in">print</span>(error)
            }
            
            showImport.wrappedValue = <span class="hljs-literal">false</span>
  })
</code></pre><p>ç³»ç»Ÿä¼šè‡ªåŠ¨å¼¹å‡ºä¸€ä¸ªsheet,ç›®å‰çš„fileImporteræœ‰bug,å¦‚æœä½¿ç”¨æ‰‹åŠ¿å–æ¶ˆsheet,ä¼šå¾ˆéš¾äºŒæ¬¡å‘¼å‡º.åªèƒ½ä½¿ç”¨cancelæ¥å–æ¶ˆ.</p><p>å…¶å®æˆ‘æ›´å–œæ¬¢ä¹‹å‰çš„ç”¨æ³•,ä¸è¿‡ç°åœ¨ä»¥å‰çš„ç”¨æ³•å·²ç»è¢«åºŸå¼ƒäº†.</p><hr><h2>åŸæ–‡ç« </h2><hr><h2>importFiles</h2><pre data-language="swift"><code>@<span class="hljs-type">Environment</span>(\.importFiles) <span class="hljs-keyword">var</span> importFile

importFile.callAsFunction(singleOfType: [.plainText]){ result <span class="hljs-keyword">in</span>}
</code></pre><h2>exportFiles</h2><pre data-language="swift"><code>@<span class="hljs-type">Environment</span>(\.exportFiles) <span class="hljs-keyword">var</span> exportFile

<span class="hljs-keyword">try</span>! exportFile.callAsFunction(<span class="hljs-type">FileWrapper</span>(url: <span class="hljs-type">URL</span>(fileURLWithPath:filePath), options: .immediate), contentType: .plainText){result <span class="hljs-keyword">in</span>}
</code></pre><h2>ç¤ºä¾‹ä»£ç </h2><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ExportImportTest</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">Environment</span>(\.importFiles) <span class="hljs-keyword">var</span> importFile
    @<span class="hljs-type">Environment</span>(\.exportFiles) <span class="hljs-keyword">var</span> exportFile
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> text:<span class="hljs-type">String</span> = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">List</span>{
            <span class="hljs-type">Button</span>(<span class="hljs-string">"ç”Ÿæˆæ–‡ä»¶"</span>){
                <span class="hljs-keyword">let</span> filePath = <span class="hljs-type">NSTemporaryDirectory</span>() + <span class="hljs-string">"test.txt"</span>
                <span class="hljs-keyword">let</span> outputText = <span class="hljs-string">"Hello World!"</span>
                <span class="hljs-keyword">do</span> {
                    <span class="hljs-keyword">try</span> outputText.write(toFile: filePath, atomically: <span class="hljs-literal">true</span>, encoding: .utf8)
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æµ‹è¯•æ–‡ä»¶å·²ç”Ÿæˆ"</span>)
                }
                <span class="hljs-keyword">catch</span> <span class="hljs-keyword">let</span> error {
                    <span class="hljs-built_in">print</span>(error)
                }
            }
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"å¯¼å…¥æ–‡ä»¶importFiles"</span>){
                importFile.callAsFunction(singleOfType: [.plainText]){ result <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">switch</span> result{
                    <span class="hljs-keyword">case</span> .success(<span class="hljs-keyword">let</span> url):
                        <span class="hljs-built_in">print</span>(url)
                        <span class="hljs-keyword">do</span> {
                            <span class="hljs-comment">//iOSçš„æ²™ç›’æœºåˆ¶ä¿æŠ¤éœ€è¦æˆ‘ä»¬ç”³è¯·ä¸´æ—¶è°ƒç”¨urlçš„æƒé™</span>
                            <span class="hljs-number">_</span> = url.startAccessingSecurityScopedResource()
                            <span class="hljs-keyword">let</span> fileData = <span class="hljs-keyword">try</span> <span class="hljs-type">Data</span>(contentsOf: url)
                            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> text = <span class="hljs-type">String</span>(data:fileData,encoding: .utf8) {
                                <span class="hljs-keyword">self</span>.text = text
                                <span class="hljs-built_in">print</span>(text)
                            }
                            url.stopAccessingSecurityScopedResource()
                        }
                        <span class="hljs-keyword">catch</span> <span class="hljs-keyword">let</span> error {
                            <span class="hljs-built_in">print</span>(error)
                        }
                    <span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
                        <span class="hljs-built_in">print</span>(error)
                    <span class="hljs-keyword">case</span> .<span class="hljs-keyword">none</span>:
                        <span class="hljs-keyword">break</span>
                    }
                }
            }
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"å¯¼å‡ºæ–‡ä»¶exportFiles"</span>){
                <span class="hljs-comment">//exportFile.callAsFunction(moving: URL, completion:  ) ç§»åŠ¨æ–‡ä»¶,æºæ–‡ä»¶ä¼šè¢«åˆ é™¤</span>
                <span class="hljs-comment">//moveå¦‚æœå‡ºé”™(æ¯”å¦‚æ²¡æœ‰æ‰¾åˆ°æºæ–‡ä»¶,ç¨‹åºä¼šå´©æºƒ)</span>
                <span class="hljs-comment">//ä»ä¸´æ—¶ç›®å½•å¯¼å‡ºæ–‡ä»¶æ— è®ºæ˜¯å¦ä½¿ç”¨move,æºæ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤</span>
                <span class="hljs-comment">//ä¸ªäººæ¯”è¾ƒå€¾å‘äºFileWrapperçš„è°ƒç”¨æ–¹å¼</span>
                <span class="hljs-keyword">let</span> filePath = <span class="hljs-type">NSTemporaryDirectory</span>() + <span class="hljs-string">"test.txt"</span>
                <span class="hljs-keyword">do</span> {
                    <span class="hljs-keyword">try</span> exportFile.callAsFunction(<span class="hljs-type">FileWrapper</span>(url: <span class="hljs-type">URL</span>(fileURLWithPath:filePath), options: .immediate), contentType: .plainText){result <span class="hljs-keyword">in</span>
                        <span class="hljs-keyword">switch</span> result{
                        <span class="hljs-keyword">case</span> .success(<span class="hljs-keyword">let</span> url):
                            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ–‡ä»¶å¯¼å‡ºæˆåŠŸ:\(url)"</span>)
                        <span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
                            <span class="hljs-built_in">print</span>(error)
                        <span class="hljs-keyword">case</span> .<span class="hljs-keyword">none</span>:
                            <span class="hljs-keyword">break</span>
                        }
                    }
                }
                <span class="hljs-keyword">catch</span> <span class="hljs-keyword">let</span> error {
                    <span class="hljs-built_in">print</span>(error)
                }
            }
            
            <span class="hljs-type">Text</span>(<span class="hljs-string">"å¯¼å…¥æ–‡ä»¶å†…å®¹:\(text)"</span>)
        }
    }
}
</code></pre><blockquote><p><strong>macOSä¸‹éœ€è¦å°†é¡¹ç›®é…ç½®ä¸­çš„ App Sandbox - User Selected File è®¾ç½®ä¸º è¯»å†™</strong></p></blockquote><video src="http://cdn.fatbobman.com/howto-swiftui-import-export-video.mp4" controls = "controls">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video><h2>é—æ†¾</h2><p>æ²¡æœ‰æä¾›åŸç”Ÿçš„activityViewControllerã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-scrollviewReader</guid><title>HowTo â€”â€” SwiftUI2.0ä½¿ç”¨ScrollViewReaderå®šä½æ»šåŠ¨ä½ç½®</title><description>SwiftUI2.0å¢åŠ äº†æ»šåŠ¨å®šä½åŠŸèƒ½,å·²ç»å¯ä»¥è¾ƒè½»æ¾çš„é€‚åº”å¤§å¤šæ•°åœºæ™¯çš„åº”ç”¨ã€‚å®ç°æ‰‹æ®µå®Œå…¨ä¸åŒäºä¹‹å‰æ°‘é—´çš„å„ç§è§£å†³æ–¹æ¡ˆ,å¹¶ä¸æ˜¯é€šè¿‡è®¾ç½®å…·ä½“çš„offsetæ¥è¿›è¡Œå®šä½,è€Œæ˜¯ä½¿ç”¨idæ¥è¿›è¡Œä½ç½®æ ‡è®°ã€‚</description><link>http://www.fatbobman.com/posts/howto-swiftui-scrollviewReader</link><pubDate>Thu, 23 Jul 2020 13:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUI2.0å¢åŠ äº†æ»šåŠ¨å®šä½åŠŸèƒ½,å·²ç»å¯ä»¥è¾ƒè½»æ¾çš„é€‚åº”å¤§å¤šæ•°åœºæ™¯çš„åº”ç”¨ã€‚å®ç°æ‰‹æ®µå®Œå…¨ä¸åŒäºä¹‹å‰æ°‘é—´çš„å„ç§è§£å†³æ–¹æ¡ˆ,å¹¶ä¸æ˜¯é€šè¿‡è®¾ç½®å…·ä½“çš„offsetæ¥è¿›è¡Œå®šä½,è€Œæ˜¯ä½¿ç”¨idæ¥è¿›è¡Œä½ç½®æ ‡è®°ã€‚</p></blockquote><h2>åŸºæœ¬ç”¨æ³•â€”â€”å®ç°ä»å³å‘å·¦æ»šåŠ¨</h2><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ScrollReaderTest</span>: <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">ScrollView</span>(.horizontal) {
            <span class="hljs-comment">//ç±»ä¼¼GeometryReaderçš„ä½¿ç”¨æ–¹å¼ï¼Œè®¾å®šæ»šåŠ¨å®šä½åŒºåŸŸ</span>
            <span class="hljs-type">ScrollViewReader</span>{ proxy <span class="hljs-keyword">in</span>
                <span class="hljs-type">Rectangle</span>()
                    .fill(<span class="hljs-type">LinearGradient</span>(
                      gradient: <span class="hljs-type">Gradient</span>(colors: [.blue,.red]),
                      startPoint: .leading,
                      endPoint: .trailing))
                    .frame(width: <span class="hljs-number">1000</span>, height: <span class="hljs-number">300</span>, alignment: .center)
                    .id(<span class="hljs-string">"rec"</span>) <span class="hljs-comment">//ä¸ºScrollViewä¸­éœ€è¦å®šä½çš„Viewè®¾ç½®id</span>
                    .onAppear {
                        <span class="hljs-comment">//æ»šåŠ¨åˆ°æŒ‡å®šidçš„ä½ç½®ï¼ŒæŒ‰ç…§anchorçš„è®¾ç½®æ¥å¯¹é½</span>
                        proxy.scrollTo(<span class="hljs-string">"rec"</span>,anchor:.trailing)
                  }
            }
        }
    }
}
</code></pre><h2>é€šè¿‡æŒ‰é’®æ¥æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®</h2><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ScrollReadeTest</span>: <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> list = <span class="hljs-type">ScrollItem</span>.items(<span class="hljs-number">300</span>)
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> position:<span class="hljs-type">Int</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
      <span class="hljs-type">NavigationView</span>{
        <span class="hljs-type">ScrollView</span>{
            <span class="hljs-type">ScrollViewReader</span>{ proxy <span class="hljs-keyword">in</span>
                <span class="hljs-type">LazyVStack</span>{
                    <span class="hljs-type">ForEach</span>(list,id:\.id){ item <span class="hljs-keyword">in</span>
                        <span class="hljs-type">Text</span>(item.title).id(item.id)
                    }
                }
                .onChange(of: position) { positon <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">switch</span> position{
                    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: 
                        <span class="hljs-keyword">let</span> id = list.first!.id
                        withAnimation(<span class="hljs-type">Animation</span>.easeInOut){
                            proxy.scrollTo(id,anchor:.top)
                        }
                    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                        
                        <span class="hljs-keyword">let</span> id = list[<span class="hljs-type">Int</span>(list.<span class="hljs-built_in">count</span> / <span class="hljs-number">2</span>)].id
                        withAnimation(<span class="hljs-type">Animation</span>.easeInOut){
                            proxy.scrollTo(id,anchor:.center)
                        }
                    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                        <span class="hljs-keyword">let</span> id = list.last!.id
                        withAnimation(<span class="hljs-type">Animation</span>.easeInOut){
                            proxy.scrollTo(id,anchor:.bottom)
                        }
                    <span class="hljs-keyword">default</span>:
                        <span class="hljs-keyword">break</span>
                    }
                }
            }
        }
        .navigationTitle(<span class="hljs-string">"æ»šåŠ¨å®šä½"</span>)
        
        .toolbar {
            <span class="hljs-type">ToolbarItem</span>(placement:.automatic) {
                <span class="hljs-type">HStack</span>{
                    <span class="hljs-type">Button</span>(<span class="hljs-string">"top"</span>){
                        position = <span class="hljs-number">1</span>
                    }
                    <span class="hljs-type">Button</span>(<span class="hljs-string">"mid"</span>){
                        position = <span class="hljs-number">2</span>
                    }
                    <span class="hljs-type">Button</span>(<span class="hljs-string">"end"</span>){
                        position = <span class="hljs-number">3</span>
                    }
                }
            }
         }
      }
   }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ScrollItem</span>:<span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">var</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">var</span> title:<span class="hljs-type">String</span>
    
    <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">items</span><span class="hljs-params">(<span class="hljs-number">_</span> <span class="hljs-built_in">count</span>:Int)</span></span> -&gt; [<span class="hljs-type">ScrollItem</span>]{
        <span class="hljs-keyword">var</span> result:[<span class="hljs-type">ScrollItem</span>] = []
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..&lt;<span class="hljs-built_in">count</span>{
            result.append(<span class="hljs-type">ScrollItem</span>(title:<span class="hljs-type">String</span>(<span class="hljs-string">"index:\(i) title:\(Int.random(in: 1000...5000))"</span>)))
        }
        <span class="hljs-keyword">return</span> result
    }
}
</code></pre><video src="http://cdn.fatbobman.com/howto-swiftui-scrollviewReader-video.mp4" controls="controls">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video><h2>é—æ†¾</h2><p>æ²¡æœ‰ç®€å•çš„æ‰‹æ®µè®°å½•å½“å‰çš„æ»šåŠ¨ä½ç½®ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-progressView</guid><title>HowTo â€”â€” SwiftUI2.0 ä½¿ç”¨ProgressViewæ˜¾ç¤ºè¿›åº¦æ¡</title><description>SwiftUI2.0 æ–°å¢äº†ä¸€äº›ä¾¿æ·çš„å†…ç½®æ§ä»¶ï¼Œæ¯”å¦‚è¯´Labelã€ProgressViewç­‰ã€‚å…¶åŸºæœ¬å½¢æ€éƒ½å¾ˆæ™®é€šï¼Œä¸è¿‡éƒ½æ”¯æŒè‡ªå®šä¹‰styleã€‚å®˜æ–¹çš„æ„å›¾ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œé€šè¿‡å†…ç½®æ§ä»¶ï¼Œè§„èŒƒä»£ç ã€æé«˜åŸå‹ç¼–å†™é€Ÿåº¦ï¼Œå¦‚éœ€è¦æ›´ç²¾ç»†æ§åˆ¶å¯é€šè¿‡æ‰©å±•styleæ¥å®Œæˆã€‚</description><link>http://www.fatbobman.com/posts/howto-swiftui-progressView</link><pubDate>Sun, 12 Jul 2020 13:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUI2.0 æ–°å¢äº†ä¸€äº›ä¾¿æ·çš„å†…ç½®æ§ä»¶ï¼Œæ¯”å¦‚è¯´Labelã€ProgressViewç­‰ã€‚å…¶åŸºæœ¬å½¢æ€éƒ½å¾ˆæ™®é€šï¼Œä¸è¿‡éƒ½æ”¯æŒè‡ªå®šä¹‰styleã€‚å®˜æ–¹çš„æ„å›¾ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œé€šè¿‡å†…ç½®æ§ä»¶ï¼Œè§„èŒƒä»£ç ã€æé«˜åŸå‹ç¼–å†™é€Ÿåº¦ï¼Œå¦‚éœ€è¦æ›´ç²¾ç»†æ§åˆ¶å¯é€šè¿‡æ‰©å±•styleæ¥å®Œæˆã€‚</p></blockquote><h2>ç»å…¸å°èŠèŠ±</h2><pre data-language="swift"><code><span class="hljs-type">ProgressView</span>()
</code></pre><img src="http://cdn.fatbobman.com/howto-swiftui-progressView-progress1.png" alt="progress1"/><h2>çº¿æ€§è¿›åº¦æ¡</h2><pre data-language="swift"><code><span class="hljs-type">ProgressView</span>(<span class="hljs-string">"å®Œæˆé‡"</span>, value: <span class="hljs-number">50</span>, total: <span class="hljs-number">100</span>)
</code></pre><img src="http://cdn.fatbobman.com/howto-swiftui-progressView-progress2.png" alt="æˆªå±2020-07-11 ä¸‹åˆ4.09.34"/><h2>ä»£ç ç¤ºä¾‹</h2><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ProgressTest</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> timer = <span class="hljs-type">Timer</span>.<span class="hljs-type">TimerPublisher</span>(interval: <span class="hljs-number">0.03</span>, runLoop: .main, mode: .common).autoconnect()
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> value:<span class="hljs-type">Double</span> = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">List</span>{
            <span class="hljs-comment">//æ— æ³•å®šä¹‰é¢œè‰²</span>
            <span class="hljs-type">ProgressView</span>()
            
            <span class="hljs-comment">//æ— æ³•éšè—Label</span>
            <span class="hljs-type">ProgressView</span>(<span class="hljs-string">"å®Œæˆé‡"</span>, value: value, total: <span class="hljs-number">100</span>)
                .accentColor(.red)
            <span class="hljs-comment">//è‡ªå®šä¹‰Style</span>
            <span class="hljs-type">ProgressView</span>(<span class="hljs-string">"å·¥ç¨‹è¿›åº¦"</span>,value: value, total: <span class="hljs-number">100</span>)
                .progressViewStyle(<span class="hljs-type">MyProgressViewStyle</span>())
        }
        .onAppear {
            timer = <span class="hljs-type">Timer</span>.<span class="hljs-type">TimerPublisher</span>(interval: <span class="hljs-number">0.03</span>, runLoop: .main, mode: .common).autoconnect()
        }
        .onReceive(timer) { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> value &lt; <span class="hljs-number">100</span> {
                value += <span class="hljs-number">2</span>
            }
        }
    }
}

<span class="hljs-comment">//å®šä¹‰æ–¹æ³•éƒ½å¤§åŒå°å¼‚ã€‚</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyProgressViewStyle</span>:<span class="hljs-title">ProgressViewStyle</span></span>{
    <span class="hljs-keyword">let</span> foregroundColor:<span class="hljs-type">Color</span>
    <span class="hljs-keyword">let</span> backgroundColor:<span class="hljs-type">Color</span>
    <span class="hljs-keyword">init</span>(foregroundColor:<span class="hljs-type">Color</span> = .blue,backgroundColor:<span class="hljs-type">Color</span> = .orange){
        <span class="hljs-keyword">self</span>.foregroundColor = foregroundColor
        <span class="hljs-keyword">self</span>.backgroundColor = backgroundColor
    }
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeBody</span><span class="hljs-params">(configuration: Configuration)</span></span> -&gt; some <span class="hljs-type">View</span> {
        <span class="hljs-type">GeometryReader</span>{ proxy <span class="hljs-keyword">in</span>
            <span class="hljs-type">ZStack</span>(alignment:.topLeading){
            backgroundColor
            <span class="hljs-type">Rectangle</span>()
                .fill(foregroundColor)
                .frame(width:proxy.size.width * <span class="hljs-type">CGFloat</span>(configuration.fractionCompleted ?? <span class="hljs-number">0.0</span>))
            }.clipShape(<span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">10</span>))
            .overlay(
                    configuration.label
                        .foregroundColor(.white)
            )
        }
    }
}
</code></pre><video src="http://cdn.fatbobman.com/howto-swiftui-progressView-video.mov" controls = "controls">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-onOpenUrl</guid><title>HowTo â€”â€” ä½¿ç”¨onOpenURLå¤„ç†Universal Links</title><description>SwiftUI2.0ç”±äºå¯ä»¥é‡‡ç”¨æ–°çš„ä»£ç æ¶æ„ï¼ˆLife Cycle SwiftUI Appï¼‰æ¥ç»„ç»‡app,å› æ­¤æä¾›äº†onOpenURLæ¥å¤„ç†Univeresal Linksã€‚ä¸åŒäºåœ¨AppDelegateæˆ–SceneDelegateä¸­çš„è§£å†³æ–¹æ¡ˆï¼ŒonOpenURLä½œä¸ºä¸€ä¸ªview modifierï¼Œä½ å¯ä»¥åœ¨ä»»æ„Viewä¸Šæ³¨å†Œä½ çš„appçš„URLå¤„ç†æœºåˆ¶ã€‚</description><link>http://www.fatbobman.com/posts/howto-swiftui-onOpenUrl</link><pubDate>Sat, 11 Jul 2020 13:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUI2.0ç”±äºå¯ä»¥é‡‡ç”¨æ–°çš„ä»£ç æ¶æ„ï¼ˆLife Cycle SwiftUI Appï¼‰æ¥ç»„ç»‡app,å› æ­¤æä¾›äº†onOpenURLæ¥å¤„ç†Univeresal Linksã€‚ä¸åŒäºåœ¨AppDelegateæˆ–SceneDelegateä¸­çš„è§£å†³æ–¹æ¡ˆï¼ŒonOpenURLä½œä¸ºä¸€ä¸ªview modifierï¼Œä½ å¯ä»¥åœ¨ä»»æ„Viewä¸Šæ³¨å†Œä½ çš„appçš„URLå¤„ç†æœºåˆ¶ã€‚å…³äºå¦‚ä½•ä¸ºè‡ªå·±çš„appåˆ›å»ºURL Schemeï¼Œè¯·å‚é˜…<a href="https://developer.apple.com/documentation/uikit/inter-process_communication/allowing_apps_and_websites_to_link_to_your_content/defining_a_custom_url_scheme_for_your_app">è‹¹æœçš„å®˜æ–¹æ–‡æ¡£</a>ã€‚</p></blockquote><h2>åŸºæœ¬ç”¨æ³•</h2><pre data-language="swift"><code><span class="hljs-type">VStack</span>{
   <span class="hljs-type">Text</span>(<span class="hljs-string">"Hello World"</span>)
}
.onOpenURL{ url <span class="hljs-keyword">in</span>
    <span class="hljs-comment">//åšç‚¹å•¥</span>
}
</code></pre><h2>ç¤ºä¾‹ä»£ç </h2><p>é¦–å…ˆåœ¨é¡¹ç›®ä¸­è®¾ç½®URL</p><img src="http://cdn.fatbobman.com/howto-swiftui-onOpenURL-URL.png" alt="URL"/><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> tabSelection:<span class="hljs-type">TabSelection</span> = .news
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> show = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">TabView</span>(selection:$tabSelection){
            <span class="hljs-type">Text</span>(<span class="hljs-string">"News"</span>)
                .tabItem {<span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"newspaper"</span>)}
                .tag(<span class="hljs-type">TabSelection</span>.news)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Music"</span>)
                .tabItem {<span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"music.quarternote.3"</span>)}
                .tag(<span class="hljs-type">TabSelection</span>.music)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Settings"</span>)
                .tabItem {<span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"dial.max"</span>)}
                .tag(<span class="hljs-type">TabSelection</span>.settings)
        }
        .sheet(isPresented: $show) {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"URLè°ƒç”¨å‚æ•°é”™è¯¯"</span>)
        }
        .onOpenURL { url <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">let</span> selection = url.host
            <span class="hljs-keyword">switch</span> selection{
            <span class="hljs-keyword">case</span> <span class="hljs-string">"news"</span>:
                tabSelection = .news
            <span class="hljs-keyword">case</span> <span class="hljs-string">"music"</span>:
                tabSelection = .music
            <span class="hljs-keyword">case</span> <span class="hljs-string">"settings"</span>:
                tabSelection = .settings
            <span class="hljs-keyword">default</span>:
                show = <span class="hljs-literal">true</span>
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">TabSelection</span>:<span class="hljs-title">Hashable</span></span>{
    <span class="hljs-keyword">case</span> news,music,settings
}
</code></pre><blockquote><p>macOSç›®å‰æš‚ä¸æ”¯æŒï¼Œåº”è¯¥ä¼šåœ¨æ­£å¼ç‰ˆæœ¬æä¾›ã€‚</p></blockquote><video src="http://cdn.fatbobman.com/howto-swiftui-onOpenURL-video.mp4" controls = "controls">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video><h2>ç‰¹åˆ«æ³¨æ„</h2><ul><li>onOpenURLåªæœ‰åœ¨é¡¹ç›®é‡‡ç”¨Swift Appçš„æ–¹å¼ç®¡ç†Life Cycleæ‰ä¼šå“åº”</li></ul><ul><li>åœ¨ä»£ç ä¸­å¯ä»¥æ·»åŠ å¤šä¸ªonOpenURLï¼Œæ³¨å†Œåœ¨ä¸åŒçš„Viewä¸Šï¼Œå½“é‡‡ç”¨URLè®¿é—®æ—¶ï¼Œæ¯ä¸ªé—­åŒ…éƒ½ä¼šå“åº”ã€‚è¿™æ ·å¯ä»¥é’ˆå¯¹ä¸åŒçš„Viewåšå‡ºå„è‡ªéœ€è¦çš„è°ƒæ•´ã€‚</li></ul>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-toolbar</guid><title>HowTo â€”â€” SwiftUI2.0 ä½¿ç”¨ToolBaræ›¿ä»£navigationbarItems</title><description>SwiftUI2.0ä¸ºäº†å®ç°æ›´å¥½çš„å¤šå¹³å°æ”¯æŒåŒæ—¶éœ€è¦å…¼é¡¾1.0ç‰ˆæœ¬ä»£ç å…¼å®¹æ€§ï¼Œæä¾›äº†ä¸€äº›ä¸å·²æœ‰æ§ä»¶åŠŸèƒ½ä¸Šç±»ä¼¼ä½†åç§°å’Œç”¨æ³•å…¨æ–°çš„æ§ä»¶ã€‚æ¯”å¦‚ToolBar, navigationTitleç­‰ã€‚Toolbarå¯ä»¥å®ç°navigationbarItemsçš„å…¨éƒ¨åŠŸèƒ½ï¼Œå¹¶æ–°å¢äº†åœ¨å¤šå¹³å°ä¸‹çš„é€‚é…ã€‚é‡‡ç”¨äº†å…¨æ–°çš„è¯­æ³•ï¼Œä»£ç æ›´æ˜“é˜…è¯»ã€‚</description><link>http://www.fatbobman.com/posts/howto-swiftui-toolbar</link><pubDate>Fri, 10 Jul 2020 14:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUI2.0ä¸ºäº†å®ç°æ›´å¥½çš„å¤šå¹³å°æ”¯æŒåŒæ—¶éœ€è¦å…¼é¡¾1.0ç‰ˆæœ¬ä»£ç å…¼å®¹æ€§ï¼Œæä¾›äº†ä¸€äº›ä¸å·²æœ‰æ§ä»¶åŠŸèƒ½ä¸Šç±»ä¼¼ä½†åç§°å’Œç”¨æ³•å…¨æ–°çš„æ§ä»¶ã€‚æ¯”å¦‚ToolBar, navigationTitleç­‰ã€‚Toolbarå¯ä»¥å®ç°navigationbarItemsçš„å…¨éƒ¨åŠŸèƒ½ï¼Œå¹¶æ–°å¢äº†åœ¨å¤šå¹³å°ä¸‹çš„é€‚é…ã€‚é‡‡ç”¨äº†å…¨æ–°çš„è¯­æ³•ï¼Œä»£ç æ›´æ˜“é˜…è¯»ã€‚ <strong>åœ¨å½“å‰çš„Xcode Version 12.0 beta 2 (12A6163b)ç‰ˆæœ¬ä¸‹ï¼ŒToolBaråœ¨macOSä¸‹ä»ç„¶æœ‰éå¸¸å¤šçš„é—®é¢˜ã€‚</strong></p></blockquote><h2>åŸºæœ¬ç”¨æ³•</h2><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ToolBarTest</span>: <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
      <span class="hljs-type">NavigationView</span>{
        <span class="hljs-type">Text</span>(<span class="hljs-string">"ToolBar æ¼”ç¤º"</span>)
            .toolbar{
                <span class="hljs-type">ToolbarItem</span>(placement:.automatic){
                    <span class="hljs-type">HStack</span>(spacing:<span class="hljs-number">20</span>){
                        <span class="hljs-type">Button</span>(action:{<span class="hljs-built_in">print</span>(<span class="hljs-string">"wave"</span>)}){
                            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"waveform.path.badge.plus"</span>)
                                .foregroundColor(.purple)
                                .scaleEffect(<span class="hljs-number">1.5</span>, anchor: .center)
                        }
                        
                    }
                }
                <span class="hljs-comment">//placementè®¾ç½®æ”¾ç½®ä½ç½®ï¼ŒToolBarItemä¸­çš„Viewè§£æä¸ä¼šå®Œå…¨å’Œé¢„æœŸä¸€è‡´ï¼Œä¸çŸ¥é“æ˜¯ç‰¹åˆ«é™åˆ¶è¿˜æ˜¯bug.æ¯”å¦‚è¯´æ— æ³•æ˜¾ç¤ºå¤šå½©ç¬¦å·ï¼Œæ— æ³•ä½¿ç”¨Spacerç­‰ã€‚</span>
                <span class="hljs-type">ToolbarItem</span>(placement: .bottomBar){
                    <span class="hljs-type">HStack</span>(spacing:<span class="hljs-number">100</span>){
                        <span class="hljs-type">Button</span>(action:{<span class="hljs-built_in">print</span>(<span class="hljs-string">"lt"</span>)}){
                            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"lt.rectangle.roundedtop.fill"</span>)
                                .foregroundColor(.purple)
                                .scaleEffect(<span class="hljs-number">1.5</span>, anchor: .center)
                        }
                        
                        <span class="hljs-type">Button</span>(action:{<span class="hljs-built_in">print</span>(<span class="hljs-string">"rt"</span>)}){
                            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"rt.rectangle.roundedtop.fill"</span>)
                                .foregroundColor(.purple)
                                .scaleEffect(<span class="hljs-number">1.5</span>, anchor: .center)
                        }
                    }
                }
            }
        }
    }
}
</code></pre><img src="http://cdn.fatbobman.com/howto-swiftui-toolbar-toolbar1.png width=300" alt="æˆªå±2020-07-10 ä¸Šåˆ9.01.52"/><h2>å¤šå¹³å°é€‚é…</h2><p>ä¸ºäº†èƒ½å¤Ÿæ›´å¥½çš„é€‚é…å¤šå¹³å°ï¼Œplacmentæä¾›äº†automaticè¿™æ ·çš„å¤šå¹³å°è‡ªé€‚åº”é€‰é¡¹ã€‚placementæœ‰äº›å€¼å…¨å¹³å°å¯ç”¨ï¼Œæœ‰äº›åªæ”¯æŒéƒ¨åˆ†å¹³å°ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†çš„å¯åœ¨å¤šå¹³å°è¿è¡Œä¸è¿‡åªèƒ½åœ¨éƒ¨åˆ†å¹³å°æ­£ç¡®æ˜¾ç¤ºã€‚</p><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ToolBarTest</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> placementSelection:<span class="hljs-type">Placement</span> = .automatic
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> placement:<span class="hljs-type">ToolbarItemPlacement</span> = .automatic
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> show = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">NavigationView</span>{
            <span class="hljs-type">VStack</span>{
                <span class="hljs-type">Picker</span>(<span class="hljs-string">"placement:"</span>,selection:$placementSelection){
                    <span class="hljs-type">ForEach</span>(<span class="hljs-type">Placement</span>.allCases,id:\.<span class="hljs-keyword">self</span>){ placement <span class="hljs-keyword">in</span>
                        <span class="hljs-type">Text</span>(placement.rawValue)
                            .tag(placement)
                    }
                }
                .labelsHidden()
                .padding(.all, <span class="hljs-number">10</span>)
                .onChange(of: placementSelection) { value <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">switch</span> value{
                    <span class="hljs-keyword">case</span> .automatic:
                        placement = .automatic
                    <span class="hljs-keyword">case</span> .principal:
                        placement = .principal <span class="hljs-comment">//iOSä¸æ˜¾ç¤º</span>
                    <span class="hljs-keyword">case</span> .navigation:
                        placement = .navigation
                    <span class="hljs-keyword">case</span> .primaryAction:
                        placement = .primaryAction
                    <span class="hljs-keyword">case</span> .status:
                        placement = .status <span class="hljs-comment">//iOSä¸æ˜¾ç¤º</span>
                    <span class="hljs-keyword">case</span> .confirmationAction:
                        placement = .confirmationAction <span class="hljs-comment">//iOSä¸æ˜¾ç¤º</span>
                    <span class="hljs-keyword">case</span> .cancellationAction:
                        placement = .cancellationAction <span class="hljs-comment">//iOSä¸æ˜¾ç¤º</span>
                    <span class="hljs-keyword">case</span> .destructiveAction:
                        placement = .destructiveAction <span class="hljs-comment">//iOSä¸æ˜¾ç¤º</span>
                    #<span class="hljs-keyword">if</span> os(iOS)
                    <span class="hljs-keyword">case</span> .bottomBar:
                        placement = .bottomBar
                    <span class="hljs-comment">//ä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ‰bug,è®¾ç½®åä¸æ˜¾ç¤º</span>
                    <span class="hljs-comment">//ToolbarItem(placement:.bottomBar)å¯ä»¥æ˜¾ç¤º</span>
                    <span class="hljs-keyword">case</span> .navigationBarLeading:
                        placement = .navigationBarLeading
                    <span class="hljs-keyword">case</span> .navigationBarTrailing:
                        placement = .navigationBarTrailing
                    #endif
                    }
                }
                <span class="hljs-comment">//åœ¨macOSä¸‹å¦‚æœéœ€è¦æ˜¾å¼è®¾ç½®æ˜¯å¦æ˜¾ç¤ºToolBar,éœ€è¦è®¾ç½®id,iOSä¸‹å¯ä»¥ä¸ç”¨è®¾ç½®</span>
                <span class="hljs-comment">//å½“å‰åœ¨macOSä¸‹,å¦‚æœä¸æ˜¾å¼å…³é—­å¯èƒ½å¯¼è‡´ä¸åŒViewçš„ToolBaræ··åˆåˆ°äº†ä¸€èµ·,æˆ–è€…é‡å¤å‡ºç°.ä¸çŸ¥é“æ˜¯å¦æ˜¯bugè¿˜æ˜¯è®¾è®¡é€»è¾‘</span>
                .toolbar(id:<span class="hljs-string">"ToolBar"</span>) {
                    <span class="hljs-type">ToolbarItem</span>(id:<span class="hljs-string">"1"</span>,placement:placement,showsByDefault:show) {
                        <span class="hljs-type">Button</span>(<span class="hljs-string">"ç¡®å®š"</span>){
                            
                        }
                    }
                }
                .navigationTitle(<span class="hljs-string">"Toolbaræ¼”ç¤º"</span>)
                
                #<span class="hljs-keyword">if</span> os(macOS)
                <span class="hljs-type">Toggle</span>(<span class="hljs-string">"æ˜¾ç¤ºToolBar"</span>,isOn:$show)
                <span class="hljs-type">Spacer</span>()
                #endif
            } .frame(maxWidth:.infinity,maxHeight: .infinity)
        }
        
    }
}

<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Placement</span>:<span class="hljs-title">String</span>,<span class="hljs-title">CaseIterable</span></span>{
    <span class="hljs-keyword">case</span> automatic,principal,navigation
    <span class="hljs-keyword">case</span> primaryAction,status,confirmationAction
    <span class="hljs-keyword">case</span> cancellationAction,destructiveAction
    #<span class="hljs-keyword">if</span> os(iOS)
    <span class="hljs-keyword">case</span> navigationBarLeading,navigationBarTrailing,bottomBar
    #endif
}
</code></pre><video src="http://cdn.fatbobman.com/howto-swiftui-toolbar-video.mp4" controls = "controls">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video><blockquote><p>macOSä¸‹ä¸åŒplacementçš„æ¼”ç¤º</p></blockquote><p><strong>é—æ†¾</strong></p><p>macOSç›®å‰bugè¾ƒå¤šï¼ŒToolBarItemå¯¹äºViewçš„è§£æè¿˜ä¸å®Œæ•´ï¼ŒToolBarContentBuilderä¸æ”¯æŒé€»è¾‘åˆ¤æ–­ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-link-openurl</guid><title>HowTo â€”â€” SwiftUI2.0 ä½¿ç”¨Linkæˆ–openURLæ‰“å¼€URL scheme</title><description>SwiftUI2.0æä¾›äº†åŸç”Ÿçš„æ‰“å¼€URL schemeçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ååˆ†æ–¹ä¾¿çš„åœ¨ä»£ç ä¸­è°ƒç”¨å…¶ä»–çš„appã€‚</description><link>http://www.fatbobman.com/posts/howto-swiftui-link-openurl</link><pubDate>Fri, 10 Jul 2020 13:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUI2.0æä¾›äº†åŸç”Ÿçš„æ‰“å¼€URL schemeçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ååˆ†æ–¹ä¾¿çš„åœ¨ä»£ç ä¸­è°ƒç”¨å…¶ä»–çš„appã€‚</p></blockquote><h2>Link</h2><p>ç±»ä¼¼äº NavigationLink ,ç›´æ¥æ‰“å¼€URL schemeå¯¹åº”çš„app</p><pre data-language="swift"><code><span class="hljs-type">Link</span>(<span class="hljs-string">"openURL"</span>,destination:safariUrl)
</code></pre><h2>openURL</h2><p>æœ¬æ¬¡åœ¨SwiftUI2.0ä¸­ï¼Œè‹¹æœæä¾›äº†è‹¥å¹²ä¸ªé€šè¿‡Environmentæ³¨å…¥çš„è°ƒç”¨ç³»ç»Ÿæ“ä½œçš„æ–¹æ³•ã€‚æ¯”å¦‚ exportFiles,importFiles,openURLç­‰ã€‚</p><pre data-language="swift"><code>@<span class="hljs-type">Environment</span>(\.openURL) <span class="hljs-keyword">var</span> openURL
openURL.callAsFunction(url)
</code></pre><h2>ä»£ç èŒƒä¾‹</h2><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">URLTest</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">Environment</span>(\.openURL) <span class="hljs-keyword">var</span> openURL
    <span class="hljs-keyword">let</span> safariUrl = <span class="hljs-type">URL</span>(string:<span class="hljs-string">"http://www.apple.com"</span>)!
    <span class="hljs-keyword">let</span> mailUrl = <span class="hljs-type">URL</span>(string:<span class="hljs-string">"mailto:foo@example.com?cc=bar@example.com&amp;subject=Hello%20Wrold&amp;body=Testing!"</span>)!
    <span class="hljs-keyword">let</span> phoneURl = <span class="hljs-type">URL</span>(string:<span class="hljs-string">"tel:12345678"</span>)!
    
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">List</span>{
            <span class="hljs-type">Link</span>(<span class="hljs-string">"ä½¿ç”¨safariæ‰“å¼€ç½‘é¡µ"</span>,destination:safariUrl)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"å‘é€é‚®ä»¶"</span>){
                openURL.callAsFunction(mailUrl){ result <span class="hljs-keyword">in</span>
                    <span class="hljs-built_in">print</span>(result)
                }
            }
            <span class="hljs-type">Link</span>(destination: phoneURl){
                <span class="hljs-type">Label</span>(<span class="hljs-string">"æ‹¨æ‰“ç”µè¯"</span>,systemImage:<span class="hljs-string">"phone.circle"</span>)
            }
        }
    }
}
</code></pre><blockquote><p>æ¨¡æ‹Ÿå™¨ä»…æ”¯æŒæå°‘æ•°çš„URLï¼Œæœ€å¥½ä½¿ç”¨çœŸæœºæµ‹è¯• <a href="https://developer.apple.com/library/archive/featuredarticles/iPhoneURLScheme_Reference/PhoneLinks/PhoneLinks.html#//apple_ref/doc/uid/TP40007899-CH6-SW1">è‹¹æœå®˜æ–¹æä¾›çš„ä¸€äº›URL scheme</a></p></blockquote><video src="http://cdn.fatbobman.com/howto-swiftui-openurl-video.mp4" controls = "controls">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-grid</guid><title>HowTO â€”â€” SwiftUI2.0 åŸç”Ÿçš„Grid</title><description>SwiftUIçš„ç¬¬ä¸€ç‰ˆä¸­ï¼Œå®˜æ–¹å¹¶æ²¡æœ‰æä¾›UICollectionViewçš„å¯¹åº”åŠŸèƒ½ã€‚å¼€å‘è€…éœ€è¦è‡ªè¡ŒåŒ…è£…æˆ–è€…ä¾èµ–å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ã€‚SwiftUI2.0ä¸­ï¼Œè‹¹æœé€šè¿‡LazyVGridã€LazyHGridæä¾›äº†Gridæ§ä»¶ã€‚è¯¥æ§ä»¶çš„å®ç°å¾ˆæœ‰SwiftUIçš„é£æ ¼ï¼Œå’Œä¼—å¤šçš„ç¬¬ä¸‰æ–¹åº“æœ‰æ˜¾è‘—çš„åŒºåˆ«ã€‚</description><link>http://www.fatbobman.com/posts/howto-swiftui-grid</link><pubDate>Fri, 10 Jul 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUIçš„ç¬¬ä¸€ç‰ˆä¸­ï¼Œå®˜æ–¹å¹¶æ²¡æœ‰æä¾›UICollectionViewçš„å¯¹åº”åŠŸèƒ½ã€‚å¼€å‘è€…éœ€è¦è‡ªè¡ŒåŒ…è£…æˆ–è€…ä¾èµ–å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ã€‚SwiftUI2.0ä¸­ï¼Œè‹¹æœé€šè¿‡LazyVGridã€LazyHGridæä¾›äº†Gridæ§ä»¶ã€‚è¯¥æ§ä»¶çš„å®ç°å¾ˆæœ‰SwiftUIçš„é£æ ¼ï¼Œå’Œä¼—å¤šçš„ç¬¬ä¸‰æ–¹åº“æœ‰æ˜¾è‘—çš„åŒºåˆ«ã€‚</p></blockquote><h2>åŸºæœ¬ç”¨æ³•</h2><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">GridTest1</span>: <span class="hljs-title">View</span> </span>{
    
    <span class="hljs-keyword">let</span> columns = [
        <span class="hljs-type">GridItem</span>(.adaptive(minimum: <span class="hljs-number">50</span>))
        <span class="hljs-comment">//adaptiveè‡ªé€‚åº”ï¼Œåœ¨ä¸€è¡Œæˆ–ä¸€åˆ—ä¸­æ”¾å…¥å°½å¯èƒ½å¤šçš„Item</span>
        <span class="hljs-comment">//fixedå®Œå…¨å›ºå®šçš„å°ºå¯¸ GridItem(.fixed(50)), éœ€æ˜¾å¼è®¾ç½®æ¯è¡Œæˆ–æ¯åˆ—ä¸­æ”¾å…¥çš„itemæ•°é‡</span>
        <span class="hljs-comment">//flexibleç”¨æ³•ç±»ä¼¼fixedï¼Œä¸è¿‡æ¯ä¸ªitemçš„å°ºå¯¸å¯ä»¥å¼¹æ€§è°ƒæ•´ï¼ŒåŒæ ·éœ€è¦æ˜¾å¼è®¾ç½®itemæ•°é‡</span>
        <span class="hljs-comment">//å¯ä»¥æ··ç”¨</span>
    ]
    
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">ScrollView</span>{
            <span class="hljs-type">LazyVGrid</span>(columns: columns, <span class="hljs-comment">//è¡Œåˆ—è®¾ç½®æ•°æ®</span>
                      alignment: .center,
                      spacing: <span class="hljs-number">20</span>,  <span class="hljs-comment">//itemè¡Œæˆ–åˆ—å®½</span>
                      pinnedViews: [.sectionHeaders] 
                      <span class="hljs-comment">//å¦‚æœæœ‰section,å°†headeræˆ–footeråœ¨æ»šåŠ¨ä¸­å›ºå®š</span>
            ){
                <span class="hljs-type">Section</span>(header:<span class="hljs-type">Text</span>(<span class="hljs-string">"Header"</span>)){
                    <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>...<span class="hljs-number">1000</span>,id:\.<span class="hljs-keyword">self</span>){ id <span class="hljs-keyword">in</span>
                        <span class="hljs-type">Text</span>(<span class="hljs-type">String</span>(id))
                            .foregroundColor(.white)
                            .padding(.all, <span class="hljs-number">10</span>)
                            .background(<span class="hljs-type">Rectangle</span>().fill(<span class="hljs-type">Color</span>.orange))
                    }
                }
            }
        }
    }
}
</code></pre><img src="http://cdn.fatbobman.com/howto-swiftui-grid1.png" alt="image-20200709202554829"/><h2>LazyVGridå’ŒLazyHGridæ··åˆä½¿ç”¨</h2><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CombineGrid</span>: <span class="hljs-title">View</span> </span>{
    
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">ScrollView</span>{
            <span class="hljs-type">LazyVGrid</span>(columns: [<span class="hljs-type">GridItem</span>(.adaptive(minimum:<span class="hljs-number">40</span>))], alignment: .center, spacing: <span class="hljs-number">10</span>){
                <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>...<span class="hljs-number">40</span>,id:\.<span class="hljs-keyword">self</span>){ id <span class="hljs-keyword">in</span>
                    cell(id:id,color:.red)
                }
            }
            <span class="hljs-comment">//æ¨ªå‘æ»šåŠ¨</span>
            <span class="hljs-type">ScrollView</span>(.horizontal) {
                <span class="hljs-type">LazyHGrid</span>(rows: [<span class="hljs-type">GridItem</span>(.fixed(<span class="hljs-number">50</span>)),<span class="hljs-type">GridItem</span>(.fixed(<span class="hljs-number">50</span>))]){
                    <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>...<span class="hljs-number">100</span>,id:\.<span class="hljs-keyword">self</span>){id <span class="hljs-keyword">in</span>
                        cell(id:id,color:.green)
                    }
                }
            }
            .frame(height: <span class="hljs-number">240</span>, alignment: .center)
            <span class="hljs-type">LazyVGrid</span>(columns: [<span class="hljs-type">GridItem</span>(.adaptive(minimum:<span class="hljs-number">40</span>))], alignment: .center, spacing: <span class="hljs-number">10</span>){
                <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>...<span class="hljs-number">100</span>,id:\.<span class="hljs-keyword">self</span>){ id <span class="hljs-keyword">in</span>
                    cell(id:id,color:.blue)
                }
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">cell</span><span class="hljs-params">(id:Int,color:Color)</span></span> -&gt; some <span class="hljs-type">View</span>{
        <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">10</span>)
            .fill(color)
            .frame(width: <span class="hljs-number">50</span>, height: <span class="hljs-number">50</span>)
            .overlay(<span class="hljs-type">Text</span>(<span class="hljs-string">"\(id)"</span>).foregroundColor(.white))
    }
}
</code></pre><img src="http://cdn.fatbobman.com/howto-swiftui-grid2.png" alt="image-20200709205047655"/><blockquote><p><strong>è¿™æ®µä»£ç å¿«é€Ÿå‘ä¸Šæ»šåŠ¨æ—¶æ˜¾ç¤ºæ­£å¸¸ï¼Œå¦‚æœå‘ä¸Šæ»šåŠ¨é€Ÿåº¦è¾ƒæ…¢ï¼Œä¸­éƒ¨çš„LazyHGridä¼šæ˜¾ç¤ºå¼‚å¸¸ã€‚åº”è¯¥æ˜¯bugã€‚å½“å‰ç¯å¢ƒXcode Version 12.0 beta 2 (12A6163b)</strong></p></blockquote><h2>å„ç§å‚æ•°æ··åˆçš„ä¾‹å­</h2><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">GridTest</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> data = (<span class="hljs-number">1</span>...<span class="hljs-number">1000</span>).<span class="hljs-built_in">map</span>{i <span class="hljs-keyword">in</span> <span class="hljs-type">CellView</span>(item:i, width: <span class="hljs-type">CGFloat</span>(<span class="hljs-type">Int</span>.random(<span class="hljs-keyword">in</span>: <span class="hljs-number">30</span>...<span class="hljs-number">100</span>)), height: <span class="hljs-type">CGFloat</span>(<span class="hljs-type">Int</span>.random(<span class="hljs-keyword">in</span>: <span class="hljs-number">40</span>...<span class="hljs-number">80</span>)))}
    
    <span class="hljs-keyword">let</span> column1 = [
        <span class="hljs-type">GridItem</span>(.adaptive(minimum: <span class="hljs-number">40</span>, maximum: <span class="hljs-number">80</span>))
    ]
    <span class="hljs-keyword">let</span> column2 = [
        <span class="hljs-type">GridItem</span>(.flexible()),
        <span class="hljs-type">GridItem</span>(.flexible()),
        <span class="hljs-type">GridItem</span>(.flexible()),
        <span class="hljs-type">GridItem</span>(.flexible()),
        <span class="hljs-type">GridItem</span>(.flexible()),
    ]
    <span class="hljs-keyword">let</span> column3 = [
        <span class="hljs-type">GridItem</span>(.fixed(<span class="hljs-number">100</span>)),
        <span class="hljs-type">GridItem</span>(.fixed(<span class="hljs-number">100</span>)),
        <span class="hljs-type">GridItem</span>(.fixed(<span class="hljs-number">100</span>)),
        <span class="hljs-type">GridItem</span>(.fixed(<span class="hljs-number">100</span>)),
        <span class="hljs-type">GridItem</span>(.fixed(<span class="hljs-number">100</span>)),
    ]
    
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> selection = <span class="hljs-number">1</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> alignment:<span class="hljs-type">HorizontalAlignment</span> = .leading
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> alignmentSelection = <span class="hljs-number">0</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> spacing:<span class="hljs-type">CGFloat</span> = <span class="hljs-number">10</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>{
            <span class="hljs-type">Picker</span>(<span class="hljs-string">""</span>, selection: $selection){
                <span class="hljs-type">Text</span>(<span class="hljs-string">"adaptive"</span>).tag(<span class="hljs-number">0</span>)
                <span class="hljs-type">Text</span>(<span class="hljs-string">"flexible"</span>).tag(<span class="hljs-number">1</span>)
                <span class="hljs-type">Text</span>(<span class="hljs-string">"fixed"</span>).tag(<span class="hljs-number">2</span>)
            }
            .pickerStyle(<span class="hljs-type">SegmentedPickerStyle</span>())
            .labelsHidden()
            <span class="hljs-type">Picker</span>(<span class="hljs-string">""</span>,selection:$alignmentSelection){
                <span class="hljs-type">Text</span>(<span class="hljs-string">"leading"</span>).tag(<span class="hljs-number">0</span>)
                <span class="hljs-type">Text</span>(<span class="hljs-string">"center"</span>).tag(<span class="hljs-number">1</span>)
                <span class="hljs-type">Text</span>(<span class="hljs-string">"trailing"</span>).tag(<span class="hljs-number">2</span>)
            }
            .pickerStyle(<span class="hljs-type">SegmentedPickerStyle</span>())
            .labelsHidden()
            <span class="hljs-type">Slider</span>(value: $spacing, <span class="hljs-keyword">in</span>: -<span class="hljs-number">100</span>...<span class="hljs-number">100</span>){<span class="hljs-type">Text</span>(<span class="hljs-string">"spacing"</span>)}
            <span class="hljs-type">Text</span>(<span class="hljs-string">"\(spacing)"</span>)
                .onChange(of: alignmentSelection) { value <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">switch</span> value{
                    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
                        alignment = .leading
                    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                        alignment = .center
                    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                        alignment = .trailing
                    <span class="hljs-keyword">default</span>:
                        <span class="hljs-keyword">break</span>
                    }
                }
            <span class="hljs-type">Button</span>(<span class="hljs-string">"shuffle"</span>){
                withAnimation(<span class="hljs-type">Animation</span>.easeInOut){
                    data.shuffle()
                }
            }
            <span class="hljs-type">ScrollView</span>{
                <span class="hljs-keyword">let</span> colums = [column1,column2,column3]
                <span class="hljs-type">LazyVGrid</span>(columns: colums[selection], alignment: alignment, spacing: spacing, pinnedViews: [.sectionHeaders]){
                    <span class="hljs-type">Section</span>(header: <span class="hljs-type">Text</span>(<span class="hljs-string">"header"</span>)){
                        <span class="hljs-type">ForEach</span>(data,id:\.id){ view <span class="hljs-keyword">in</span>
                            view
                        }
                    }
                }
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CellView</span>:<span class="hljs-title">View</span>,<span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> item:<span class="hljs-type">Int</span>
    <span class="hljs-keyword">let</span> width:<span class="hljs-type">CGFloat</span>
    <span class="hljs-keyword">let</span> height:<span class="hljs-type">CGFloat</span>
    <span class="hljs-keyword">let</span> colors:[<span class="hljs-type">Color</span>] = [.red,.blue,.yellow,.purple,.pink,.green]
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">Rectangle</span>()
            .fill(colors.randomElement() ?? <span class="hljs-type">Color</span>.gray)
            .frame(width: width, height: height, alignment: .center)
            .overlay(<span class="hljs-type">Text</span>(<span class="hljs-string">"\(item)"</span>).font(.caption2))
    }
}
</code></pre><blockquote><p>**ç”±äºæ˜¯Lazyæ˜¾å¼ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰å°†å…¨éƒ¨cellæ»šåŠ¨æ˜¾ç¤ºå‡ºæ¥ä¾¿è¿›è¡Œshuffleæ“ä½œï¼Œæ²¡æœ‰åˆ›å»ºçš„cellå°†ä¸ä¼šä»¥åŠ¨ç”»çš„æ–¹å¼è¿›è¡Œç§»åŠ¨ã€‚</p></blockquote><video src="http://cdn.fatbobman.com/howto-swiftui-gridvideo.mov" controls = "controls" >ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬è§†é¢‘</video><p>ç›®å‰LazyGridæ²¡æœ‰è‡ªåŠ¨é¿ç¢°çš„èƒ½åŠ›ï¼Œä¹Ÿæ— æ³•å®ç°Waterfall Gridçš„æ•ˆæœã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-label</guid><title>HowTo â€”â€” SwiftUI2.0å¦‚ä½•ä½¿ç”¨Label</title><description>SwiftUI2.0ä¸­æ–°å¢äº†Labelæ§ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ·»åŠ ç”±å›¾ç‰‡å’Œæ–‡å­—ç»„æˆçš„æ ‡ç­¾.</description><link>http://www.fatbobman.com/posts/howto-swiftui-label</link><pubDate>Thu, 9 Jul 2020 13:05:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUI2.0ä¸­æ–°å¢äº†Labelæ§ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ·»åŠ ç”±å›¾ç‰‡å’Œæ–‡å­—ç»„æˆçš„æ ‡ç­¾</p></blockquote><h2>åŸºæœ¬ç”¨æ³•</h2><pre data-language="swift"><code><span class="hljs-type">Label</span>(<span class="hljs-string">"Hello World"</span>,systemImage:<span class="hljs-string">"person.badge.plus"</span>)
</code></pre><img src="http://cdn.fatbobman.com/howto-swiftui-label1.png" alt="image-20200709174029886"/><h2>æ”¯æŒè‡ªå®šä¹‰æ ‡ç­¾é£æ ¼</h2><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">LabelTest</span>: <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">List</span>(<span class="hljs-type">LabelItem</span>.labels(),id:\.id){ label <span class="hljs-keyword">in</span>
            <span class="hljs-type">Label</span>(label.title,systemImage:label.image)
                .foregroundColor(.blue)
                .labelStyle(<span class="hljs-type">MyLabelStyle</span>(color:label.color))
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyLabelStyle</span>:<span class="hljs-title">LabelStyle</span></span>{
    <span class="hljs-keyword">let</span> color:<span class="hljs-type">Color</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeBody</span><span class="hljs-params">(configuration: <span class="hljs-keyword">Self</span>.Configuration)</span></span> -&gt; some <span class="hljs-type">View</span>{
       <span class="hljs-type">HStack</span>{
            configuration.icon <span class="hljs-comment">//View,ä¸èƒ½ç²¾ç»†æ§åˆ¶</span>
                .font(.title)
                .foregroundColor(color) <span class="hljs-comment">//é¢œè‰²æ˜¯å åŠ ä¸Šå»çš„ï¼Œå¹¶ä¸èƒ½å‡†ç¡®æ˜¾ç¤º</span>
            configuration.title  <span class="hljs-comment">//View,ä¸èƒ½ç²¾ç»†æ§åˆ¶</span>
                .foregroundColor(.blue)
            <span class="hljs-type">Spacer</span>()
        }.padding(.all, <span class="hljs-number">10</span>)
        .background(
            <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">10</span>)
                .fill(<span class="hljs-type">Color</span>.yellow)
        )
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">LabelItem</span>:<span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> title:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> image:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> color:<span class="hljs-type">Color</span>
    <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">labels</span><span class="hljs-params">()</span></span> -&gt; [<span class="hljs-type">LabelItem</span>] {
        <span class="hljs-keyword">return</span> [
       <span class="hljs-type">LabelItem</span>(title: <span class="hljs-string">"Label1"</span>, image: <span class="hljs-string">"pencil.tip.crop.circle.badge.plus"</span>, color: .red),
       <span class="hljs-type">LabelItem</span>(title: <span class="hljs-string">"df"</span>, image: <span class="hljs-string">"person.crop.circle.fill.badge.plus"</span>, color: .blue),
        ]
    }
}
</code></pre><img src="http://cdn.fatbobman.com/howto-swiftui-label2.png" alt="image-20200709175339008"/><h2>ä½¿ç”¨è‡ªå·±çš„Labelæ§ä»¶ï¼Œæ›´å¤šæ§åˆ¶åŠ›</h2><p>Labelèƒ½å¤Ÿæé«˜å¼€å‘æ•ˆç‡ï¼Œä¸è¿‡å¹¶ä¸èƒ½ç²¾ç»†æ§åˆ¶ï¼Œä¸‹é¢ä»£ç ä½¿ç”¨è‡ªå®šä¹‰MyLabelï¼Œå¯ä»¥æ”¯æŒSF2.0æä¾›çš„å½©è‰²ç¬¦å·ã€‚</p><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">LabelTest</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> multiColor = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>{
        <span class="hljs-type">Toggle</span>(<span class="hljs-string">"å½©è‰²ç¬¦å·"</span>, isOn: $multiColor).padding(.horizontal, <span class="hljs-number">20</span>)
        <span class="hljs-type">List</span>(<span class="hljs-type">LabelItem</span>.labels(),id:\.id){ label <span class="hljs-keyword">in</span>         
              <span class="hljs-type">MyLabel</span>(title:label.title,
                      systemImage:label.image,
                      color:label.color,
                      multiColor:multiColor)
        }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">LabelItem</span>:<span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> title:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> image:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> color:<span class="hljs-type">Color</span>
    <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">labels</span><span class="hljs-params">()</span></span> -&gt; [<span class="hljs-type">LabelItem</span>] {
        <span class="hljs-keyword">return</span> [
       <span class="hljs-type">LabelItem</span>(title: <span class="hljs-string">"Label1"</span>, image: <span class="hljs-string">"pencil.tip.crop.circle.badge.plus"</span>, color: .red),
       <span class="hljs-type">LabelItem</span>(title: <span class="hljs-string">"df"</span>, image: <span class="hljs-string">"person.crop.circle.fill.badge.plus"</span>, color: .blue),
        ]
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyLabel</span>:<span class="hljs-title">View</span></span>{
    <span class="hljs-keyword">let</span> title:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> systemImage:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> color:<span class="hljs-type">Color</span>
    <span class="hljs-keyword">let</span> multiColor:<span class="hljs-type">Bool</span>
    
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">HStack</span>{
            <span class="hljs-type">Image</span>(systemName: systemImage)
                .renderingMode(multiColor ? .original : .template)
                .foregroundColor(multiColor ? .clear : color)
            <span class="hljs-type">Text</span>(title)
                .bold()
                .foregroundColor(.blue)
            <span class="hljs-type">Spacer</span>()
        }
        .padding(.all, <span class="hljs-number">10</span>)
        .background(
            <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">10</span>)
                .fill(<span class="hljs-type">Color</span>.yellow)
        )
    }
}
</code></pre><img src="http://cdn.fatbobman.com/howto-swiftui-label3.png" alt="image-20200709180353538"/>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-lazyStack</guid><title>HowTo â€”â€” SwiftU2.0 LazyVStack,LazyHStack</title><description>SwiftUI2.0æä¾›äº†LazyVStackå’ŒLazyHStackï¼Œå…¶ä½œç”¨æ˜¯åªæœ‰å½“Viewåœ¨å¯è§åŒºåŸŸå†…æ‰è¿›è¡Œæ¸²æŸ“ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å¤§æé«˜appæ‰§è¡Œæ•ˆç‡</description><link>http://www.fatbobman.com/posts/howto-swiftui-lazyStack</link><pubDate>Thu, 9 Jul 2020 13:05:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>SwiftUI2.0æä¾›äº†LazyVStackå’ŒLazyHStackï¼Œå…¶ä½œç”¨æ˜¯åªæœ‰å½“Viewåœ¨å¯è§åŒºåŸŸå†…æ‰è¿›è¡Œæ¸²æŸ“ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å¤§æé«˜appæ‰§è¡Œæ•ˆç‡ã€‚ç”±äºVStackæˆ–HStackå¯¼è‡´çš„æ•ˆç‡é—®é¢˜ï¼Œåœ¨<a href="https://zhuanlan.zhihu.com/p/111151515">SwiftUI List (3) â€”â€” Listã€Formã€VStack</a>æ–‡ç« ä¸­æœ‰ç®€å•çš„æ¯”è¾ƒã€‚</p></blockquote><h2>åŸºæœ¬ç”¨æ³•</h2><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">LazyStack</span>: <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">ScrollView</span>{
            <span class="hljs-type">LazyVStack</span>{ <span class="hljs-comment">//æ¢æˆVStackä½œæ¯”è¾ƒæ–°æ•°æ®åˆ›å»ºçš„æ—¶æœº</span>
                <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>...<span class="hljs-number">1000</span>,id:\.<span class="hljs-keyword">self</span>){ id <span class="hljs-keyword">in</span>
                    <span class="hljs-type">Text</span>(<span class="hljs-type">LazyItem</span>(id:id).title)
                }
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">LazyItem</span></span>{
    <span class="hljs-keyword">let</span> id:<span class="hljs-type">Int</span>
    <span class="hljs-keyword">let</span> title:<span class="hljs-type">String</span>
    <span class="hljs-keyword">init</span>(id:<span class="hljs-type">Int</span>){
        <span class="hljs-keyword">self</span>.id = id
        <span class="hljs-keyword">self</span>.title = <span class="hljs-string">"id:\(id)"</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"init new object:\(id)"</span>) 
    }
}
</code></pre><h2>ä½¿ç”¨Lazyç‰¹æ€§åˆ›å»ºä¸é—´æ–­çš„åˆ—è¡¨æ˜¾ç¤º</h2><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">LazyStack</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> list = (<span class="hljs-number">0</span>...<span class="hljs-number">40</span>).<span class="hljs-built_in">map</span>{<span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-type">Item</span>(number:<span class="hljs-type">Int</span>.random(<span class="hljs-keyword">in</span>: <span class="hljs-number">1000</span>...<span class="hljs-number">5000</span>))}
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> loading = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>{
        <span class="hljs-type">Text</span>(<span class="hljs-string">"count:\(list.count)"</span>)
        <span class="hljs-comment">//æ•°æ®æ•°é‡ï¼Œåœ¨LazyVStackä¸‹æ•°æ®åœ¨æ¯æ¬¡åˆ·æ–°åæ‰ä¼šå¢åŠ ï¼Œåœ¨VStackä¸‹ï¼Œæ•°æ®ä¼šä¸€ç›´å¢åŠ ã€‚</span>
        <span class="hljs-type">ScrollView</span>{
            <span class="hljs-type">LazyVStack</span>{ <span class="hljs-comment">//æ¢æˆVStackä½œæ¯”è¾ƒ</span>
                <span class="hljs-type">ForEach</span>(list,id:\.id){ item <span class="hljs-keyword">in</span>
                    <span class="hljs-type">Text</span>(<span class="hljs-string">"id:\(item.number)"</span>)
                        .onAppear {
                            moreItem(id: item.id)
                        }
                }
            }
            <span class="hljs-keyword">if</span> loading {
                <span class="hljs-type">ProgressView</span>()
            }
        }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">moreItem</span><span class="hljs-params">(id:UUID)</span></span>{
       <span class="hljs-comment">//å¦‚æœæ˜¯æœ€åä¸€ä¸ªæ•°æ®åˆ™è·å–æ–°æ•°æ®</span>
        <span class="hljs-keyword">if</span> id == list.last!.id &amp;&amp; loading != <span class="hljs-literal">true</span> {
            loading = <span class="hljs-literal">true</span>
            <span class="hljs-comment">//å¢åŠ å»¶æ—¶ï¼Œæ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è·å–æ•ˆæœ</span>
            <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="hljs-number">1</span>){
                <span class="hljs-comment">//æ•°æ®æ¨¡æ‹Ÿï¼Œä¹Ÿå¯è·å–ç½‘ç»œæ•°æ®</span>
                list.append(contentsOf: (<span class="hljs-number">0</span>...<span class="hljs-number">30</span>)
                            .<span class="hljs-built_in">map</span>{<span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-type">Item</span>(number:<span class="hljs-type">Int</span>.random(<span class="hljs-keyword">in</span>: <span class="hljs-number">1000</span>...<span class="hljs-number">5000</span>))})
                loading = <span class="hljs-literal">false</span>
            }
        }
        
    }
}

 <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Item</span>:<span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> number:<span class="hljs-type">Int</span>
}
</code></pre><p>LazyHStackçš„ç”¨æ³•åŒLazyVStackä¸€æ ·</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/howto-swiftui-map</guid><title>HowToâ€”â€” Swift2.0åœ¨è§†å›¾ä¸­æ˜¾ç¤ºåœ°å›¾</title><description>Swift2.0ä¸­ï¼Œè‹¹æœæ·»åŠ äº†Mapï¼Œè®©å¼€å‘è€…å¯ä»¥éå¸¸å®¹æ˜“çš„åœ¨Viewä¸­æ·»åŠ éœ€è¦çš„åœ°å›¾å…ƒç´ ã€‚æœ¬æ–‡ç®€å•ä»‹ç»äº†å…¶ç”¨æ³•</description><link>http://www.fatbobman.com/posts/howto-swiftui-map</link><pubDate>Thu, 9 Jul 2020 13:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>Swift2.0ä¸­ï¼Œè‹¹æœæ·»åŠ äº†Mapï¼Œè®©å¼€å‘è€…å¯ä»¥éå¸¸å®¹æ˜“çš„åœ¨Viewä¸­æ·»åŠ éœ€è¦çš„åœ°å›¾å…ƒç´ ã€‚</p></blockquote><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI
<span class="hljs-keyword">import</span> MapKit

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MapView</span>: <span class="hljs-title">View</span></span>{
    <span class="hljs-comment">//è®¾ç½®åˆå§‹æ˜¾ç¤ºåŒºåŸŸ</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> region:<span class="hljs-type">MKCoordinateRegion</span> = <span class="hljs-type">MKCoordinateRegion</span>(
        center: <span class="hljs-type">CLLocationCoordinate2D</span>(latitude: <span class="hljs-number">38.92083</span>, longitude: <span class="hljs-number">121.63917</span>),
        span: <span class="hljs-type">MKCoordinateSpan</span>(latitudeDelta: <span class="hljs-number">0.5</span>, longitudeDelta: <span class="hljs-number">0.5</span>)
    )
    
    <span class="hljs-comment">//è®¾ç½®æ˜¯å¦æŒç»­è·Ÿè¸ªç”¨æˆ·å½“å‰ä½ç½®</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> trackmode = <span class="hljs-type">MapUserTrackingMode</span>.follow
    
    <span class="hljs-comment">//è®¾ç½®æ ‡è®°ç‚¹ä¿¡æ¯</span>
    <span class="hljs-keyword">let</span> dots:[<span class="hljs-type">MapDot</span>] = [
        <span class="hljs-type">MapDot</span>(title:<span class="hljs-string">"point1"</span>,
               coordinate:<span class="hljs-type">CLLocationCoordinate2D</span>(latitude: <span class="hljs-number">38.92083</span>, longitude: <span class="hljs-number">121.63917</span>),
               color:.red),
        <span class="hljs-type">MapDot</span>(title:<span class="hljs-string">"point2"</span>,
               coordinate:<span class="hljs-type">CLLocationCoordinate2D</span>(latitude: <span class="hljs-number">38.92183</span>, longitude: <span class="hljs-number">121.62717</span>),
               color:.blue)
    ]
    
    @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">Store</span>()
    
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">ZStack</span>(alignment:.bottom){
            <span class="hljs-type">Map</span>(coordinateRegion: $region,
                interactionModes: .all, <span class="hljs-comment">//.pan .zoom .all</span>
                showsUserLocation: <span class="hljs-literal">true</span>, <span class="hljs-comment">//æ˜¯å¦æ˜¾ç¤ºç”¨æˆ·å½“å‰ä½ç½®</span>
                userTrackingMode:$trackmode, <span class="hljs-comment">//æ˜¯å¦æ›´æ–°ç”¨æˆ·ä½ç½®</span>
                annotationItems:dots <span class="hljs-comment">//æ ‡è®°ç‚¹æ•°æ®</span>
            ){item <span class="hljs-keyword">in</span>
                <span class="hljs-comment">//æ ‡è®°ç‚¹æ˜¾ç¤º,ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å†…ç½®çš„MapPin,ä¸è¿‡MapPinæ— æ³•å“åº”ç”¨æˆ·è¾“å…¥</span>
                <span class="hljs-type">MapAnnotation</span>(coordinate: item.coordinate  ){
                    <span class="hljs-comment">//ä¸çŸ¥é“æ˜¯å¦æ˜¯bug,ç›®å‰iOSä¸‹æ— æ³•æ˜¾ç¤ºText,maxOSå¯ä»¥æ˜¾ç¤º</span>
                    <span class="hljs-type">Label</span>(item.title, systemImage: <span class="hljs-string">"star.fill"</span>)
                        .font(.body)
                        .foregroundColor(item.color)
                        .onTapGesture {
                            <span class="hljs-built_in">print</span>(item.title)
                        }
                }
            }
        }
        .edgesIgnoringSafeArea(.all)
    }
}

<span class="hljs-comment">//æ ‡è®°ç‚¹æ•°æ®,è¦æ±‚ç¬¦åˆIdentifiable</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MapDot</span>:<span class="hljs-title">Identifiable</span></span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> title:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> coordinate:<span class="hljs-type">CLLocationCoordinate2D</span>
    <span class="hljs-keyword">let</span> color:<span class="hljs-type">Color</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span>:<span class="hljs-title">ObservableObject</span> </span>{
    <span class="hljs-keyword">let</span> manager = <span class="hljs-type">CLLocationManager</span>()
    <span class="hljs-keyword">init</span>() {
        <span class="hljs-comment">//è¯·æ±‚ä½ç½®è®¿é—®æƒé™.éœ€è¦åœ¨plistä¸­è®¾ç½® Privacy - Location When In Use Usage Description</span>
        <span class="hljs-comment">//å¦‚æœä¸éœ€è¦æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä½ç½®,åˆ™æ— éœ€ç”³è¯·æƒé™</span>
        #<span class="hljs-keyword">if</span> os(iOS)
            manager.requestWhenInUseAuthorization()
        #endif
    }
}
</code></pre>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftui2-new-feature-2</guid><title>SwiftUI2.0 â€”â€” Appã€Sceneã€æ–°çš„ä»£ç ç»“æ„ï¼ˆäºŒï¼‰</title><description>åœ¨ä¸Šç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ç®€å•äº†è§£äº†Appã€Sceneï¼Œä»¥åŠå‡ ä¸ªå†…ç½®Sceneçš„åº”ç”¨ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç€é‡æ¢è®¨åœ¨SwiftUI2.0æ–°çš„ä»£ç ç»“æ„ä¸‹å¦‚æœæ›´é«˜æ•ˆçš„ç»„ç»‡Data Flowã€‚</description><link>http://www.fatbobman.com/posts/swiftui2-new-feature-2</link><pubDate>Wed, 8 Jul 2020 14:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>åœ¨<a href="http://www.fatbobman.com/posts/swiftui2-new-feature-1/">ä¸Šç¯‡æ–‡ç« </a>ä¸­æˆ‘ä»¬ç®€å•äº†è§£äº†Appã€Sceneï¼Œä»¥åŠå‡ ä¸ªå†…ç½®Sceneçš„åº”ç”¨ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç€é‡æ¢è®¨åœ¨SwiftUI2.0æ–°çš„ä»£ç ç»“æ„ä¸‹å¦‚æœæ›´é«˜æ•ˆçš„ç»„ç»‡Data Flowã€‚</p></blockquote><h2>æ–°ç‰¹æ€§</h2><h3>@AppStorage</h3><p>AppStorageæ˜¯è‹¹æœå®˜æ–¹æä¾›çš„ç”¨äºæ“ä½œUserDefaultçš„å±æ€§åŒ…è£…å™¨ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨Swiftæä¾›äº†propertyWrapperç‰¹æ€§åï¼Œå·²ç»æœ‰ä¼—å¤šçš„å¼€å‘è€…ç¼–å†™äº†ç±»ä¼¼çš„ä»£ç ã€‚åŠŸèƒ½ä¸Šæ²¡æœ‰ä»»ä½•ç‰¹åˆ«ä¹‹å¤„ï¼Œä¸è¿‡åç§°å¯¹åº”äº†æ–°çš„Appåè®®ï¼Œè®©äººæ›´å®¹æ˜“äº†è§£å…¶å¯é€‚ç”¨çš„å‘¨æœŸã€‚</p><ul><li>æ•°æ®å¯æŒä¹…åŒ–ï¼Œappé€€å‡ºåæ•°æ®ä»ä¿ç•™</li><li>ä»…åŒ…è£…äº†UserDefaultï¼Œæ•°æ®å¯ä»¥UserDefaultæ­£å¸¸è¯»å–</li><li>å¯ä¿å­˜çš„æ•°æ®ç±»å‹åŒUserDefaultï¼Œä¸é€‚åˆä¿å­˜å¤æ‚ç±»å‹æ•°æ®</li><li>åœ¨appçš„ä»»æ„Viewå±‚çº§éƒ½å¯é€‚ç”¨ï¼Œä¸è¿‡åœ¨appå±‚ä½¿ç”¨å¹¶ä¸èµ·ä½œç”¨ï¼ˆä¸æŠ¥é”™ï¼‰</li></ul><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AppStorageTest</span>: <span class="hljs-title">App</span> </span>{
    <span class="hljs-comment">//ä¸æŠ¥é”™ï¼Œä¸è¿‡ä¸èµ·ä½œç”¨</span>
    <span class="hljs-comment">//@AppStorage("count") var count = 0</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
            <span class="hljs-type">RootView</span>()
            <span class="hljs-type">CountView</span>()
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RootView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">AppStorage</span>(<span class="hljs-string">"count"</span>) <span class="hljs-keyword">var</span> <span class="hljs-built_in">count</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">List</span>{
            <span class="hljs-type">Button</span>(<span class="hljs-string">"+1"</span>){
                <span class="hljs-built_in">count</span> += <span class="hljs-number">1</span>
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CountView</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">AppStorage</span>(<span class="hljs-string">"count"</span>) <span class="hljs-keyword">var</span> <span class="hljs-built_in">count</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">Text</span>(<span class="hljs-string">"Count:\(count)"</span>)
    }
}
</code></pre><h3>@SceneStorage</h3><p>ä½¿ç”¨æ–¹æ³•åŒ@AppStorageååˆ†ç±»ä¼¼ï¼Œä¸è¿‡å…¶ä½œç”¨åŸŸä»…é™äºå½“å‰Sceneã€‚</p><ul><li>æ•°æ®ä½œç”¨åŸŸä»…é™äºSceneä¸­</li><li>ç”Ÿå‘½å‘¨æœŸåŒSceneä¸€è‡´ï¼Œå½“å‰åœ¨PadOSä¸‹ï¼Œå¦‚æœå¼ºåˆ¶é€€å‡ºä¸€ä¸ªä¸¤åˆ†å±æ˜¾ç¤ºçš„app,ç³»ç»Ÿåœ¨ä¸‹æ¬¡æ‰“å¼€appæ—¶æœ‰æ—¶ä¼šä¿ç•™ä¸Šæ¬¡çš„Sceneä¿¡æ¯ã€‚ä¸è¿‡ï¼Œå¦‚æœå¦‚æœå•ç‹¬é€€å‡ºä¸€ä¸ªSceneï¼Œæ•°æ®åˆ™å¤±æ•ˆ</li><li>æ”¯æŒçš„ç±»å‹åŸºæœ¬ç­‰åŒäº@AppStorageï¼Œé€‚åˆä¿å­˜è½»é‡æ•°æ®</li><li>æ¯”è¾ƒé€‚åˆä¿å­˜åŸºäºSceneçš„ç‰¹è´¨ä¿¡æ¯ï¼Œæ¯”å¦‚TabViewçš„é€‰æ‹©ï¼Œç‹¬ç«‹å¸ƒå±€ç­‰æ•°æ®</li></ul><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewAllApp</span>: <span class="hljs-title">App</span> </span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span>{
            <span class="hljs-type">ContentView1</span>()
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">SceneStorage</span>(<span class="hljs-string">"tabSeleted"</span>) <span class="hljs-keyword">var</span> selection = <span class="hljs-number">2</span>
    <span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
        <span class="hljs-type">TabView</span>(selection:$selection){
            <span class="hljs-type">Text</span>(<span class="hljs-string">"1"</span>).tabItem { <span class="hljs-type">Text</span>(<span class="hljs-string">"1"</span>) }.tag(<span class="hljs-number">1</span>)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"2"</span>).tabItem { <span class="hljs-type">Text</span>(<span class="hljs-string">"2"</span>) }.tag(<span class="hljs-number">2</span>)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"3"</span>).tabItem { <span class="hljs-type">Text</span>(<span class="hljs-string">"3"</span>) }.tag(<span class="hljs-number">3</span>)
        }
    }
}
</code></pre><img src="http://cdn.fatbobman.com/swiftui2-new-feature-2-sceneStorage.png" alt="abc"/><p>&gt;<strong><em>ä¸Šè¿°ä»£ç åœ¨PadOSä¸‹è¿è¡Œæ­£å¸¸ï¼Œä¸è¿‡åœ¨macOSä¸‹ç¨‹åºä¼šæŠ¥é”™ã€‚ä¼°è®¡åº”è¯¥æ˜¯bug</em></strong></p><h2>Data Flow</h2><h3>æ‰‹æ®µ</h3><p>è‹¹æœåœ¨SwiftUI2.0ä¸­æ·»åŠ äº†@AppStorage @SceneStorage @StateObject ç­‰æ–°çš„å±æ€§åŒ…è£…å™¨ï¼Œæˆ‘æ ¹æ®è‡ªå·±çš„ç†è§£å¯¹ç›®å‰SwiftUIæä¾›çš„éƒ¨åˆ†å±æ€§åŒ…è£…å™¨åšäº†å¦‚ä¸‹æ€»ç»“ï¼š</p><img src="http://cdn.fatbobman.com/swiftui2-new-feature-2-propertyWrapperSheet.png" alt="propertyWrapperSheet"/><p>ç»è¿‡æ­¤æ¬¡å‡çº§åï¼ŒSwiftUIå·²ç»å¤§å¤§çš„å®Œå–„äº†å„ä¸ªå±‚çº§æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå¯¹ä¸åŒçš„ç±»å‹ã€ä¸åŒçš„åœºåˆã€ä¸åŒçš„ç”¨é€”éƒ½æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œä¸ºç¼–å†™ç¬¦åˆSwiftUIçš„Data Flowæä¾›äº†ä¾¿åˆ©ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©é€‚åˆçš„Source of truthæ‰‹æ®µã€‚</p><p>æƒ³äº†è§£å…¶ä¸­çš„æ›´å¤šç»†èŠ‚ï¼Œå¯ä»¥å‚çœ‹æˆ‘çš„å…¶ä»–æ–‡ç« ï¼š</p><p><a href="http://www.fatbobman.com/posts/swiftUI-state/">@State ç ”ç©¶</a></p><p><a href="http://www.fatbobman.com/posts/stateobject/">@StateObjectç ”ç©¶</a></p><p><a href="http://www.fatbobman.com/posts/observableObject-study/">ObservableObjectç ”ç©¶â€”â€”æƒ³è¯´çˆ±ä½ ä¸å®¹æ˜“</a></p><h3>å˜åŒ–</h3><p>åœ¨SwiftUI1.0ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨AppDelegateä¸­åˆ›å»ºéœ€è¦ç”Ÿå‘½å‘¨æœŸä¸appä¸€è‡´çš„æ•°æ®ï¼ˆæ¯”å¦‚CoreDataçš„Containerï¼‰ï¼Œåœ¨SceneDelegateä¸­åˆ›å»ºStoreä¹‹ç±»çš„æ•°æ®æºï¼Œå¹¶é€šè¿‡.environmentObjectæ³¨å…¥ã€‚ä¸è¿‡éšç€SwiftUI2.0åœ¨ç¨‹åºå…¥å£æ–¹é¢çš„å˜åŒ–ï¼Œä»¥åŠé‡‡å–çš„å…¨æ–°Delegateå“åº”æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´ç®€æ´ã€æ¸…æ™°çš„ä»£ç å®Œæˆä¸Šè¿°å·¥ä½œã€‚</p><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewAllApp</span>: <span class="hljs-title">App</span> </span>{
    @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">Store</span>()
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span>{
            <span class="hljs-type">ContentView</span>()
                .environmentObject(store)
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span>:<span class="hljs-title">ObservableObject</span></span>{
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> <span class="hljs-built_in">count</span> = <span class="hljs-number">0</span>
}
</code></pre><p>ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå°†</p><pre data-language="swift"><code>@<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">Store</span>()
</code></pre><p>æ¢æˆ</p><pre data-language="swift"><code><span class="hljs-keyword">let</span> store = <span class="hljs-type">Store</span>()
</code></pre><p>ç›®å‰æ¥è¯´æ˜¯ä¸€æ ·çš„ã€‚</p><p><em>è™½ç„¶ç›®å‰SceneBuilderã€CommandBuilderå¯¹Dynamic updateå’Œé€»è¾‘åˆ¤æ–­å°šä¸æ”¯æŒï¼Œæˆ‘ç›¸ä¿¡åº”è¯¥åœ¨ä¸ä¹…çš„å°†æ¥ï¼Œæˆ–è®¸æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç æ¥å®Œæˆå¾ˆå¤šæœ‰è¶£çš„å·¥ä½œäº†,**å½“å‰ä»£ç æ— æ³•æ‰§è¡Œ</em>**</p><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewAllApp</span>: <span class="hljs-title">App</span> </span>{
    @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">Store</span>()
    @<span class="hljs-type">SceneBuilder</span> <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-comment">//@SceneBuilderç›®å‰ä¸æ”¯æŒåˆ¤æ–­ï¼Œä¸è¿‡å°†æ¥åº”è¯¥ä¼šåŠ ä¸Š</span>
        <span class="hljs-keyword">if</span> store.scene == <span class="hljs-number">0</span> {
        <span class="hljs-type">WindowGroup</span>{
            <span class="hljs-type">ContentView1</span>()
                .environmentObject(store)
        }
        .onChange(of: store.number){ value <span class="hljs-keyword">in</span>
            <span class="hljs-built_in">print</span>(value)
        }
        .commands{
            <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"DynamicButton"</span>){
                <span class="hljs-comment">//ç›®å‰æ— æ³•åŠ¨æ€åˆ‡æ¢å†…å®¹ï¼Œæ€€ç–‘æ˜¯bugï¼Œå·²åé¦ˆ</span>
                <span class="hljs-keyword">switch</span> store.number{
                <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
                    <span class="hljs-type">Button</span>(<span class="hljs-string">"0"</span>){}
                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                    <span class="hljs-type">Button</span>(<span class="hljs-string">"1"</span>){}
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-type">Button</span>(<span class="hljs-string">"other"</span>){}
                }
            }
        }
        }
        <span class="hljs-keyword">else</span> {
         <span class="hljs-type">DocumentGroup</span>(newDocment:<span class="hljs-type">TextFile</span>()){ file <span class="hljs-keyword">in</span>
              <span class="hljs-type">TextEditorView</span>(document:file.$document)
         }
        }
        
        <span class="hljs-type">Settings</span>{
            <span class="hljs-type">VStack</span>{
               <span class="hljs-comment">//å¯æ­£å¸¸å˜æ¢</span>
                <span class="hljs-type">Text</span>(<span class="hljs-string">"\(store.number)"</span>)
                    .padding(.all, <span class="hljs-number">50</span>)
            }
        }

    }
}


<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView1</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">EnvironmentObject</span> <span class="hljs-keyword">var</span> store:<span class="hljs-type">Store</span>
    <span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
        <span class="hljs-type">VStack</span>{
        <span class="hljs-type">Picker</span>(<span class="hljs-string">"select"</span>,selection:$store.number){
            <span class="hljs-type">Text</span>(<span class="hljs-string">"0"</span>).tag(<span class="hljs-number">0</span>)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"1"</span>).tag(<span class="hljs-number">1</span>)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"2"</span>).tag(<span class="hljs-number">2</span>)
        }
        .pickerStyle(<span class="hljs-type">SegmentedPickerStyle</span>())
        .padding()
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span>:<span class="hljs-title">ObservableObject</span></span>{
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> number = <span class="hljs-number">0</span>
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> scene = <span class="hljs-number">0</span>
}
</code></pre><h3>è·¨å¹³å°ä»£ç </h3><p>åœ¨<a href="https://zhuanlan.zhihu.com/p/152624613">ä¸Šç¯‡æ–‡ç« </a>æˆ‘ä»¬ä»‹ç»äº†æ–°çš„@UIApplicationDelegateAdaptorçš„ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªæ”¯æŒDelegateçš„storeã€‚</p><pre data-language="swift"><code><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span>:<span class="hljs-title">NSObject</span>,<span class="hljs-title">ObservableObject</span></span>{
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> <span class="hljs-built_in">count</span> = <span class="hljs-number">0</span>
}

#<span class="hljs-keyword">if</span> os(iOS)
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Store</span>:<span class="hljs-title">UIApplicationDelegate</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">application</span><span class="hljs-params">(<span class="hljs-number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey : <span class="hljs-keyword">Any</span>]? = <span class="hljs-literal">nil</span>)</span></span> -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"launch"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
}
#endif

@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AllInOneApp</span>: <span class="hljs-title">App</span> </span>{
    #<span class="hljs-keyword">if</span> os(iOS)
    @<span class="hljs-type">UIApplicationDelegateAdaptor</span>(<span class="hljs-type">Store</span>.<span class="hljs-keyword">self</span>) <span class="hljs-keyword">var</span> store
    #<span class="hljs-keyword">else</span>
    @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">Store</span>()
    #endif
    
    @<span class="hljs-type">Environment</span>(\.scenePhase) <span class="hljs-keyword">var</span> phase

    @<span class="hljs-type">SceneBuilder</span> <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
            <span class="hljs-type">WindowGroup</span> {
                <span class="hljs-type">RootView</span>()
                    .environmentObject(store)
            }
            .onChange(of: phase){phase <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">switch</span> phase{
                <span class="hljs-keyword">case</span> .active:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"active"</span>)
                <span class="hljs-keyword">case</span> .inactive:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"inactive"</span>)
                <span class="hljs-keyword">case</span> .background:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"background"</span>)
                @unknown <span class="hljs-keyword">default</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"for future"</span>)
                }

            }
      
        #<span class="hljs-keyword">if</span> os(macOS)
        <span class="hljs-type">Settings</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"åå¥½è®¾ç½®"</span>).padding(.all, <span class="hljs-number">50</span>)
        }
        #endif
    }
}
</code></pre><h2>æ€»ç»“</h2><p>åœ¨<a href="http://www.fatbobman.com/posts/observableObject-study/">ObservableObjectç ”ç©¶â€”â€”æƒ³è¯´çˆ±ä½ ä¸å®¹æ˜“</a>ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨è¿‡SwiftUIæ›´å€¾å‘äºæˆ‘ä»¬ä¸è¦åˆ›å»ºä¸€ä¸ªæ²‰é‡çš„Singel source of truth,è€Œæ˜¯å°†æ¯ä¸ªåŠŸèƒ½æ¨¡å—ä½œä¸ºç‹¬ç«‹çš„çŠ¶æ€æœºï¼ˆä¸€èµ·ç»„åˆæˆä¸€ä¸ªå¤§çš„çŠ¶æ€appï¼‰ï¼Œä½¿ç”¨èƒ½å¤Ÿå¯¹ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸæ›´ç²¾ç¡®å¯æ§çš„æ‰‹æ®µåˆ›å»ºåŒºåŸŸæ€§çš„source of truthã€‚</p><p>ä»SwiftUIç¬¬ä¸€ä¸ªç‰ˆæœ¬å‡çº§çš„å†…å®¹æ¥çœ‹ï¼Œç›®å‰SwiftUIä»æ˜¯è¿™æ ·çš„æ€è·¯ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftui2-new-feature-1</guid><title>SwiftUI2.0 â€”â€” Appã€Sceneã€æ–°çš„ä»£ç ç»“æ„ï¼ˆä¸€ï¼‰</title><description>æœ¬æ–‡ç®€å•ä»‹ç»äº†SwiftUI2.0ä¸­å…¨æ–°æä¾›çš„Appåè®®ã€Sceneåè®®ï¼Œæµ…è°ˆäº†åœ¨å…¨æ–°çš„ä»£ç ç»“æ„ä¸‹å¦‚ä½•ç»„ç»‡Data Flowï¼Œå¹¶æä¾›äº†SwiftUI2.0ä¸­é¢„ç½®çš„Sceneçš„ä¸€äº›ä½¿ç”¨ç¤ºä¾‹ã€‚å½“å‰è¿è¡Œç¯å¢ƒä¸º Xcode Version 12.0 beta (12A6159), macOS Big Sur 11.0 Betaç‰ˆ(20A4299v)ã€‚</description><link>http://www.fatbobman.com/posts/swiftui2-new-feature-1</link><pubDate>Wed, 8 Jul 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>æœ¬æ–‡ç®€å•ä»‹ç»äº†SwiftUI2.0ä¸­å…¨æ–°æä¾›çš„Appåè®®ã€Sceneåè®®ï¼Œæµ…è°ˆäº†åœ¨å…¨æ–°çš„ä»£ç ç»“æ„ä¸‹å¦‚ä½•ç»„ç»‡Data Flowï¼Œå¹¶æä¾›äº†SwiftUI2.0ä¸­é¢„ç½®çš„Sceneçš„ä¸€äº›ä½¿ç”¨ç¤ºä¾‹ã€‚ å½“å‰è¿è¡Œç¯å¢ƒä¸º Xcode Version 12.0 beta (12A6159), macOS Big Sur 11.0 Betaç‰ˆ(20A4299v)ã€‚</p></blockquote><p>WWDC20ä¸­ï¼Œè‹¹æœä¸ºå¼€å‘è€…å¸¦æ¥äº†åŸºäºSwiftUIçš„å…¨æ–°é¡¹ç›®æ¨¡æ¿ã€‚ä½¿ç”¨è¯¥æ¨¡æ¿ï¼Œå°†ä½¿é¡¹ç›®ä»£ç å˜å¾—å¼‚å¸¸ç®€æ´ã€æ¸…æ™°ã€‚</p><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewAllApp</span>: <span class="hljs-title">App</span> </span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Hello world"</span>)
        }
    }
}
</code></pre><p>ä¸Šè¿°ä»£ç å¯ä»¥åœ¨å±å¹•ä¸Šå®ŒæˆHello worldçš„æ˜¾ç¤ºï¼Œä¸”èƒ½å¤Ÿè¿è¡ŒäºiOSå’ŒmacOSå¹³å°ä¸‹ã€‚</p><h2>åŸºæœ¬æ¦‚å¿µ</h2><h3>App</h3><p>SwiftUI2.0æä¾›çš„å…¨æ–°åè®®ã€‚é€šè¿‡å£°æ˜ä¸€ä¸ªç¬¦åˆAppåè®®çš„ç»“æ„æ¥åˆ›å»ºä¸€ä¸ªç¨‹åºï¼Œå¹¶é€šè¿‡è®¡ç®—å±æ€§bodyæ¥å®ç°ç¨‹åºçš„å†…å®¹ã€‚</p><ul><li>é€šè¿‡@main(swift5.3 æ–°ç‰¹æ€§)è®¾å®šç¨‹åºçš„å…¥å£ï¼Œæ¯ä¸ªé¡¹ç›®åªèƒ½æœ‰ä¸€ä¸ªè¿›å…¥ç‚¹</li><li>ç®¡ç†æ•´ä¸ªappçš„ç”Ÿå‘½å‘¨æœŸ</li></ul><ul><li>åœ¨è¿™ä¸ªä½œç”¨åŸŸä¸‹å£°æ˜çš„å¸¸é‡ã€å˜é‡å…¶ç”Ÿå‘½å‘¨æœŸä¸æ•´ä¸ªappæ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</li></ul><h3>Scene</h3><p>åœºæ™¯æ˜¯è§†å›¾ï¼ˆViewï¼‰å±‚æ¬¡ç»“æ„çš„å®¹å™¨ã€‚é€šè¿‡åœ¨Appå®ä¾‹çš„bodyä¸­ç»„åˆä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆSceneåè®®çš„å®ä¾‹æ¥å‘ˆç°å…·ä½“ç¨‹åºã€‚</p><ul><li>ç”Ÿå‘½å‘¨æœŸç”±ç³»ç»Ÿç®¡ç†</li><li>ç³»ç»Ÿä¼šæ ¹æ®è¿è¡Œå¹³å°çš„ä¸åŒè€Œè°ƒæ•´åœºæ™¯çš„å±•ç¤ºè¡Œä¸ºï¼ˆæ¯”å¦‚ç›¸åŒçš„ä»£ç åœ¨iOSå’ŒmacOSä¸‹çš„å‘ˆç°ä¸åŒï¼Œæˆ–è€…æŸäº›åœºæ™¯ä»…èƒ½è¿è¡Œäºç‰¹å®šçš„å¹³å°ï¼‰</li><li>SwiftUI2.0æä¾›äº†å‡ ä¸ªé¢„ç½®çš„åœºæ™¯ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ç¬¦åˆSceneåè®®çš„åœºæ™¯ã€‚ä¸Šè¿°ä»£ç ä¸­ä¾¿æ˜¯ä½¿ç”¨çš„ä¸€ä¸ªé¢„ç½®åœºæ™¯WindowGroup</li></ul><p>é€šè¿‡Appå’ŒSceneçš„åŠ å…¥ï¼Œç»ä¸æ˜¯ä»…ä»…å‡å°‘ä»£ç é‡è¿™ä¹ˆç®€å•ã€‚é€šè¿‡è¿™ä¸ªæ˜ç¡®çš„å±‚çº§è®¾å®šï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½çš„æŒæ¡åœ¨ä¸åŒä½œç”¨åŸŸä¸‹å„ä¸ªéƒ¨åˆ†çš„ç”Ÿå‘½å‘¨æœŸã€æ›´ç²¾å‡†æ•°æ®ä¼ é€’ã€ä»¥åŠæ›´ä¾¿åˆ©çš„å¤šå¹³å°ä»£ç å…±äº«ã€‚æœ¬æ–‡åé¢ä¼šç”¨å…·ä½“ä»£ç æ¥é€ä¸ªé˜è¿°ã€‚</p><p><em>Appå’ŒSceneéƒ½æ˜¯é€šè¿‡å„è‡ªçš„functionBuilderæ¥è§£æçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„æ¨¡æ¿ä»ç¨‹åºçš„å…¥å£å¼€å§‹ä¾¿æ˜¯ä½¿ç”¨DSLæ¥æè¿°çš„ã€‚</em></p><h2>ç¨‹åºç³»ç»Ÿäº‹ä»¶å“åº”</h2><p>ç”±äºå»é™¤äº†AppDelegate.swiftå’ŒSceneDelegate.swiftï¼ŒSwiftUI2.0æä¾›äº†æ–°çš„æ–¹æ³•æ¥è®©ç¨‹åºå“åº”ç³»ç»Ÿäº‹ä»¶ã€‚</p><h3>é’ˆå¯¹AppDelegate.swift</h3><p>åœ¨iOSç³»ç»Ÿä¸‹ï¼Œé€šè¿‡ä½¿ç”¨@UIApplicationDelegateAdaptorå¯ä»¥æ–¹ä¾¿çš„å®ç°ä¹‹å‰AppDelegate.swfitä¸­æä¾›çš„åŠŸèƒ½ï¼š</p><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewAllApp</span>: <span class="hljs-title">App</span> </span>{
   @<span class="hljs-type">UIApplicationDelegateAdaptor</span>(<span class="hljs-type">AppDelegate</span>.<span class="hljs-keyword">self</span>) <span class="hljs-keyword">var</span> appDelegate
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Hello world"</span>)
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppDelegate</span>:<span class="hljs-title">NSObject</span>,<span class="hljs-title">UIApplicationDelegate</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">application</span><span class="hljs-params">(<span class="hljs-number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey : <span class="hljs-keyword">Any</span>]? = <span class="hljs-literal">nil</span>)</span></span> -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"launch"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
}
</code></pre><p>ç”±äºç›®å‰è¿˜æ˜¯æµ‹è¯•ç‰ˆï¼Œè™½ç„¶å¾ˆå¤šçš„äº‹ä»¶å·²ç»å®šä¹‰ï¼Œä½†ç°åœ¨å¹¶æ²¡æœ‰å“åº”ã€‚ä¼°è®¡å¾ˆå¿«ä¼šå¢åŠ ä¿®æ”¹è¿‡æ¥</p><h3>é’ˆå¯¹SceneDelegate.swift</h3><p>é€šè¿‡æ–°å¢æ·»çš„EnvironmentKey <strong>scenePhase</strong> å’Œæ–°çš„<strong>.onChange</strong> æ–¹æ³•ï¼ŒSwiftUIæä¾›äº†ä¸€ä¸ªæ›´åŠ æœ‰è¶£çš„åœºæ™¯äº‹ä»¶è§£å†³æ–¹æ¡ˆï¼š</p><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewAllApp</span>: <span class="hljs-title">App</span> </span>{
    @<span class="hljs-type">Environment</span>(\.scenePhase) <span class="hljs-keyword">var</span> phase
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
           <span class="hljs-type">ContentView</span>()
        }
        .onChange(of: phase){phase <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">switch</span> phase{
                <span class="hljs-keyword">case</span> .active:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"active"</span>)
                <span class="hljs-keyword">case</span> .inactive:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"inactive"</span>)
                <span class="hljs-keyword">case</span> .background:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"background"</span>)
                @unknown <span class="hljs-keyword">default</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"for future"</span>)
                }

          }
    }
}
</code></pre><p>åŒæ ·æ˜¯ç”±äºæµ‹è¯•ç‰ˆçš„åŸå› ï¼Œè¯¥å“åº”ç›®å‰å¹¶æ²¡æœ‰å®Œæˆã€‚ä¸è¿‡è¿™æ®µä»£ç ç›®å‰æ¥çœ‹æ˜¯iOSå’ŒmacOSéƒ½é€šç”¨çš„</p><h3>æ›´æ–°</h3><p>ç›®å‰å‘ç°å¦‚æœåœ¨Viewä¸­ï¼Œå¯ä»¥è·å–scenePhaseçš„çŠ¶æ€æ›´æ–°ã€‚ä¸‹æ¥ä»£ç ç›®å‰å¯ä»¥æ­£å¸¸æ‰§è¡Œ</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>:<span class="hljs-title">View</span></span>{ 
  @<span class="hljs-type">Environment</span>(\.scenePhase) <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> scenePhase
 <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
  <span class="hljs-type">WindowGroup</span> {
   <span class="hljs-type">ContentView</span>()
  }
  .onChange(of: phase){phase <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">switch</span> phase{
                <span class="hljs-keyword">case</span> .active:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"active"</span>)
                <span class="hljs-keyword">case</span> .inactive:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"inactive"</span>)
                <span class="hljs-keyword">case</span> .background:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"background"</span>)
                @unknown <span class="hljs-keyword">default</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"for future"</span>)
                }
         }
   }
}
</code></pre><h2>é¢„ç½®åœºæ™¯</h2><ul><li><strong>WKNotificationScene</strong> ä»…é€‚ç”¨äºwatchOS7.0ï¼Œç”¨äºå“åº”æŒ‡å®šç±»åˆ«çš„è¿œç¨‹æˆ–æœ¬åœ°é€šçŸ¥ã€‚ç›®å‰è¿˜æ²¡æœ‰ç ”ç©¶ã€‚</li></ul><ul><li><strong>WindowGroup</strong></li></ul><p>æœ€å¸¸ç”¨çš„åœºæ™¯ï¼Œå¯ä»¥å‘ˆç°ä¸€ç»„ç»“æ„ç›¸åŒçš„çª—å£ã€‚ä½¿ç”¨è¯¥åœºæ™¯ï¼Œæˆ‘ä»¬æ— éœ€åœ¨ä»£ç ä¸Šåšä¿®æ”¹ï¼Œåªéœ€è¦åœ¨é¡¹ç›®ä¸­è®¾å®šæ˜¯å¦æ”¯æŒå¤šçª—å£ï¼Œç³»ç»Ÿå°†ä¼šæŒ‰ç…§è¿è¡Œå¹³å°çš„ç‰¹æ€§è‡ªåŠ¨ç®¡ç†ã€‚</p><p>åœ¨iOSä¸­ï¼Œåªèƒ½å‘ˆç°ä¸€ä¸ªè¿è¡Œçª—å£ã€‚</p><p>åœ¨PadOSä¸­ï¼ˆå¦‚æ‰“å¼€å¤šçª—å£æ”¯æŒï¼‰ï¼Œæœ€å¤šå¯ä»¥æ‰“å¼€ä¸¤ä¸ªè¿è¡Œçª—å£ï¼Œå¯ä»¥åˆ†å±æ˜¾ç¤ºï¼Œä¹Ÿå¯ä»¥å…¨å±ç‹¬ç«‹æ˜¾ç¤ºã€‚</p><p>åœ¨macOSä¸­ï¼Œå¯ä»¥æ‰“å¼€å¤šä¸ªçª—å£ï¼Œå¹¶é€šè¿‡ç¨‹åºèœå•ä¸­çš„çª—å£èœå•æ¥è¿›è¡Œå¤šçª—å£ç®¡ç†ã€‚</p><p>æœ€å¼€å§‹çš„ä»£ç åœ¨ä¸‰ä¸ªå¹³å°ä¸‹çš„çŠ¶æ€ï¼š</p><img src="http://cdn.fatbobman.com/swiftui2-new-feature-1-windowGroup.png" alt="windowGroup"/><p>å¦‚æœåœ¨ä¸€ä¸ªWindowGroupé‡ŒåŠ å…¥å¤šä¸ªView,å‘ˆç°çŠ¶æ€æœ‰ç‚¹ç±»ä¼¼VStackã€‚</p><p>åœ¨ä¸€ä¸ªSceneä¸­åŠ å…¥å¤šä¸ªWindowGroupï¼Œåªæœ‰æœ€å‰é¢çš„å¯ä»¥è¢«æ˜¾ç¤ºã€‚</p><ul><li><strong>DocumentGroup</strong></li></ul><p>åˆ›å»ºä¸€ä¸ªå¯å¤„ç†æŒ‡å®šæ–‡ä»¶ç±»å‹çš„çª—å£ã€‚åœ¨iOSå’ŒPadOSä¸‹éƒ½é¦–å…ˆä¼šå‘ˆç°æ–‡ä»¶ç®¡ç†å™¨ï¼Œç‚¹å‡»æ–‡ä»¶ï¼Œè¿›å…¥å¯¹åº”çš„Viewæ¥å¤„ç†ã€‚macOSä¸‹ï¼Œé€šè¿‡èœå•ä¸­çš„æ–‡ä»¶æ“ä½œæ¥é€‰æ‹©æˆ–åˆ›å»ºæ–‡ä»¶ã€‚</p><p>é€šè¿‡åˆ›å»ºä¸€ä¸ªç¬¦åˆFileDocumentçš„ç»“æ„æ¥å®šä¹‰æ”¯æŒå“ªç§æ ¼å¼ï¼Œä»¥åŠæ‰“å¼€å’Œä¿å­˜çš„å·¥ä½œã€‚</p><pre data-language="swift"><code>  <span class="hljs-comment">//çº¯æ–‡æœ¬æ ¼å¼æ–‡ä»¶ã€‚writeçš„æ–¹æ³•ç”¨äºæè¿°å¦‚ä½•å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœä¸éœ€å†™å…¥å¯ä¸ºç©ºã€‚</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TextFile</span>: <span class="hljs-title">FileDocument</span> </span>{
      <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> readableContentTypes = [<span class="hljs-type">UTType</span>.plainText]
      <span class="hljs-keyword">var</span> text = <span class="hljs-string">""</span>
      <span class="hljs-keyword">init</span>(initialText: <span class="hljs-type">String</span> = <span class="hljs-string">""</span>) {
          text = initialText
      }
      <span class="hljs-keyword">init</span>(fileWrapper: <span class="hljs-type">FileWrapper</span>, contentType: <span class="hljs-type">UTType</span>) <span class="hljs-keyword">throws</span> {
          <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data = fileWrapper.regularFileContents {
              text = <span class="hljs-type">String</span>(decoding: data, <span class="hljs-keyword">as</span>: <span class="hljs-type">UTF8</span>.<span class="hljs-keyword">self</span>)
          }
      }
      <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">write</span><span class="hljs-params">(to fileWrapper: <span class="hljs-keyword">inout</span> FileWrapper, contentType: UTType)</span></span> <span class="hljs-keyword">throws</span> {
          <span class="hljs-keyword">let</span> data = <span class="hljs-type">Data</span>(text.utf8)
          <span class="hljs-keyword">let</span> file = <span class="hljs-type">FileWrapper</span>(regularFileWithContents: data)
          fileWrapper = file
      }
  }
  <span class="hljs-comment">//å›¾ç‰‡æ–‡ä»¶ï¼Œç”±äºéœ€è¦è½¬æ¢æˆUIImageï¼Œè¯¥ä»£ç åªæ”¯æŒiOSæˆ–PadOS</span>
  #<span class="hljs-keyword">if</span> os(iOS)
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ImageFile</span>: <span class="hljs-title">FileDocument</span> </span>{
      <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> readableContentTypes = [<span class="hljs-type">UTType</span>.image]
      <span class="hljs-keyword">var</span> image = <span class="hljs-type">UIImage</span>()
      <span class="hljs-keyword">init</span>(initialImage: <span class="hljs-type">UIImage</span> = <span class="hljs-type">UIImage</span>()) {
          image = initialImage
      }
    
      <span class="hljs-keyword">init</span>(fileWrapper: <span class="hljs-type">FileWrapper</span>, contentType: <span class="hljs-type">UTType</span>) <span class="hljs-keyword">throws</span> {
          <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data = fileWrapper.regularFileContents {
              image =   <span class="hljs-type">UIImage</span>(data: data) ?? <span class="hljs-type">UIImage</span>()
          }
      }
  
      <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">write</span><span class="hljs-params">(to fileWrapper: <span class="hljs-keyword">inout</span> FileWrapper, contentType: UTType)</span></span> <span class="hljs-keyword">throws</span> { }
  }
  #endif
</code></pre><p>è°ƒç”¨</p><pre data-language="swift"><code>  <span class="hljs-keyword">import</span> SwiftUI
  #<span class="hljs-keyword">if</span> os(iOS)
  <span class="hljs-keyword">import</span> UIKit
  #endif
  <span class="hljs-keyword">import</span> UniformTypeIdentifiers
  
  @main
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewAllApp</span>: <span class="hljs-title">App</span> </span>{
     @<span class="hljs-type">SceneBuilder</span> <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
          <span class="hljs-comment">//å¯è¯»å†™</span>
          <span class="hljs-type">DocumentGroup</span>(newDocument: <span class="hljs-type">TextFile</span>()) { file <span class="hljs-keyword">in</span>
                  <span class="hljs-type">TextEditorView</span>(document: file.$document)
          }
          
          #<span class="hljs-keyword">if</span> os(iOS)
          <span class="hljs-comment">//åªè¯»</span>
          <span class="hljs-type">DocumentGroup</span>(viewing: <span class="hljs-type">ImageFile</span>.<span class="hljs-keyword">self</span>) { file <span class="hljs-keyword">in</span>
                  <span class="hljs-type">ImageViewerView</span>(file: file.$document)
            }
          #endif
      }
  }
  
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TextEditorView</span>: <span class="hljs-title">View</span> </span>{
      @<span class="hljs-type">Binding</span> <span class="hljs-keyword">var</span> document: <span class="hljs-type">TextFile</span>
      @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">""</span>
      <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
          <span class="hljs-type">VStack</span>{
          <span class="hljs-type">TextEditor</span>(text: $document.text)
              .padding()
          }
          .background(<span class="hljs-type">Color</span>.gray)
      }
  }
  
  #<span class="hljs-keyword">if</span> os(iOS)
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ImageViewerView</span>:<span class="hljs-title">View</span></span>{
      @<span class="hljs-type">Binding</span> <span class="hljs-keyword">var</span> document:<span class="hljs-type">ImageFile</span>
      <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
          <span class="hljs-type">Image</span>(uiImage: document.image)
              .resizable(resizingMode: .stretch)
              .aspectRatio(contentMode: .fit)
      }
  }
  #endif
</code></pre><img src="http://cdn.fatbobman.com/swiftui2-new-feature-1-documentGroup.png" alt="DocumentGroup"/><p>å¯ä»¥å°†å¤šä¸ªDocumentGroupæ”¾å…¥Sceneä¸­ï¼Œç¨‹åºå°†ä¼šä¸€å¹¶æ”¯æŒæ¯ä¸ªDocumentGroupæ‰€å®šä¹‰çš„æ–‡ä»¶ç±»å‹ã€‚ä¸Šè¿°ä»£ç ä½¿ç¨‹åºå¯ä»¥åˆ›å»ºã€ç¼–è¾‘çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥æµè§ˆå›¾ç‰‡æ–‡ä»¶ã€‚</p><p>åœ¨macOSä¸Šï¼Œéœ€è¦åœ¨macOS.entitlementsä¸­è®¾ç½®com.apple.security.files.user-selected.read-writeä¸ºçœŸæ‰èƒ½å®Œæˆå†™å…¥ã€‚</p><p>å½“åœ¨Sceneä¸­åŠ å…¥å¤šä¸ªåœºæ™¯æ—¶ï¼Œéœ€è¦ä½¿ç”¨@SceneBuilderæˆ–ç”¨Groupå°†å¤šä¸ªåœºæ™¯æ¶µç›–èµ·æ¥ã€‚</p><p>macOSä¸‹å½“åŒæ—¶åŠ å…¥WindowGroupå’ŒDocumentGroupæ—¶ï¼Œä¸¤ä¸ªåŠŸèƒ½éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œã€‚iOSæˆ–PadOSä¸‹ï¼Œåªæœ‰é¡ºåºåœ¨æœ€å‰é¢çš„è¢«æ˜¾ç¤ºã€‚</p><p>ç”±äºæµ‹è¯•ç‰ˆçš„åŸå› ï¼Œç›®å‰ä»æœ‰å¤§é‡çš„åŠŸèƒ½æ— æ³•å®ç°æˆ–æœ‰é—®é¢˜ã€‚æ¯”å¦‚ä»æ— æ³•åœ¨iOSä¸Šé€šè¿‡fileDocumentæä¾›çš„filenameæ¥è®¾ç½®æ–‡ä»¶åï¼Œæˆ–è€…æ— æ³•åœ¨åˆ›å»ºæ–°æ–‡ä»¶æ—¶é€‰æ‹©æ ¼å¼ç­‰</p><ul><li><strong>Settings</strong></li></ul><p>åªç”¨äºmacOS,ç”¨äºç¼–å†™ç¨‹åºçš„åå¥½è®¾ç½®çª—å£ã€‚</p><pre data-language="swift"><code>  #<span class="hljs-keyword">if</span> os(macOS)
      <span class="hljs-type">Settings</span>{
        <span class="hljs-type">Text</span>(<span class="hljs-string">"åå¥½è®¾ç½®"</span>).padding(.all, <span class="hljs-number">50</span>)
      }
  #endif
</code></pre><img src="http://cdn.fatbobman.com/swiftui2-new-feature-1-settings.jpg" alt="Settings"/><h2>å…¶ä»–</h2><ul><li><strong>onChange</strong> ç›‘è§†æŒ‡å®šçš„å€¼ï¼Œåœ¨å€¼æ”¹å˜æ—¶æ‰§è¡ŒæŒ‡å®šçš„actionã€‚åœ¨scenePhaseçš„ç”¨æ³•ä»‹ç»ä¸­æœ‰ä½¿ç”¨çš„èŒƒä¾‹</li></ul><ul><li><strong>onCommands</strong> åœ¨macOSä¸‹è®¾ç½®ç¨‹åºçš„èœå•ã€‚å…·ä½“çš„ä½¿ç”¨æ–¹æ³•è¯·æŸ¥çœ‹<a href="https://zhuanlan.zhihu.com/p/152127847">SwiftUI2.0 â€”â€” Commandsï¼ˆmacOSèœå•ï¼‰</a></li></ul><ul><li><strong>defaultAppStorage</strong> å¦‚æœä¸æƒ³ä½¿ç”¨ç³»ç»Ÿç¼ºçœUserDefault.standardï¼Œå¯ä»¥è‡ªè¡Œè®¾ç½®å­˜å‚¨ä½ç½®ï¼Œä½¿ç”¨çš„å‡ ç‡ä¸é«˜ã€‚</li></ul><h2>å°ç»“</h2><p>è‡³æ­¤ï¼Œæœ¬æ–‡ç®€å•ä»‹ç»äº†SwiftUI2.0æ–°å¢çš„Appå’ŒSceneï¼Œä¸‹ç¯‡æ–‡ç« æˆ‘ä»¬å°†æ¢è®¨åœ¨æ–°çš„å±‚æ¬¡ç»“æ„ä¸‹å¦‚ä½•ç»„ç»‡æˆ‘ä»¬ä»£ç çš„Data Flowã€‚</p><p>å½“å‰çš„@AppBuilderå’Œ@SceneBuilderçš„åŠŸèƒ½éƒ½ååˆ†çš„åŸºç¡€ï¼Œä¸åŒ…å«ä»»ä½•çš„é€»è¾‘åˆ¤æ–­åŠŸèƒ½ï¼Œå› æ­¤ç›®å‰æˆ‘è¿˜æ²¡æœ‰åŠæ³•å®ç°æ ¹æ®æ¡ä»¶æ¥é€‰æ‹©æ€§çš„å±•ç¤ºæ‰€éœ€çš„Sceneã€‚ç›¸ä¿¡è‹¹æœåº”è¯¥ä¼šåœ¨æœªæ¥å¢åŠ è¿™æ ·çš„èƒ½åŠ›</p><p><em>æœ¬æ–‡çš„ä»£ç ä¸ºäº†èƒ½å¤Ÿåœ¨å¤šå¹³å°ä½¿ç”¨ï¼Œæ‰€ä»¥å¢åŠ äº†ä¸å°‘ç¼–è¯‘åˆ¤æ–­ï¼Œå¦‚æœä½ åªæ˜¯åœ¨iOS,æˆ–macOSä¸‹å¼€å‘SwiftUIï¼Œåˆ™å¯æ ¹æ®å„è‡ªå¹³å°ç®€åŒ–ä»£ç ã€‚å¦å¤–Xcode12ä¸­çš„ä»£ç è¡¥å…¨å¯¹äºTargetçš„è®¾å®šå¾ˆæ•æ„Ÿï¼Œå¦‚æœä½ å‘ç°æ— æ³•å¯¹æŸäº›å¹³å°çš„ç‰¹å®šè¯­å¥è¿›è¡Œè¡¥å…¨ï¼Œè¯·æŸ¥çœ‹æ˜¯å¦å°†Schemeè®¾ç½®åˆ°å¯¹åº”çš„å¹³å°ã€‚</em></p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/focusedBinding</guid><title>@FocusedBinding æµ…è°ˆ</title><description>åœ¨è‹¹æœWWDC20ä¸­è§†é¢‘ä¸­å‡ºç°äº†ä¸‹é¢çš„ä»£ç ï¼Œä»‹ç»äº†ä¸€ä¸ªæ–°çš„å±æ€§åŒ…è£…å™¨@FocusedBindingã€‚ç”±äºä»å¤„äºæµ‹è¯•é˜¶æ®µï¼Œå½“å‰çš„ä»£ç å¹¶ä¸èƒ½è¢«æ­£ç¡®çš„æ‰§è¡Œã€‚@FocusedBindingçš„èµ„æ–™è‹¹æœæŠ«éœ²çš„ä¹Ÿå¾ˆå°‘ï¼Œç½‘ä¸Šä¹Ÿæ²¡æœ‰ç›¸å…³çš„ä¿¡æ¯ã€‚å‡ºäºä¸ªäººå…´è¶£ï¼Œæˆ‘å¯¹å®ƒè¿›è¡Œäº†ç®€å•çš„ç ”ç©¶ã€‚å°½ç®¡@FocusedBindingåœ¨ç›®å‰Xcode Version 12.0 beta 2 (12A6163b)çš„ç‰ˆæœ¬ä¸Šè¿è¡Œè¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œä½†æˆ‘åŸºæœ¬ä¸Šå¯¹å…¶æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚</description><link>http://www.fatbobman.com/posts/focusedBinding</link><pubDate>Sun, 5 Jul 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>åœ¨è‹¹æœWWDC20ä¸­è§†é¢‘ä¸­å‡ºç°äº†ä¸‹é¢çš„ä»£ç ï¼Œä»‹ç»äº†ä¸€ä¸ªæ–°çš„å±æ€§åŒ…è£…å™¨@FocusedBindingã€‚ç”±äºä»å¤„äºæµ‹è¯•é˜¶æ®µï¼Œå½“å‰çš„ä»£ç å¹¶ä¸èƒ½è¢«æ­£ç¡®çš„æ‰§è¡Œã€‚@FocusedBindingçš„èµ„æ–™è‹¹æœæŠ«éœ²çš„ä¹Ÿå¾ˆå°‘ï¼Œç½‘ä¸Šä¹Ÿæ²¡æœ‰ç›¸å…³çš„ä¿¡æ¯ã€‚å‡ºäºä¸ªäººå…´è¶£ï¼Œæˆ‘å¯¹å®ƒè¿›è¡Œäº†ç®€å•çš„ç ”ç©¶ã€‚å°½ç®¡@FocusedBindingåœ¨ç›®å‰Xcode Version 12.0 beta 2 (12A6163b)çš„ç‰ˆæœ¬ä¸Šè¿è¡Œè¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œä½†æˆ‘åŸºæœ¬ä¸Šå¯¹å…¶æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚</p></blockquote><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">BookCommands</span>: <span class="hljs-title">Commands</span> </span>{
 @<span class="hljs-type">FocusedBinding</span>(\.selectedBook) <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> selectedBook: <span class="hljs-type">Book?</span>
  <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Commands</span> {
    <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"Book"</span>) {
        <span class="hljs-type">Section</span> {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"Update Progress..."</span>, action: updateProgress)
                .keyboardShortcut(<span class="hljs-string">"u"</span>)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"Mark Completed"</span>, action: markCompleted)
                .keyboardShortcut(<span class="hljs-string">"C"</span>)
        }
        .disabled(selectedBook == <span class="hljs-literal">nil</span>)
    }
  }

   <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateProgress</span><span class="hljs-params">()</span></span> {
       selectedBook?.updateProgress()
   }
   <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">markCompleted</span><span class="hljs-params">()</span></span> {
       selectedBook?.markCompleted()
   }
}
</code></pre><h2>ç”¨é€”</h2><p><strong>åœ¨ä»»æ„è§†å›¾ï¼ˆViewï¼‰ä¹‹é—´æ•°æ®å…±äº«ã€ä¿®æ”¹ã€ç»‘å®šæ“ä½œã€‚</strong></p><p>åœ¨SwiftUI1.0ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨EnvironmentKeyå‘å­è§†å›¾ä¼ é€’æ•°æ®ï¼Œä½¿ç”¨PreferenceKeyå‘çˆ¶è§†å›¾ä¼ é€’æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨ä¸åœ¨åŒä¸€è§†å›¾æ ‘ä¸Šçš„ä¸¤ä¸ªå¹³è¡Œè§†å›¾é—´è¿›è¡Œæ•°æ®ä¼ é€’çš„è¯ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨Single of truthæˆ–è€…é€šè¿‡NotificationCenteræ¥è¿›è¡Œã€‚</p><p>åœ¨SwiftUI2.0ä¸­ï¼Œè‹¹æœå¼•å…¥äº†@FocusedBindingå’Œ@FocusedValueæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é€šè¿‡å®šä¹‰FocusedValueKeyï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„çš„è§†å›¾ä¹‹é—´ï¼Œæ— éœ€é€šè¿‡Single of truthï¼Œä¾¿å¯ä»¥ç›´æ¥è¿›è¡Œæ•°æ®å…±äº«ã€ä¿®æ”¹ã€ç»‘å®šã€‚</p><p>åœ¨<a href="https://zhuanlan.zhihu.com/p/152127847">SwiftUI2.0 â€”â€” Commandsï¼ˆmacOSèœå•ï¼‰</a>è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡äº†Single of truthçš„æ–¹å¼ï¼Œåœ¨Appè¿™ä¸ªå±‚çº§ï¼Œä½¿Commnadså¯ä»¥åŒå…¶ä»–è§†å›¾è¿›è¡Œæ•°æ®å…±äº«ã€‚é€šè¿‡WWDCæä¾›çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè‹¹æœå¸Œæœ›èƒ½å¤Ÿæä¾›ä¸€ç§å…¶ä»–çš„è§£å†³æ–¹æ¡ˆï¼Œå®Œæˆä¸Šè¿°çš„åŠŸèƒ½ã€‚åŒæ ·ï¼Œè¿™ç§æ–¹æ¡ˆä¹Ÿä½¿æˆ‘ä»¬æ‹¥æœ‰äº†å¯ä»¥åœ¨ä»»æ„è§†å›¾ï¼ˆæ— è®ºæ˜¯å¦åœ¨åŒä¸€é¢—æ ‘ä¸Šï¼Œæ˜¯å¦æœ‰è”ç³»ï¼‰ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</p><h2>ä½¿ç”¨æ–¹æ³•</h2><p>å…¶åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼å’ŒEnvironmentå¾ˆç±»ä¼¼ï¼Œéƒ½éœ€è¦é¦–å…ˆå®šä¹‰æŒ‡å®šçš„Key</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FocusedMessageKey</span>:<span class="hljs-title">FocusedValueKey</span></span>{
    <span class="hljs-comment">//åŒEnvironmentKeyä¸åŒï¼ŒFocusedValueKeyæ²¡æœ‰ç¼ºçœå€¼ï¼Œä¸”å¿…é¡»æ˜¯ä¸€ä¸ªå¯é€‰å€¼ã€‚ä¸ºäº†ä¸‹é¢çš„æ¼”ç¤ºï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†æ•°æ®ç±»å‹è®¾ç½®ä¸ºBinding&lt;String&gt;,å¯ä»¥è®¾ç½®ä¸ºä»»æ„å€¼ç±»å‹æ•°æ®</span>
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">Value</span> = <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">String</span>&gt;
}

<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">FocusedValues</span></span>{
    
    <span class="hljs-keyword">var</span> message:<span class="hljs-type">Binding</span>&lt;<span class="hljs-type">String</span>&gt;?{
        <span class="hljs-keyword">get</span>{<span class="hljs-keyword">self</span>[<span class="hljs-type">FocusedMessageKey</span>.<span class="hljs-keyword">self</span>]}
        <span class="hljs-keyword">set</span>{<span class="hljs-keyword">self</span>[<span class="hljs-type">FocusedMessageKey</span>.<span class="hljs-keyword">self</span>] = newValue}
    }
}
</code></pre><p>ç”±äºå¯ä»¥ä½¿ç”¨åœ¨ä»»æ„è§†å›¾ï¼Œæ‰€ä»¥æ•°æ®æ— éœ€æ³¨å…¥ã€‚å’ŒEnvironmentKeyä¸åŒï¼ˆåªåœ¨å½“å‰æ³¨å…¥çš„è§†å›¾æ ‘ä¹‹ä¸‹æœ‰æ•ˆï¼‰ï¼Œæ•°æ®åœ¨å…¨åŸŸæœ‰æ•ˆã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ShowView</span>:<span class="hljs-title">View</span></span>{
    <span class="hljs-comment">//è°ƒç”¨æ–¹å¼åŒ@Environmentå‡ ä¹ä¸€è‡´,ä½¿ç”¨@FocusedValueæˆ–@FocusedBindingéœ€ä¸åŒçš„å¼•ç”¨æ–¹å¼</span>
    @<span class="hljs-type">FocusedValue</span>(\.message) <span class="hljs-keyword">var</span> focusedMessage
    <span class="hljs-comment">//@FocusedBinding(\.message) var focusedMessage1</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">VStack</span>{
        <span class="hljs-type">Text</span>(<span class="hljs-string">"focused:\(focusedMessage?.wrappedValue ?? "</span><span class="hljs-string">")"</span>)
        <span class="hljs-comment">//Text("focused:\(focusedMessage1 ?? "")")</span>
        }
    }
}
</code></pre><p>åœ¨å¦ä¸€è§†å›¾å¯¹è¯¥FocusedValueKeyæ•°æ®è¿›è¡Œä¿®æ”¹ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">InputView1</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> text = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">VStack</span>{
        <span class="hljs-type">TextField</span>(<span class="hljs-string">"input1:"</span>,text:$text)
            .textFieldStyle(<span class="hljs-type">RoundedBorderTextFieldStyle</span>())
            <span class="hljs-comment">//ä½¿messageå’ŒtextåŒæ­¥</span>
            .focusedValue(\.message, $text)
        }
    }
}
</code></pre><p>å¯ä»¥åœ¨å¤šä¸ªè§†å›¾å¯¹åŒä¸€FocusedValueKeyè¿›è¡Œä¿®æ”¹</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">InputView2</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> text = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
        <span class="hljs-type">TextField</span>(<span class="hljs-string">"input2:"</span>,text:$text)
            .textFieldStyle(<span class="hljs-type">RoundedBorderTextFieldStyle</span>())
            .focusedValue(\.message, $text)
    }
}
</code></pre><p>æœ€åç»„è£…åœ¨ä¸€èµ·</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RootView</span>: <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>{
            <span class="hljs-comment">//ä¸‰ä¸ªè§†å›¾æ˜¯å¹³è¡Œå…³ç³»ï¼Œåœ¨ä¹‹å‰ä½¿ç”¨Environmentæˆ–è€…Preferenceéƒ½æ— æ³•åœ¨è¿™ä¸‰ä¸ªè§†å›¾é—´è¿›è¡Œæ•°æ®ä¼ é€’ã€å…±äº«</span>
            <span class="hljs-type">InputView1</span>()
            <span class="hljs-type">InputView2</span>()
            <span class="hljs-type">ShowView</span>()
        }
        .padding(.all, <span class="hljs-number">20</span>)
        .frame(maxWidth:.infinity, maxHeight: .infinity)
    }
}
</code></pre><video src="http://cdn.fatbobman.com/focusebinding-video.mov" controls="controls">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ’­æ”¾è¯¥è§†é¢‘ï¼</video><p>ç›®å‰åœ¨iOSä¸‹æ— æ³•è·å–FocusedValueKeyæ•°å€¼ï¼Œæ–‡æ¡£ä¸­æ ‡è¯†æ˜¯æ”¯æŒiOSçš„ï¼Œåº”è¯¥åœ¨æœªæ¥ä¼šè§£å†³</p><h2>å¦‚ä½•ç”¨ï¼Œæ€ä¹ˆç”¨ï¼Ÿ</h2><p>FoccusedBindingçš„å¼•å…¥ï¼Œè¿›ä¸€æ­¥å®Œå–„äº†SwiftUIä¸åŒè§†å›¾ä¸­æ•°æ®æ“ä½œçš„åŠŸèƒ½ã€‚ä¸è¿‡ä¸ªäººå»ºè®®è¿˜æ˜¯ä¸è¦æ»¥ç”¨æ­¤åŠŸèƒ½ã€‚</p><p>ç”±äºæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„è§†å›¾ä¸­ä¿®æ”¹keyä¸­çš„å€¼ï¼Œä¸€æ—¦æ»¥ç”¨ï¼Œå¾ˆå¯èƒ½å†åº¦é™·å…¥ä»£ç éš¾ä»¥ç®¡ç†çš„çª˜å¢ƒã€‚</p><p>å¯¹äºä¸€äº›åŠŸèƒ½å¾ˆç®€å•ï¼Œæ— éœ€ä½¿ç”¨MVVMé€»è¾‘çš„ä»£ç ï¼Œæˆ–è€…Single of truthè¿‡äºè‡ƒè‚¿ï¼ˆ<a href="http://www.fatbobman.com/posts/observableObject-study/">ObservableObjectç ”ç©¶â€”â€”æƒ³è¯´çˆ±ä½ ä¸å®¹æ˜“</a>ï¼‰ï¼Œå¯èƒ½å¯¼è‡´appå“åº”é—®é¢˜çš„ä»£ç ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸Šè¿°çš„æ–¹æ¡ˆã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftUI2-commands</guid><title>SwiftUI2.0 â€”â€” Commandsï¼ˆmacOSèœå•ï¼‰</title><description>æœ¬æ–‡ä»‹ç»äº†SwiftUI 2.0ä¸­ï¼Œå¦‚ä½•ä¸ºmacOSå¹³å°æ·»åŠ èœå•ã€‚è‹¹æœåœ¨SwiftUI2.0ä¸­å¢åŠ äº†Multiplatformé¡¹ç›®æ¨¡æ¿ï¼Œä½¿å¾—åŒä¸€å¥—ä»£ç ï¼Œä»…éœ€å°‘é‡çš„é€‚é…ä¾¿å¯ä»¥åŒæ—¶æ»¡è¶³iOSä»¥åŠmacOSçš„éœ€è¦ã€‚å¯¹äºmacOSä¸Šè¿è¡Œçš„app,æ‹¥æœ‰è‡ªå®šä¹‰çš„èœå•æ˜¯ä¸€ä¸ªååˆ†é‡è¦çš„å¹³å°ç‰¹å¾ã€‚å¯¹äºæ²¡æœ‰macOSå¼€å‘ç»éªŒçš„æˆ‘æ¥è¯´ï¼Œå­¦ä¹ å¦‚ä½•è®¾è®¡å¼€å‘èœå•å˜å¾—ååˆ†æœ‰è¶£ä¸”å¿…è¦ã€‚</description><link>http://www.fatbobman.com/posts/swiftUI2-commands</link><pubDate>Sat, 27 Jun 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>æœ¬æ–‡ä»‹ç»äº†SwiftUI 2.0ä¸­ï¼Œå¦‚ä½•ä¸ºmacOSå¹³å°æ·»åŠ èœå•ã€‚ å½“å‰è¿è¡Œç¯å¢ƒä¸º Xcode Version 12.0 beta (12A6159), macOS Big Sur 11.0 Betaç‰ˆ(20A4299v)ã€‚</p></blockquote><p>è‹¹æœåœ¨SwiftUI2.0ä¸­å¢åŠ äº†Multiplatformé¡¹ç›®æ¨¡æ¿ï¼Œä½¿å¾—åŒä¸€å¥—ä»£ç ï¼Œä»…éœ€å°‘é‡çš„é€‚é…ä¾¿å¯ä»¥åŒæ—¶æ»¡è¶³iOSä»¥åŠmacOSçš„éœ€è¦ã€‚å¯¹äºmacOSä¸Šè¿è¡Œçš„app,æ‹¥æœ‰è‡ªå®šä¹‰çš„èœå•æ˜¯ä¸€ä¸ªååˆ†é‡è¦çš„å¹³å°ç‰¹å¾ã€‚å¯¹äºæ²¡æœ‰macOSå¼€å‘ç»éªŒçš„æˆ‘æ¥è¯´ï¼Œå­¦ä¹ å¦‚ä½•è®¾è®¡å¼€å‘èœå•å˜å¾—ååˆ†æœ‰è¶£ä¸”å¿…è¦ã€‚</p><h2>åŸºç¡€</h2><p>åœ¨SwiftUIä¸‹ä¸ºappæ·»åŠ èœå•ååˆ†æ–¹ä¾¿ï¼Œä¸‹é¢çš„ä»£ç ä¾¿å¯ä»¥ä¸ºappæ·»åŠ ä¸€ä¸ªæœ€åŸºç¡€çš„èœå•ã€‚</p><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CommandExampleApp</span>: <span class="hljs-title">App</span> </span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
           <span class="hljs-type">ContentView</span>()
        }
        .commands{
           <span class="hljs-type">Menu</span>()
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Menu</span>:<span class="hljs-title">Commands</span></span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Commands</span>{
        <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"My Menu"</span>){
            <span class="hljs-type">Button</span>(<span class="hljs-string">"menu1"</span>){
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"menu1"</span>)
            }
        }
    }
}
</code></pre><p>é€šè¿‡åˆ›å»ºä¸€ä¸ªç¬¦åˆCommandsåè®®çš„ç»“æ„æ¥æè¿°ä½ è¦åœ¨appä¸­æ·»åŠ çš„è‡ªå®šä¹‰èœå•é¡¹</p><img src="http://cdn.fatbobman.com/swiftui2-commands-test1.png" alt="test1"/><h2>å‡ ä¸ªæ¦‚å¿µ</h2><ul><li>@CommandBuilder</li></ul><p>SwiftUI2.0ä¸­ï¼Œè‹¹æœä¸ºæˆ‘æ¥å¸¦æ¥äº†å¾ˆå¤šæ–°çš„function builderã€‚Menuä¸­çš„bodyï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª@CommandsBuilderã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å†…ç½®çš„è¯­å¥é€šè¿‡DSLçš„æ–¹å¼ï¼Œæ–¹ä¾¿çš„å®šä¹‰è‡ªå·±æ‰€éœ€çš„èœå•ã€‚DSLçš„å¥½å¤„æ˜¯ç®€å•æ˜äº†ï¼Œä¸è¿‡åŠŸèƒ½ä¹Ÿæœ‰æ‰€é™å®šï¼Œç›®å‰@CommandsBuilderæ”¯æŒçš„æ–¹æ³•æ¯”è¾ƒå°‘ï¼Œå¹¶ä¸æ”¯æŒé€»è¾‘åˆ¤æ–­ã€‚</p><pre data-language="swift"><code>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyCommand</span>:<span class="hljs-title">Commands</span></span>{
      <span class="hljs-comment">//å¦‚æœéœ€è¦å¤šä¸ªèœå•åˆ—ï¼Œéœ€åœ¨bodyå‰æ˜¾å¼æ³¨æ˜@CommandsBuilderï¼Œæˆ–è€…ä½¿ç”¨Groupï¼Œè¿™ä¸€æ–¹æ³•ï¼ŒåŒæ ·ä½¿ç”¨ä¸å…¶ä»–functionBuilderçš„æè¿°ã€‚</span>
      @<span class="hljs-type">CommandsBuilder</span> <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Commands</span>{
          <span class="hljs-comment">//æ¯ä¸ªCommandMenuéƒ½æ˜¯ä¸€ä¸ªèœå•åˆ—</span>
          <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"Menu1"</span>){
              <span class="hljs-type">Button</span>(<span class="hljs-string">"Test1"</span>){
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"test2"</span>)
              }
                <span class="hljs-type">Button</span>(<span class="hljs-string">"Test2"</span>){
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"test2"</span>)
              }
          }
          
          <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"Menu2"</span>){
              <span class="hljs-type">Button</span>(action: test1{
                  <span class="hljs-type">Text</span>(<span class="hljs-string">"ğŸ˜ƒButton"</span>)
              }
          }
      }
      
      <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>{
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"test command"</span>)
      }
  
  }
  
</code></pre><ul><li>CommandMenu</li></ul><p>CommandMenuæ˜¯ä¸€ä¸ªèœå•åˆ—ï¼Œåœ¨åŒä¸€ä¸ªCommandMenuä¸­ï¼Œä½ å¯ä»¥å®šä¹‰å¤šä¸ªButtonã€‚CommandMenuä¸­çš„Contentæ˜¯ç¬¦åˆViewåè®®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒViewä¸­ä¸å°‘æ‰‹æ®µã€æ§ä»¶éƒ½å¯ä»¥è¢«ç”¨æ¥æè¿°èœå•çš„å…·ä½“å‘ˆç°ã€‚æˆ‘ä»¬å¯ä»¥åƒç¼–å†™Viewä¸€æ ·æ¥ç¼–å†™èœå•ï¼ˆæ¯”å¦‚è®¾ç½®å­—ä½“ã€é¢œè‰²ã€å¾ªç¯ã€åˆ¤æ–­ç­‰ç­‰ï¼‰ã€‚</p><pre data-language="swift"><code>  <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"Menu"</span>){
    <span class="hljs-type">Button</span>(<span class="hljs-string">"test1"</span>){}
    <span class="hljs-type">Divider</span>()
    <span class="hljs-type">Button</span>(action:{}){<span class="hljs-type">Text</span>(<span class="hljs-string">"test2"</span>).foregroundColor(.red)}
  }
</code></pre><ul><li>Button</li></ul><p>èœå•ä¸­å•ä¸ªé€‰é¡¹çš„å®ç°æ–¹æ³•ã€‚</p><pre data-language="swift"><code>    <span class="hljs-type">Button</span>(action: {}){
      <span class="hljs-type">HStack</span>{
          <span class="hljs-type">Text</span>(<span class="hljs-string">"ğŸ±"</span>).foregroundColor(.blue)
          <span class="hljs-type">Divider</span>().padding(.leading,<span class="hljs-number">10</span>)
          <span class="hljs-type">Text</span>(<span class="hljs-string">"Button"</span>)
      }
      }
</code></pre><ul><li>MenuButton</li></ul><p>å­èœå•çš„å®ç°æ–¹æ³•ã€‚</p><pre data-language="swift"><code>  <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"Test"</span>){
             <span class="hljs-type">Button</span>(action:{test1()}){
                  <span class="hljs-type">Text</span>(<span class="hljs-string">"test1"</span>).foregroundColor(.black)
             }
              
              #<span class="hljs-keyword">if</span> os(macOS)
              <span class="hljs-type">MenuButton</span>(<span class="hljs-string">"Switch Selection"</span>){
                  <span class="hljs-type">Button</span>(<span class="hljs-string">"one"</span>){
                      store.changeState(.one)
                  }
                  <span class="hljs-type">Button</span>(<span class="hljs-string">"two"</span>){
                      store.changeState(.two)
                  }
                  <span class="hljs-type">Button</span>(<span class="hljs-string">"three"</span>){
                      store.changeState(.three)
                  }
              }
              #endif
          }
</code></pre><ul><li>.commands</li></ul><p>Sceneçš„æ–¹æ³•ï¼Œä¸ºåœºæ™¯æ·»åŠ èœå•ã€‚commandsä¸­å…è®¸æ·»åŠ å¤šä¸ªç¬¦åˆCommandsåè®®çš„èœå•å®šä¹‰ã€‚æ‰€æœ‰å®šä¹‰çš„èœå•éƒ½ä¼šä¸€å¹¶æ˜¾ç¤ºã€‚</p><pre data-language="swift"><code>          <span class="hljs-type">WindowGroup</span> {
              <span class="hljs-type">RootView</span>()
                  .environmentObject(store)
          }
          .commands{
              <span class="hljs-type">OtherMenu</span>()
              <span class="hljs-type">Menu</span>()
          }
</code></pre><ul><li>keyboardShortcut</li></ul><p>ä¸ºèœå•ä¸Šçš„é€‰é¡¹æ·»åŠ å¿«æ·é”®ã€‚é€šè¿‡modifiersè®¾ç½®éœ€è¦é…åˆçš„æŒ‰é”®ï¼Œ.helpä¸ºé€‰é¡¹æ·»åŠ æ‚¬åœå¸®åŠ©</p><pre data-language="swift"><code>  <span class="hljs-type">Button</span>(action:{test1()})
         {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"test1"</span>).foregroundColor(.black)
          }
           .keyboardShortcut(<span class="hljs-string">"1"</span>, modifiers: [.command,.shift])
           .help(<span class="hljs-string">"help test1"</span>)
                  
  <span class="hljs-type">Button</span>(<span class="hljs-string">"test2"</span>, action: test2)
           .keyboardShortcut(<span class="hljs-string">"2"</span>, modifiers: .command)
</code></pre><ul><li>CommandGroup</li></ul><p>åœ¨ç³»ç»Ÿæä¾›çš„é»˜è®¤èœå•é€‰é¡¹ä¸Šæ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ã€‚é€šè¿‡replacing,before,afteræ¥å†³å®šæ˜¯æ›¿æ¢åŸé€‰é¡¹è¿˜æ˜¯è®¾ç½®åœ¨æŒ‡å®šé€‰é¡¹ä½ç½®ä¹‹åæˆ–ä¹‹å‰ã€‚</p><pre data-language="swift"><code>  <span class="hljs-comment">//åœ¨ç³»ç»Ÿé¢„ç½®çš„å¸®åŠ©èœå•æ ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªè‡ªå·±çš„é€‰é¡¹</span>
  <span class="hljs-type">CommandGroup</span>(replacing: <span class="hljs-type">CommandGroupPlacement</span>.appInfo, addition: {<span class="hljs-type">Button</span>(<span class="hljs-string">"replace"</span>){}})
  <span class="hljs-type">CommandGroup</span>(before: <span class="hljs-type">CommandGroupPlacement</span>.help, addition: {<span class="hljs-type">Button</span>(<span class="hljs-string">"before"</span>){}})
  <span class="hljs-type">CommandGroup</span>(after: <span class="hljs-type">CommandGroupPlacement</span>.newItem, addition: {<span class="hljs-type">Button</span>(<span class="hljs-string">"after"</span>){}})
</code></pre><h2>ä¾‹å­</h2><p>è¿™é‡Œç®€å•çš„ä¾‹ç¨‹å±•ç¤ºäº†å¦‚ä½•åœ¨menuå¦‚ä½•é€šè¿‡è°ƒç”¨storeæ¥å½±å“appçš„è¡Œä¸ºã€‚å¹¶åšäº†ç®€å•çš„å¤šå¹³å°é€‚é…ã€‚åœ¨macOSå¹³å°ä¸‹ï¼Œé€šè¿‡é€‰æ‹©å­èœå•ä¸­ä¸åŒçš„é€‰é¡¹æ¥å½±å“æ˜¾ç¤ºæ–‡æœ¬ã€‚åœ¨iOSä¸‹é€šè¿‡pickeræ¥å®ç°ã€‚</p><p><a href="https://github.com/fatbobman/CommandExample">å¯åœ¨æ­¤å¤„ä¸‹è½½å®Œæˆä»£ç </a></p><pre data-language="swift"><code>@main
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CommandExampleApp</span>: <span class="hljs-title">App</span> </span>{
    @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">Store</span>()
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
            <span class="hljs-type">RootView</span>()
                .environmentObject(store)
        }
        .commands{
          #<span class="hljs-keyword">if</span> os(macOS) 
            <span class="hljs-type">MyCommand</span>(store: store)
            <span class="hljs-type">OtherMenu</span>()
          #endif
        }
    }
}

#<span class="hljs-keyword">if</span> os(macOS)
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyCommand</span>:<span class="hljs-title">Commands</span></span>{
    @<span class="hljs-type">ObservedObject</span> <span class="hljs-keyword">var</span> store:<span class="hljs-type">Store</span>
    @<span class="hljs-type">CommandsBuilder</span> <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Commands</span>{
        <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"Test"</span>){
            <span class="hljs-type">Section</span>{
                <span class="hljs-type">Button</span>(action:{test1()}){
                    <span class="hljs-type">Text</span>(<span class="hljs-string">"test1"</span>).foregroundColor(.black)
                }
                .keyboardShortcut(<span class="hljs-string">"1"</span>, modifiers: [.command,.shift])
                .help(<span class="hljs-string">"help test1"</span>)
                
                <span class="hljs-type">Button</span>(<span class="hljs-string">"test2"</span>, action: test2)
                    .keyboardShortcut(<span class="hljs-string">"2"</span>, modifiers: .command)
            }
            
            <span class="hljs-keyword">switch</span> store.selection{
            <span class="hljs-keyword">case</span> .one:
                <span class="hljs-type">Text</span>(<span class="hljs-string">"one"</span>)
            <span class="hljs-keyword">case</span> .two:
                <span class="hljs-type">Text</span>(<span class="hljs-string">"two"</span>)
            <span class="hljs-keyword">case</span> .three:
                <span class="hljs-type">Text</span>(<span class="hljs-string">"three"</span>)
            }
            
            <span class="hljs-type">Divider</span>().padding(.horizontal, <span class="hljs-number">10</span>)
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"other"</span>){
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"other command"</span>)
            }
            
            
            <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>..&lt;<span class="hljs-number">3</span>){ i <span class="hljs-keyword">in</span>
                <span class="hljs-type">Button</span>(<span class="hljs-string">"button\(i)"</span>){
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"button\(i)"</span>)
                }
            }
            
            <span class="hljs-type">MenuButton</span>(<span class="hljs-string">"Switch Selection"</span>){
                <span class="hljs-type">Button</span>(<span class="hljs-string">"one"</span>){
                    store.changeState(.one)
                }
                <span class="hljs-type">Button</span>(<span class="hljs-string">"two"</span>){
                    store.changeState(.two)
                }
                <span class="hljs-type">Button</span>(<span class="hljs-string">"three"</span>){
                    store.changeState(.three)
                }
            }
        }
        
        <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"Menu2"</span>){
            <span class="hljs-type">Button</span>(action: {}){
                <span class="hljs-type">Text</span>(<span class="hljs-string">"ğŸ˜ƒButton"</span>)
            }
        }
        
        <span class="hljs-comment">//å‘ç°æœ‰çš„èœå•é¡¹ä¸­å¢åŠ åŠŸèƒ½</span>
        <span class="hljs-type">CommandGroup</span>(after: <span class="hljs-type">CommandGroupPlacement</span>.help, addition: {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"new help button"</span>){
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"new help"</span>)
            }
        })
        

    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>{
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"test1 command"</span>)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span></span>{
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"test2 command"</span>)
    }
}
#endif

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">OtherMenu</span>:<span class="hljs-title">Commands</span></span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">Commands</span>{
        <span class="hljs-type">CommandMenu</span>(<span class="hljs-string">"otherMenu"</span>){
            <span class="hljs-type">Button</span>(<span class="hljs-string">"abc"</span>){
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"abc"</span>)
            }
        }
    }
}


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span>:<span class="hljs-title">ObservableObject</span></span>{
    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Selection</span></span>{
        <span class="hljs-keyword">case</span> one,two,three
    }
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> selection:<span class="hljs-type">Selection</span> = .one
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">changeState</span><span class="hljs-params">(<span class="hljs-number">_</span> selection:Selection)</span></span>{
        <span class="hljs-keyword">self</span>.selection = selection
    }
}
</code></pre><h2>è¡¥å……ï¼ˆæ‰“å¼€æ–°çª—å£ï¼‰</h2><p>æˆ‘å°è¯•åœ¨èœå•æŒ‰é’®ä¸­æ‰“å¼€æ–°çš„Viewï¼Œä¸è¿‡å¹¶æ²¡æœ‰æ‰¾åˆ°åŸç”Ÿçš„SwiftUIå¼çš„æ–¹æ³•ã€‚æˆ‘æ›´å¸Œæœ›@SceneBuilderèƒ½å¤Ÿæ”¯æŒé€»è¾‘åˆ¤æ–­ï¼Œè¿™æ ·å¯ä»¥ä»»æ„åœ¨WindowGroupç»„ç»‡æˆ‘æƒ³æ˜¾ç¤ºçš„Viewäº†ã€‚</p><pre data-language="swift"><code><span class="hljs-comment">//æ‰“å¼€æ–°çš„View</span>
<span class="hljs-type">Button</span>(<span class="hljs-string">"other window"</span>){
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"other command"</span>)
    <span class="hljs-keyword">let</span> contentView =
        <span class="hljs-type">VStack</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"New Window"</span>).padding(.all, <span class="hljs-number">10</span>)
        }.frame(minWidth: <span class="hljs-number">200</span>, minHeight: <span class="hljs-number">200</span>, alignment: .center)
    

    <span class="hljs-keyword">var</span> window: <span class="hljs-type">NSWindow!</span>
    <span class="hljs-comment">// Create the window and set the content view.</span>
    window = <span class="hljs-type">NSWindow</span>(
        contentRect: <span class="hljs-type">NSRect</span>(x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>, width: <span class="hljs-number">480</span>, height: <span class="hljs-number">300</span>),
        styleMask: [.titled, .closable, .miniaturizable, .resizable, .fullSizeContentView],
        backing: .buffered, <span class="hljs-keyword">defer</span>: <span class="hljs-literal">false</span>)
    window.isReleasedWhenClosed = <span class="hljs-literal">false</span>
    window.center()
    window.setFrameAutosaveName(<span class="hljs-string">"Main Window"</span>)
    window.contentView = <span class="hljs-type">NSHostingView</span>(rootView: contentView)
    window.makeKeyAndOrderFront(<span class="hljs-literal">nil</span>)
}

<span class="hljs-comment">//æ‰“å¼€ç³»ç»Ÿæ–‡ä»¶é€‰æ‹©é¢æ¿</span>
<span class="hljs-type">Button</span>(<span class="hljs-string">"open panel"</span>){
    <span class="hljs-keyword">let</span> panel = <span class="hljs-type">NSOpenPanel</span>()
          panel.nameFieldLabel = <span class="hljs-string">"open test:"</span>
          panel.begin { response <span class="hljs-keyword">in</span>
              <span class="hljs-keyword">if</span> response == <span class="hljs-type">NSApplication</span>.<span class="hljs-type">ModalResponse</span>.<span class="hljs-type">OK</span>, <span class="hljs-keyword">let</span> fileUrl = panel.url {
                  <span class="hljs-built_in">print</span>(fileUrl)
              }
          }
}
</code></pre><h2>å½“å‰çš„é—®é¢˜</h2><p>ç”±äºç›®å‰è¿˜å¤„åœ¨æ—©æœŸçš„æµ‹è¯•é˜¶æ®µï¼Œèœå•çš„å®ç°å’ŒåŠŸèƒ½ä¸Šè¿˜æœ‰äº›ä¸è¶³ä¹‹å¤„ï¼Œä»¥ä¸‹æ˜¯æˆ‘ç°åœ¨æ¯”è¾ƒåœ¨æ„çš„ï¼š</p><ul><li>Buttonæ–‡æœ¬çš„ç¼ºçœé¢œè‰²å’Œç³»ç»Ÿçš„èœå•é€‰é¡¹é¢œè‰²ä¸åŒã€‚éœ€è¦æ‰‹å·¥è®¾ç½®</li><li>ShortCutçš„é¢œè‰²å’Œç³»ç»Ÿèœå•çš„é¢œè‰²ä¸åŒ</li><li>Dividerçš„é¢œè‰²å’Œç³»ç»Ÿèœå•ä¸åŒ</li><li>MenuButtonåœ¨å¤šå¹³å°å¼€å‘æ—¶ï¼Œå¿…é¡»æ·»åŠ ç¼–è¯‘æ³¨é‡Šã€‚è€Œå…¶ä»–æ¯”å¦‚åˆ›å»ºCommandsï¼Œ.commandsç­‰éƒ½ä¸éœ€è¦</li><li>@CommandBuilderå’Œ@SceneBuilderç›®å‰éƒ½ä¸æ”¯æŒåˆ¤æ–­ã€‚å› æ­¤æ— æ³•é€šè¿‡ç¨‹åºåŠ¨æ€çš„æ·»åŠ æˆ–å‡å°‘ä¸€ä¸ªèœå•åˆ—ã€‚ä¸è¿‡ä».commandä¸­å¯ä»¥æ·»åŠ å¤šä¸ªCommandsç»“æ„æ¥çœ‹ï¼Œåç»­åº”è¯¥æ˜¯æœ‰è¿™æ ·çš„æ‰“ç®—çš„ã€‚</li></ul>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/stateobject</guid><title>SwiftUI 2.0 â€”â€” @StateObject ç ”ç©¶</title><description>WWDC20åˆšåˆšç»“æŸï¼Œåœ¨è¿‡å»çš„ä¸€å‘¨ï¼Œè‹¹æœä¸ºå¼€å‘è€…å¸¦æ¥äº†å·¨å¤§çš„æƒŠå–œã€‚ç”±äºæ–°ç‰¹æ€§å®åœ¨å¤ªå¤šï¼Œéœ€è¦ä¸å°‘æ—¶é—´æ¥æ¶ˆåŒ–ï¼Œæˆ‘é¦–å…ˆé€‰æ‹©è‡ªå·±æœ€æ„Ÿå…´è¶£çš„å†…å®¹è¿›è¡Œä¸€äº›ç®€å•çš„ç ”ç©¶å’Œæ¢è®¨ã€‚æœ¬æ–‡é¦–å…ˆæµ…è°ˆä¸€ä¸‹SwiftUIæ–°æä¾›çš„å±æ€§åŒ…è£…å™¨@StateObjectã€‚</description><link>http://www.fatbobman.com/posts/stateobject</link><pubDate>Fri, 26 Jun 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>WWDC20åˆšåˆšç»“æŸï¼Œåœ¨è¿‡å»çš„ä¸€å‘¨ï¼Œè‹¹æœä¸ºå¼€å‘è€…å¸¦æ¥äº†å·¨å¤§çš„æƒŠå–œã€‚ç”±äºæ–°ç‰¹æ€§å®åœ¨å¤ªå¤šï¼Œéœ€è¦ä¸å°‘æ—¶é—´æ¥æ¶ˆåŒ–ï¼Œæˆ‘é¦–å…ˆé€‰æ‹©è‡ªå·±æœ€æ„Ÿå…´è¶£çš„å†…å®¹è¿›è¡Œä¸€äº›ç®€å•çš„ç ”ç©¶å’Œæ¢è®¨ã€‚æœ¬æ–‡é¦–å…ˆæµ…è°ˆä¸€ä¸‹SwiftUIæ–°æä¾›çš„å±æ€§åŒ…è£…å™¨@StateObjectã€‚</p></blockquote><h2>ä¸ºä»€ä¹ˆè¦æ–°å¢@StateObject</h2><p>åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« <a href="https://zhuanlan.zhihu.com/p/141229504">@Stateç ”ç©¶</a>ä¸­æˆ‘ä»¬æ¢è®¨è¿‡@Stateï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„å°†å€¼ç±»å‹æ•°æ®ä½œä¸ºViewçš„Source of truthã€‚åœ¨SwiftUI 1.0æ—¶ä»£ï¼Œå¦‚æœæƒ³å°†å¼•ç”¨ç±»å‹ä½œä¸ºsource of truth,é€šå¸¸çš„æ–¹æ³•æ˜¯ä½¿ç”¨@EnvironmentObjectæˆ–è€… @ObservedObjectã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RootView</span>:<span class="hljs-title">View</span></span>{
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">ContentView</span>()
            .environmentObject(<span class="hljs-type">Store</span>())
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">EnvironmentObject</span>  <span class="hljs-keyword">var</span> store1:<span class="hljs-type">Store</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">Text</span>(<span class="hljs-string">"count:\(store.count)"</span>)
    }
}
</code></pre><p>å¯¹äºä½¿ç”¨@EnvironmentObjectæ³¨å…¥çš„æ•°æ®ï¼Œç”±äºå…¶é€šå¸¸æ˜¯åœ¨SceneDelegateæˆ–ç€å½“å‰Viewçš„çˆ¶è¾ˆã€ç¥–å…ˆViewä¸Šåˆ›å»ºçš„ï¼Œæ‰€ä»¥å…¶ç”Ÿå‘½å‘¨æœŸå¿…ç„¶ä¸çŸ­äºå½“å‰View,å› æ­¤åœ¨ä½¿ç”¨ä¸­å¹¶ä¸ä¼šå‘ç”Ÿç”±äºç”Ÿå‘½å‘¨æœŸä¸å¯é¢„æµ‹è€Œå¯¼è‡´çš„å¼‚å¸¸ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Test5</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">ObservedObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">Store</span>()
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">Text</span>(<span class="hljs-string">"count:\(store.count)"</span>)
    }
}
</code></pre><p>å¯¹äºä¸Šé¢çš„ä»£ç ï¼Œä¹çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•ä¸å¦¥ï¼Œä¸è¿‡ç”±äº@ObservedObjectçš„æœºåˆ¶é—®é¢˜ï¼Œå…¶åˆ›å»ºçš„å®ä¾‹å¹¶ä¸è¢«å½“å‰Viewæ‰€æ‹¥æœ‰ï¼ˆå½“å‰Viewæ— æ³•ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œå› æ­¤åœ¨ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µä¸‹ä¼šå‡ºç°ä¸å¯é¢„æ–™çš„ç»“æœã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿè®©å¼€å‘è€…æ›´å¥½çš„æŒæ§ä»£ç ï¼ŒåŒæ—¶ä¹Ÿä¿æŒå¯¹äºä¸Šä¸€ç‰ˆæœ¬è‰¯å¥½çš„å…¼å®¹æ€§ï¼Œè‹¹æœåœ¨SwiftUI2.0ä¸­æ·»åŠ äº†@StateObjectã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯@Stateçš„å¼•ç”¨ç±»å‹ç‰ˆæœ¬ã€‚</p><p>åœ¨WWDCçš„è§†é¢‘ä¸­ï¼Œè‹¹æœæ˜ç¡®çš„è¡¨æ˜@StateObjectæ˜¯è¢«åˆ›å»ºä»–çš„Viewæ‰€æŒæœ‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å®Œå…¨å¯æ§çš„ï¼Œæ˜¯åŒåˆ›å»ºå®ƒçš„Viewçš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·çš„ã€‚</p><p><strong>@StateObject å’Œ @ObservedObject çš„åŒºåˆ«å°±æ˜¯å®ä¾‹æ˜¯å¦è¢«åˆ›å»ºå…¶çš„Viewæ‰€æŒæœ‰ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸæ˜¯å¦å®Œå…¨å¯æ§ã€‚</strong></p><h2>é€šè¿‡ä»£ç äº†è§£ä¸åŒ</h2><p>æˆ‘é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥è¯¦ç»†é˜è¿°ä¸€ä¸‹ @StateObject å’Œ @ObservedObjectçš„ä¸åŒè¡¨ç°ã€‚</p><p><strong>å‡†å¤‡å·¥ä½œï¼š</strong></p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateObjectClass</span>:<span class="hljs-title">ObservableObject</span></span>{
    <span class="hljs-keyword">let</span> type:<span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> id:<span class="hljs-type">Int</span>
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> <span class="hljs-built_in">count</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">init</span>(type:<span class="hljs-type">String</span>){
        <span class="hljs-keyword">self</span>.type = type
        <span class="hljs-keyword">self</span>.id = <span class="hljs-type">Int</span>.random(<span class="hljs-keyword">in</span>: <span class="hljs-number">0</span>...<span class="hljs-number">1000</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"type:\(type) id:\(id) init"</span>)
    }
    <span class="hljs-keyword">deinit</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"type:\(type) id:\(id) deinit"</span>)
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CountViewState</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> state = <span class="hljs-type">StateObjectClass</span>(type:<span class="hljs-string">"StateObject"</span>)
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">VStack</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"@StateObject count :\(state.count)"</span>)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"+1"</span>){
                state.<span class="hljs-built_in">count</span> += <span class="hljs-number">1</span>
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CountViewObserved</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">ObservedObject</span> <span class="hljs-keyword">var</span> state = <span class="hljs-type">StateObjectClass</span>(type:<span class="hljs-string">"Observed"</span>)
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">VStack</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"@Observed count :\(state.count)"</span>)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"+1"</span>){
                state.<span class="hljs-built_in">count</span> += <span class="hljs-number">1</span>
            }
        }
    }
}
</code></pre><p>StateObjectClasså°†åœ¨å…¶è¢«åˆ›å»ºå’Œé”€æ¯æ—¶é€šè¿‡type å’Œ id å‘ŠçŸ¥æˆ‘ä»¬å®ƒæ˜¯è¢«é‚£ç§æ–¹æ³•åˆ›å»ºçš„ï¼Œä»¥åŠå…·ä½“å“ªä¸ªå®ä¾‹è¢«é”€æ¯äº†ã€‚</p><p>CountViewStateå’ŒCountViewObservedå”¯ä¸€çš„ä¸åŒæ˜¯åˆ›å»ºå®ä¾‹ä½¿ç”¨çš„å±æ€§åŒ…è£…å™¨ä¸åŒã€‚</p><p><strong>æµ‹è¯•1ï¼š</strong></p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Test1</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> <span class="hljs-built_in">count</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"åˆ·æ–°CounterViewè®¡æ•° :\(count)"</span>)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"åˆ·æ–°"</span>){
                <span class="hljs-built_in">count</span> += <span class="hljs-number">1</span>
            }
            
            <span class="hljs-type">CountViewState</span>()
                .padding()
            
            <span class="hljs-type">CountViewObserved</span>()
                .padding()
            
        }
    }
}
</code></pre><p>åœ¨æµ‹è¯•1ä¸­ï¼Œå½“è¿›ç‚¹å‡»+1æŒ‰é’®æ—¶ï¼Œæ— è®ºæ˜¯@StateObjectæˆ–æ˜¯@ObservedObjectå…¶éƒ½è¡¨ç°å‡ºä¸€è‡´çš„çŠ¶æ€ï¼Œä¸¤ä¸ªViewéƒ½å¯ä»¥æ­£å¸¸çš„æ˜¾ç¤ºå½“å‰æŒ‰é’®çš„ç‚¹å‡»æ¬¡æ•°ï¼Œä¸è¿‡å½“ç‚¹å‡»åˆ·æ–°æŒ‰é’®æ—¶ï¼ŒCountViewStateä¸­çš„æ•°å€¼ä»ç„¶æ­£å¸¸ï¼Œä¸è¿‡CountViewObservedä¸­çš„è®¡æ•°å€¼è¢«æ¸…é›¶äº†ã€‚ä»è°ƒè¯•ä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œå½“ç‚¹å‡»åˆ·æ–°æ—¶ï¼ŒCountViewObservedä¸­çš„å®ä¾‹è¢«é‡æ–°åˆ›å»ºäº†ï¼Œå¹¶é”€æ¯äº†ä¹‹å‰çš„å®ä¾‹ï¼ˆCountViewObservedè§†å›¾å¹¶æ²¡æœ‰è¢«é‡æ–°åˆ›å»ºï¼Œä»…æ˜¯é‡æ–°æ±‚äº†bodyçš„å€¼ï¼‰ã€‚</p><pre data-language="swift"><code>type:<span class="hljs-type">Observed</span> id:<span class="hljs-number">443</span> <span class="hljs-keyword">init</span>
type:<span class="hljs-type">Observed</span> id:<span class="hljs-number">103</span> <span class="hljs-keyword">deinit</span>
</code></pre><p>åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œ@ObservedObjectåˆ›å»ºçš„å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸçŸ­äºå½“å‰Viewã€‚</p><p><strong>æµ‹è¯•2:</strong></p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Test2</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> <span class="hljs-built_in">count</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">NavigationView</span>{
            <span class="hljs-type">List</span>{
                <span class="hljs-type">NavigationLink</span>(<span class="hljs-string">"@StateObject"</span>, destination: <span class="hljs-type">CountViewState</span>())
                <span class="hljs-type">NavigationLink</span>(<span class="hljs-string">"@ObservedObject"</span>, destination: <span class="hljs-type">CountViewObserved</span>())
            }
        }
    }
}
</code></pre><p>æµ‹è¯•2ä¸­ï¼Œç‚¹å‡»linkè¿›å…¥å¯¹åº”çš„Viewåé€šè¿‡ç‚¹å‡»+1è¿›è¡Œè®¡æ•°ï¼Œç„¶åè¿”å›çˆ¶è§†å›¾ã€‚å½“å†æ¬¡è¿›å…¥linkåï¼Œ@StateObjectå¯¹åº”çš„è§†å›¾ä¸­è®¡æ•°æ¸…é›¶ï¼ˆç”±äºè¿”å›çˆ¶è§†å›¾ï¼Œå†æ¬¡è¿›å…¥æ—¶ä¼šé‡æ–°åˆ›å»ºè§†å›¾ï¼Œæ‰€ä»¥ä¼šé‡æ–°åˆ›å»ºå®ä¾‹ï¼‰ï¼Œä¸è¿‡@ObservedObjectå¯¹åº”çš„è§†å›¾ä¸­è®¡æ•°æ˜¯ä¸æ¸…é›¶çš„ã€‚</p><p>åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œ@ObservedObjectåˆ›å»ºçš„å®ä¾‹ç”Ÿå‘½å‘¨æœŸé•¿äºå½“å‰çš„Viewã€‚</p><p><strong>æµ‹è¯•3:</strong></p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Test3</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> showStateObjectSheet = <span class="hljs-literal">false</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> showObservedObjectSheet = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">List</span>{
            <span class="hljs-type">Button</span>(<span class="hljs-string">"Show StateObject Sheet"</span>){
                showStateObjectSheet.toggle()
            }
            .sheet(isPresented: $showStateObjectSheet) {
                <span class="hljs-type">CountViewState</span>()
            }
            <span class="hljs-type">Button</span>(<span class="hljs-string">"Show ObservedObject Sheet"</span>){
                showObservedObjectSheet.toggle()
            }
            .sheet(isPresented: $showObservedObjectSheet) {
                <span class="hljs-type">CountViewObserved</span>()
            }   
        }
    }
}
</code></pre><p>æµ‹è¯•3ä¸­ç‚¹å‡»æŒ‰é’®ï¼Œåœ¨sheetä¸­ç‚¹å‡»+1,å½“å†æ¬¡è¿›å…¥sheetåï¼Œæ— è®ºæ˜¯@StateObjectè¿˜æ˜¯@ObservedObjectå¯¹åº”çš„Viewä¸­çš„è®¡æ•°éƒ½è¢«æ¸…é›¶ã€‚</p><p>åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œ@ObservedObjectåˆ›å»ºçš„å®ä¾‹ç”Ÿå‘½å‘¨æœŸå’ŒViewæ˜¯ä¸€è‡´çš„ã€‚</p><p><strong>ä¸‰æ®µä»£ç ï¼Œä¸‰ç§ç»“æœï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè‹¹æœè¦æ–°å¢@StateObjectçš„åŸå› â€”â€”è®©å¼€å‘è€…å¯ä»¥æ˜ç¡®åœ°äº†è§£å¹¶æŒæ¡å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¶ˆé™¤ä¸ç¡®å®šæ€§ï¼</strong></p><h2>ObservedObjectæ˜¯å¦è¿˜æœ‰å­˜åœ¨çš„å¿…è¦ï¼Ÿ</h2><p>å¯¹æˆ‘ä¸ªäººè€Œè¨€ï¼ŒåŸºæœ¬å¤±å»äº†ä½¿ç”¨å…¶çš„ç†ç”±ï¼ˆå¯ç”¨äºç»‘å®šçˆ¶è§†å›¾ä¼ é€’çš„@StateObjectï¼‰ã€‚</p><p>å°½ç®¡æˆ–è®¸ä¸Šé¢ä¾‹å­çš„æŸç§ç‰¹æ€§å¯èƒ½è®©ä½ è§‰å¾—ObservedObjectå¯ä»¥å®ŒæˆæŸäº›ç‰¹æ®Šéœ€æ±‚ï¼ˆæ¯”å¦‚æµ‹è¯•2ï¼‰ï¼Œä½†æˆ‘ä»¬æ— æ³•ä¿è¯è‹¹æœåœ¨ä¹‹åä¸æ”¹å˜ObservedObjectçš„è¿è¡Œæœºç†ï¼Œä»è€Œæ”¹å˜å½“å‰çš„ç»“æœã€‚</p><p>æˆ‘ä¸ªäººè¿˜æ˜¯æ›´æ¨èå°†æ¥éƒ½ä½¿ç”¨@StateObjectæ¥æ¶ˆé™¤ä»£ç è¿è¡Œçš„ä¸ç¡®å®šæ€§ã€‚</p><p>é€šè¿‡ä¸‹è¿°ä»£ç ï¼Œä½¿ç”¨@StateObjectåŒæ ·å¯ä»¥å¾—åˆ°æµ‹è¯•2ä¸­ObservedObjectçš„è¿è¡Œæ•ˆæœã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Test4</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> showStateObjectSheet = <span class="hljs-literal">false</span>
    @<span class="hljs-type">StateObject</span> <span class="hljs-keyword">var</span> state = <span class="hljs-type">StateObjectClass</span>(type: <span class="hljs-string">"stateObject"</span>)
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">List</span>{
            <span class="hljs-type">Button</span>(<span class="hljs-string">"Show StateObject1 Sheet"</span>){
                showStateObjectSheet.toggle()
            }
            .sheet(isPresented: $showStateObjectSheet) {
                <span class="hljs-type">CountViewState1</span>(state: state)
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CountViewState1</span>:<span class="hljs-title">View</span></span>{
    @<span class="hljs-type">ObservedObject</span> <span class="hljs-keyword">var</span> state:<span class="hljs-type">StateObjectClass</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span>{
        <span class="hljs-type">VStack</span>{
            <span class="hljs-type">Text</span>(<span class="hljs-string">"@StateObject count :\(state.count)"</span>)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"+1"</span>){
                state.<span class="hljs-built_in">count</span> += <span class="hljs-number">1</span>
            }
        }
    }
}
</code></pre><h2>Next</h2><p>è‹¹æœä½¿ç”¨@StateObjectä¸€æ–¹é¢ä¿®å¤äº†ä¹‹å‰çš„éšæ‚£ï¼ŒåŒæ—¶é€šè¿‡SwiftUI2.0ä¼—å¤šæ–°ç‰¹æ€§çš„å¼•å…¥ï¼Œè¿›ä¸€æ­¥å®Œå–„äº†Data Flowçš„å®ç°æ‰‹æ®µã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ã€ŠSwiftUI2.0 â€”â€” 100% SwiftUI appã€‹ä¸­ï¼Œæˆ‘ä»¬æ¥è¿›ä¸€æ­¥æ¢è®¨ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/observableObject-study</guid><title>ObservableObjectç ”ç©¶â€”â€”æƒ³è¯´çˆ±ä½ ä¸å®¹æ˜“</title><description>æœ¬æ–‡ä¸»è¦ç ”ç©¶åœ¨SwiftUIä¸­ï¼Œé‡‡ç”¨å•ä¸€æ•°æ®æº(Single Source of Truth)çš„å¼€å‘æ¨¡å¼ï¼ŒObservableObjectæ˜¯å¦ä¸ºæœ€ä½³é€‰æ‹©ã€‚æ˜¯å¦å¯ä»¥åœ¨å‡ ä¹ä¸æ”¹å˜ç°æœ‰è®¾è®¡æ€è·¯ä¸‹è¿›è¡Œæ–°çš„å°è¯•ï¼Œä»¥æé«˜å“åº”æ•ˆç‡ã€‚æœ€åæä¾›äº†ä¸€ä¸ªä»é‡‡ç”¨å•ä¸€æ•°æ®æºè®¾è®¡æ€è·¯ä½†å®Œå…¨å¼ƒç”¨ObservableObjectçš„æ–¹å¼ã€‚</description><link>http://www.fatbobman.com/posts/observableObject-study</link><pubDate>Sun, 17 May 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦ç ”ç©¶åœ¨SwiftUIä¸­ï¼Œé‡‡ç”¨å•ä¸€æ•°æ®æº(Single Source of Truth)çš„å¼€å‘æ¨¡å¼ï¼ŒObservableObjectæ˜¯å¦ä¸ºæœ€ä½³é€‰æ‹©ã€‚æ˜¯å¦å¯ä»¥åœ¨å‡ ä¹ä¸æ”¹å˜ç°æœ‰è®¾è®¡æ€è·¯ä¸‹è¿›è¡Œæ–°çš„å°è¯•ï¼Œä»¥æé«˜å“åº”æ•ˆç‡ã€‚æœ€åæä¾›äº†ä¸€ä¸ªä»é‡‡ç”¨å•ä¸€æ•°æ®æºè®¾è®¡æ€è·¯ä½†å®Œå…¨å¼ƒç”¨ObservableObjectçš„æ–¹å¼ã€‚</p></blockquote><h2>å•ä¸€æ•°æ®æº</h2><p>æˆ‘æ˜¯åœ¨å»å¹´é˜…è¯»ç‹å·å†™çš„<a href="https://objccn.io/products/swift-ui">ã€ŠSwiftUI ä¸ Combine ç¼–ç¨‹ã€‹</a>æ‰ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°<strong>å•ä¸€æ•°æ®æº</strong>è¿™ä¸€æ¦‚å¿µçš„ã€‚</p><ul><li>å°† app å½“ä½œä¸€ä¸ªçŠ¶æ€æœºï¼ŒçŠ¶æ€å†³å®šç”¨æˆ·ç•Œé¢ã€‚</li></ul><ul><li>è¿™äº›çŠ¶æ€éƒ½ä¿å­˜åœ¨ä¸€ä¸ª Store å¯¹è±¡ä¸­ï¼Œè¢«ç§°ä¸º Stateã€‚</li></ul><ul><li>View ä¸èƒ½ç›´æ¥æ“ä½œ Stateï¼Œè€Œåªèƒ½é€šè¿‡å‘é€ Action çš„æ–¹å¼ï¼Œé—´æ¥æ”¹å˜å­˜å‚¨åœ¨ Store ä¸­çš„ Stateã€‚</li></ul><ul><li>Reducer æ¥å—åŸæœ‰çš„ State å’Œå‘é€è¿‡æ¥çš„ Actionï¼Œç”Ÿæˆæ–°çš„ Stateã€‚</li></ul><ul><li>ç”¨æ–°çš„ State æ›¿æ¢ Store ä¸­åŸæœ‰çš„çŠ¶æ€ï¼Œå¹¶ç”¨æ–°çŠ¶æ€æ¥é©±åŠ¨æ›´æ–°ç•Œé¢ã€‚</li></ul><img src="http://cdn.fatbobman.com/observableObject-study-reduximage.gif" alt="Reduxæ¶æ„"/><p>åœ¨è¯¥ä¹¦ä¸­ç»“åˆä½œè€…ä¹‹å‰Reduxã€RxSwiftç­‰å¼€å‘ç»éªŒï¼Œæä¾›äº†ä¸€ä¸ªSwiftUIåŒ–çš„èŒƒä¾‹ç¨‹åºã€‚ä¹‹åæˆ‘ä¹Ÿç»§ç»­å­¦ä¹ äº†ä¸€äº›æœ‰å…³çš„èµ„æ–™ï¼Œå¹¶é€šè¿‡é˜…è¯»Githubä¸Šä¸å°‘çš„å¼€æºèŒƒä¾‹ï¼ŒåŸºæœ¬å¯¹è¿™ä¸€æ–¹å¼æœ‰æ‰€æŒæ¡ï¼Œå¹¶åœ¨<a href="https://apps.apple.com/app/id1492861358"><strong>å¥åº·ç¬”è®°</strong></a>ä¸­å¾—ä»¥åº”ç”¨ã€‚æ€»çš„æ¥è¯´ï¼Œå½“å‰åœ¨SwiftUIæ¡†æ¶ä¸‹ï¼Œå¤§å®¶çš„å®ç°æ‰‹æ®µä¸»è¦çš„ä¸åŒéƒ½ä½“ç°åœ¨ç»†èŠ‚ä¸Šï¼Œå¤§çš„æ–¹å‘ã€æ¨¡å¼ã€ä»£ç æ„æˆåŸºæœ¬éƒ½å·®ä¸å¤šï¼š</p><ul><li>Storeå¯¹è±¡éµå®ˆObservableObjectåè®®</li></ul><ul><li>Stateä¿å­˜åœ¨Storeå¯¹è±¡ä¸­ï¼Œå¹¶ä½¿ç”¨@Publishedè¿›è¡ŒåŒ…è£…ã€‚ä»è€Œåœ¨Stateå‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥Store</li></ul><ul><li>Storeå¯¹è±¡é€šè¿‡@ObservedObject æˆ– @EnvironmentObjectä¸Viewå»ºç«‹ä¾èµ–</li></ul><ul><li>Storeå¯¹è±¡åœ¨Stateå˜åŒ–åé€šè¿‡objectWillChangeçš„Pbulisheré€šçŸ¥ä¸å…¶å·²å»ºç«‹ä¾èµ–å…³ç³»çš„Viewè¿›è¡Œåˆ·æ–°</li></ul><ul><li>Viewå‘é€Action -&gt; Recudcer(State,Action) -&gt; newState å‘¨è€Œå¤å§‹</li></ul><ul><li>ç”±äºSwiftUIçš„åŒå‘ç»‘å®šæœºåˆ¶ï¼Œæ•°æ®æµå¹¶éå®Œå…¨å•å‘çš„</li></ul><ul><li>åœ¨éƒ¨åˆ†è§†å›¾ä¸­å¯ä»¥ç»“åˆSwiftUIé€šè¿‡çš„å…¶ä»–åŒ…è£…å±æ€§å¦‚@FetchRequestç­‰å°†çŠ¶æ€å±€éƒ¨åŒ–</li></ul><p>åä¸¤é¡¹æ˜¯åˆ©ç”¨SwiftUIçš„ç‰¹æ€§ï¼Œä¹Ÿå¯ä»¥ä¸é‡‡ç”¨ï¼Œå®Œå…¨é‡‡ç”¨å•å‘æ•°æ®æµçš„æ–¹å¼</p><p>åŸºäºä»¥ä¸Šæ–¹æ³•ï¼Œåœ¨SwiftUIä¸­è¿›è¡Œå•ä¸€æ•°æ®æºå¼€å‘æ˜¯éå¸¸ä¾¿åˆ©çš„ï¼Œåœ¨å¤šæ•°æƒ…å†µä¸‹æ‰§è¡Œæ•ˆç‡ã€å“åº”é€Ÿåº¦éƒ½æ˜¯æœ‰åŸºæœ¬ä¿è¯çš„ã€‚ä¸è¿‡å°±åƒæˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://zhuanlan.zhihu.com/p/141229504">@Stateç ”ç©¶</a> ä¸­æåˆ°è¿‡çš„ï¼Œ<strong>å½“éšç€åŠ¨æ€æ•°æ®é‡çš„å¢å¤§ã€ä¸Storeä¿æœ‰ä¾èµ–å…³ç³»çš„Viewæ•°é‡æé«˜åˆ°ä¸€å®šç¨‹åº¦åï¼Œæ•´ä¸ªappçš„å“åº”æ•ˆç‡ä¾¿ä¼šæ€¥å‰§æ¶åŒ–ã€‚</strong></p><p>æ¶åŒ–çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>å¯¹äºéµå¾ªObservableObjectå¯¹è±¡çš„ä¾èµ–æ³¨å…¥æ—¶æœº</li><li>Viewçš„ç²¾ç»†åŒ–</li><li>ä¾èµ–é€šçŸ¥æ¥å£å”¯ä¸€æ€§ã€‚Stateï¼ˆçŠ¶æ€é›†åˆï¼‰ä¸­ä»»ä½•çš„å•ä¸€å…ƒç´ å‘ç”Ÿå˜åŒ–éƒ½å°†é€šçŸ¥æ‰€æœ‰ä¸Storeæœ‰ä¾èµ–çš„Viewè¿›è¡Œé‡ç»˜ã€‚</li></ol><p>æˆ‘å°±ä»¥ä¸Šå‡ ç‚¹é€æ¡è¿›è¡Œåˆ†æã€‚</p><h2>å¯¹äºéµå¾ªObservableObjectå¯¹è±¡çš„ä¾èµ–æ³¨å…¥æ—¶æœº</h2><p>åœ¨ <a href="https://zhuanlan.zhihu.com/p/141229504">@Stateç ”ç©¶</a> ä¸­çš„ <strong>ä»€ä¹ˆæ—¶å€™å»ºç«‹çš„ä¾èµ–ï¼Ÿ</strong>ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡äº†ä¸€æ®µä»£ç è¿›è¡Œè¿‡@Stateå’Œ@ObservedObjectå¯¹äºä¾èµ–æ³¨å…¥æ—¶æœºçš„æ¨æµ‹ã€‚ç»“æœå°±æ˜¯é€šè¿‡ä½¿ç”¨@ObservedObjectæˆ–@EnvironmentObjectè¿›è¡Œçš„ä¾èµ–æ³¨å…¥ï¼Œç¼–è¯‘å™¨æ²¡æœ‰åŠæ³•æ ¹æ®å½“å‰Viewçš„å…·ä½“å†…å®¹æ¥è¿›è¡Œæ›´ç²¾ç¡®çš„åˆ¤æ–­ï¼Œåªè¦ä½ çš„Viewä¸­è¿›è¡Œäº†å£°æ˜ï¼Œä¾èµ–å…³ç³»å˜å»ºç«‹äº†ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MainView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">ObservedObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">AppStore</span>()

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"mainView"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-type">Form</span> {
            <span class="hljs-type">SubView</span>(date: $store.date)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"ä¿®æ”¹æ—¥æœŸ"</span>) {
                <span class="hljs-keyword">self</span>.store.date = <span class="hljs-type">Date</span>().description
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SubView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">Binding</span> <span class="hljs-keyword">var</span> date: <span class="hljs-type">String</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"subView"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-type">Text</span>(date)
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppStore</span>:<span class="hljs-title">ObservableObject</span></span>{
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> date:<span class="hljs-type">String</span> = <span class="hljs-type">Date</span>().description
}
</code></pre><p>æ‰§è¡Œåè¾“å‡ºå¦‚ä¸‹ï¼š</p><pre data-language="swift"><code>mainView
subView
mainView
subView
...
</code></pre><p>æ›´è¯¦ç»†çš„åˆ†æè¯·å‚è§ <a href="http://www.fatbobman.com/posts/swiftUI-state/">@Stateç ”ç©¶</a></p><p><strong>å³ä½¿ä½ åªåœ¨Viewä¸­å‘é€actionï¼Œå¹¶æ²¡æœ‰æ˜¾ç¤ºStateä¸­çš„æ•°æ®æˆ–ä½¿ç”¨å…¶åšåˆ¤æ–­ï¼Œè¯¥Viewä¹Ÿä¼šè¢«å¼ºåˆ¶åˆ·æ–°ã€‚ç”šè‡³ï¼Œå¦‚æœä½ åƒæˆ‘ä¸€æ ·ï¼Œå¿˜äº†ç§»é™¤åœ¨Viewä¸­çš„å£°æ˜ï¼ŒViewä¹ŸåŒæ ·ä¼šè¢«æ›´æ–°ã€‚</strong></p><p>å¦‚æœç±»ä¼¼çš„Viewæ¯”è¾ƒå¤šï¼Œä½ çš„appå°†ä¼šå‡ºç°å¤§é‡çš„æ— æ•ˆæ›´æ–°ã€‚</p><h2>Viewçš„ç²¾ç»†åŒ–</h2><p>è¿™é‡Œæ‰€æŒ‡çš„Viewæ˜¯ä½ è‡ªå·±æ„å»ºçš„éµå¾ªViewåè®®çš„ç»“æ„ä½“ã€‚</p><p>åœ¨SwiftUIä¸‹å¼€å‘ï¼Œæ— è®ºæ˜¯ä¸»è§‚è¿˜æ˜¯å®¢è§‚éƒ½éœ€è¦ä½ å°†Viewçš„è¡¨è¿°ç²¾ç»†åŒ–ï¼Œç”¨æ›´å¤šçš„å­Viewæ¥ç»„æˆä½ çš„æœ€ç»ˆè§†å›¾ï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰çš„ä»£ç éƒ½å°½é‡å†™åœ¨åŒä¸€ä¸ªViewä¸Šã€‚</p><h3>ä¸»è§‚æ–¹é¢</h3><ul><li>æ›´å°çš„è€¦åˆæ€§</li></ul><ul><li>æ›´å¼ºçš„å¤ç”¨æ€§</li></ul><h3>å®¢è§‚æ–¹é¢</h3><h4>ViewBuilderçš„è®¾è®¡é™åˆ¶</h4><p>FunctionBuilderä½œä¸ºSwift5.1çš„é‡è¦æ–°å¢ç‰¹æ€§ï¼Œæˆä¸ºäº†SwiftUIå£°æ˜å¼ç¼–ç¨‹çš„åŸºç¡€ã€‚å®ƒä¸ºåœ¨Swiftä»£ç ä¸­å®ç°DSLå¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ã€‚ä¸è¿‡ä½œä¸ºä¸€ä¸ªæ–°ç”Ÿäº§ç‰©ï¼Œå®ƒç›®å‰çš„èƒ½åŠ›è¿˜å¹¶ä¸ååˆ†çš„å¼ºå¤§ã€‚ ç›®å‰å®ƒä»…æä¾›éå¸¸æœ‰é™çš„é€»è¾‘è¯­å¥ åœ¨ç¼–å†™ä»£ç ä¸­ï¼Œä¸ºäº†èƒ½å¤Ÿå®ç°æ›´å¤šé€»è¾‘å’Œä¸°å¯Œçš„UIï¼Œæˆ‘ä»¬å¿…é¡»æŠŠä»£ç åˆ†æ•£åˆ°å„ä¸ªViewä¸­ï¼Œå†æœ€ç»ˆåˆæˆã€‚å¦åˆ™ä½ ä¼šç»å¸¸è·å¾—æ— æ³•ä½¿ç”¨è¿‡å¤šé€»è¾‘ç­‰ç­‰çš„é”™è¯¯æç¤ºã€‚</p><h4>ä»¥Bodyä¸ºå•ä½çš„ä¼˜åŒ–æœºåˆ¶</h4><p>SwiftUIä¸ºäº†å‡å°‘Viewçš„é‡ç»˜å…¶å®åšäº†å¤§é‡çš„å·¥ä½œï¼Œå®ƒä»¥Viewçš„bodyä¸ºå•ä½è¿›è¡Œéå¸¸æ·±åº¦çš„ä¼˜åŒ–ï¼ˆbodyæ˜¯æ¯ä¸ªViewçš„å”¯ä¸€å…¥å£ï¼›Viewä¸­ä½¿ç”¨func -&gt; some Viewæ— æ³•äº«å—ä¼˜åŒ–ï¼Œåªæœ‰ç‹¬ç«‹çš„Viewæ‰å¯ä»¥ï¼‰ã€‚SwiftUIåœ¨ç¨‹åºç¼–è¯‘æ—¶ä¾¿å·²å°†æ‰€æœ‰çš„Viewç¼–è¯‘æˆViewæ ‘ï¼Œå®ƒå°½å¯èƒ½çš„åªå¯¹å¿…é¡»è¦å“åº”çŠ¶æ€å˜åŒ–çš„Viewï¼ˆ@Stateå®Œç¾çš„æ”¯æŒï¼‰è¿›è¡Œé‡ç»˜å·¥ä½œã€‚ç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡è‡ªè¡Œè®¾ç½®Equatableçš„æ¯”å¯¹æ¡ä»¶è¿›ä¸€æ­¥ä¼˜åŒ–Viewé‡ç»˜ç­–ç•¥ã€‚<br>#### Xcodeçš„ä»£ç å®æ—¶è§£æèƒ½åŠ›é™åˆ¶ ####<br> å¦‚æœä½ åœ¨åŒä¸€ä¸ªViewä¸­å†™å…¥äº†è¿‡å¤šçš„ä»£ç ï¼ŒXcodeçš„ä»£ç æç¤ºåŠŸèƒ½å‡ ä¹å°±ä¼šå˜å¾—ä¸å¯ç”¨äº†ã€‚æˆ‘ä¼°è®¡åº”è¯¥æ˜¯è§£æDSLæœ¬èº«çš„å·¥ä½œé‡éå¸¸å¤§ï¼Œæˆ‘ä»¬åœ¨View bodyä¸­å†™çš„çœ‹èµ·æ¥ä¸å¤šçš„æè¿°è¯­å¥ï¼Œå…¶å®åé¢å¯¹åº”çš„æ˜¯éå¸¸å¤šçš„å…·ä½“ä»£ç ã€‚Xcodeçš„ä»£ç æç¤ºæ€»ä¼šè¶…å‡ºäº†å®ƒåˆç†çš„è®¡ç®—æ—¶é—´è€Œå¯¼è‡´æ•…éšœã€‚æ­¤æ—¶åªéœ€æŠŠViewåˆ†è§£æˆå‡ ä¸ªViewï¼Œå³ä½¿ä»ç„¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ŒXcodeçš„å·¥ä½œä¹Ÿä¼šç«‹åˆ»æ­£å¸¸èµ·æ¥ã€‚</p><h4>é¢„è§ˆçš„å¯é æ€§é™åˆ¶</h4><p>æ–°çš„é¢„è§ˆåŠŸèƒ½æœ¬æ¥ä¼šæå¤§çš„æå‡å¸ƒå±€åŠè°ƒè¯•æ•ˆç‡ï¼Œä½†ç”±äºå…¶å¯¹å¤æ‚ä»£ç çš„æ”¯æŒå¹¶ä¸å®Œç¾ï¼Œå°†Viewåˆ†å‰²åï¼Œé€šè¿‡ä½¿ç”¨åˆé€‚çš„Previewæ§åˆ¶è¯­å¥å¯ä»¥é«˜æ•ˆã€æ— é”™çš„å¯¹æ¯ä¸ªå­Viewè¿›è¡Œç‹¬ç«‹é¢„è§ˆã€‚</p><p>ä»ä¸Šé¢å‡ ç‚¹çœ‹ï¼Œæ— è®ºä»ä»»ä½•è§’åº¦ï¼Œæ›´ç²¾ç»†åŒ–çš„Viewæè¿°éƒ½æ˜¯ååˆ†åˆé€‚çš„ã€‚</p><p><strong>ä½†ç”±äºåœ¨å•ä¸€æ•°æ®æºçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä¼šæœ‰æ›´å¤šçš„Viewå’ŒStoreå»ºç«‹ä¾èµ–ã€‚ä¼—å¤šçš„ä¾èµ–å°†ä½¿æˆ‘ä»¬æ— æ³•äº«å—åˆ°SwiftUIæä¾›çš„Viewæ›´æ–°ä¼˜åŒ–æœºåˆ¶ã€‚</strong></p><p>æœ‰å…³Viewä¼˜åŒ–çš„é—®é¢˜å¤§å®¶å¯ä»¥å‚è€ƒ <a href="https://objccn.io/products/thinking-in-swiftui">ã€ŠSwiftUIç¼–ç¨‹æ€æƒ³ã€‹</a>ä¸€ä¹¦ä¸­Viewæ›´æ–°æœºåˆ¶çš„ä»‹ç»ï¼Œå¦å¤–<a href="https://swiftui-lab.com/equatableview/">swiftui-lab</a>ä¸Šä¹Ÿæœ‰æ¢è®¨Equalityçš„æ–‡ç« ã€‚</p><h2>ä¾èµ–é€šçŸ¥æ¥å£å”¯ä¸€æ€§</h2><p>Stateï¼ˆçŠ¶æ€é›†åˆï¼‰ä¸­ä»»ä½•çš„å•ä¸€å…ƒç´ çš„å˜åŒ–éƒ½å°†é€šçŸ¥æ‰€æœ‰ä¸Storeæœ‰ä¾èµ–çš„Viewè¿›è¡Œé‡ç»˜ã€‚</p><p>ä½¿ç”¨@Publishedå¯¹Stateè¿›è¡Œäº†åŒ…è£…ã€‚åœ¨Stateçš„å€¼å‘ç”Ÿå˜åŒ–åï¼Œå…¶ä¼šé€šè¿‡Storeï¼ˆObservableObjectåè®®ï¼‰æä¾›çš„ObjectWillChangePublisherå‘é€é€šçŸ¥ï¼Œæ‰€æœ‰ä¸å…¶æœ‰ä¾èµ–çš„Viewè¿›è¡Œåˆ·æ–°ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppStore</span>:<span class="hljs-title">ObservableObject</span></span>{
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> state = <span class="hljs-type">State</span>()
      ...
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">State</span></span>{
    <span class="hljs-keyword">var</span> userName:<span class="hljs-type">String</span> = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> login:<span class="hljs-type">Bool</span> = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> selection:<span class="hljs-type">Int</span> = <span class="hljs-number">0</span>
}
</code></pre><p>å¯¹äºä¸€ä¸ªå¹¶ä¸å¤æ‚çš„Stateæ¥è¯´ï¼Œå°½ç®¡ä»æœ‰æ— æ•ˆåŠ¨ä½œï¼Œä½†æ•´ä½“æ•ˆç‡å½±å“å¹¶ä¸å¤§ï¼Œä½†æ˜¯å¦‚æœä½ çš„appçš„Stateé‡Œé¢å†…å®¹è¾ƒå¤šï¼Œæ›´æ–°è¾ƒé¢‘ç¹ï¼ŒViewçš„æ›´æ–°å‹åŠ›ä¼šé™¡ç„¶å¢å¤§ã€‚å°¤å…¶Stateä¸­æœ¬æ¥å¾ˆå¤šæ•°æ®çš„å˜åŒ–æ€§æ˜¯ä¸é«˜çš„ï¼Œå¤§é‡çš„Viewåªéœ€è¦ä½¿ç”¨å˜åŒ–æ€§ä½çš„æ•°æ®ï¼Œä½†åªè¦Stateå‘ç”Ÿä»»ä½•æ”¹åŠ¨ï¼Œéƒ½å°†è¢«è¿«é‡ç»˜ã€‚</p><h2>å¦‚ä½•æ”¹å–„</h2><p>åœ¨å‘ç°äº†ä¸Šè¿°çš„é—®é¢˜åï¼Œå¼€å§‹é€æ­¥å°è¯•æ‰¾å¯»è§£å†³çš„é€”å¾„ã€‚</p><h3>ç¬¬ä¸€æ­¥ å‡å°‘æ³¨å…¥ä¾èµ–</h3><p>é’ˆå¯¹åªè¦å£°æ˜åˆ™å°±ä¼šå½¢æˆä¾èµ–çš„çš„é—®é¢˜ï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„å°±æ˜¯å‡å°‘æ³¨å…¥ä¾èµ–ã€‚é¦–å…ˆä¸è¦åœ¨ä»£ç ä¸­æ·»åŠ ä¸å¿…è¦çš„ä¾èµ–å£°æ˜ï¼›å¯¹äºé‚£äº›åªéœ€è¦å‘é€Actionä½†å¹¶ä¸ä½¿ç”¨Stateçš„Viewï¼Œå°†storeå®šä¹‰æˆå…¨éƒ¨å˜é‡ï¼Œæ— éœ€æ³¨å…¥ç›´æ¥ä½¿ç”¨ã€‚</p><pre data-language="swift"><code><span class="hljs-comment">//AppDelegateä¸­</span>
<span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">Store</span>()

<span class="hljs-comment">//</span>
<span class="hljs-keyword">let</span> store = (<span class="hljs-type">UIApplication</span>.shared.delegate <span class="hljs-keyword">as</span>! <span class="hljs-type">AppDelegate</span>).store
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>:<span class="hljs-title">View</span></span>{
  <span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
    <span class="hljs-type">Button</span>(<span class="hljs-string">"ç›´æ¥ä½¿ç”¨Action"</span>){
      store.dispatch(.test)
    }
  }
}

<span class="hljs-comment">//å…¶ä»–éœ€è¦ä¾èµ–æ³¨å…¥çš„Viewåˆ™æ­£å¸¸ä½¿ç”¨</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">OtherView</span>:<span class="hljs-title">View</span></span>{
  @<span class="hljs-type">EnvironmentObject</span> <span class="hljs-keyword">var</span> store:<span class="hljs-type">Store</span>
  <span class="hljs-keyword">var</span> boyd:some <span class="hljs-type">View</span>{
    <span class="hljs-type">Text</span>(store.state.name)
  }
}
</code></pre><h4>ç¬¬äºŒæ­¥ å°†æ— å¿…è¦æ€§çš„çŠ¶æ€åŒºåŸŸåŒ–</h4><p>å¬èµ·æ¥è¿™æ¡è²Œä¼¼èƒŒç¦»äº†å•ä¸€æ•°æ®æºçš„æ€æƒ³ï¼Œä¸è¿‡å…¶å®åœ¨appä¸­ï¼Œæœ‰éå¸¸å¤šçš„çŠ¶æ€ä»…å¯¹å½“å‰Viewæˆ–å°èŒƒå›´çš„Viewæœ‰æ•ˆã€‚å¦‚æœèƒ½å¤Ÿåˆç†çš„è¿›è¡Œè®¾è®¡ï¼Œè¿™äº›çŠ¶æ€ä¿¡æ¯åœ¨è‡ªå·±çš„å°åŒºåŸŸä¸­å®Œå…¨å¯ä»¥å¾ˆå¥½åœ°è‡ªæˆ‘ç®¡ç†ï¼Œè‡ªæˆ‘ç»´æŒã€‚æ²¡æœ‰å¿…è¦ç»Ÿç»Ÿæ±‡æ€»åˆ°Stateä¸­ã€‚</p><p>åœ¨åŒºåŸŸèŒƒå›´å†…æ¥åˆ›å»ºè¢«ç»´æŒä¸€ä¸ªå°çš„çŠ¶æ€ï¼Œä¸»è¦å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ‰‹æ®µï¼š</p><ul><li>å–„ç”¨@State åœ¨ <a href="https://zhuanlan.zhihu.com/p/141229504">@Stateç ”ç©¶</a> è¿™ç¯‡æ–‡ç« ä¸­,æˆ‘ä»¬è®¨è®ºäº†SwiftUIå¯¹äº@Stateçš„ä¼˜åŒ–é—®é¢˜ã€‚å¦‚æœè®¾è®¡åˆç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ— å…³å¤§å±€çš„ä¿¡æ¯ï¼Œä¿å­˜åœ¨å±€éƒ¨Viewã€‚åŒæ—¶é€šè¿‡å¯¹@Stateçš„äºŒåº¦åŒ…è£…ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥å®Œæˆæ‰€éœ€è¦çš„å‰¯ä½œç”¨ã€‚è¯¥Viewçš„å­Viewå¦‚æœä½¿ç”¨äº†@Bindingï¼Œä¹Ÿåªå¯¹å±€éƒ¨çš„Viewæ ‘äº§ç”Ÿå½±å“ã€‚</li></ul><p>å¦å¤–ä¹Ÿå¯ä»¥å°†å¸¸ç”¨çš„Viewä¿®é¥°é€šè¿‡ViewModifierè¿›è¡ŒåŒ…è£…ã€‚ViewModifierå¯ä»¥ç»´æŒè‡ªå·±çš„@Stateï¼Œå¯ä»¥è‡ªè¡Œç®¡ç†çŠ¶æ€ã€‚</p><ul><li>åˆ›å»ºè‡ªå·±çš„@EnviromentKeyæˆ–PreferenceKeyï¼Œä»…æ³¨å…¥éœ€è¦çš„Viewæ ‘åˆ†æ”¯</li></ul><p>åŒEnviromentObjectç±»ä¼¼ï¼Œæ³¨å…¥EnviromentKeyçš„ä¾èµ–ä¹Ÿæ˜¯æ˜¾æ€§çš„</p><pre data-language="swift"><code>  @<span class="hljs-type">Environment</span>(\.myKey) <span class="hljs-keyword">var</span> currentPage
</code></pre><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼Œæ›´æ”¹è¯¥EnvironmentKeyçš„å€¼ï¼Œä½†ä½œç”¨èŒƒå›´ä»…é’ˆå¯¹å½“å‰Viewä¸‹é¢çš„å­Viewåˆ†æ”¯</p><pre data-language="swift"><code>  <span class="hljs-type">Button</span>(<span class="hljs-string">"ä¿®æ”¹å€¼"</span>){
    <span class="hljs-keyword">self</span>.currentPage = <span class="hljs-number">3</span>
  }
  <span class="hljs-type">SubView</span>()
      .environment(\.myKey, currentPage)
</code></pre><p>EnvironmentObjectä¹Ÿæ˜¯å¯ä»¥åœ¨ä»»æ„æŸä¸ªåˆ†æ”¯æ³¨å…¥ä¾èµ–çš„ï¼Œä¸è¿‡ç”±äºå…¶æ˜¯å¼•ç”¨ç±»å‹ï¼Œé€šå¸¸ä»»ä½•åˆ†æ”¯çš„æ”¹åŠ¨ï¼Œéƒ½ä»ç„¶ä¼šå¯¹æ•´ä¸ªViewæ ‘å…¶ä»–çš„ä½¿ç”¨è€…é€ æˆå½±å“ã€‚</p><p>åŒç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨PreferenceKeyï¼Œåªå°†æ•°æ®æ³¨å…¥åˆ°å½“å‰Viewä¹‹ä¸Šçš„å±‚çº§ã€‚</p><p>å€¼ç±»å‹æ— è®ºå¦‚ä½•éƒ½è¦æ¯”å¼•ç”¨ç±»å‹éƒ½æ›´å¯æ§äº›ã€‚</p><ul><li>åœ¨å½“å‰Viewä½¿ç”¨SwiftUIæä¾›çš„å…¶ä»–åŒ…è£…å±æ€§</li></ul><p>æˆ‘ç°åœ¨æœ€å¸¸ä½¿ç”¨çš„SwiftUIçš„å…¶ä»–åŒ…è£…å±æ€§å°±å±@FetchRequestäº†ã€‚é™¤äº†å¿…è¦çš„æ•°æ®æ”¾ç½®äºStateä¸­ï¼Œæˆ‘å¯¹äºCoreDateçš„å¤§å¤šæ•°æ®éœ€æ±‚éƒ½é€šè¿‡è¯¥å±æ€§åŒ…è£…å™¨æ¥å®Œæˆã€‚@FetchRequestç›®å‰æœ‰ä¸è¶³ä¹‹å¤„ï¼Œæ¯”å¦‚æ— æ³•è¿›è¡Œæ›´ç²¾ç»†çš„æ‰¹é‡æŒ‡å®šã€æ˜ç¡®æƒ°æ€§çŠ¶æ€ã€è·å–é™åˆ¶ç­‰ï¼Œä¸è¿‡ç›¸å¯¹äºå®ƒå¸¦æ¥çš„ä¾¿åˆ©æ€§ï¼Œæˆ‘è¿˜æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚FetchRequestå®Œå…¨å¯ä»¥å®ç°åŒå…¶ä»–CoreData NSFetchRequestä¸€æ ·çš„ç¨‹åºåŒ–Requestè®¾å®šï¼Œç»“åˆä¸Šé¢çš„æ–¹å¼åŒæ ·å¯ä»¥å°†Requestç”Ÿæˆå™¨æ”¾åœ¨Storeä¸­è€Œä¸å½±å“å½“å‰Viewã€‚</p><pre data-language="swift"><code>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SideView</span>: <span class="hljs-title">View</span> </span>{
      @<span class="hljs-type">Environment</span>(\.managedObjectContext)
      <span class="hljs-keyword">var</span> context
  
      @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> search: <span class="hljs-type">Search?</span>
  
      <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
          <span class="hljs-type">VStack</span>(alignment: .leading) {
              <span class="hljs-type">SearchView</span>(
                  onSearch: <span class="hljs-keyword">self</span>.onSearch
              )
              <span class="hljs-type">InsideListView</span>(fetchRequest: makeFetchRequest())  <span class="hljs-comment">//æ ¹æ®ä¸Šé¢çš„search æ¥ç”Ÿæˆä¸åŒè°“è¯å¯¹åº”çš„fetchrequest.</span>
          }
      }
  
      <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeFetchRequest</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">FetchRequest</span>&lt;<span class="hljs-type">Book</span>&gt; {
          <span class="hljs-keyword">let</span> predicate: <span class="hljs-type">NSPredicate?</span>
          <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> search = search {
              <span class="hljs-keyword">let</span> textPredicate = <span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"string CONTAINS[cd] %@"</span>, search.text)
              <span class="hljs-keyword">let</span> appPredicate = <span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"appName == %@"</span>, search.app)
              <span class="hljs-keyword">let</span> typePredicate = <span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"type == %@"</span>, search.type)
  
              <span class="hljs-keyword">var</span> predicates: [<span class="hljs-type">NSPredicate</span>] = []
              <span class="hljs-keyword">if</span> search.text.<span class="hljs-built_in">count</span> &gt;= <span class="hljs-number">3</span> {
                  predicates.append(textPredicate)
              }
  
              <span class="hljs-keyword">if</span> search.app != <span class="hljs-type">Constants</span>.all {
                  predicates.append(appPredicate)
              }
  
              <span class="hljs-keyword">if</span> search.type != <span class="hljs-type">Constants</span>.all {
                  predicates.append(typePredicate)
              }
  
              predicate = <span class="hljs-type">NSCompoundPredicate</span>(andPredicateWithSubpredicates: predicates)
          } <span class="hljs-keyword">else</span> {
              predicate = <span class="hljs-literal">nil</span>
          }
  
          <span class="hljs-keyword">return</span> <span class="hljs-type">FetchRequest</span>&lt;<span class="hljs-type">Book</span>&gt;(
              entity: <span class="hljs-type">Book</span>.entity(),
              sortDescriptors: [
                  <span class="hljs-type">NSSortDescriptor</span>(keyPath: \<span class="hljs-type">Book</span>.date, ascending: <span class="hljs-literal">false</span>)
              ],
              predicate: predicate
          )
      }
  
      <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onSearch</span><span class="hljs-params">(<span class="hljs-number">_</span> search: Search)</span></span> {
          <span class="hljs-keyword">if</span> search.text.<span class="hljs-built_in">count</span> &lt; <span class="hljs-number">3</span> &amp;&amp; search.type != <span class="hljs-type">Constants</span>.all &amp;&amp; search.app != <span class="hljs-type">Constants</span>.all {
              <span class="hljs-keyword">self</span>.search = <span class="hljs-literal">nil</span>
          } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">self</span>.search = search
          }
      }
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">InsideListView</span>: <span class="hljs-title">View</span> </span>{
      @<span class="hljs-type">Environment</span>(\.managedObjectContext)
      <span class="hljs-keyword">var</span> context
  
      <span class="hljs-keyword">var</span> fetchRequest: <span class="hljs-type">FetchRequest</span>&lt;<span class="hljs-type">Book</span>&gt;    <span class="hljs-comment">//åªå£°æ˜,å†…å®¹éœ€è¦ç”±è°ƒç”¨è€…æ¥è®¾å®š</span>
  
      <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
          <span class="hljs-type">List</span>(items) {
              <span class="hljs-type">ForEach</span>
         }
      }
  
      <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> items: <span class="hljs-type">FetchedResults</span>&lt;<span class="hljs-type">Book</span>&gt; {
          fetchRequest.wrappedValue
      }
  }
</code></pre><p>æˆ‘ç›¸ä¿¡ï¼Œä¸‹ä¸€æ­¥SwiftUIåº”è¯¥è¿˜ä¼šæä¾›æ›´å¤šçš„ç›´æ¥å°†çŠ¶æ€æ§åˆ¶åœ¨å±€éƒ¨çš„åŒ…è£…å™¨ã€‚</p><h4>ç¬¬ä¸‰éƒ¨ å’ŒObservedObjectè¯´å†è§</h4><p>åªè¦æˆ‘ä»¬çš„Viewè¿˜éœ€è¦ä¾èµ–å•ä¸€æ•°æ®æºçš„Stateï¼Œå‰é¢æˆ‘ä»¬åšåŠªåŠ›å°±éƒ½ä»˜ä¹‹ä¸œæµäº†ã€‚ä½†åšæŒå•ä¸€æ•°æ®æºçš„è®¾è®¡æ€è·¯åˆæ˜¯ååˆ†æ˜ç¡®çš„ã€‚ç”±äºä»»ä½•çŠ¶æ€çš„å˜åŒ–ObservedObjectåªæœ‰é€šè¿‡ObjectWillChangePublisherè¿™ä¸€ä¸ªé€”å¾„æ¥é€šçŸ¥ä¸å…¶ä¾èµ–çš„Viewï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªèƒ½æ”¾å¼ƒä½¿ç”¨ObservedObjectï¼Œé€šè¿‡è‡ªå·±åˆ›å»ºè§†å›¾å’ŒStateä¸­æ¯ä¸ªç‹¬ç«‹å…ƒç´ çš„ä¾èµ–å…³ç³»ï¼Œå®Œæˆæˆ‘ä»¬çš„ä¼˜åŒ–ç›®çš„ã€‚</p><p>Combineå½“ç„¶æ˜¯é¦–é€‰ã€‚æˆ‘å¸Œæœ›è¾¾åˆ°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p><ul><li>Stateä»ç„¶ä»¥ç›®å‰çš„å½¢å¼ä¿å­˜åœ¨Storeä¸­ï¼Œæ•´ä¸ªç¨‹åºçš„ç»“æ„åŸºæœ¬å’Œä½¿ç”¨ObservedObjectä¸€æ ·</li><li>Stateä¸­æ¯ä¸ªå…ƒç´ å¯ä»¥è‡ªå·±é€šçŸ¥ä¸å…¶ä¾èµ–çš„Viewè€Œä¸é€šè¿‡@Published</li><li>æ¯ä¸ªViewå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦åŒStateä¸­çš„å…ƒç´ å»ºç«‹ä¾èµ–å…³ç³»ï¼ŒStateä¸­å…¶ä»–æ— å…³çš„å˜åŒ–ä¸ä¼šå¯¼è‡´å…¶è¢«å¼ºåˆ¶åˆ·æ–°</li><li>Stateä¸­çš„æ•°æ®ä»ç„¶æ”¯æŒBindingç­‰æ“ä½œï¼Œè€Œä¸”èƒ½å¤Ÿæ”¯æŒå„ç§å½¢å¼çš„ç»“æ„è®¾å®š</li></ul><p>åŸºäºä»¥ä¸Šå‡ ç‚¹ï¼Œæˆ‘æœ€ç»ˆé‡‡ç”¨äº†å¦‚ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼š</p><p>1ã€Storeä¸å˜ï¼Œåªæ˜¯å»æ‰äº†ObservedObject</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Store</span></span>{
  <span class="hljs-keyword">var</span> state = <span class="hljs-type">AppState</span>()
  ...
}
</code></pre><p>2ã€Stateç»“æ„å¦‚ä¸‹</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AppState</span></span>{
  <span class="hljs-keyword">var</span> name = <span class="hljs-type">CurrentValueSubject</span>&lt;<span class="hljs-type">String</span>,<span class="hljs-type">Never</span>&gt;(<span class="hljs-string">"è‚˜å­"</span>)
  <span class="hljs-keyword">var</span> age = <span class="hljs-type">CurrentValueSubject</span>&lt;<span class="hljs-type">Int</span>,<span class="hljs-type">Never</span>&gt;(<span class="hljs-number">100</span>)
}
</code></pre><p>é€šè¿‡ä½¿ç”¨CurrentValueSubjectæ¥åˆ›å»ºæŒ‡å®šç±»å‹çš„Publisherã€‚</p><p>3ã€é€šè¿‡å¦‚ä¸‹æ–¹å¼æ³¨å…¥</p><pre data-language="swift"><code><span class="hljs-comment">//å½“å‰Viewåªéœ€è¦æ˜¾ç¤ºname</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>:<span class="hljs-title">View</span></span>{
  @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> name:<span class="hljs-type">String</span> = <span class="hljs-string">""</span>
  <span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
    <span class="hljs-type">Form</span>{
      <span class="hljs-type">Text</span>(name)
    }
    .onReceive(store.state.name, perform: { name <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">self</span>.name = name
            })
  }
}
</code></pre><p>æˆ‘ä»¬éœ€è¦æ˜¾å¼çš„åœ¨æ¯ä¸ªViewä¸­æŠŠéœ€è¦ä¾èµ–çš„å…ƒç´ å•ç‹¬é€šè¿‡.onReceiveè·å–å¹¶ä¿å­˜åˆ°æœ¬åœ°ã€‚</p><p>4ã€ä¿®æ”¹Stateä¸­çš„å€¼</p><pre data-language="swift"><code><span class="hljs-comment">//åŸºäºView-&gt; Action æ¥ä¿®æ”¹Stateçš„æœºåˆ¶</span>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Store</span></span>{
  <span class="hljs-comment">//ä¾‹ç¨‹å¹¶ééµå¾ªactionï¼Œä¸è¿‡ä¹Ÿæ˜¯è°ƒç”¨Storeï¼Œæ„ä¼šå³å¯</span>
  fune test{
     state.name.value = <span class="hljs-string">"å¤§è‚˜å­"</span>
  }
}

<span class="hljs-comment">//åœ¨ä¸Šé¢çš„ContentViewä¸­æ·»åŠ </span>
<span class="hljs-type">Button</span>(<span class="hljs-string">"ä¿®æ”¹åå­—"</span>){
  store.test()
}
</code></pre><p>5ã€æ”¯æŒBinding</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">CurrentValueSubject</span></span>{
    <span class="hljs-keyword">var</span> binding:<span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Output</span>&gt;{
        <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Output</span>&gt;(<span class="hljs-keyword">get</span>: {<span class="hljs-keyword">self</span>.value}, <span class="hljs-keyword">set</span>: {<span class="hljs-keyword">self</span>.value = $<span class="hljs-number">0</span>})
    }
}
<span class="hljs-comment">//ä½¿ç”¨binding</span>

<span class="hljs-type">TextField</span>(<span class="hljs-string">"å§“å"</span>,text:store.state.name.binding)
</code></pre><p>6ã€å¯¹ç»“æ„ä½“æ”¯æŒBinding</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Student</span></span>{
    <span class="hljs-keyword">var</span> name = <span class="hljs-string">"fat"</span>
    <span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span>
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AppState</span></span>{
      <span class="hljs-keyword">var</span> student = <span class="hljs-type">CurrentValueSubject</span>&lt;<span class="hljs-type">Student</span>,<span class="hljs-type">Never</span>&gt;(<span class="hljs-type">Student</span>())
}

<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">CurrentValueSubject</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">binding</span>&lt;Value&gt;<span class="hljs-params">(<span class="hljs-keyword">for</span> keyPath:WritableKeyPath&lt;Output,Value&gt;)</span></span>-&gt;<span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Value</span>&gt;{
               <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Value</span>&gt;(<span class="hljs-keyword">get</span>: {<span class="hljs-keyword">self</span>.value[keyPath:keyPath]}, 
                              <span class="hljs-keyword">set</span>: { <span class="hljs-keyword">self</span>.value[keyPath:keyPath] = $<span class="hljs-number">0</span>})
    }
}

<span class="hljs-comment">//ä½¿ç”¨Binding</span>
<span class="hljs-type">TextField</span>(<span class="hljs-string">"studentName:"</span>,text: store.state.student.binding(<span class="hljs-keyword">for</span>: \.name))
</code></pre><p>7ã€å¯¹äºæ›´å¤æ‚çš„Stateå…ƒç´ è®¾è®¡çš„Bindingæ”¯æŒã€‚å¦‚æœä½ å´æœ‰å¿…è¦åœ¨Stateä¸­åˆ›å»ºä»¥ä¸ŠBindingæ–¹å¼æ— æ³•æ”¯æŒçš„æ ¼å¼å¯ä»¥é€šè¿‡ä½¿ç”¨æˆ‘å¦ä¸€ç¯‡æ–‡ç« ä¸­ <a href="https://zhuanlan.zhihu.com/p/141229504">@Stateç ”ç©¶</a>æœ€ååˆ›å»ºçš„å¢å¼ºå‹@MyStateæ¥å®Œæˆç‰¹æ®Šçš„éœ€è¦ï¼Œä½ å¯¹æœ¬åœ°çš„ studentAgeåšçš„ä»»ä½•æ”¹åŠ¨éƒ½å°†è‡ªåŠ¨çš„åé¦ˆåˆ°Stateä¸­</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>:<span class="hljs-title">View</span></span>{
  @<span class="hljs-type">MyState</span>&lt;<span class="hljs-type">String</span>&gt;(wrappedValue: <span class="hljs-type">String</span>(store.state.student.value.age), toAction: {
        store.state.student.value.age = <span class="hljs-type">Int</span>($<span class="hljs-number">0</span>) ?? <span class="hljs-number">0</span>
    }) <span class="hljs-keyword">var</span> studentAge
  <span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
     <span class="hljs-type">TextField</span>(<span class="hljs-string">"student age:"</span>,text: $studentAge)   
  }
}
</code></pre><p>è‡³æ­¤æˆ‘ä»¬ä¾¿è¾¾æˆäº†ä¹‹å‰è®¾å®šçš„å…¨éƒ¨ç›®æ ‡ã€‚</p><ul><li>åªå¯¹åŸæœ‰çš„ç¨‹åºç»“æ„åšå¾®å°çš„è°ƒæ•´</li></ul><ul><li>Stateä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¼šåœ¨è‡ªæ”¹åŠ¨æ—¶ç‹¬ç«‹çš„å‘å‡ºé€šçŸ¥</li></ul><ul><li>æ¯ä¸ªViewå¯ä»¥åªä¸è‡ªå·±æœ‰å…³çš„Stateä¸­çš„å…ƒç´ åˆ›å»ºä¾èµ–</li></ul><ul><li>å¯¹Bindingçš„å®Œç¾æ”¯æŒ</li></ul><h4>è¿½åŠ ï¼šå‡å°‘ä»£ç é‡</h4><p>åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä¸Šè¿°è§£å†³æ–¹æ¡ˆä¼šå¯¼è‡´æ¯ä¸ªViewçš„ä»£ç é‡æœ‰äº†ä¸€å®šçš„å¢é•¿ã€‚å°¤å…¶æ˜¯å½“ä½ å¿˜äº†å†™.onReceiveæ—¶ï¼Œç¨‹åºå¹¶ä¸ä¼šæŠ¥é”™ï¼Œä½†åŒæ—¶æ•°æ®ä¸ä¼šå®æ—¶å“åº”ï¼Œåå€’å¢åŠ æ’æŸ¥é”™è¯¯çš„éš¾åº¦ã€‚é€šè¿‡ä½¿ç”¨å±æ€§åŒ…è£…å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†Publisherè®¢é˜…å’Œå˜é‡å£°æ˜åˆäºŒä¸ºä¸€ï¼Œè¿›ä¸€æ­¥çš„ä¼˜åŒ–ä¸Šè¿°çš„è§£å†³æ–¹æ¡ˆã€‚</p><pre data-language="swift"><code><span class="hljs-meta">@propertyWrapper</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ObservedPublisher</span>&lt;<span class="hljs-title">P</span>:<span class="hljs-title">Publisher</span>&gt;:<span class="hljs-title">DynamicProperty</span> <span class="hljs-title">where</span> <span class="hljs-title">P</span>.<span class="hljs-title">Failure</span> == <span class="hljs-title">Never</span></span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> publisher:<span class="hljs-type">P</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> cancellable:<span class="hljs-type">AnyCancellable?</span> = <span class="hljs-literal">nil</span>
    
    @<span class="hljs-type">State</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> wrappedValue:<span class="hljs-type">P</span>.<span class="hljs-type">Output</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> updateWrappedValue = <span class="hljs-type">MutableHeapWrapper</span>&lt;(<span class="hljs-type">P</span>.<span class="hljs-type">Output</span>)-&gt;<span class="hljs-type">Void</span>&gt;({ <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> })
    
    <span class="hljs-keyword">init</span>(publisher:<span class="hljs-type">P</span>,initial:<span class="hljs-type">P</span>.<span class="hljs-type">Output</span>) {
        <span class="hljs-keyword">self</span>.publisher = publisher
        <span class="hljs-keyword">self</span>._wrappedValue = .<span class="hljs-keyword">init</span>(wrappedValue: initial)
        
        <span class="hljs-keyword">let</span> updateWrappedValue = <span class="hljs-keyword">self</span>.updateWrappedValue
        <span class="hljs-keyword">self</span>._cancellable = .<span class="hljs-keyword">init</span>(initialValue:  publisher
            .delay(<span class="hljs-keyword">for</span>: .nanoseconds(<span class="hljs-number">1</span>), scheduler: <span class="hljs-type">RunLoop</span>.main)
            .sink(receiveValue: {
                updateWrappedValue.value($<span class="hljs-number">0</span>)
            }))
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">mutating</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">update</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">let</span> _wrappedValue = <span class="hljs-keyword">self</span>._wrappedValue
        updateWrappedValue.value = {
            _wrappedValue.wrappedValue = $<span class="hljs-number">0</span>}
    }
    
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MutableHeapWrapper</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> value: <span class="hljs-type">T</span>
    
    @inlinable
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>(<span class="hljs-number">_</span> value: <span class="hljs-type">T</span>) {
        <span class="hljs-keyword">self</span>.value = value
    }
}
</code></pre><p>ä¸Šé¢çš„ä»£ç æ¥è‡ªäºå¼€æºé¡¹ç›®SwiftUIXï¼Œæˆ‘å¯¹å…¶è¿›è¡Œäº†å¾ˆå°ä¿®æ”¹ä½¿å…¶èƒ½å¤Ÿé€‚é…CurrentValueSubject</p><p>ä½¿ç”¨æ–¹æ³•</p><pre data-language="swift"><code>@<span class="hljs-type">ObservedPublisher</span>(publisher: store.state.title, initial: <span class="hljs-string">""</span>) <span class="hljs-keyword">var</span> title
</code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥çš„å‡å°‘äº†ä»£ç é‡ï¼Œå¹¶ä¸”åŸºæœ¬æ¶ˆé™¤äº†ç”±äºæ¼å†™.onReceiveè€Œå¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚</p><p>ä¸Šè¿°ä»£ç æˆ‘å·²ç»æ”¾åˆ°äº†<a href="https://github.com/fatbobman/MySingleSoureOfTruthDemo">Github</a></p><h2>æ€»ç»“</h2><p>ä¹‹æ‰€ä»¥è¿›è¡Œè¿™æ–¹é¢çš„æ¢è®¨æ˜¯ç”±äºæˆ‘çš„appå‡ºç°äº†å“åº”çš„ç²˜æ»ï¼ˆå’Œæˆ‘å¿ƒç›®ä¸­iOSå¹³å°ä¸Šè¯¥æœ‰çš„ä¸æ»‘æ„Ÿæœ‰è½å·®ï¼‰ã€‚åœ¨ç ”ç©¶å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¹Ÿè®©æˆ‘å¯¹SwiftUIçš„æœ‰äº†è¿›ä¸€æ­¥çš„è®¤è¯†ã€‚æ— è®ºæˆ‘æå‡ºçš„æ€è·¯æ˜¯å¦æ­£ç¡®ï¼Œè‡³å°‘æ•´ä¸ªè¿‡ç¨‹è®©æˆ‘è·ç›ŠåŒªæµ…ã€‚</p><p>åœ¨æˆ‘åšè¿™æ–¹é¢å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæ°å¥½ä¹Ÿå‘ç°äº†å¦å¤–ä¸€ä½æœ‹å‹æå‡ºäº†ç±»ä¼¼çš„è§‚ç‚¹ï¼Œå¹¶æå‡ºäº†ä»–çš„è§£å†³æ–¹æ¡ˆã€‚ç”±äºä»–ä¹‹å‰æœ‰RxSwiftä¸Šå¼€å‘å¤§å‹é¡¹ç›®çš„ç»éªŒï¼Œä»–çš„è§£å†³æ–¹æ¡ˆä½¿ç”¨äº†å¿«ç…§ï¼ˆSnapShotï¼‰çš„æ¦‚å¿µã€‚æ³¨å…¥æ–¹å¼é‡‡ç”¨EnvironmetKeyï¼Œå¯¹äºStateå…ƒç´ çš„æ— æ•ˆä¿®æ”¹ï¼ˆæ¯”å¦‚è¯´å’ŒåŸå€¼ç›¸åŒï¼‰åšäº†æ¯”è¾ƒå¥½çš„è¿‡æ»¤ã€‚å¯ä»¥åˆ°<a href="https://nalexn.github.io/swiftui-observableobject/">ä»–çš„åšå®¢</a>æŸ¥çœ‹è¯¥æ–‡ã€‚</p><p>æœ€åå¸Œæœ›Appleèƒ½å¤Ÿåœ¨å°†æ¥æä¾›æ›´åŸç”Ÿçš„æ–¹å¼è§£å†³ä»¥ä¸Šé—®é¢˜ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/swiftUI-state</guid><title>@stateç ”ç©¶</title><description>æœ¬æ–‡è¯•å›¾æ¢è®¨å¹¶åˆ†æSwiftUI ä¸­ @Stateçš„å®ç°æ–¹å¼å’Œè¿è¡Œç‰¹å¾ï¼›æœ€åæä¾›äº†ä¸€ä¸ªæœ‰å…³æ‰©å±•@StateåŠŸèƒ½çš„æ€è·¯åŠä¾‹ç¨‹ã€‚è¯»è€…éœ€è¦å¯¹SwiftUIçš„å“åº”å¼ç¼–ç¨‹æœ‰åŸºæœ¬æ¦‚å¿µã€‚</description><link>http://www.fatbobman.com/posts/swiftUI-state</link><pubDate>Sun, 17 May 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>æœ¬æ–‡è¯•å›¾æ¢è®¨å¹¶åˆ†æSwiftUI ä¸­ @Stateçš„å®ç°æ–¹å¼å’Œè¿è¡Œç‰¹å¾ï¼›æœ€åæä¾›äº†ä¸€ä¸ªæœ‰å…³æ‰©å±•@StateåŠŸèƒ½çš„æ€è·¯åŠä¾‹ç¨‹ã€‚è¯»è€…éœ€è¦å¯¹SwiftUIçš„å“åº”å¼ç¼–ç¨‹æœ‰åŸºæœ¬æ¦‚å¿µã€‚</p></blockquote><h2>ç ”ç©¶çš„æ„ä¹‰ä½•åœ¨</h2><p>æˆ‘åœ¨å»å¹´åº•ä½¿ç”¨äº†SwiftUIå†™äº†ç¬¬ä¸€ä¸ª iOS app <strong>å¥åº·ç¬”è®°</strong>ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦å“åº”å¼ç¼–ç¨‹æ¦‚å¿µã€‚åœ¨æœ‰äº†äº›åŸºæœ¬çš„è®¤è¯†å’Œå°è¯•åï¼Œæ·±æ·±çš„è¢«è¿™ç§ç¼–ç¨‹çš„æ€è·¯æ‰€æ‰“åŠ¨ã€‚ä¸è¿‡ï¼Œæˆ‘åœ¨ä½¿ç”¨ä¸­ä¹Ÿå‘ç°äº†ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ã€‚å°±åƒä¹‹å‰åœ¨ <a href="https://zhuanlan.zhihu.com/p/103822455">è€äººæ–°å…µ</a> ä¸­è¯´çš„é‚£æ ·ï¼Œæˆ‘å‘ç°åœ¨è§†å›¾ï¼ˆViewï¼‰æ•°é‡è¾¾åˆ°ä¸€å®šç¨‹åº¦ï¼Œéšç€æ•°æ®é‡çš„å¢åŠ ï¼Œæ•´ä¸ªappçš„å“åº”æœ‰äº›å¼€å§‹è¿Ÿé’ï¼Œå˜å¾—æœ‰ç²˜æ»æ„Ÿã€ä¸è·Ÿæ‰‹ã€‚appå“åº”å‡ºç°äº†é—®é¢˜ä¸€æ–¹é¢è‚¯å®šå’Œæˆ‘çš„ä»£ç æ•ˆç‡ã€æ•°æ®ç»“æ„è®¾è®¡æ¬ ä½³æœ‰å…³ï¼›ä¸è¿‡éšç€ç»§ç»­åˆ†æï¼Œå‘ç°å…¶ä¸­ä¹Ÿæœ‰å¾ˆå¤§éƒ¨åˆ†åŸå› æ¥è‡ªäºSwiftUIä¸­æ‰€ä½¿ç”¨çš„å“åº”å¼çš„å®ç°æ–¹å¼ã€‚ä¸æ°å½“çš„ä½¿ç”¨ï¼Œå¯èƒ½å¯¼è‡´å“åº”é€Ÿåº¦ä¼šéšç€æ•°æ®é‡åŠViewé‡çš„å¢åŠ è€Œå¤§å¹…ä¸‹é™ã€‚é€šè¿‡ä¸€æ®µæ—¶é—´çš„ç ”ç©¶å’Œåˆ†æï¼Œæˆ‘æ‰“ç®—ç”¨ä¸¤ç¯‡æ–‡ç« æ¥é˜è¿°è¿™æ–¹é¢çš„é—®é¢˜ï¼Œå¹¶å°è¯•æä¾›ä¸€ä¸ªç°é˜¶æ®µçš„ä½¿ç”¨æ€è·¯ã€‚</p><h2>æ•°æ®ï¼ˆçŠ¶æ€ï¼‰é©±åŠ¨</h2><p>åœ¨SwiftUIä¸­ï¼Œè§†å›¾æ˜¯ç”±æ•°æ®ï¼ˆçŠ¶æ€ï¼‰é©±åŠ¨çš„ã€‚æŒ‰ç…§è‹¹æœçš„è¯´æ³•ï¼Œè§†å›¾æ˜¯çŠ¶æ€çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯äº‹ä»¶çš„åºåˆ—ï¼ˆThe views are a function of state, not a sequence of eventsï¼‰ã€‚æ¯å½“è§†å›¾åœ¨åˆ›å»ºæˆ–è§£ææ—¶ï¼Œéƒ½ä¼šä¸ºè¯¥è§†å›¾å’Œä¸è¯¥è§†å›¾ä¸­ä½¿ç”¨çš„çŠ¶æ€æ•°æ®ä¹‹é—´åˆ›å»ºä¸€ä¸ªä¾èµ–å…³ç³»ï¼Œæ¯å½“çŠ¶æ€çš„ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ˜¯ï¼Œæœ‰ä¾èµ–å…³ç³»çš„è§†å›¾åˆ™ä¼šé©¬ä¸Šååº”å‡ºè¿™äº›å˜åŒ–å¹¶é‡ç»˜ã€‚SwiftUIä¸­æä¾›äº†è¯¸å¦‚ @State ObservedObject EnvironmentObjectç­‰æ¥åˆ›å»ºåº”å¯¹ä¸åŒç±»å‹ã€ä¸åŒä½œç”¨åŸŸçš„çŠ¶æ€å½¢å¼ã€‚</p><img src="http://cdn.fatbobman.com/state-study-image.jpg" alt="ç±»å‹åŠä½œç”¨åŸŸ"/><center>å›¾ç‰‡æ¥è‡ªäºSwiftUI for Absoloute Beginners</center><p>å…¶ä¸­@Stateåªèƒ½ç”¨äºå½“å‰è§†å›¾ï¼Œå¹¶ä¸”å…¶å¯¹åº”çš„æ•°æ®ç±»å‹ä¸ºå€¼ç±»å‹ï¼ˆå¦‚æœéè¦å¯¹åº”å¼•ç”¨ç±»å‹çš„è¯åˆ™å¿…é¡»åœ¨æ¯æ¬¡èµ‹å€¼æ—¶é‡æ–°åˆ›å»ºæ–°çš„å®ä¾‹æ‰å¯ä»¥ï¼‰ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DemoView</span>:<span class="hljs-title">View</span></span>{
  @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">"è‚˜å­"</span>
  <span class="hljs-keyword">var</span> body:some <span class="hljs-type">View</span>{
    <span class="hljs-type">VStack</span>{
      <span class="hljs-type">Text</span>(name)
      <span class="hljs-type">Button</span>(<span class="hljs-string">"æ”¹å"</span>){
        <span class="hljs-keyword">self</span>.name = <span class="hljs-string">"å¤§è‚˜å­"</span>
      }
    }
  }
}
</code></pre><p>é€šè¿‡æ‰§è¡Œä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸¤ä¸ªæƒ…å†µï¼š</p><ol><li>é€šè¿‡ä½¿ç”¨@Stateï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœªä½¿ç”¨mutatingçš„æƒ…å†µä¸‹ä¿®æ”¹ç»“æ„ä¸­çš„å€¼</li></ol><ol start="2"><li>å½“çŠ¶æ€å€¼å‘ç”Ÿå˜åŒ–åï¼Œè§†å›¾ä¼šè‡ªåŠ¨é‡ç»˜ä»¥ååº”çŠ¶æ€çš„å˜åŒ–ã€‚</li></ol><h2>@Stateå¦‚ä½•å·¥ä½œçš„</h2><p>åœ¨åˆ†æ@Stateå¦‚ä½•å·¥ä½œä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªçŸ¥è¯†ç‚¹</p><h3>å±æ€§åŒ…è£…å™¨</h3><p>ä½œä¸ºswift 5.1çš„æ–°å¢åŠŸèƒ½ä¹‹ä¸€ï¼Œ<a href="https://swiftgg.gitbook.io/swift/swift-jiao-cheng/10_properties#property-wrappers">å±æ€§åŒ…è£…å™¨åœ¨ç®¡ç†å±æ€§å¦‚ä½•å­˜å‚¨å’Œå®šä¹‰å±æ€§çš„ä»£ç ä¹‹é—´æ·»åŠ äº†ä¸€ä¸ªåˆ†å‰²å±‚</a>ã€‚é€šè¿‡è¯¥ç‰¹æ€§ï¼Œå¯ä»¥åœ¨å¯¹å€¼æ ¡éªŒã€æŒä¹…åŒ–ã€ç¼–è§£ç ç­‰å¤šä¸ªæ–¹é¢è·å¾—æ”¶ç›Šã€‚</p><p>å®ƒçš„å®ç°ä¹Ÿå¾ˆç®€å•,ä¸‹é¢çš„ä¾‹å­å®šä¹‰äº†ä¸€ä¸ªåŒ…è£…å™¨ç”¨æ¥ç¡®ä¿å®ƒåŒ…è£…çš„å€¼å§‹ç»ˆå°äºç­‰äº12ã€‚å¦‚æœè¦æ±‚å®ƒå­˜å‚¨ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå®ƒåˆ™ä¼šå­˜å‚¨ 12 è¿™ä¸ªæ•°å­—ã€‚å‘ˆç°å€¼(æŠ•å°„å€¼)åˆ™è¿”å›å½“å‰åŒ…è£…å€¼æ˜¯å¦ä¸ºå¶æ•°</p><pre data-language="swift"><code><span class="hljs-meta">@propertyWrapper</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TwelveOrLess</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> number: <span class="hljs-type">Int</span>
    <span class="hljs-keyword">init</span>() { <span class="hljs-keyword">self</span>.number = <span class="hljs-number">0</span> }
    <span class="hljs-keyword">var</span> wrappedValue: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> number }
        <span class="hljs-keyword">set</span> { number = <span class="hljs-built_in">min</span>(newValue, <span class="hljs-number">12</span>) }
    }
    <span class="hljs-keyword">var</span> projectedValue: <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">self</span>.number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>
    }
}
</code></pre><p>æ›´å¤šçš„å…·ä½“èµ„æ–™è¯·æŸ¥é˜…<a href="https://swiftgg.gitbook.io/swift/swift-jiao-cheng/10_properties#property-wrappers">å®˜æ–¹æ–‡æ¡£</a></p><h3>Binding</h3><p>Bindingæ˜¯æ•°æ®çš„ä¸€çº§å¼•ç”¨ï¼Œåœ¨SwiftUIä¸­ä½œä¸ºæ•°æ®ï¼ˆçŠ¶æ€ï¼‰åŒå‘ç»‘å®šçš„æ¡¥æ¢ï¼Œå…è®¸åœ¨ä¸æ‹¥æœ‰æ•°æ®çš„æƒ…å†µä¸‹å¯¹æ•°æ®è¿›è¡Œè¯»å†™æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥ç»‘å®šåˆ°å¤šç§ç±»å‹ï¼ŒåŒ…æ‹¬ State ObservedObject ç­‰ï¼Œç”šè‡³è¿˜å¯ä»¥ç»‘å®šåˆ°å¦ä¸€ä¸ªBindingä¸Šé¢ã€‚Bindingæœ¬èº«å°±æ˜¯ä¸€ä¸ªGetterå’ŒSetterçš„å°è£…ã€‚</p><h3>State çš„å®šä¹‰</h3><pre data-language="swift"><code>@frozen <span class="hljs-meta">@propertyWrapper</span> <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">Value</span>&gt; : <span class="hljs-title">DynamicProperty</span> </span>{

    <span class="hljs-comment">/// Initialize with the provided initial value.</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>(wrappedValue value: <span class="hljs-type">Value</span>)

    <span class="hljs-comment">/// Initialize with the provided initial value.</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>(initialValue value: <span class="hljs-type">Value</span>)

    <span class="hljs-comment">/// The current state value.</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> wrappedValue: <span class="hljs-type">Value</span> { <span class="hljs-keyword">get</span> <span class="hljs-keyword">nonmutating</span> <span class="hljs-keyword">set</span> }

    <span class="hljs-comment">/// Produces the binding referencing this state value</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> projectedValue: <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Value</span>&gt; { <span class="hljs-keyword">get</span> }
}
</code></pre><h3>DynamicProperty çš„å®šä¹‰</h3><pre data-language="swift"><code><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">DynamicProperty</span> </span>{

    <span class="hljs-comment">/// Called immediately before the view's body() function is</span>
    <span class="hljs-comment">/// executed, after updating the values of any dynamic properties</span>
    <span class="hljs-comment">/// stored in `self`.</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">update</span><span class="hljs-params">()</span></span>
}
</code></pre><h3>å·¥ä½œåŸç†</h3><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ @State æœ‰ä¸¤ä¸ªä½œç”¨</p><ol><li>é€šè¿‡ä½¿ç”¨@Stateï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœªä½¿ç”¨mutatingçš„æƒ…å†µä¸‹ä¿®æ”¹ç»“æ„ä¸­çš„å€¼</li><li>å½“çŠ¶æ€å€¼å‘ç”Ÿå˜åŒ–åï¼Œè§†å›¾ä¼šè‡ªåŠ¨é‡ç»˜ä»¥ååº”çŠ¶æ€çš„å˜åŒ–ã€‚</li></ol><p>è®©æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„çŸ¥è¯†ç‚¹æ¥åˆ†æå¦‚ä½•æ‰èƒ½å®ç°ä»¥ä¸ŠåŠŸèƒ½ã€‚</p><ul><li>@Stateæœ¬èº«åŒ…å« @propertyWrapper,æ„å‘³ç€ä»–æ˜¯ä¸€ä¸ªå±æ€§åŒ…è£…å™¨ã€‚</li></ul><ul><li>public var wrappedValue: Value { get nonmutating set } æ„å‘³ç€ä»–çš„åŒ…è£…å€¼å¹¶æ²¡æœ‰ä¿å­˜åœ¨æœ¬åœ°ã€‚</li></ul><ul><li>å®ƒçš„å‘ˆç°å€¼ï¼ˆæŠ•å°„å€¼ï¼‰ä¸ºBindingç±»å‹ã€‚ä¹Ÿå°±æ˜¯åªæ˜¯ä¸€ä¸ªç®¡é“ï¼Œå¯¹åŒ…è£…æ•°æ®çš„å¼•ç”¨</li></ul><ul><li>éµå¾ª DynamicProperty åè®®ï¼Œè¯¥åè®®å®Œæˆäº†åˆ›å»ºæ•°æ®ï¼ˆçŠ¶æ€ï¼‰å’Œè§†å›¾çš„ä¾èµ–æ“ä½œæ‰€éœ€æ¥å£ã€‚ç°åœ¨åªæš´éœ²äº†å¾ˆå°‘çš„æ¥å£ï¼Œæˆ‘ä»¬æš‚æ—¶æ— æ³•å®Œå…¨ä½¿ç”¨å®ƒã€‚</li></ul><p>åœ¨äº†è§£äº†ä»¥ä¸Šå‡ ç‚¹åï¼Œæˆ‘ä»¬æ¥å°è¯•ä½¿ç”¨è‡ªå·±çš„ä»£ç æ¥æ„å»ºä¸€ä¸ª@Stateçš„<strong><em>åŠæˆå“</em></strong></p><pre data-language="swift"><code><span class="hljs-meta">@propertyWrapper</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyStates</span>:<span class="hljs-title">DynamicProperty</span></span>{
    <span class="hljs-keyword">init</span>(wrappedValue:<span class="hljs-type">String</span>){
        <span class="hljs-type">UserDefaults</span>.standard.<span class="hljs-keyword">set</span>(wrappedValue, forKey: <span class="hljs-string">"myString"</span>)
    }
    
    <span class="hljs-keyword">var</span> wrappedValue:<span class="hljs-type">String</span>{
        <span class="hljs-keyword">nonmutating</span> <span class="hljs-keyword">set</span>{<span class="hljs-type">UserDefaults</span>.standard.<span class="hljs-keyword">set</span>(newValue, forKey: <span class="hljs-string">"myString"</span>)}
        <span class="hljs-keyword">get</span>{<span class="hljs-type">UserDefaults</span>.standard.string(forKey: <span class="hljs-string">"myString"</span>) ?? <span class="hljs-string">""</span>}
    }
    
    <span class="hljs-keyword">var</span> projectedValue:<span class="hljs-type">Binding</span>&lt;<span class="hljs-type">String</span>&gt;{
        <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">String</span>&gt;(
            <span class="hljs-keyword">get</span>:{<span class="hljs-type">String</span>(<span class="hljs-keyword">self</span>.wrappedValue)},
            <span class="hljs-keyword">set</span>:{
                <span class="hljs-keyword">self</span>.wrappedValue = $<span class="hljs-number">0</span>
        }
        )
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">update</span><span class="hljs-params">()</span></span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"é‡ç»˜è§†å›¾"</span>)
    }
}
</code></pre><p>è¿™æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨æ¥åŒ…è£…Stringç±»å‹çš„Stateã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨UserDefaultå°†æ•°æ®åŒ…è£…åä¿å­˜åˆ°æœ¬åœ°ã€‚è¯»å–åŒ…è£…æ•°æ®ä¹Ÿæ˜¯ä»æœ¬åœ°çš„UserDefaulté‡Œè¯»å–çš„ã€‚</p><p>ä¸ºäº†èƒ½å¤ŸåŒ…è£…å…¶ä»–çš„ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†èƒ½å¤Ÿæé«˜å­˜å‚¨æ•ˆç‡ï¼Œè¿›ä¸€æ­¥çš„å¯ä»¥ä¿®æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š</p><pre data-language="swift"><code><span class="hljs-meta">@propertyWrapper</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyState</span>&lt;<span class="hljs-title">Value</span>&gt;:<span class="hljs-title">DynamicProperty</span></span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _value:<span class="hljs-type">Value</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _location:<span class="hljs-type">AnyLocation</span>&lt;<span class="hljs-type">Value</span>&gt;?
    
    <span class="hljs-keyword">init</span>(wrappedValue:<span class="hljs-type">Value</span>){
        <span class="hljs-keyword">self</span>._value = wrappedValue
        <span class="hljs-keyword">self</span>._location = <span class="hljs-type">AnyLocation</span>(value: wrappedValue)
    }
    
    <span class="hljs-keyword">var</span> wrappedValue:<span class="hljs-type">Value</span>{
        <span class="hljs-keyword">get</span>{ _location?._value.pointee ?? _value}
        <span class="hljs-keyword">nonmutating</span> <span class="hljs-keyword">set</span>{ _location?._value.pointee = newValue}
    }
    
    <span class="hljs-keyword">var</span> projectedValue:<span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Value</span>&gt;{
        <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Value</span>&gt;(
            <span class="hljs-keyword">get</span>:{<span class="hljs-keyword">self</span>.wrappedValue},
            <span class="hljs-keyword">set</span>:{<span class="hljs-keyword">self</span>._location?._value.pointee = $<span class="hljs-number">0</span>}
        )
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">update</span><span class="hljs-params">()</span></span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"é‡ç»˜è§†å›¾"</span>)
    }
}


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnyLocation</span>&lt;<span class="hljs-title">Value</span>&gt;</span>{
    <span class="hljs-keyword">let</span> _value = <span class="hljs-type">UnsafeMutablePointer</span>&lt;<span class="hljs-type">Value</span>&gt;.allocate(capacity: <span class="hljs-number">1</span>)
    <span class="hljs-keyword">init</span>(value:<span class="hljs-type">Value</span>){
        <span class="hljs-keyword">self</span>._value.pointee = value
    }
}
</code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†è¿™ä¸ª@MyStateçš„åŠæˆå“ã€‚</p><p>ä¹‹æ‰€ä»¥è¯´æ˜¯åŠæˆå“ï¼Œå› ä¸ºå°½ç®¡æˆ‘ä»¬ä¹Ÿéµå¾ªäº†DynamicPropertyåè®®ï¼Œä½†æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„è¿™æ®µä»£ç å¹¶ä¸èƒ½å’Œè§†å›¾å»ºç«‹ä¾èµ–ã€‚æˆ‘ä»¬å¯ä»¥å’Œä½¿ç”¨@Stateä¸€æ ·æ¥ä½¿ç”¨@MyStateï¼ŒåŒæ ·æ”¯æŒç»‘å®šã€ä¿®æ”¹ï¼Œé™¤äº†è§†å›¾ä¸ä¼šè‡ªåŠ¨åˆ·æ–°ğŸ˜‚ã€‚</p><p>ä½†è‡³å°‘æˆ‘ä»¬å¯ä»¥å¤§æ¦‚äº†è§£@Stateæ˜¯å¦‚ä½•è®©æˆ‘ä»¬åœ¨è§†å›¾ä¸­ä¿®æ”¹ã€ç»‘å®šæ•°æ®çš„ã€‚</p><h3>ä»€ä¹ˆæ—¶å€™å»ºç«‹çš„ä¾èµ–ï¼Ÿ</h3><p>æˆ‘ç›®å‰æ— æ³•æ‰¾åˆ°ä»»ä½•å…³äºSwiftUIå»ºç«‹ä¾èµ–çš„æ›´å…·ä½“çš„èµ„æ–™æˆ–å®ç°çº¿ç´¢ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤æ®µä»£ç æ¥çŒœæµ‹ç¼–è¯‘å™¨æ˜¯å¦‚ä½•å¤„ç†æ•°æ®å’Œè§†å›¾ä¹‹é—´çš„ä¾èµ–å…³è”æ—¶æœºçš„ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MainView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> date: <span class="hljs-type">String</span> = <span class="hljs-type">Date</span>().description
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"mainView"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-type">Form</span> {
            <span class="hljs-type">SubView</span>(date: $date)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"ä¿®æ”¹æ—¥æœŸ"</span>) {
                <span class="hljs-keyword">self</span>.date = <span class="hljs-type">Date</span>().description
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SubView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">Binding</span> <span class="hljs-keyword">var</span> date: <span class="hljs-type">String</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"subView"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-type">Text</span>(date)
    }
}
</code></pre><p>æ‰§è¡Œè¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ç‚¹å‡»<strong>ä¿®æ”¹æ—¥æœŸ</strong> ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡º</p><pre data-language="bash"><code>mainView
subView
subView
...
</code></pre><p>è™½ç„¶æˆ‘ä»¬åœ¨MainViewä¸­ä½¿ç”¨@Stateå£°æ˜äº†dateï¼Œå¹¶ä¸”åœ¨MainViewä¸­ä¿®æ”¹äº†dateçš„å€¼ï¼Œä½†ç”±äºæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨MainViewä¸­ä½¿ç”¨dateçš„å€¼æ¥è¿›è¡Œæ˜¾ç¤ºæˆ–è€…åˆ¤æ–­ï¼Œæ‰€ä»¥æ— è®ºæˆ‘ä»¬å¦‚ä½•ä¿®æ”¹dateå€¼ï¼ŒMainViewéƒ½ä¸ä¼šé‡ç»˜ã€‚æˆ‘æ¨æµ‹@StateåŒè§†å›¾çš„ä¾èµ–æ˜¯åœ¨ViewBuilderè§£ææ—¶è¿›è¡Œçš„ã€‚ç¼–è¯‘å™¨åœ¨è§£ææˆ‘ä»¬çš„bodyæ—¶ï¼Œä¼šåˆ¤æ–­dateçš„æ•°æ®å˜åŒ–æ˜¯å¦ä¼šå¯¹å½“å‰è§†å›¾é€ æˆæ”¹å˜ã€‚å¦‚æœæ²¡æœ‰åˆ™ä¸å»ºç«‹ä¾èµ–å…³è”ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨å¦ä¸€æ®µä»£ç æ¥åˆ†æç¼–è¯‘å™¨å¯¹ ObservedObject çš„ååº”ã€‚</p><pre data-language="swift"><code><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MainView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">ObservedObject</span> <span class="hljs-keyword">var</span> store = <span class="hljs-type">AppStore</span>()
    
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"mainView"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-type">Form</span> {
            <span class="hljs-type">SubView</span>(date: $store.date)
            <span class="hljs-type">Button</span>(<span class="hljs-string">"ä¿®æ”¹æ—¥æœŸ"</span>) {
                <span class="hljs-keyword">self</span>.store.date = <span class="hljs-type">Date</span>().description
            }
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SubView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">Binding</span> <span class="hljs-keyword">var</span> date: <span class="hljs-type">String</span>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"subView"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-type">Text</span>(date)
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppStore</span>:<span class="hljs-title">ObservableObject</span></span>{
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> date:<span class="hljs-type">String</span> = <span class="hljs-type">Date</span>().description
}
</code></pre><p>æ‰§è¡Œåè¾“å‡ºå¦‚ä¸‹ï¼š</p><pre data-language="bash"><code>mainView
subView
mainView
subView
...
</code></pre><p>æˆ‘ä»¬æŠŠ@Stateæ¢æˆäº†@ObservedObject ï¼ŒåŒæ ·åœ¨MainViewä¸­å¹¶æ²¡æœ‰æ˜¾ç¤ºstore.dateçš„å€¼æˆ–è€…ç”¨å…¶æ¥åšåˆ¤æ–­ï¼Œä½†æ˜¯åªè¦æˆ‘ä»¬æ”¹å˜äº†storeé‡Œçš„dateå€¼ï¼ŒMainViewä¾¿ä¼šåˆ·æ–°é‡ç»˜ã€‚ç”±æ­¤å¯ä»¥æ¨æµ‹ï¼ŒSwiftUIå¯¹äºObservedObjecté‡‡ç”¨äº†ä¸åŒçš„ä¾èµ–åˆ›å»ºæ—¶æœºï¼Œåªè¦å£°æ˜ï¼Œæ— è®ºbodyé‡Œæ˜¯å¦æœ‰éœ€è¦ï¼Œåœ¨ObservableObjectçš„objectWillChangeäº§ç”Ÿsendåï¼Œéƒ½ä¼šè¿›è¡Œé‡ç»˜ã€‚å› æ­¤ObservedObjectå¾ˆå¯èƒ½æ˜¯åœ¨åˆå§‹åŒ–MainViewçš„æ—¶å€™å»ºç«‹çš„ä¾èµ–å…³ç³»ã€‚</p><p>ä¹‹æ‰€ä»¥èŠ±æ°”åŠ›æ¥åˆ¤æ–­è¿™ä¸ªé—®é¢˜ï¼Œ<strong>å› ä¸ºè¿™ä¸¤ç§åˆ›å»ºä¾èµ–çš„æ—¶æœºçš„ä¸åŒä¼šå¯¼è‡´Viewæ›´æ–°æ•ˆç‡çš„å·¨å¤§å·®å¼‚ã€‚è¿™ä¸ªå·®å¼‚ä¹Ÿæ­£æ˜¯æˆ‘ä¸‹ä¸€ç¯‡æ–‡ç« è¦é‡ç‚¹æ¢è®¨çš„åœ°æ–¹</strong>ã€‚</p><h2>æ‰“é€ é€‚åˆè‡ªå·±çš„å¢å¼ºå‹ @State</h2><p>@Stateä½¿ç”¨å±æ€§åŒ…è£…å™¨è¿™ä¸ªç‰¹æ€§æ¥å®ç°äº†å®ƒæ—¢å®šçš„åŠŸèƒ½ï¼Œä¸è¿‡å±æ€§åŒ…è£…å™¨è¿˜è¢«å¹¿æ³›ç”¨äºæ•°æ®éªŒè¯ã€å‰¯ä½œç”¨ç­‰ä¼—å¤šé¢†åŸŸï¼Œæˆ‘ä»¬èƒ½å¦å°†ä¼—å¤šåŠŸèƒ½å±æ€§é›†äºä¸€èº«ï¼Ÿ</p><p>æœ¬æ–‡æˆ‘ä»¬è‡ªå·±é€šè¿‡ä»£ç æ‰“é€ çš„@StateåŠæˆå“å¹¶ä¸èƒ½åˆ›å»ºå’Œè§†å›¾çš„ä¾èµ–ï¼Œæˆ‘ä»¬å¦‚ä½•æ‰èƒ½å®Œæˆè¿™ç§ä¾èµ–å…³è”çš„åˆ›å»ºï¼Ÿ</p><p>@Stateä¸ä»…å¯ä»¥è¢«ç”¨äºå¯¹å±æ€§çš„åŒ…è£…ï¼ŒåŒæ—¶Stateæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ç»“æ„ä½“ã€‚å®ƒé€šè¿‡å†…éƒ¨æ²¡æœ‰æš´éœ²çš„åŠŸèƒ½æ¥å£å®Œæˆäº†åŒè§†å›¾çš„ä¾èµ–åˆ›å»ºã€‚</p><p>ä»¥ä¸‹ä¸¤ç§ä½¿ç”¨æ–¹å¼æ˜¯ç­‰æ•ˆçš„ï¼š</p><pre data-language="swift"><code>@<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">""</span>
<span class="hljs-keyword">self</span>.name = <span class="hljs-string">"è‚˜å­"</span>
</code></pre><pre data-language="swift"><code><span class="hljs-keyword">var</span> name = <span class="hljs-type">State</span>&lt;<span class="hljs-type">String</span>&gt;(wrappedValue:<span class="hljs-string">""</span>)
<span class="hljs-keyword">self</span>.name.wrappedValue = <span class="hljs-string">"è‚˜å­"</span>
</code></pre><p>å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†Stateä½œä¸ºåŒ…è£…å€¼ç±»å‹ï¼Œåˆ›å»ºæ–°çš„å±æ€§åŒ…è£…å™¨ï¼Œæ¥å®ç°æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡ â€”â€” å®Œæ•´åŠŸèƒ½ã€å¯ä»»æ„æ‰©å±•çš„å¢å¼ºå‹@Stateã€‚</p><pre data-language="swift"><code><span class="hljs-meta">@propertyWrapper</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyState</span>&lt;<span class="hljs-title">Value</span>&gt;:<span class="hljs-title">DynamicProperty</span></span>{
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">Action</span> = (<span class="hljs-type">Value</span>) -&gt; <span class="hljs-type">Void</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _value:<span class="hljs-type">State</span>&lt;<span class="hljs-type">Value</span>&gt;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _toAction:<span class="hljs-type">Action?</span>
    
    <span class="hljs-keyword">init</span>(wrappedValue value:<span class="hljs-type">Value</span>){
        <span class="hljs-keyword">self</span>._value = <span class="hljs-type">State</span>&lt;<span class="hljs-type">Value</span>&gt;(wrappedValue: value)
    }
    
    <span class="hljs-keyword">init</span>(wrappedValue value:<span class="hljs-type">Value</span>,toAction:@escaping <span class="hljs-type">Action</span>){
        <span class="hljs-keyword">self</span>._value = <span class="hljs-type">State</span>&lt;<span class="hljs-type">Value</span>&gt;(wrappedValue: value)
        <span class="hljs-keyword">self</span>._toAction = toAction
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> wrappedValue: <span class="hljs-type">Value</span> {
        <span class="hljs-keyword">get</span> {<span class="hljs-keyword">self</span>._value.wrappedValue}
        <span class="hljs-keyword">nonmutating</span> <span class="hljs-keyword">set</span> {<span class="hljs-keyword">self</span>._value.wrappedValue = newValue}
    }Ã·
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> projectedValue: <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Value</span>&gt;{
        <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">Value</span>&gt;(
            <span class="hljs-keyword">get</span>: {<span class="hljs-keyword">self</span>._value.wrappedValue},
            <span class="hljs-keyword">set</span>: {
                <span class="hljs-keyword">self</span>._value.wrappedValue = $<span class="hljs-number">0</span>
                <span class="hljs-keyword">self</span>._toAction?($<span class="hljs-number">0</span>)
        }
        )
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">update</span><span class="hljs-params">()</span></span> {
       <span class="hljs-built_in">print</span>(<span class="hljs-string">"è§†å›¾é‡ç»˜"</span>)
    }
    
    
}
</code></pre><p>è¿™æ®µä»£ç ä»…ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä»»æ„åˆ›å»ºè‡ªå·±æ‰€éœ€çš„åŠŸèƒ½ã€‚</p><pre data-language="swift"><code>@<span class="hljs-type">MyState</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">"hello"</span>  <span class="hljs-comment">//å®ç°å’Œæ ‡å‡†@Stateä¸€æ ·çš„åŠŸèƒ½</span>
</code></pre><pre data-language="swift"><code>@<span class="hljs-type">MyState</span>&lt;<span class="hljs-type">String</span>&gt;(
  wrappedValue: <span class="hljs-string">"hello"</span>, 
  toAction: {<span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>)}
) <span class="hljs-keyword">var</span> name
<span class="hljs-comment">//åœ¨æ¯æ¬¡èµ‹å€¼åï¼ˆåŒ…æ‹¬é€šè¿‡Bindingä¿®æ”¹ï¼‰æ‰§è¡Œ toAction å®šä¹‰çš„å‡½æ•°</span>
</code></pre><h2>æ¥ä¸‹æ¥ï¼Ÿ</h2><p>åœ¨å“åº”å¼ç¼–ç¨‹å¼€å§‹æµè¡Œçš„ä»Šå¤©ï¼Œè¶Šæ¥è¶Šå¤šçš„äººéƒ½åœ¨ä½¿ç”¨å•ä¸€æ•°æ®æºï¼ˆSingle Souce of Truthï¼‰çš„æ„æ¶æ–¹å¼è¿›è¡Œè®¾è®¡å’Œå¼€å‘ã€‚å¦‚ä½•ä½¿ç”¨@Stateè¿™ç§ä½œç”¨åŸŸèŒƒå›´ä»…é™äºå½“å‰è§†å›¾çš„ç‰¹æ€§ï¼Ÿä»…ä»å‘½åæ¥çœ‹ï¼Œè‹¹æœç»™äº†ä»–æœ€æœ¬è´¨çš„åç§°â€”â€”Stateã€‚Stateå±äºSwiftUIæ¶æ„ï¼ŒObservableObjectå±äºCombineæ¶æ„ï¼ŒSwiftUIæ˜æ˜¾å¯¹äºStateçš„ä¼˜åŒ–è¦å¥½äºObservableObjectã€‚å¦‚ä½•åœ¨æ»¡è¶³å•ä¸€æ•°æ®æºçš„æƒ…å†µä¸‹æœ€å¤§é™åº¦äº«å—SwiftUIçš„ä¼˜åŒ–ä¾¿åˆ©ï¼Ÿæˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è¿›è¡Œè¿›ä¸€æ­¥æ¢è®¨ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/vapor4</guid><title>Vapor4 çš„å®‰è£…ä¸é…ç½®</title><description>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨mac 10.5.4å’Œubuntu 18.04ä¸‹å®‰è£…Vaporå‘½ä»¤è¡Œå·¥å…·ï¼Œåˆ›å»ºVaporé¡¹ç›®ï¼Œç®€å•çš„è°ƒè¯•é¡¹ç›®ä»¥åŠå¦‚ä½•éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹ã€‚æ–‡ä¸­çš„è¿è¡Œç¯å¢ƒä¸º: Vapor4,Swift5.2,Catalina 10.5.4,Ubuntu18.04</description><link>http://www.fatbobman.com/posts/vapor4</link><pubDate>Thu, 7 May 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<blockquote><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨mac 10.5.4å’Œubuntu 18.04ä¸‹å®‰è£…Vaporå‘½ä»¤è¡Œå·¥å…·ï¼Œåˆ›å»ºVaporé¡¹ç›®ï¼Œç®€å•çš„è°ƒè¯•é¡¹ç›®ä»¥åŠå¦‚ä½•éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹ã€‚æ–‡ä¸­çš„è¿è¡Œç¯å¢ƒä¸º: Vapor4,Swift5.2,Catalina 10.5.4,Ubuntu18.04</p></blockquote><p>æœ€è¿‘æ–°å¼€é€šäº†ä¸€ä¸ªäº‘æœåŠ¡å™¨ï¼ˆLinuxç³»ç»Ÿï¼‰ï¼Œä½¿ç”¨<a href="https://hexo.io/zh-cn/index.html/">Hexo</a>åˆ›å»ºäº†æ–°çš„åšå®¢ç½‘é¡µã€‚è€ƒè™‘å¢åŠ ç‚¹ç®€å•çš„äº¤äº’åŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦åœ¨æœåŠ¡å™¨ç«¯æ·»åŠ é€»è¾‘å¤„ç†èƒ½åŠ›ã€‚ç”±äºè¿‘åŠå¹´æ¥åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ä½¿ç”¨Swiftï¼Œæ‰€ä»¥æ‰“ç®—å°è¯•ä¸€ä¸‹Server Side Swiftã€‚æ²¡æœ‰å¤ªä»”ç»†é€‰æ‹©å„ç§æ¡†æ¶ï¼Œçœ‹è¿‡å‡ ä¸ªä»‹ç»Vaporä½¿ç”¨çš„è§†é¢‘åï¼Œæ„Ÿè§‰ä¸é”™ï¼Œä¾¿å¼€å§‹å°è¯•å®‰è£…é…ç½®ã€‚</p><p>Vaporçš„å®˜æ–¹æ–‡æ¡£å®åœ¨æ˜¯æœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œç½‘ä¸Šçš„ä¸å°‘å¿ƒå¾—ã€æ•™ç¨‹åˆæœ‰ç‚¹é™ˆæ—§ï¼ˆç›®å‰ç‰ˆæœ¬è°ƒæ•´è¾ƒå¤§ï¼‰ã€‚é€šè¿‡ä¸¤å¤©çš„æŠ˜è…¾ï¼Œç»ˆäºåŸºæœ¬ä¸Šç†å‡ºäº†è„‰ç»œï¼Œåˆæ­¥æ­å»ºäº†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒã€‚</p><h2>ä»€ä¹ˆæ˜¯Vapor</h2><p><a href="https://github.com/vapor/vapor">Vapor</a>æ˜¯ä¸€ä¸ªä½¿ç”¨swiftè¯­è¨€ç¼–å†™çš„Webç½‘ç»œæ¡†æ¶ï¼Œå®ƒæ˜¯è·¨å¹³å°çš„ï¼ˆmacã€Linuxï¼‰ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨swiftè¯­è¨€ä»¥åŠå…¶ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“æ¥é«˜æ•ˆçš„å®Œæˆå¤šç§ç½‘ç»œæœåŠ¡ã€‚</p><pre data-language="swift"><code><span class="hljs-keyword">import</span> Vapor

<span class="hljs-keyword">let</span> app = <span class="hljs-keyword">try</span> <span class="hljs-type">Application</span>()
<span class="hljs-keyword">let</span> router = <span class="hljs-keyword">try</span> app.make(<span class="hljs-type">Router</span>.<span class="hljs-keyword">self</span>)

router.<span class="hljs-keyword">get</span>(<span class="hljs-string">"hello"</span>) { req <span class="hljs-keyword">in</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, world."</span>
}

<span class="hljs-keyword">try</span> app.run()
</code></pre><p>ä¸Šé¢çš„ä»£ç å˜å¯ä»¥å®Œæˆä¸€ä¸ªæœ€åŸºæœ¬çš„ç½‘ç»œæœåŠ¡ã€‚è®¿é—® <code>http://localhost:8080/hello</code> ç½‘é¡µè¿”å› <em>hello, world.</em></p><p>ä½ å¯ä»¥åœ¨macæˆ–Linuxå¹³å°ä¸Šå¼€å‘ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å°†é€šè¿‡Vaporæ¡†æ¶å¼€å‘çš„é¡¹ç›®éƒ¨ç½²åˆ°macæˆ–Linuxå¹³å°ä¸Šã€‚</p><h2>ä»€ä¹ˆæ˜¯Vaper å‘½ä»¤è¡Œå·¥å…·</h2><p>Vaperå‘½ä»¤è¡Œå·¥å…·çš„ä½œç”¨æœ‰ï¼š</p><ul><li>åŸºäºæ¨¡æ¿åˆ›å»ºVaperé¡¹ç›®</li><li>é…ç½®ã€ç¼–è¯‘ã€è¿è¡Œé¡¹ç›®</li><li>å…¶ä»–é…åˆæ“ä½œç³»ç»Ÿçš„ä¸€äº›åŠŸèƒ½</li></ul><p>ä½†å®ƒä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœç”¨æˆ·å·²ç»å¾ˆç†Ÿæ‚‰Vaporçš„å¼€å‘å’Œé…ç½®ï¼Œæ— è®ºæ˜¯åœ¨å¼€å‘ç¯å¢ƒè¿˜æ˜¯è¿è¡Œç¯å¢ƒéƒ½å¯ä»¥ä¸ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚ä¸è¿‡å¯¹äºåƒæˆ‘è¿™æ ·çš„æ–°æ‰‹æ¥è¯´ï¼Œæ— ç–‘å®ƒæ˜¯ä¸€ä¸ªå¥½çš„å¸®æ‰‹ã€‚</p><h3>å¼€å‘Vaperé¡¹ç›®éœ€è¦çš„èµ„æº</h3><ul><li>mac æˆ– Linux ï¼Œæˆ‘ç›®å‰åœ¨Catalina 10.5.4 å’Œ Ubuntu 18.04ä¸‹éƒ½æˆåŠŸå®Œæˆäº†é…ç½®</li><li>swiftè¯­è¨€ç¯å¢ƒï¼Œç›®å‰Vapor4å¯ä»¥åœ¨swift5.2ä¸‹è¿è¡Œ</li><li>webæœåŠ¡å™¨ï¼Œæˆ‘ç›®å‰ä½¿ç”¨Nginx ï¼ˆå¦‚æœåªæ˜¯ç”¨äºå¼€å‘æµ‹è¯•ï¼Œä¹Ÿå¯ä»¥ä¸é…ç½®ï¼‰</li></ul><h2>å®‰è£…swift</h2><h3>Mac</h3><p>åœ¨macå¹³å°ä¸‹ï¼Œå®‰è£…XcodeåŠXcode ommand Line Toolsï¼ŒVapor4å¯¹xcodeæä¾›äº†éå¸¸å‹å¥½çš„æ”¯æŒï¼Œå¯ä»¥åƒå…¶ä»–çš„swifté¡¹ç›®ä¸€æ ·ä½¿ç”¨å…¨éƒ¨çš„Xcodeçš„å„ç§èƒ½åŠ›ï¼ˆæ¯”å¦‚æ–­ç‚¹è°ƒè¯•ï¼‰ã€‚</p><h4>Ubuntu 18.04</h4><pre data-language="bash"><code>sudo apt-get install clang
sudo apt-get install libcurl3 libpython2.7 libpython2.7-dev 

<span class="hljs-comment">#ä»swift.orgæ‰¾åˆ°éœ€è¦çš„æ–‡ä»¶</span>

wget https://swift.org/builds/swift-5.2.3-release/ubuntu1804/swift-5.2.3-RELEASE/swift-5.2.3-RELEASE-ubuntu18.04.tar.gz

tar xzvf swift-5.2.3-RELEASE-ubuntu18.04.tar.gz
sudo mv swift-5.2.3-RELEASE-ubuntu18.04 /usr/share/swift

<span class="hljs-built_in">echo</span> <span class="hljs-string">"export PATH=/usr/share/swift/usr/bin:<span class="hljs-variable">$PATH</span>"</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">source</span>  ~/.bashrc
</code></pre><p>æˆ‘ä¹Ÿä½¿ç”¨è¿‡Dockerå®‰è£…Swift5.2ï¼Œä¸è¿‡Imageæœ‰ç‚¹å¤ªå¤§ï¼Œéœ€è¦1.2Gbå·¦å³çš„ç©ºé—´ã€‚</p><pre data-language="bash"><code><span class="hljs-comment">#Dockerå®‰è£…Swiftçš„æ–¹æ³•ã€‚</span>
docker pull swift
</code></pre><h2>å®‰è£…Vaporå‘½ä»¤è¡Œå·¥å…·</h2><h3>MacOS</h3><pre data-language="shell"><code>brew tap vapor/tap
brew install vapor
<span class="hljs-meta">#</span><span class="bash">æˆ‘ç›®å‰å®‰è£…çš„æ˜¯ vapor-beta</span>
<span class="hljs-meta">#</span><span class="bash">brew install vapor-beta</span>
<span class="hljs-meta">#</span><span class="bash">æ‰§è¡Œvaporæµ‹è¯•ä¸€ä¸‹</span>
vapor
</code></pre><h3>Ubuntu 1804</h3><p>Ubuntuä¸‹å®‰è£…Vapor toolboxç•¥å¾®éº»çƒ¦ï¼Œä¸»è¦æ˜¯ç›®å‰çš„Vapor Toolboxæºæ–‡ä»¶æœ‰ç‚¹é—®é¢˜éœ€è¦åšä¸€äº›ä¿®æ”¹æ‰èƒ½æ­£å¸¸ç¼–è¯‘ã€‚</p><p>é¦–å…ˆä¿è¯å·²æˆåŠŸå®‰è£… <strong>swift</strong></p><pre data-language="bash"><code><span class="hljs-built_in">cd</span> ~
git <span class="hljs-built_in">clone</span> https://github.com/vapor/toolbox.git
<span class="hljs-built_in">cd</span> toolbox
</code></pre><p>åœ¨ Test ç›®å½•ä¸‹ åˆ›å»ºä¸€ä¸ª <strong>LinuxMain.swift</strong> æ–‡ä»¶</p><pre data-language="swift"><code><span class="hljs-keyword">import</span> XCTest
<span class="hljs-meta">@testable</span> <span class="hljs-keyword">import</span> AppTests
<span class="hljs-type">XCTMain</span>([testCase(<span class="hljs-type">AppTests</span>.allTests)])
</code></pre><p><strong><em>è¿™ä¸ªæ˜¯Swift SPMéœ€è¦çš„æ–‡ä»¶ï¼Œä¸Šé¢æˆ‘åªå†™äº†ä¸ªæœ€ç®€å•çš„èƒ½å¤Ÿå®Œæˆç¼–è¯‘å³å¯ï¼Œä¸æ¸…æ¥šä¸ºä»€ä¹ˆå®˜æ–¹çš„gitæºä¸åŒ…å«è¿™ä¸ªæ–‡ä»¶ã€‚</em></strong></p><p>ä¿®æ”¹ Source/VaporToolbox/exec.swift æ–‡ä»¶</p><p>åœ¨36è¡Œå·¦å³ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰æ‰¾åˆ°</p><pre data-language="undefined"><code>
let spawned = posix_spawnp(&pid, argv[0], &fileActions, nil, argv + [nil], envp + [nil])
</code></pre><p>ä¿®æ”¹æˆ</p><pre data-language="swift"><code><span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> _argv0 = argv[<span class="hljs-number">0</span>] <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"unwrap error"</span>)
        }
<span class="hljs-keyword">let</span> spawned = posix_spawnp(&amp;pid, _argv, &amp;fileActions, <span class="hljs-literal">nil</span>, argv + [<span class="hljs-literal">nil</span>], envp + [<span class="hljs-literal">nil</span>])
</code></pre><p><strong><em>åŒæ ·ä¸æ¸…æ¥šä¸ºä»€ä¹ˆä»£ç ä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªé”™è¯¯ã€‚</em></strong></p><p>å®Œæˆä¸Šè¿°ä¿®æ”¹å</p><pre data-language="bash"><code><span class="hljs-built_in">cd</span> ~/toolbox
swift build -c release --<span class="hljs-built_in">disable</span>-sandbox
sudo mv .build/release/vapor /usr/<span class="hljs-built_in">local</span>/bin
</code></pre><p><em>ä»¥ä¸Šæ­¥éª¤åœ¨æˆ‘æœ¬åœ°çš„Ubuntuä¸Šå·²å¯æ­£å¸¸ç¼–è¯‘ï¼Œä¸è¿‡åœ¨æˆ‘çš„è…¾è®¯äº‘ä¸»æœºä¸Šï¼Œç¼–è¯‘æ—¶ä¼šç¼ºå°‘ä¸€ä¸ªç›¸å…³åº“ï¼Œæ·»åŠ ä¸Šåå³å¯æ­£å¸¸ç¼–è¯‘ã€‚</em></p><pre data-language="bash"><code>sudo apt-get install libcurl4 -y
</code></pre><p>è‡³æ­¤Vapor Toolbox å®‰è£…å®Œæ¯•ã€‚</p><p><em>Toolboxçš„ç›®å½•ä¸­åŒ…å«äº†Dockerfileï¼Œä½¿ç”¨å®ƒå¯ä»¥ç›´æ¥å°†toolboxç”Ÿæˆä¸€ä¸ªDocker Imageï¼Œå¹¶ä¸”ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½swiftçš„Docker Imageã€‚ä¸è¿‡æˆ‘åœ¨Ubuntuä¸Šä½¿ç”¨è¿™ç§æ–¹æ³•å®‰è£…åï¼ˆå·²é…ç½®entrypointï¼‰ï¼Œvaporçš„Imageæ²¡æœ‰åå­—ï¼Œåªæœ‰container idï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡idæ¥è¿è¡Œã€‚ä¸ªäººç›®å‰ä¸æ¨èè¿™ç§æ–¹å¼ã€‚</em></p><h2>ä½¿ç”¨ Vaporå‘½ä»¤è¡Œå·¥å…·</h2><h3>åˆ›å»ºé¡¹ç›®</h3><pre data-language="bash"><code><span class="hljs-comment">#vapor new &lt;projectname&gt; [--template]</span>
vapor new hello
</code></pre><p>ä½¿ç”¨ç¼ºçœæ¨¡æ¿åˆ›å»ºä¸€ä¸ªåä¸º hello çš„Vaporé¡¹ç›®ã€‚</p><p>åˆ›å»ºçš„è¿‡ç¨‹å…¶å®å°±æ˜¯ä»githubä¸Šcloneä¸€ä¸ªæ¨¡æ¿ï¼Œå¹¶å¯å¸®ä½ è¿›è¡Œç®€å•é…ç½®ã€‚å¦‚æœå·²ç»æ¯”è¾ƒç†Ÿæ‚‰çš„è¯ä¹Ÿå¯ä»¥ä¸é€‚ç”¨å·¥å…·ï¼Œç›´æ¥ä»githubä¸Š<a href="https://github.com/vapor?q=template&type=&language=">å…‹éš†æ¨¡æ¿</a>å¼€å§‹é¡¹ç›®ã€‚</p><p>åœ¨Macç³»ç»Ÿä¸‹ï¼Œæ¨¡æ¿å¯ä»¥ç›´æ¥ç¼–è¯‘è¿è¡Œï¼Œä¸è¿‡Linuxä¸‹ï¼Œgitæºä»ç„¶ç¼ºå°‘ <strong>LinuxMain.swift</strong> æ–‡ä»¶ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•ï¼Œåœ¨é¡¹ç›®ä¸­åŠ å…¥è¯¥æ–‡ä»¶åæ–¹å¯ç¼–è¯‘ã€‚</p><p>cloneå®Œæˆåï¼Œç³»ç»Ÿä¼šæœ‰å¦‚ä¸‹æç¤ºï¼š</p><pre data-language="bash"><code>Would you like to use Fluent? y
æ•°æ®åº“ç±»å‹é€‰æ‹© <span class="hljs-comment">#æˆ‘é€‰æ‹©äº† sqllite</span>
</code></pre><p>ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„é€‰æ‹©ç›´æ¥åœ¨æ¨¡æ¿ä¸­åˆ›å»ºå¥½ç›¸åº”çš„ä»£ç ã€‚ï¼ˆ<a href="https://github.com/vapor/fluent">Fluent</a> æ˜¯ä¸€ä¸ªswiftå†™çš„ORMï¼‰</p><h3>ç¼–è¯‘é¡¹ç›®</h3><pre data-language="bash"><code><span class="hljs-built_in">cd</span> ~/hello
vapor build
</code></pre><p>æˆ‘åœ¨ubuntuä¸‹æ‰§è¡Œ<strong>vapor new</strong>å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œä¸è¿‡<strong>vapor build</strong>æ‰§è¡ŒæŠ¥é”™ã€‚å› æ­¤å°±ç›´æ¥ä½¿ç”¨ <strong>swift build</strong> æ¥ç¼–è¯‘é¡¹ç›®ã€‚å…¶å®<strong>build</strong> å’Œ <strong>run</strong> éƒ½æ˜¯ç›´æ¥è°ƒç”¨çš„ <strong>swift</strong> å‘½ä»¤ã€‚</p><h3>è¿è¡Œé¡¹ç›®</h3><pre data-language="bash"><code>vapor run 
<span class="hljs-comment">#ç³»ç»Ÿæ˜¾ç¤ºï¼Œè¯´æ˜é¡¹ç›®å·²æ­£å¸¸å¯åŠ¨ã€‚å¯ä»¥é€šè¿‡ http://127.0.0.1:8080 è®¿é—®</span>
Environment(name: <span class="hljs-string">"development"</span>, arguments: [<span class="hljs-string">".build/x86_64-apple-macosx/debug/Run"</span>])
[ NOTICE ] Server starting on http://127.0.0.1:8080
</code></pre><p>å¯ä»¥åœ¨è¿è¡Œå‘½ä»¤åé¢æ·»åŠ è¿è¡ŒçŠ¶æ€ï¼Œå¯¹äºéƒ¨ç½²å°¤ä¸ºé‡è¦ã€‚</p><pre data-language="bash"><code>vapor run --env prod 
<span class="hljs-comment"># test prod dev å¯¹åº”ä¸åŒçš„çŠ¶æ€ï¼Œä¸»è¦å…³ç³»åˆ°æ˜¯å¦æ˜¾ç¤ºæ“ä½œæ—¥å¿—ç­‰</span>
</code></pre><p>å¦‚æœæ˜¯Macç³»ç»Ÿï¼Œä½¿ç”¨</p><pre data-language="bash"><code>vapor xcode 
</code></pre><p>ç›´æ¥æ‰“å¼€Xcodeï¼Œç„¶åå°±å¯ä»¥ç›´æ¥åœ¨Xcodeä¸‹ç¼–è¾‘ã€ç¼–è¯‘ã€è°ƒè¯•ã€è¿è¡Œã€‚</p><p>å³ä½¿æ²¡æœ‰å®‰è£…Vapor Toolboxä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºXcodeé¡¹ç›®</p><pre data-language="bash"><code>swift package generate-xcodeproj
</code></pre><p>æŒ‰ç…§ä¸Šè¿°çš„æ­¥éª¤å®‰è£…åï¼Œæ— è®ºåœ¨Macä¸Šè¿˜æ˜¯Ubuntuä¸Šæˆ‘ä»¬éƒ½å¯ä»¥å¼€å§‹ç¼–å†™å¹¶è¿è¡Œè‡ªå·±çš„Vaporé¡¹ç›®äº†ã€‚</p><h2>æ¨¡æ¿é¡¹ç›®ç®€å•åˆ†æ</h2><p>æœ¬èŠ‚æˆ‘ä»¬é€šè¿‡å¯¹æ¨¡æ¿ä»£ç çš„ç®€å•åˆ†ææ¥å¿«é€Ÿæ„Ÿå—ä¸€ä¸‹Vaporçš„ä¾¿æ·ã€‚</p><p>æˆ‘ä½¿ç”¨çš„æ˜¯é¡¹ç›®ç¼ºçœæ¨¡æ¿ï¼Œå¯ç”¨Fluentï¼Œæ•°æ®åº“é€‰æ‹©çš„æ˜¯sqliteã€‚</p><p>é¡¹ç›®æºæ–‡ä»¶å­˜åœ¨Sourcesç›®å½•ä¸‹ã€‚</p><img src="http://cdn.fatbobman.com/vapor4-struct.png" alt="ç›®å½•ç»“æ„"/><p><strong>main.swift</strong>ä½œä¸ºç¨‹åºçš„å…¥å£ï¼Œåˆ›å»ºäº†VaporæœåŠ¡</p><p><strong>configure.swift</strong>ä¸­ç”±äºæˆ‘ä»¬é€‰æ‹©äº†ä½¿ç”¨sqliteï¼Œå› æ­¤ç³»ç»Ÿä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆäº†ä½¿ç”¨æ•°æ®åº“æ‰€éœ€çš„ä»£ç ã€‚ä¸‹åˆ—ä»£ç å®Œæˆæ•°æ®åº“çš„åˆ›å»ºå·¥ä½œã€‚</p><pre data-language="swift"><code>app.migrations.add(<span class="hljs-type">CreateTodo</span>())
</code></pre><p>ä¸ºäº†èƒ½å¤Ÿå®Œæ•´çš„è¿è¡Œè¿™ä¸ªæ¨¡æ¿é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ</p><pre data-language="bash"><code>vapor run migrate
</code></pre><p>ç³»ç»Ÿå°†åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å®Œæˆdb.sqliteé‡Œçš„è¡¨åˆ›å»ºå·¥ä½œã€‚å¦‚æœæ²¡æœ‰æ‰§è¡Œè¿™ä¸ªæ­¥éª¤ï¼Œè®¿é—® localhost:8080/todos å°†åœ¨å¾—åˆ°å¦‚ä¸‹çš„é”™è¯¯æç¤ºã€‚</p><pre data-language="bash"><code>[ ERROR ] error: no such table: todos
</code></pre><p><strong>Xcodeçš„ç”¨æˆ·ä¹Ÿå¯ä»¥ç›´æ¥åœ¨Schemeä¸­çš„Argumentsæ·»åŠ  --auto-migrate å®Œæˆä¸Šè¿°åŠŸèƒ½ã€‚</strong></p><p><strong>å¦å¤–ï¼Œæœ€å¥½åœ¨Xcodeä¸­å°†Scheme -- Run -- Working Directoryè®¾ç½®æˆå½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œè¿™æ ·æ— è®ºä½¿ç”¨å‘½ä»¤è¡Œï¼Œè¿˜æ˜¯ç›´æ¥ä½¿ç”¨Xcodeéƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªSqliteæ–‡ä»¶ã€‚</strong></p><pre data-language="swift"><code><span class="hljs-comment">//app.middleware.use(FileMiddleware(publicDirectory: app.directory.publicDirectory))</span>
</code></pre><p>å¦‚æœå–æ¶ˆè¿™ä¸€å¥çš„æ³¨é‡Šï¼ŒVaporå°†æä¾›å¯¹é™æ€æ–‡ä»¶çš„æ”¯æŒã€‚æˆ‘ä»¬å¯ä»¥æŠŠé™æ€æ–‡ä»¶æ”¾å…¥é¡¹ç›®æ ¹ç›®å½•çš„ Publicç›®å½•ä¸­ï¼Œå³å¯è®¿é—®ã€‚ 127.0.0.1:8080/index.html ã€‚å¦‚æœå’Œå…¶ä»–WebServeré…åˆä½¿ç”¨çš„è¯ï¼Œæˆ‘æ„Ÿè§‰è¿˜æ˜¯ç”¨å¦‚Nginxæ¥æä¾›é™æ€æ–‡ä»¶çš„æ”¯æŒæ¯”è¾ƒå¥½ã€‚</p><p>routes.swift**ä½œä¸ºé¡¹ç›®çš„æ ¸å¿ƒï¼Œåœ¨å…¶ä¸­å®Œæˆç½‘ç»œçš„è·¯ç”±é€»è¾‘è®¾å®šã€‚</p><pre data-language="swift"><code><span class="hljs-keyword">import</span> Fluent
<span class="hljs-keyword">import</span> Vapor

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">routes</span><span class="hljs-params">(<span class="hljs-number">_</span> app: Application)</span></span> <span class="hljs-keyword">throws</span> {
    <span class="hljs-comment">/*
    è®¿é—®  127.0.0.1:8080/  è¿”å›ï¼šIt works!
    */</span>
    app.<span class="hljs-keyword">get</span> { req <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"It works!"</span>
    }
    
    <span class="hljs-comment">//   localhost:8080/hello    è¿”å›: "Hello world"</span>
    app.<span class="hljs-keyword">get</span>(<span class="hljs-string">"hello"</span>) { req -&gt; <span class="hljs-type">String</span> <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, world!"</span>
    }

    <span class="hljs-keyword">let</span> todoController = <span class="hljs-type">TodoController</span>()
    <span class="hljs-comment">/*
    ä»¥ä¸‹æ“ä½œæˆ‘ä½¿ç”¨postmanè¿›è¡Œæµ‹è¯•
    post 127.0.0.1:8080/todos bodyå†…å®¹: {"title":"ä¸œå¡è‚˜å­"}  æ·»åŠ ä¸€æ¡è®°å½•
    get 127.0.0.1:8080/todos æ˜¾ç¤ºå·²æ·»åŠ çš„è®°å½•
    del 127.0.0.1:8080/todos/B508471F-FF5F-422C-B384-C300FD7B49D9 åˆ é™¤ä¸€æ¡è®°å½•ã€‚idä½¿ç”¨æ˜¾ç¤ºè®°å½•è·å–
    */</span>
    app.<span class="hljs-keyword">get</span>(<span class="hljs-string">"todos"</span>, use: todoController.index)
    app.post(<span class="hljs-string">"todos"</span>, use: todoController.create)
    app.delete(<span class="hljs-string">"todos"</span>, <span class="hljs-string">":todoID"</span>, use: todoController.delete)
}
</code></pre><p>æ›´å…·ä½“çš„åº”ç”¨å°±ä¸å±•å¼€äº†ã€‚ä¸è¿‡ä»…ä»æ¨¡æ¿ä¾‹ç¨‹ä¸Šæˆ‘ä»¬ä¾¿å¯ä»¥æ„Ÿè§‰åˆ°Vaporçš„ä¾¿åˆ©å’Œé«˜æ•ˆã€‚</p><h2>å’ŒNginx é…åˆä½¿ç”¨</h2><p>é€šè¿‡ç¼–è¾‘nginxçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„Vaporé¡¹ç›®ä¾¿å¯ä»¥å¯¹å¤–å‘å¸ƒäº†ã€‚</p><pre data-language="nginx"><code><span class="hljs-section">server</span> {
        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;
        <span class="hljs-attribute">server_name</span>  localhost;
  
        <span class="hljs-attribute">location</span> / {
          <span class="hljs-attribute">root</span>   html;
          <span class="hljs-attribute">index</span>   index.html index.htm;
          <span class="hljs-attribute">try_files</span>  <span class="hljs-variable">$uri</span> <span class="hljs-variable">@proxy</span>;
        }

        <span class="hljs-attribute">location</span> <span class="hljs-variable">@proxy</span> {
               <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8080;
               <span class="hljs-attribute">proxy_pass_header</span> Server;
               <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;
               <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;
               <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
               <span class="hljs-attribute">proxy_pass_header</span> Server;
               <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">3s</span>;
               <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">10s</span>;
}
</code></pre><p>ç°åœ¨ä½ å°±å¯ä»¥é€šè¿‡ <code>http://ä½ çš„åŸŸåæˆ–åœ°å€/todos</code> æ¥è®¿é—®ä½ çš„é¡¹ç›®ã€‚</p><p>æˆ‘ä½¿ç”¨Vaporçš„ç›®çš„æ˜¯ä¸ºäº†é…åˆè‡ªå·±çš„åšå®¢ï¼Œæ‰€ä»¥ä»éœ€é…åˆæˆ‘è‡ªå·±åŸæœ‰çš„é¡µé¢ä½¿ç”¨ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¦‚ä¸‹çš„é…ç½®ã€‚</p><p>å³ä½¿æ‰“å¼€äº†Vaporçš„é™æ€é¡µé¢æ”¯æŒï¼Œå¦‚æœæˆ‘æŠŠVaporé¡¹ç›®é…ç½®åœ¨/çš„è¯ï¼ˆå·²å–æ¶ˆVaporå¯¹æ ¹çš„å“åº”ï¼‰ï¼Œä»ç„¶éœ€è¦æ˜ç¡®çš„è¾“å…¥ <code>http://æˆ‘çš„åŸŸå/index.html</code>æ‰èƒ½è®¿é—®åˆ°ç´¢å¼•é¡µé¢ã€‚æ²¡æœ‰åŠæ³•æ‰æŠŠä»–è½¬åˆ° /api/ä¸‹ã€‚</p><pre data-language="nginx"><code><span class="hljs-section">server</span> {
        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;
        <span class="hljs-attribute">server_name</span>  localhost;
  
        <span class="hljs-attribute">location</span> / {
            <span class="hljs-attribute">root</span>   html;
            <span class="hljs-attribute">index</span>  index.html index.htm;
        }

        <span class="hljs-attribute">location</span> /api {
          <span class="hljs-attribute">root</span>   html;
          <span class="hljs-attribute">index</span>   index.html index.htm;
          <span class="hljs-attribute">try_files</span>  <span class="hljs-variable">$uri</span> <span class="hljs-variable">@proxy</span>;
        }

        <span class="hljs-attribute">location</span> <span class="hljs-variable">@proxy</span> {
               <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8080;
               <span class="hljs-attribute">proxy_pass_header</span> Server;
               <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;
               <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;
               <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
               <span class="hljs-attribute">proxy_pass_header</span> Server;
               <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">3s</span>;
               <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">10s</span>;
}
</code></pre><p>å¦‚æ­¤é…ç½®åï¼Œéœ€è¦å¯¹ä»£ç  routes.swift è¿›è¡Œæ”¹åŠ¨åå³å¯æ­£å¸¸è®¿é—®ã€‚</p><pre data-language="swift"><code>app.<span class="hljs-keyword">get</span>(<span class="hljs-string">"api"</span>,<span class="hljs-string">"hello"</span>) { req -&gt; <span class="hljs-type">String</span> <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, world!"</span>
    }
</code></pre><p>å¦‚æœè°çŸ¥é“å¦‚ä½•è®¾ç½®èƒ½å¤Ÿç›´æ¥å°†/è½¬å‘åˆ°Vaporè€Œåˆå¯ä»¥ ç›´æ¥ä½¿ç”¨ http://æˆ‘çš„åŸŸå æ¥è®¿é—®åŸæœ‰çš„é¡µé¢çƒ¦è¯·å‘ŠçŸ¥ä¸€ä¸‹ã€‚</p><h2>éƒ¨ç½²</h2><h3>ä¿®æ”¹è¿è¡Œç«¯å£</h3><p>Vapor4å¯¹äºæŒ‡å®šè¿è¡Œç«¯å£å’Œä¹‹å‰æœ‰äº†è¾ƒå¤§çš„åŒºåˆ«ã€‚</p><p>åœ¨main.swiftä¸­åšå¦‚ä¸‹ä¿®æ”¹</p><pre data-language="swift"><code>app.http.server.configuration.hostname = <span class="hljs-string">"127.0.0.1"</span> <span class="hljs-comment">//å“åº”çš„åœ°å€ 0.0.0.0 </span>
app.http.server.configuration.port = <span class="hljs-number">8000</span> <span class="hljs-comment">//å¸Œæœ›è®¾å®šçš„ç«¯å£</span>
<span class="hljs-keyword">try</span> configure(app)
</code></pre><p>ç›®å‰æˆ‘æ²¡æœ‰æ‰¾åˆ°å¦‚ä½•åœ¨å‘½ä»¤è¡Œä¸‹è®¾ç½®è¿è¡Œç«¯å£ï¼ˆVapor3ä¹‹å‰çš„æ–¹æ³•å¥½åƒå·²ç»ä¸æ”¯æŒäº†ï¼‰ã€‚å¦‚æœæœ‰äººäº†è§£çƒ¦è¯·å‘ŠçŸ¥ä¸€ä¸‹ã€‚</p><h3>æ‰‹åŠ¨éƒ¨ç½²</h3><p>ç”±äºæˆ‘ç›®å‰ä¹Ÿè¿˜åˆšåˆšå¼€å§‹æ¥è§¦Vaporï¼Œä¸ºäº†è°ƒè¯•æ–¹ä¾¿ï¼Œæˆ‘åœ¨æœ¬æœºçš„Xcodeä¸‹è¿›è¡Œå¼€å‘ã€‚é€šè¿‡githubä½œä¸ºä¸­è½¬ï¼Œå°†æœ¬åœ°çš„ä¿®æ”¹commitåˆ°repositoryä¸Šã€‚æ‰‹åŠ¨åœ¨æœåŠ¡å™¨ç«¯fetchå¹¶æ‰§è¡Œã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œçš„è¯å½“å‰ç»ˆç«¯å°†è¢«ä»»åŠ¡é”å®šã€‚</p><h3>Dockeréƒ¨ç½²</h3><p>å¦å¤–ï¼ŒVaporçš„æ¨¡æ¿æœ¬èº«å·²ç»ç”Ÿæˆäº†Dockerfileã€‚ä¹Ÿå¯ä»¥ç›´æ¥å°†å®Œæˆåçš„é¡¹ç›®ç”ŸæˆDocker Imageã€‚è¿™ç§æ–¹å¼å¯ä»¥å°†é¡¹ç›®å‘å¸ƒåˆ°ä»»ä½•æ”¯æŒDockerçš„å¹³å°ï¼ˆmacã€Linuxã€windowsç­‰ï¼‰ã€‚ä¸è¿‡é€šå¸¸åªé€‚ç”¨äºå·²ç»å¼€å‘å®Œå–„åçš„éƒ¨ç½²ã€‚æ›´å¤šç»†èŠ‚å¯æŸ¥é˜…<a href="https://docs.vapor.codes/4.0/deploy/docker/">å®˜æ–¹æ–‡æ¡£</a></p><h3>Supervisior</h3><p>Vapor Toolbox å·²æä¾›äº†å¯¹ <a href="http://supervisord.org">Supervisior</a> çš„æ”¯æŒ,å¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡supervisoræ¥ç®¡ç†æœåŠ¡ã€‚</p><p>ubuntuä¸‹å®‰è£…Supervisor</p><pre data-language="bash"><code>sudo apt-get update
sudo apt-get install supervisor
</code></pre><p>æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ä¸ªé¡¹ç›®åˆ›å»ºä¸€ä¸ªsupervisoré…ç½®æ–‡ä»¶ã€‚åˆ›å»º/etc/supervisor/conf.d/hello.conf</p><pre data-language="bash"><code>[program:hello]
<span class="hljs-built_in">command</span>=/home/parallels/hello/.build/release/Run serve --env production
directory=/home/parallels/hello
user=parallels
stdout_logfile=/var/<span class="hljs-built_in">log</span>/supervisor/%(program_name)-stdout.log
stderr_logfile=/var/<span class="hljs-built_in">log</span>/supervisor/%(program_name)-stderr.log
</code></pre><p>æ–‡ä»¶åæ˜¯ä½ çš„é¡¹ç›®å.confï¼Œç›®å½•æŒ‡å‘ä½ é¡¹ç›®çš„æ ¹ç›®å½•å¹¶è®¾ç½®å¥½ç”¨æˆ·å</p><pre data-language="bash"><code><span class="hljs-built_in">command</span>=/home/parallels/hello/.build/release/Run serve --env production
</code></pre><p>éœ€ç¡®å®šå·²å°†é¡¹ç›®ç¼–è¯‘æˆreleaseç‰ˆæœ¬ï¼Œå¦‚æœvapor buildä¸å¥½ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p><pre data-language="bash"><code><span class="hljs-built_in">cd</span> ~/hello
swift build -c release
</code></pre><p>é€šè¿‡supervisorç®¡ç†é¡¹ç›®</p><pre data-language="bash"><code>supervisorctl reread
supervisorctl add hello
supervisorctl start hello
</code></pre><p>ä¹Ÿå¯ä»¥é€šè¿‡supervisorçš„é…ç½®æ¥æŒ‡å®šè¿è¡Œç«¯å£</p><p>åœ¨/etc/supervisor/conf.d/hello.confä¸­åŠ å…¥</p><pre data-language="bash"><code>environment=PORT=8123
</code></pre><p>ä¿®æ”¹ main.swift</p><pre data-language="swift"><code><span class="hljs-keyword">let</span> port = <span class="hljs-type">Environment</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">"PORT"</span>) ?? <span class="hljs-string">""</span>
app.http.server.configuration.port = <span class="hljs-type">Int</span>(port) ?? <span class="hljs-number">8080</span>
</code></pre><h2>ç»“è¯­</h2><p>å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¯¹ä½ å¼€å§‹ä½¿ç”¨Vapor4å¸¦æ¥ä¸€ç‚¹å¸®åŠ©ã€‚åŒæ—¶ä¹Ÿå¸Œæœ›swiftèƒ½åœ¨æ›´å¤šçš„å¹³å°ä¸Šæœ‰æ‰€è¡¨ç°ã€‚</p><p>swiftå·²æœ‰æ›´å¤šçš„å®˜æ–¹å¯¹windowæ”¯æŒçš„è¿¹è±¡ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/posts/first-post</guid><title>æ—¶éš”å¤šå¹´ï¼Œé‡æ–°åˆ›å»ºäº†åšå®¢</title><description>ç”¨Hexoåˆ›å»ºäº†ä¸€ä¸ªåšå®¢ï¼Œä¸»è¦è®°å½•è‡ªå·±åœ¨å¼€å‘å¥åº·ç¬”è®°è¿‡ç¨‹ä¸­çš„ä¸€ç‚¹å¿ƒå¾—å’ŒæŠ€æœ¯æ€»ç»“ã€‚</description><link>http://www.fatbobman.com/posts/first-post</link><pubDate>Thu, 30 Apr 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<p>ç”¨Hexoåˆ›å»ºäº†ä¸€ä¸ªåšå®¢ï¼Œä¸»è¦è®°å½•è‡ªå·±åœ¨å¼€å‘å¥åº·ç¬”è®°è¿‡ç¨‹ä¸­çš„ä¸€ç‚¹å¿ƒå¾—å’ŒæŠ€æœ¯æ€»ç»“ã€‚</p>]]></content:encoded></item><item><guid isPermaLink="true">http://www.fatbobman.com/project/healthnotes</guid><title>å¥åº·ç¬”è®°</title><description>å¥åº·ç¬”è®°æ˜¯ä¸€ä¸ªå¯ä»¥è®°å½•å’Œç®¡ç†å…¨å®¶äººèº«ä½“å¥åº·æ•°æ®çš„iOS appã€‚æ‹¥æœ‰å¤šäººç®¡ç†ã€å›¾è¡¨åˆ†æã€å¤šç§æ•°æ®ç±»å‹ã€éšç§ä¿æŠ¤ã€äº‘å­˜å‚¨ç­‰ç‰¹æ€§ã€‚</description><link>http://www.fatbobman.com/project/healthnotes</link><pubDate>Thu, 16 Jan 2020 12:00:00 +0800</pubDate><content:encoded><![CDATA[<h2>èµ·å› </h2><p>ä¹‹å‰ç”±äºèº«ä½“åŸå› ï¼Œæˆ‘æœ‰5å¹´å·¦å³çš„æ—¶é—´åŸºæœ¬ä¸Šéƒ½å¾…åœ¨å®¶é‡Œæå°‘å¤–å‡ºã€‚å› ä¸ºæ²»ç–—çš„éœ€è¦ï¼Œæ¯å¤©éƒ½è¦è®°å½•å¤§é‡çš„æ²»ç–—æ•°æ®ä»¥åŠç”¨è¯æƒ…å†µã€‚å¾ˆå¹¸è¿çš„æ˜¯ï¼Œæˆ‘çš„å¦»å­æ‰¿æ‹…äº†å…¶ä¸­å¤§éƒ¨åˆ†çš„å·¥ä½œï¼Œè½¬çœ¼ä¹‹é—´ä¾¿è®°å½•äº†å¥½å¤šä¸ªç¬”è®°æœ¬ã€‚</p><p>ç»è¿‡å‡ æ¬¡æ‰‹æœ¯å’Œæ²»ç–—ï¼Œæˆ‘çš„èº«ä½“å·²ç»æ¢å¤å¤§åŠï¼Œä½†ç”±äºä»è¦ç»ˆèº«æœè¯åŠå®šæœŸæ£€æŸ¥ï¼Œæ‰€ä»¥æ¯å¤©è¿˜æ˜¯è¦è®°å½•å¾ˆå¤šçš„èº«ä½“æŒ‡æ ‡ä»¥åŠå„ç§æ£€æŸ¥ã€æ£€éªŒæ•°æ®ã€‚</p><p>æˆ‘ä¹Ÿæ›¾å°è¯•ä½¿ç”¨ç”µå­è¡¨æ ¼æˆ–å…¶ä»–çš„ç”µè„‘å·¥å…·æ¥è¾…åŠ©è®°å½•ï¼Œä½†å¹¶ä¸æ–¹ä¾¿ã€‚è¯•å›¾å¯»æ‰¾ç›¸å…³çš„æ‰‹æœºåº”ç”¨ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°è´´åˆ‡çš„ã€‚</p><p>åœ¨è¿™æœŸé—´ï¼Œè‹¹æœæ‰‹æœºçš„å¥åº·åº”ç”¨å¯¹æˆ‘çš„å¸®åŠ©ä¸å°ã€‚ç”±äºä½¿ç”¨äº†æ”¯æŒè‡ªåŠ¨å¯¼å…¥æ•°æ®çš„ä¸€äº›æµ‹é‡è®¾å¤‡ï¼Œç±»ä¼¼ä½“é‡ã€ä½“æ¸©ã€ä½“è„‚ã€è¡€å‹ç­‰éƒ½ä¼šè‡ªåŠ¨çš„å¯¼å…¥åˆ°æ‰‹æœºä¸­ï¼Œå¸®åŠ©æˆ‘æ•´ç†å’Œåˆ†æã€‚</p><p>ä½†ç³»ç»Ÿçš„å¥åº·åº”ç”¨å¯ä»¥å½•å…¥çš„æ•°æ®ç§ç±»æ˜¯å›ºå®šçš„ï¼Œæˆ‘å¤§é‡æ—¥å¸¸çš„æ•°æ®å‡æ— æ³•é€šè¿‡å…¶å½•å…¥ã€‚</p><p>åœ¨èº«ä½“å¥½è½¬äº†çš„æƒ…å†µä¸‹ï¼Œæˆ‘å¼€å§‹è€ƒè™‘è‡ªå·±å¼€å‘ä¸€æ¬¾èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚çš„åº”ç”¨ã€‚ä½†æ¯•ç«Ÿå·²ç»10å¤šå¹´æ²¡æ¥è§¦ä»£ç äº†ï¼ŒçœŸæ­£å¼€å§‹å¯åŠ¨è¿™ä¸ªé¡¹ç›®è¿˜æ˜¯å¾ˆä¸‹äº†ä¸å°çš„å†³å¿ƒå’ŒåŠŸå¤«ã€‚</p><p>é€šè¿‡è¿‘åŠå¹´çš„å­¦ä¹ å’Œå¼€å‘ï¼Œå¥åº·ç¬”è®°ï¼ˆHealth Notesï¼‰å°±è¿™æ ·é€æ¸æœ‰äº†äº›æ¨¡æ ·ã€‚ç”±äºå—åˆ°ç³»ç»Ÿçš„å¥åº·åº”ç”¨å¾ˆå¤§çš„å½±å“ï¼Œå¥åº·ç¬”è®°é‡Œçš„å¾ˆå¤šå¸ƒå±€éƒ½å’Œå…¶éƒ½æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚</p><p>2020å¹´,å¥åº·ç¬”è®°2.0å‘å¸ƒäº†. 2.0ç‰ˆåšå‡ºäº†é‡å¤§çš„å‡çº§.</p><h2>å¥åº·ç¬”è®°ä¸»è¦çš„ç‰¹ç‚¹</h2><ul><li>å¤šç¬”è®°ç®¡ç† å¯é’ˆå¯¹ä¸åŒç”¨é€”ã€ä¸åŒäººç¾¤çš„æ•°æ®åˆ†å¼€è®°å½•ã€‚å…è®¸ç”¨æˆ·åˆ›å»ºå¤šä¸ªç¬”è®°æœ¬ï¼Œæ–¹ä¾¿æ‚¨æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œå½’çº³ã€‚</li><li>å¯éšæ„è‡ªå®šä¹‰æ¡ç›®ä½¿ç”¨è€…å¯åœ¨å¥åº·ç¬”è®°ä¸­è®°å½•å¤šç§ç±»å‹çš„æ•°æ®ã€‚èƒ½å¤Ÿæ»¡è¶³ä½ ç”Ÿæ´»ä¸­ç»å¤§å¤šæ•°æƒ…å†µä¸‹çš„éœ€è¦ã€‚ æ¯ä¸ªäººæ‰€é¢å¯¹çš„æ•°æ®å†…å®¹éƒ½æœ‰æå¤§çš„ä¸åŒï¼Œæ— è®ºæ€ä¹ˆä¸“ä¸šçš„æœºæ„éƒ½æ— æ³•å®Œå…¨æ¶µç›–ç”¨æˆ·æ‰€éœ€è¦é¢å¯¹çš„æ•°æ®ç§ç±»ã€‚å¥åº·ç¬”è®°å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ¡ç›®å†…å®¹ï¼Œæ‚¨å¯ä»¥ä»»æ„åˆ›å»ºè‡ªå·±æ‰€éœ€çš„å¥åº·æ•°æ®æ¡ç›®ã€‚</li><li>å®Œå–„çš„å›¾è¡¨æœºåˆ¶ 2.0æ–°å¢äº†æ›´å¤šçš„å›¾è¡¨æ˜¾ç¤ºæ–¹å¼å·²åº”å¯¹æ›´å¤šçš„æ•°æ®ç§ç±»</li><li>ä¸ä»…è®°å½•æ•°æ® å¥åº·ç¬”è®°åŒæ—¶æä¾›å®Œå–„çš„æ–‡å­—è®°å½•èƒ½åŠ›ï¼Œæ— è®ºæ˜¯å¯¹ä¸ªåˆ«æ•°æ®çš„å•ç‹¬å¤‡æ³¨è¿˜æ˜¯è®°å½•ç”Ÿæ´»ä¸­çš„å¤§äº‹å°æƒ…ï¼Œéƒ½å¯è½»æ¾åº”å¯¹ã€‚</li><li>å¯¹è‡ªå·±çš„æ•°æ®æœ‰ç»å¯¹çš„æ§åˆ¶æƒ å¥åº·ç¬”è®°å¯å°†ç”¨æˆ·å½•å…¥çš„æ•°æ®æŒ‰éœ€å¯¼å‡ºã€‚é€šè¿‡å¯¼å‡ºæˆxls,csvæ ¼å¼çš„æ–‡ä»¶ä¾›å…¶ä»–è½¯ä»¶ä½¿ç”¨ã€‚</li><li>äº‘å­˜å‚¨ï¼Œæ•°æ®æ°¸ä¹…ä¿å­˜ æ•°æ®ä¿å­˜åœ¨äº‘æœåŠ¡å™¨ä¸Šï¼ŒåŒæ—¶æ”¯æŒå¤šæœºåŒæ­¥ï¼Œæ•°æ®å®‰å…¨æœ‰ä¿éšœã€‚</li><li>iPadçš„å…¨é¢ä¼˜åŒ–æ–¹ä¾¿ä½¿ç”¨è€…æ›´å¥½çš„åˆ©ç”¨iPadçš„å±å¹•ä¼˜åŠ¿ï¼Œæ•°æ®ç®¡ç†æ›´åŠ è½»æ¾ å¸Œæœ›ä½ ä»¬å°†æ›´å¤šçš„æ„è§å’Œå»ºè®®æ›´å¤šçš„åé¦ˆç»™æˆ‘ï¼Œå¸®åŠ©å¥åº·ç¬”è®°æ›´å¥½çš„æˆé•¿ã€‚</li></ul><p>åœ¨è¿™é‡Œå¯ä»¥ä¸‹è½½ <a href="https://apps.apple.com/us/app/health-notes-2/id1534513553"><img src="http://cdn.fatbobman.com/appStoreIcon.svg" alt="pic"/></a></p>]]></content:encoded></item></channel></rss>